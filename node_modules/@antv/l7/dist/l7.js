!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("mapbox-gl")):"function"==typeof define&&define.amd?define(["exports","mapbox-gl"],t):t((e=e||self).L7={},e.mapboxgl)}(this,(function(e,t){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var n,r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function o(e,t){return e(t={exports:{}},t.exports),t.exports
/*! *****************************************************************************
	Copyright (C) Microsoft. All rights reserved.
	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
	this file except in compliance with the License. You may obtain a copy of the
	License at http://www.apache.org/licenses/LICENSE-2.0

	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
	MERCHANTABLITY OR NON-INFRINGEMENT.

	See the Apache Version 2.0 License for specific language governing permissions
	and limitations under the License.
	***************************************************************************** */}!function(e){!function(t){var n="object"==typeof r?r:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),i=o(e);function o(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0===n.Reflect?n.Reflect=e:i=o(n.Reflect,i),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,s=!o&&!a,u={create:o?function(){return P(Object.create(null))}:a?function(){return P({__proto__:null})}:function(){return P({})},has:s?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:s?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},c=Object.getPrototypeOf(Function),l="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,f=l||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,o)},t.prototype.entries=function(){return new n(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function o(e,t){return t}function a(e,t){return[e,t]}}():Map,h=l||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new f}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}():Set,d=new(l||"function"!=typeof WeakMap?function(){var e=u.create(),n=r();return function(){function e(){this._key=r()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=r()},e}();function r(){var t;do{t="@@WeakMap@@"+a()}while(u.has(e,t));return e[t]=!0,t}function i(e,r){if(!t.call(e,n)){if(!r)return;Object.defineProperty(e,n,{value:u.create()})}return e[n]}function o(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function a(){var e,t=(e=16,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):o(new Uint8Array(e),e):o(new Array(e),e));t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<16;++r){var i=t[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}():WeakMap);function p(e,t,n){var r=d.get(e);if(_(r)){if(!n)return;r=new f,d.set(e,r)}var i=r.get(t);if(_(i)){if(!n)return;i=new f,r.set(t,i)}return i}function v(e,t,n){var r=p(t,n,!1);return!_(r)&&!!r.has(e)}function g(e,t,n){var r=p(t,n,!1);if(!_(r))return r.get(e)}function m(e,t,n,r){p(n,r,!0).set(e,t)}function y(e,t){var n=[],r=p(e,t,!1);if(_(r))return n;for(var o=function(e){var t=M(e,i);if(!E(t))throw new TypeError;var n=t.call(e);if(!S(n))throw new TypeError;return n}(r.keys()),a=0;;){var s=k(o);if(!s)return n.length=a,n;var u=s.value;try{n[a]=u}catch(e){try{O(o)}finally{throw e}}a++}}function b(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function _(e){return void 0===e}function x(e){return null===e}function S(e){return"object"==typeof e?null!==e:"function"==typeof e}function w(e,t){switch(b(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",i=M(e,r);if(void 0!==i){var o=i.call(e,n);if(S(o))throw new TypeError;return o}return function(e,t){if("string"===t){var n=e.toString;if(E(n))if(!S(i=n.call(e)))return i;if(E(r=e.valueOf))if(!S(i=r.call(e)))return i}else{var r;if(E(r=e.valueOf))if(!S(i=r.call(e)))return i;var i,o=e.toString;if(E(o))if(!S(i=o.call(e)))return i}throw new TypeError}(e,"default"===n?"number":n)}function A(e){var t=w(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function T(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function E(e){return"function"==typeof e}function C(e){return"function"==typeof e}function M(e,t){var n=e[t];if(null!=n){if(!E(n))throw new TypeError;return n}}function k(e){var t=e.next();return!t.done&&t}function O(e){var t=e.return;t&&t.call(e)}function I(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===c)return t;if(t!==c)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return"function"!=typeof i||i===e?t:i}function P(e){return e.__=void 0,delete e.__,e}e("decorate",(function(e,t,n,r){if(_(n)){if(!T(e))throw new TypeError;if(!C(t))throw new TypeError;return function(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!_(r)&&!x(r)){if(!C(r))throw new TypeError;t=r}}return t}(e,t)}if(!T(e))throw new TypeError;if(!S(t))throw new TypeError;if(!S(r)&&!_(r)&&!x(r))throw new TypeError;return x(r)&&(r=void 0),function(e,t,n,r){for(var i=e.length-1;i>=0;--i){var o=(0,e[i])(t,n,r);if(!_(o)&&!x(o)){if(!S(o))throw new TypeError;r=o}}return r}(e,t,n=A(n),r)})),e("metadata",(function(e,t){return function(n,r){if(!S(n))throw new TypeError;if(!_(r)&&!function(e){switch(b(e)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;m(e,t,n,r)}})),e("defineMetadata",(function(e,t,n,r){if(!S(n))throw new TypeError;return _(r)||(r=A(r)),m(e,t,n,r)})),e("hasMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return _(n)||(n=A(n)),function e(t,n,r){if(v(t,n,r))return!0;var i=I(n);return!x(i)&&e(t,i,r)}(e,t,n)})),e("hasOwnMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return _(n)||(n=A(n)),v(e,t,n)})),e("getMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return _(n)||(n=A(n)),function e(t,n,r){if(v(t,n,r))return g(t,n,r);var i=I(n);return x(i)?void 0:e(t,i,r)}(e,t,n)})),e("getOwnMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return _(n)||(n=A(n)),g(e,t,n)})),e("getMetadataKeys",(function(e,t){if(!S(e))throw new TypeError;return _(t)||(t=A(t)),function e(t,n){var r=y(t,n),i=I(t);if(null===i)return r;var o=e(i,n);if(o.length<=0)return r;if(r.length<=0)return o;for(var a=new h,s=[],u=0,c=r;u<c.length;u++){var l=c[u];a.has(l)||(a.add(l),s.push(l))}for(var f=0,d=o;f<d.length;f++){l=d[f];a.has(l)||(a.add(l),s.push(l))}return s}(e,t)})),e("getOwnMetadataKeys",(function(e,t){if(!S(e))throw new TypeError;return _(t)||(t=A(t)),y(e,t)})),e("deleteMetadata",(function(e,t,n){if(!S(t))throw new TypeError;_(n)||(n=A(n));var r=p(t,n,!1);if(_(r))return!1;if(!r.delete(e))return!1;if(r.size>0)return!0;var i=d.get(t);return i.delete(n),i.size>0||d.delete(t),!0}))}(i)}()}(n||(n={}));var a=o((function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||e,a),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var u,c,l=this._events[s],f=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),f){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,i),!0;case 5:return l.fn.call(l.context,t,r,i,o),!0;case 6:return l.fn.call(l.context,t,r,i,o,a),!0}for(c=1,u=new Array(f-1);c<f;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var h,d=l.length;for(c=0;c<d;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),f){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,r);break;case 4:l[c].fn.call(l[c].context,t,r,i);break;default:if(!u)for(h=1,u=new Array(f-1);h<f;h++)u[h-1]=arguments[h];l[c].fn.apply(l[c].context,u)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var u=0,c=[],l=s.length;u<l;u++)(s[u].fn!==t||i&&!s[u].once||r&&s[u].context!==r)&&c.push(s[u]);c.length?this._events[o]=1===c.length?c[0]:c:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s})),s=a.EventEmitter,u=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NON_CUSTOM_TAG_KEYS=t.POST_CONSTRUCT=t.DESIGN_PARAM_TYPES=t.PARAM_TYPES=t.TAGGED_PROP=t.TAGGED=t.MULTI_INJECT_TAG=t.INJECT_TAG=t.OPTIONAL_TAG=t.UNMANAGED_TAG=t.NAME_TAG=t.NAMED_TAG=void 0,t.NAMED_TAG="named",t.NAME_TAG="name",t.UNMANAGED_TAG="unmanaged",t.OPTIONAL_TAG="optional",t.INJECT_TAG="inject",t.MULTI_INJECT_TAG="multi_inject",t.TAGGED="inversify:tagged",t.TAGGED_PROP="inversify:tagged_props",t.PARAM_TYPES="inversify:paramtypes",t.DESIGN_PARAM_TYPES="design:paramtypes",t.POST_CONSTRUCT="post_construct",t.NON_CUSTOM_TAG_KEYS=[t.INJECT_TAG,t.MULTI_INJECT_TAG,t.NAME_TAG,t.UNMANAGED_TAG,t.NAMED_TAG,t.OPTIONAL_TAG]}));i(u);u.NON_CUSTOM_TAG_KEYS,u.POST_CONSTRUCT,u.DESIGN_PARAM_TYPES,u.PARAM_TYPES,u.TAGGED_PROP,u.TAGGED,u.MULTI_INJECT_TAG,u.INJECT_TAG,u.OPTIONAL_TAG,u.UNMANAGED_TAG,u.NAME_TAG,u.NAMED_TAG;var c=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TargetTypeEnum=t.BindingTypeEnum=t.BindingScopeEnum=void 0;t.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"};t.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};t.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"}}));i(c);c.TargetTypeEnum,c.BindingTypeEnum,c.BindingScopeEnum;var l=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.id=void 0;var n=0;t.id=function(){return n++}}));i(l);l.id;var f=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Binding=void 0;var n=function(){function e(e,t){this.id=l.id(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=c.BindingTypeEnum.Invalid,this.constraint=function(e){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var t=new e(this.serviceIdentifier,this.scope);return t.activated=t.scope===c.BindingScopeEnum.Singleton&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.cache=this.cache,t},e}();t.Binding=n}));i(f);f.Binding;var h=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.STACK_OVERFLOW=t.CIRCULAR_DEPENDENCY_IN_FACTORY=t.POST_CONSTRUCT_ERROR=t.MULTIPLE_POST_CONSTRUCT_METHODS=t.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=t.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=t.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=t.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=t.ARGUMENTS_LENGTH_MISMATCH=t.INVALID_DECORATOR_OPERATION=t.INVALID_TO_SELF_VALUE=t.INVALID_FUNCTION_BINDING=t.INVALID_MIDDLEWARE_RETURN=t.NO_MORE_SNAPSHOTS_AVAILABLE=t.INVALID_BINDING_TYPE=t.NOT_IMPLEMENTED=t.CIRCULAR_DEPENDENCY=t.UNDEFINED_INJECT_ANNOTATION=t.MISSING_INJECT_ANNOTATION=t.MISSING_INJECTABLE_ANNOTATION=t.NOT_REGISTERED=t.CANNOT_UNBIND=t.AMBIGUOUS_MATCH=t.KEY_NOT_FOUND=t.NULL_ARGUMENT=t.DUPLICATED_METADATA=t.DUPLICATED_INJECTABLE_DECORATOR=void 0,t.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",t.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",t.NULL_ARGUMENT="NULL argument",t.KEY_NOT_FOUND="Key Not Found",t.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",t.CANNOT_UNBIND="Could not unbind serviceIdentifier:",t.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",t.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",t.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";t.UNDEFINED_INJECT_ANNOTATION=function(e){return"@inject called with undefined this could mean that the class "+e+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},t.CIRCULAR_DEPENDENCY="Circular dependency found:",t.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",t.INVALID_BINDING_TYPE="Invalid binding type:",t.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",t.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",t.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",t.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",t.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";t.ARGUMENTS_LENGTH_MISMATCH=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"The number of constructor arguments in the derived class "+e[0]+" must be >= than the number of constructor arguments of its base class."},t.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",t.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",t.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",t.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",t.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";t.POST_CONSTRUCT_ERROR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"@postConstruct error in class "+e[0]+": "+e[1]};t.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"It looks like there is a circular dependency in one of the '"+e[0]+"' bindings. Please investigate bindings withservice identifier '"+e[1]+"'."},t.STACK_OVERFLOW="Maximum call stack size exceeded"}));i(h);h.STACK_OVERFLOW,h.CIRCULAR_DEPENDENCY_IN_FACTORY,h.POST_CONSTRUCT_ERROR,h.MULTIPLE_POST_CONSTRUCT_METHODS,h.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK,h.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE,h.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE,h.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT,h.ARGUMENTS_LENGTH_MISMATCH,h.INVALID_DECORATOR_OPERATION,h.INVALID_TO_SELF_VALUE,h.INVALID_FUNCTION_BINDING,h.INVALID_MIDDLEWARE_RETURN,h.NO_MORE_SNAPSHOTS_AVAILABLE,h.INVALID_BINDING_TYPE,h.NOT_IMPLEMENTED,h.CIRCULAR_DEPENDENCY,h.UNDEFINED_INJECT_ANNOTATION,h.MISSING_INJECT_ANNOTATION,h.MISSING_INJECTABLE_ANNOTATION,h.NOT_REGISTERED,h.CANNOT_UNBIND,h.AMBIGUOUS_MATCH,h.KEY_NOT_FOUND,h.NULL_ARGUMENT,h.DUPLICATED_METADATA,h.DUPLICATED_INJECTABLE_DECORATOR;var d=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataReader=void 0;var n=function(){function e(){}return e.prototype.getConstructorMetadata=function(e){return{compilerGeneratedMetadata:Reflect.getMetadata(u.PARAM_TYPES,e),userGeneratedMetadata:Reflect.getMetadata(u.TAGGED,e)||{}}},e.prototype.getPropertiesMetadata=function(e){return Reflect.getMetadata(u.TAGGED_PROP,e)||[]},e}();t.MetadataReader=n}));i(d);d.MetadataReader;var p=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingCount=void 0;t.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1}}));i(p);p.BindingCount;var v=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isStackOverflowExeption=void 0,t.isStackOverflowExeption=function(e){return e instanceof RangeError||e.message===h.STACK_OVERFLOW}}));i(v);v.isStackOverflowExeption;var g=o((function(e,t){function n(e){return"function"==typeof e?e.name:"symbol"==typeof e?e.toString():e}function r(e){if(e.name)return e.name;var t=e.toString(),n=t.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+t}Object.defineProperty(t,"__esModule",{value:!0}),t.circularDependencyToException=t.listMetadataForTarget=t.listRegisteredBindingsForServiceIdentifier=t.getServiceIdentifierAsString=t.getFunctionName=void 0,t.getServiceIdentifierAsString=n,t.listRegisteredBindingsForServiceIdentifier=function(e,t,n){var i="",o=n(e,t);return 0!==o.length&&(i="\nRegistered bindings:",o.forEach((function(e){var t="Object";null!==e.implementationType&&(t=r(e.implementationType)),i=i+"\n "+t,e.constraint.metaData&&(i=i+" - "+e.constraint.metaData)}))),i},t.circularDependencyToException=function e(t){t.childRequests.forEach((function(t){if(function e(t,n){return null!==t.parentRequest&&(t.parentRequest.serviceIdentifier===n||e(t.parentRequest,n))}(t,t.serviceIdentifier)){var r=function(e){return function e(t,r){void 0===r&&(r=[]);var i=n(t.serviceIdentifier);return r.push(i),null!==t.parentRequest?e(t.parentRequest,r):r}(e).reverse().join(" --\x3e ")}(t);throw new Error(h.CIRCULAR_DEPENDENCY+" "+r)}e(t)}))},t.listMetadataForTarget=function(e,t){if(t.isTagged()||t.isNamed()){var n="",r=t.getNamedTag(),i=t.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(e){n+=e.toString()+"\n"}))," "+e+"\n "+e+" - "+n}return" "+e},t.getFunctionName=r}));i(g);g.circularDependencyToException,g.listMetadataForTarget,g.listRegisteredBindingsForServiceIdentifier,g.getServiceIdentifierAsString,g.getFunctionName;var m=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Context=void 0;var n=function(){function e(e){this.id=l.id(),this.container=e}return e.prototype.addPlan=function(e){this.plan=e},e.prototype.setCurrentRequest=function(e){this.currentRequest=e},e}();t.Context=n}));i(m);m.Context;var y=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var n=function(){function e(e,t){this.key=e,this.value=t}return e.prototype.toString=function(){return this.key===u.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},e}();t.Metadata=n}));i(y);y.Metadata;var b=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Plan=void 0;var n=function(e,t){this.parentContext=e,this.rootRequest=t};t.Plan=n}));i(b);b.Plan;var _=o((function(e,t){function n(e,t,n,r,i){var o={},a="number"==typeof i,s=void 0!==i&&a?i.toString():n;if(a&&void 0!==n)throw new Error(h.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(e,t)&&(o=Reflect.getMetadata(e,t));var u=o[s];if(Array.isArray(u))for(var c=0,l=u;c<l.length;c++){var f=l[c];if(f.key===r.key)throw new Error(h.DUPLICATED_METADATA+" "+f.key.toString())}else u=[];u.push(r),o[s]=u,Reflect.defineMetadata(e,o,t)}function r(e,t){Reflect.decorate(e,t)}function i(e,t){return function(n,r){t(n,r,e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.tagProperty=t.tagParameter=t.decorate=void 0,t.tagParameter=function(e,t,r,i){n(u.TAGGED,e,t,i,r)},t.tagProperty=function(e,t,r){n(u.TAGGED_PROP,e.constructor,t,r)},t.decorate=function(e,t,n){"number"==typeof n?r([i(n,e)],t):"string"==typeof n?Reflect.decorate([e],t,n):r([e],t)}}));i(_);_.tagProperty,_.tagParameter,_.decorate;var x=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.inject=t.LazyServiceIdentifer=void 0;var n=function(){function e(e){this._cb=e}return e.prototype.unwrap=function(){return this._cb()},e}();t.LazyServiceIdentifer=n,t.inject=function(e){return function(t,n,r){if(void 0===e)throw new Error(h.UNDEFINED_INJECT_ANNOTATION(t.name));var i=new y.Metadata(u.INJECT_TAG,e);"number"==typeof r?_.tagParameter(t,n,r,i):_.tagProperty(t,n,i)}}}));i(x);x.inject,x.LazyServiceIdentifer;var S=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.QueryableString=void 0;var n=function(){function e(e){this.str=e}return e.prototype.startsWith=function(e){return 0===this.str.indexOf(e)},e.prototype.endsWith=function(e){var t,n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},e.prototype.contains=function(e){return-1!==this.str.indexOf(e)},e.prototype.equals=function(e){return this.str===e},e.prototype.value=function(){return this.str},e}();t.QueryableString=n}));i(S);S.QueryableString;var w=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Target=void 0;var n=function(){function e(e,t,n,r){this.id=l.id(),this.type=e,this.serviceIdentifier=n,this.name=new S.QueryableString(t||""),this.metadata=new Array;var i=null;"string"==typeof r?i=new y.Metadata(u.NAMED_TAG,r):r instanceof y.Metadata&&(i=r),null!==i&&this.metadata.push(i)}return e.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){if(n[t].key===e)return!0}return!1},e.prototype.isArray=function(){return this.hasTag(u.MULTI_INJECT_TAG)},e.prototype.matchesArray=function(e){return this.matchesTag(u.MULTI_INJECT_TAG)(e)},e.prototype.isNamed=function(){return this.hasTag(u.NAMED_TAG)},e.prototype.isTagged=function(){return this.metadata.some((function(e){return u.NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))}))},e.prototype.isOptional=function(){return this.matchesTag(u.OPTIONAL_TAG)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(e){return e.key===u.NAMED_TAG}))[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(e){return u.NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))})):null},e.prototype.matchesNamedTag=function(e){return this.matchesTag(u.NAMED_TAG)(e)},e.prototype.matchesTag=function(e){var t=this;return function(n){for(var r=0,i=t.metadata;r<i.length;r++){var o=i[r];if(o.key===e&&o.value===n)return!0}return!1}},e}();t.Target=n}));i(w);w.Target;var A=o((function(e,t){var n=r&&r.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};function i(e,t,r,i){var s=e.getConstructorMetadata(r),u=s.compilerGeneratedMetadata;if(void 0===u){var l=h.MISSING_INJECTABLE_ANNOTATION+" "+t+".";throw new Error(l)}var f=s.userGeneratedMetadata,d=Object.keys(f),p=0===r.length&&d.length>0,v=d.length>r.length,g=function(e,t,n,r,i){for(var a=[],s=0;s<i;s++){var u=o(s,e,t,n,r);null!==u&&a.push(u)}return a}(i,t,u,f,p||v?d.length:r.length),m=function e(t,r){for(var i=t.getPropertiesMetadata(r),o=[],s=Object.keys(i),u=0,l=s;u<l.length;u++){var f=l[u],h=i[f],d=a(i[f]),p=d.targetName||f,v=d.inject||d.multiInject,g=new w.Target(c.TargetTypeEnum.ClassProperty,p,v);g.metadata=h,o.push(g)}var m=Object.getPrototypeOf(r.prototype).constructor;if(m!==Object){var y=e(t,m);o=n(n([],o),y)}return o}(e,r);return n(n([],g),m)}function o(e,t,n,r,i){var o=i[e.toString()]||[],s=a(o),u=!0!==s.unmanaged,l=r[e],f=s.inject||s.multiInject;if((l=f||l)instanceof x.LazyServiceIdentifer&&(l=l.unwrap()),u){if(!t&&(l===Object||l===Function||void 0===l)){var d=h.MISSING_INJECT_ANNOTATION+" argument "+e+" in class "+n+".";throw new Error(d)}var p=new w.Target(c.TargetTypeEnum.ConstructorArgument,s.targetName,l);return p.metadata=o,p}return null}function a(e){var t={};return e.forEach((function(e){t[e.key.toString()]=e.value})),{inject:t[u.INJECT_TAG],multiInject:t[u.MULTI_INJECT_TAG],targetName:t[u.NAME_TAG],unmanaged:t[u.UNMANAGED_TAG]}}Object.defineProperty(t,"__esModule",{value:!0}),t.getFunctionName=t.getBaseClassDependencyCount=t.getDependencies=void 0,Object.defineProperty(t,"getFunctionName",{enumerable:!0,get:function(){return g.getFunctionName}}),t.getDependencies=function(e,t){return i(e,g.getFunctionName(t),t,!1)},t.getBaseClassDependencyCount=function e(t,n){var r=Object.getPrototypeOf(n.prototype).constructor;if(r!==Object){var o=i(t,g.getFunctionName(r),r,!0),a=o.map((function(e){return e.metadata.filter((function(e){return e.key===u.UNMANAGED_TAG}))})),s=[].concat.apply([],a).length,c=o.length-s;return c>0?c:e(t,r)}return 0}}));i(A);A.getFunctionName,A.getBaseClassDependencyCount,A.getDependencies;var T=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Request=void 0;var n=function(){function e(e,t,n,r,i){this.id=l.id(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=i,this.childRequests=[],this.bindings=Array.isArray(r)?r:[r],this.requestScope=null===n?new Map:null}return e.prototype.addChildRequest=function(t,n,r){var i=new e(t,this.parentContext,this,n,r);return this.childRequests.push(i),i},e}();t.Request=n}));i(T);T.Request;var E=o((function(e,t){function n(e){return e._bindingDictionary}function r(e,t,n,r,i,o){var a=e?u.MULTI_INJECT_TAG:u.INJECT_TAG,s=new y.Metadata(a,n),c=new w.Target(t,r,n,s);if(void 0!==i){var l=new y.Metadata(i,o);c.metadata.push(l)}return c}function i(e,t,n,r,i){var a=o(n.container,i.serviceIdentifier),s=[];return a.length===p.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof i.serviceIdentifier&&e.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(i.serviceIdentifier).toSelf(),a=o(n.container,i.serviceIdentifier)),s=t?a:a.filter((function(e){var t=new T.Request(e.serviceIdentifier,n,r,e,i);return e.constraint(t)})),function(e,t,n,r){switch(t.length){case p.BindingCount.NoBindingsAvailable:if(n.isOptional())return t;var i=g.getServiceIdentifierAsString(e),a=h.NOT_REGISTERED;throw a+=g.listMetadataForTarget(i,n),a+=g.listRegisteredBindingsForServiceIdentifier(r,i,o),new Error(a);case p.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return t;case p.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return t;i=g.getServiceIdentifierAsString(e),a=h.AMBIGUOUS_MATCH+" "+i;throw a+=g.listRegisteredBindingsForServiceIdentifier(r,i,o),new Error(a)}}(i.serviceIdentifier,s,i,n.container),s}function o(e,t){var r=[],i=n(e);return i.hasKey(t)?r=i.get(t):null!==e.parent&&(r=o(e.parent,t)),r}Object.defineProperty(t,"__esModule",{value:!0}),t.getBindingDictionary=t.createMockRequest=t.plan=void 0,t.getBindingDictionary=n,t.plan=function(e,t,n,o,a,s,u,l){void 0===l&&(l=!1);var f=new m.Context(t),d=r(n,o,a,"",s,u);try{return function e(t,n,r,o,a,s){var u,l;if(null===a){u=i(t,n,o,null,s),l=new T.Request(r,o,null,u,s);var f=new b.Plan(o,l);o.addPlan(f)}else u=i(t,n,o,a,s),l=a.addChildRequest(s.serviceIdentifier,u,s);u.forEach((function(n){var r=null;if(s.isArray())r=l.addChildRequest(n.serviceIdentifier,n,s);else{if(n.cache)return;r=l}if(n.type===c.BindingTypeEnum.Instance&&null!==n.implementationType){var i=A.getDependencies(t,n.implementationType);if(!o.container.options.skipBaseClassChecks){var a=A.getBaseClassDependencyCount(t,n.implementationType);if(i.length<a){var u=h.ARGUMENTS_LENGTH_MISMATCH(A.getFunctionName(n.implementationType));throw new Error(u)}}i.forEach((function(n){e(t,!1,n.serviceIdentifier,o,r,n)}))}}))}(e,l,a,f,null,d),f}catch(e){throw v.isStackOverflowExeption(e)&&f.plan&&g.circularDependencyToException(f.plan.rootRequest),e}},t.createMockRequest=function(e,t,n,r){var i=new w.Target(c.TargetTypeEnum.Variable,"",t,new y.Metadata(n,r)),o=new m.Context(e);return new T.Request(t,o,null,[],i)}}));i(E);E.getBindingDictionary,E.createMockRequest,E.plan;var C=o((function(e,t){var n=r&&r.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.resolveInstance=void 0,t.resolveInstance=function(e,t,r){var i,o,a=null;if(t.length>0){var s=t.filter((function(e){return null!==e.target&&e.target.type===c.TargetTypeEnum.ConstructorArgument})).map(r);o=s,a=function(e,t,n){var r=t.filter((function(e){return null!==e.target&&e.target.type===c.TargetTypeEnum.ClassProperty})),i=r.map(n);return r.forEach((function(t,n){var r;r=t.target.name.value();var o=i[n];e[r]=o})),e}(a=new((i=e).bind.apply(i,n([void 0],o))),t,r)}else a=new e;return function(e,t){if(Reflect.hasMetadata(u.POST_CONSTRUCT,e)){var n=Reflect.getMetadata(u.POST_CONSTRUCT,e);try{t[n.value]()}catch(t){throw new Error(h.POST_CONSTRUCT_ERROR(e.name,t.message))}}}(e,a),a}}));i(C);C.resolveInstance;var M=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.resolve=void 0;var n=function(e,t,n){try{return n()}catch(n){throw v.isStackOverflowExeption(n)?new Error(h.CIRCULAR_DEPENDENCY_IN_FACTORY(e,t.toString())):n}},r=function(e){return function(t){t.parentContext.setCurrentRequest(t);var i=t.bindings,o=t.childRequests,a=t.target&&t.target.isArray(),s=!(t.parentRequest&&t.parentRequest.target&&t.target&&t.parentRequest.target.matchesArray(t.target.serviceIdentifier));if(a&&s)return o.map((function(t){return r(e)(t)}));var u=null;if(!t.target.isOptional()||0!==i.length){var l=i[0],f=l.scope===c.BindingScopeEnum.Singleton,d=l.scope===c.BindingScopeEnum.Request;if(f&&l.activated)return l.cache;if(d&&null!==e&&e.has(l.id))return e.get(l.id);if(l.type===c.BindingTypeEnum.ConstantValue)u=l.cache,l.activated=!0;else if(l.type===c.BindingTypeEnum.Function)u=l.cache,l.activated=!0;else if(l.type===c.BindingTypeEnum.Constructor)u=l.implementationType;else if(l.type===c.BindingTypeEnum.DynamicValue&&null!==l.dynamicValue)u=n("toDynamicValue",l.serviceIdentifier,(function(){return l.dynamicValue(t.parentContext)}));else if(l.type===c.BindingTypeEnum.Factory&&null!==l.factory)u=n("toFactory",l.serviceIdentifier,(function(){return l.factory(t.parentContext)}));else if(l.type===c.BindingTypeEnum.Provider&&null!==l.provider)u=n("toProvider",l.serviceIdentifier,(function(){return l.provider(t.parentContext)}));else{if(l.type!==c.BindingTypeEnum.Instance||null===l.implementationType){var p=g.getServiceIdentifierAsString(t.serviceIdentifier);throw new Error(h.INVALID_BINDING_TYPE+" "+p)}u=C.resolveInstance(l.implementationType,o,r(e))}return"function"==typeof l.onActivation&&(u=l.onActivation(t.parentContext,u)),f&&(l.cache=u,l.activated=!0),d&&null!==e&&!e.has(l.id)&&e.set(l.id,u),u}}};t.resolve=function(e){return r(e.plan.rootRequest.requestScope)(e.plan.rootRequest)}}));i(M);M.resolve;var k=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.typeConstraint=t.namedConstraint=t.taggedConstraint=t.traverseAncerstors=void 0;var n=function(e,t){var r=e.parentRequest;return null!==r&&(!!t(r)||n(r,t))};t.traverseAncerstors=n;var r=function(e){return function(t){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(e)(t)};return n.metaData=new y.Metadata(e,t),n}};t.taggedConstraint=r;var i=r(u.NAMED_TAG);t.namedConstraint=i;t.typeConstraint=function(e){return function(t){var n=null;if(null!==t){if(n=t.bindings[0],"string"==typeof e)return n.serviceIdentifier===e;var r=t.bindings[0].implementationType;return e===r}return!1}}}));i(k);k.typeConstraint,k.namedConstraint,k.taggedConstraint,k.traverseAncerstors;var O=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingWhenSyntax=void 0;var n=function(){function e(e){this._binding=e}return e.prototype.when=function(e){return this._binding.constraint=e,new I.BindingOnSyntax(this._binding)},e.prototype.whenTargetNamed=function(e){return this._binding.constraint=k.namedConstraint(e),new I.BindingOnSyntax(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){return null!==e.target&&!e.target.isNamed()&&!e.target.isTagged()},new I.BindingOnSyntax(this._binding)},e.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=k.taggedConstraint(e)(t),new I.BindingOnSyntax(this._binding)},e.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return k.typeConstraint(e)(t.parentRequest)},new I.BindingOnSyntax(this._binding)},e.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return k.namedConstraint(e)(t.parentRequest)},new I.BindingOnSyntax(this._binding)},e.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return k.taggedConstraint(e)(t)(n.parentRequest)},new I.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return k.traverseAncerstors(t,k.typeConstraint(e))},new I.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return!k.traverseAncerstors(t,k.typeConstraint(e))},new I.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return k.traverseAncerstors(t,k.namedConstraint(e))},new I.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return!k.traverseAncerstors(t,k.namedConstraint(e))},new I.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return k.traverseAncerstors(n,k.taggedConstraint(e)(t))},new I.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return!k.traverseAncerstors(n,k.taggedConstraint(e)(t))},new I.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return k.traverseAncerstors(t,e)},new I.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return!k.traverseAncerstors(t,e)},new I.BindingOnSyntax(this._binding)},e}();t.BindingWhenSyntax=n}));i(O);O.BindingWhenSyntax;var I=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingOnSyntax=void 0;var n=function(){function e(e){this._binding=e}return e.prototype.onActivation=function(e){return this._binding.onActivation=e,new O.BindingWhenSyntax(this._binding)},e}();t.BindingOnSyntax=n}));i(I);I.BindingOnSyntax;var P=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingWhenOnSyntax=void 0;var n=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new O.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new I.BindingOnSyntax(this._binding)}return e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingWhenOnSyntax=n}));i(P);P.BindingWhenOnSyntax;var L=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingInSyntax=void 0;var n=function(){function e(e){this._binding=e}return e.prototype.inRequestScope=function(){return this._binding.scope=c.BindingScopeEnum.Request,new P.BindingWhenOnSyntax(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=c.BindingScopeEnum.Singleton,new P.BindingWhenOnSyntax(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=c.BindingScopeEnum.Transient,new P.BindingWhenOnSyntax(this._binding)},e}();t.BindingInSyntax=n}));i(L);L.BindingInSyntax;var R=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingInWhenOnSyntax=void 0;var n=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new O.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new I.BindingOnSyntax(this._binding),this._bindingInSyntax=new L.BindingInSyntax(e)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingInWhenOnSyntax=n}));i(R);R.BindingInWhenOnSyntax;var N=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingToSyntax=void 0;var n=function(){function e(e){this._binding=e}return e.prototype.to=function(e){return this._binding.type=c.BindingTypeEnum.Instance,this._binding.implementationType=e,new R.BindingInWhenOnSyntax(this._binding)},e.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+h.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},e.prototype.toConstantValue=function(e){return this._binding.type=c.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=c.BindingScopeEnum.Singleton,new P.BindingWhenOnSyntax(this._binding)},e.prototype.toDynamicValue=function(e){return this._binding.type=c.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new R.BindingInWhenOnSyntax(this._binding)},e.prototype.toConstructor=function(e){return this._binding.type=c.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=c.BindingScopeEnum.Singleton,new P.BindingWhenOnSyntax(this._binding)},e.prototype.toFactory=function(e){return this._binding.type=c.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=c.BindingScopeEnum.Singleton,new P.BindingWhenOnSyntax(this._binding)},e.prototype.toFunction=function(e){if("function"!=typeof e)throw new Error(h.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=c.BindingTypeEnum.Function,this._binding.scope=c.BindingScopeEnum.Singleton,t},e.prototype.toAutoFactory=function(e){return this._binding.type=c.BindingTypeEnum.Factory,this._binding.factory=function(t){return function(){return t.container.get(e)}},this._binding.scope=c.BindingScopeEnum.Singleton,new P.BindingWhenOnSyntax(this._binding)},e.prototype.toProvider=function(e){return this._binding.type=c.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=c.BindingScopeEnum.Singleton,new P.BindingWhenOnSyntax(this._binding)},e.prototype.toService=function(e){this.toDynamicValue((function(t){return t.container.get(e)}))},e}();t.BindingToSyntax=n}));i(N);N.BindingToSyntax;var D=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ContainerSnapshot=void 0;var n=function(){function e(){}return e.of=function(t,n){var r=new e;return r.bindings=t,r.middleware=n,r},e}();t.ContainerSnapshot=n}));i(D);D.ContainerSnapshot;var F=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Lookup=void 0;var n=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(e,t){if(null==e)throw new Error(h.NULL_ARGUMENT);if(null==t)throw new Error(h.NULL_ARGUMENT);var n=this._map.get(e);void 0!==n?(n.push(t),this._map.set(e,n)):this._map.set(e,[t])},e.prototype.get=function(e){if(null==e)throw new Error(h.NULL_ARGUMENT);var t=this._map.get(e);if(void 0!==t)return t;throw new Error(h.KEY_NOT_FOUND)},e.prototype.remove=function(e){if(null==e)throw new Error(h.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(h.KEY_NOT_FOUND)},e.prototype.removeByCondition=function(e){var t=this;this._map.forEach((function(n,r){var i=n.filter((function(t){return!e(t)}));i.length>0?t._map.set(r,i):t._map.delete(r)}))},e.prototype.hasKey=function(e){if(null==e)throw new Error(h.NULL_ARGUMENT);return this._map.has(e)},e.prototype.clone=function(){var t=new e;return this._map.forEach((function(e,n){e.forEach((function(e){return t.add(n,e.clone())}))})),t},e.prototype.traverse=function(e){this._map.forEach((function(t,n){e(n,t)}))},e}();t.Lookup=n}));i(F);F.Lookup;var z=o((function(e,t){var n=r&&r.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=r&&r.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=r&&r.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.Container=void 0;var a=function(){function e(e){this._appliedMiddleware=[];var t=e||{};if("object"!=typeof t)throw new Error(""+h.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===t.defaultScope)t.defaultScope=c.BindingScopeEnum.Transient;else if(t.defaultScope!==c.BindingScopeEnum.Singleton&&t.defaultScope!==c.BindingScopeEnum.Transient&&t.defaultScope!==c.BindingScopeEnum.Request)throw new Error(""+h.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===t.autoBindInjectable)t.autoBindInjectable=!1;else if("boolean"!=typeof t.autoBindInjectable)throw new Error(""+h.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===t.skipBaseClassChecks)t.skipBaseClassChecks=!1;else if("boolean"!=typeof t.skipBaseClassChecks)throw new Error(""+h.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=l.id(),this._bindingDictionary=new F.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new d.MetadataReader}return e.merge=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var a=new e,s=o([t,n],r).map((function(e){return E.getBindingDictionary(e)})),u=E.getBindingDictionary(a);function c(e,t){e.traverse((function(e,n){n.forEach((function(e){t.add(e.serviceIdentifier,e.clone())}))}))}return s.forEach((function(e){c(e,u)})),a},e.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=e;r<i.length;r++){var o=i[r],a=n(o.id);o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},e.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n(this,void 0,void 0,(function(){var t,n,r,o,a;return i(this,(function(i){switch(i.label){case 0:t=this._getContainerModuleHelpersFactory(),n=0,r=e,i.label=1;case 1:return n<r.length?(o=r[n],a=t(o.id),[4,o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)]):[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(e){return function(t){return t.moduleId===e}};t.forEach((function(t){var n=r(t.id);e._bindingDictionary.removeByCondition(n)}))},e.prototype.bind=function(e){var t=this.options.defaultScope||c.BindingScopeEnum.Transient,n=new f.Binding(e,t);return this._bindingDictionary.add(e,n),new N.BindingToSyntax(n)},e.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},e.prototype.unbind=function(e){try{this._bindingDictionary.remove(e)}catch(t){throw new Error(h.CANNOT_UNBIND+" "+g.getServiceIdentifierAsString(e))}},e.prototype.unbindAll=function(){this._bindingDictionary=new F.Lookup},e.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},e.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,u.NAMED_TAG,t)},e.prototype.isBoundTagged=function(e,t,n){var r=!1;if(this._bindingDictionary.hasKey(e)){var i=this._bindingDictionary.get(e),o=E.createMockRequest(this,e,t,n);r=i.some((function(e){return e.constraint(o)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(e,t,n)),r},e.prototype.snapshot=function(){this._snapshots.push(D.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},e.prototype.restore=function(){var e=this._snapshots.pop();if(void 0===e)throw new Error(h.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._middleware=e.middleware},e.prototype.createChild=function(t){var n=new e(t||this.options);return n.parent=this,n},e.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._appliedMiddleware=this._appliedMiddleware.concat(e);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce((function(e,t){return t(e)}),n)},e.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},e.prototype.get=function(e){return this._get(!1,!1,c.TargetTypeEnum.Variable,e)},e.prototype.getTagged=function(e,t,n){return this._get(!1,!1,c.TargetTypeEnum.Variable,e,t,n)},e.prototype.getNamed=function(e,t){return this.getTagged(e,u.NAMED_TAG,t)},e.prototype.getAll=function(e){return this._get(!0,!0,c.TargetTypeEnum.Variable,e)},e.prototype.getAllTagged=function(e,t,n){return this._get(!1,!0,c.TargetTypeEnum.Variable,e,t,n)},e.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,u.NAMED_TAG,t)},e.prototype.resolve=function(e){var t=this.createChild();return t.bind(e).toSelf(),this._appliedMiddleware.forEach((function(e){t.applyMiddleware(e)})),t.get(e)},e.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(e,t){e._binding.moduleId=t},n=function(n){return function(r){var i=e.rebind.bind(e)(r);return t(i,n),i}};return function(r){return{bindFunction:(i=r,function(n){var r=e.bind.bind(e)(n);return t(r,i),r}),isboundFunction:function(t){return e.isBound.bind(e)(t)},rebindFunction:n(r),unbindFunction:function(t){e.unbind.bind(e)(t)}};var i}},e.prototype._get=function(e,t,n,r,i,o){var a=null,s={avoidConstraints:e,contextInterceptor:function(e){return e},isMultiInject:t,key:i,serviceIdentifier:r,targetType:n,value:o};if(this._middleware){if(null==(a=this._middleware(s)))throw new Error(h.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(s);return a},e.prototype._planAndResolve=function(){var e=this;return function(t){var n=E.plan(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);return n=t.contextInterceptor(n),M.resolve(n)}},e}();t.Container=a}));i(z);z.Container;var j=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncContainerModule=t.ContainerModule=void 0;var n=function(e){this.id=l.id(),this.registry=e};t.ContainerModule=n;var r=function(e){this.id=l.id(),this.registry=e};t.AsyncContainerModule=r}));i(j);j.AsyncContainerModule,j.ContainerModule;var U=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.injectable=void 0,t.injectable=function(){return function(e){if(Reflect.hasOwnMetadata(u.PARAM_TYPES,e))throw new Error(h.DUPLICATED_INJECTABLE_DECORATOR);var t=Reflect.getMetadata(u.DESIGN_PARAM_TYPES,e)||[];return Reflect.defineMetadata(u.PARAM_TYPES,t,e),e}}}));i(U);U.injectable;var B=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.tagged=void 0,t.tagged=function(e,t){return function(n,r,i){var o=new y.Metadata(e,t);"number"==typeof i?_.tagParameter(n,r,i,o):_.tagProperty(n,r,o)}}}));i(B);B.tagged;var V=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.named=void 0,t.named=function(e){return function(t,n,r){var i=new y.Metadata(u.NAMED_TAG,e);"number"==typeof r?_.tagParameter(t,n,r,i):_.tagProperty(t,n,i)}}}));i(V);V.named;var H=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.optional=void 0,t.optional=function(){return function(e,t,n){var r=new y.Metadata(u.OPTIONAL_TAG,!0);"number"==typeof n?_.tagParameter(e,t,n,r):_.tagProperty(e,t,r)}}}));i(H);H.optional;var G=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.unmanaged=void 0,t.unmanaged=function(){return function(e,t,n){var r=new y.Metadata(u.UNMANAGED_TAG,!0);_.tagParameter(e,t,n,r)}}}));i(G);G.unmanaged;var W=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.multiInject=void 0,t.multiInject=function(e){return function(t,n,r){var i=new y.Metadata(u.MULTI_INJECT_TAG,e);"number"==typeof r?_.tagParameter(t,n,r,i):_.tagProperty(t,n,i)}}}));i(W);W.multiInject;var Z=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.targetName=void 0,t.targetName=function(e){return function(t,n,r){var i=new y.Metadata(u.NAME_TAG,e);_.tagParameter(t,n,r,i)}}}));i(Z);Z.targetName;var Y=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.postConstruct=void 0,t.postConstruct=function(){return function(e,t,n){var r=new y.Metadata(u.POST_CONSTRUCT,t);if(Reflect.hasOwnMetadata(u.POST_CONSTRUCT,e.constructor))throw new Error(h.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(u.POST_CONSTRUCT,r,e.constructor)}}}));i(Y);Y.postConstruct;var q=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.multiBindToService=void 0;t.multiBindToService=function(e){return function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(n){return e.bind(n).toService(t)}))}}}}));i(q);q.multiBindToService;var X=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.multiBindToService=t.getServiceIdentifierAsString=t.typeConstraint=t.namedConstraint=t.taggedConstraint=t.traverseAncerstors=t.decorate=t.id=t.MetadataReader=t.postConstruct=t.targetName=t.multiInject=t.unmanaged=t.optional=t.LazyServiceIdentifer=t.inject=t.named=t.tagged=t.injectable=t.ContainerModule=t.AsyncContainerModule=t.TargetTypeEnum=t.BindingTypeEnum=t.BindingScopeEnum=t.Container=t.METADATA_KEY=void 0,t.METADATA_KEY=u,Object.defineProperty(t,"Container",{enumerable:!0,get:function(){return z.Container}}),Object.defineProperty(t,"BindingScopeEnum",{enumerable:!0,get:function(){return c.BindingScopeEnum}}),Object.defineProperty(t,"BindingTypeEnum",{enumerable:!0,get:function(){return c.BindingTypeEnum}}),Object.defineProperty(t,"TargetTypeEnum",{enumerable:!0,get:function(){return c.TargetTypeEnum}}),Object.defineProperty(t,"AsyncContainerModule",{enumerable:!0,get:function(){return j.AsyncContainerModule}}),Object.defineProperty(t,"ContainerModule",{enumerable:!0,get:function(){return j.ContainerModule}}),Object.defineProperty(t,"injectable",{enumerable:!0,get:function(){return U.injectable}}),Object.defineProperty(t,"tagged",{enumerable:!0,get:function(){return B.tagged}}),Object.defineProperty(t,"named",{enumerable:!0,get:function(){return V.named}}),Object.defineProperty(t,"inject",{enumerable:!0,get:function(){return x.inject}}),Object.defineProperty(t,"LazyServiceIdentifer",{enumerable:!0,get:function(){return x.LazyServiceIdentifer}}),Object.defineProperty(t,"optional",{enumerable:!0,get:function(){return H.optional}}),Object.defineProperty(t,"unmanaged",{enumerable:!0,get:function(){return G.unmanaged}}),Object.defineProperty(t,"multiInject",{enumerable:!0,get:function(){return W.multiInject}}),Object.defineProperty(t,"targetName",{enumerable:!0,get:function(){return Z.targetName}}),Object.defineProperty(t,"postConstruct",{enumerable:!0,get:function(){return Y.postConstruct}}),Object.defineProperty(t,"MetadataReader",{enumerable:!0,get:function(){return d.MetadataReader}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return l.id}}),Object.defineProperty(t,"decorate",{enumerable:!0,get:function(){return _.decorate}}),Object.defineProperty(t,"traverseAncerstors",{enumerable:!0,get:function(){return k.traverseAncerstors}}),Object.defineProperty(t,"taggedConstraint",{enumerable:!0,get:function(){return k.taggedConstraint}}),Object.defineProperty(t,"namedConstraint",{enumerable:!0,get:function(){return k.namedConstraint}}),Object.defineProperty(t,"typeConstraint",{enumerable:!0,get:function(){return k.typeConstraint}}),Object.defineProperty(t,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return g.getServiceIdentifierAsString}}),Object.defineProperty(t,"multiBindToService",{enumerable:!0,get:function(){return q.multiBindToService}})}));i(X);X.multiBindToService,X.getServiceIdentifierAsString,X.typeConstraint,X.namedConstraint,X.taggedConstraint,X.traverseAncerstors;var K=X.decorate,Q=(X.id,X.MetadataReader,X.postConstruct),J=(X.targetName,X.multiInject,X.unmanaged,X.optional,X.LazyServiceIdentifer,X.inject),$=(X.named,X.tagged,X.injectable),ee=(X.ContainerModule,X.AsyncContainerModule,X.TargetTypeEnum,X.BindingTypeEnum,X.BindingScopeEnum,X.Container),te=(X.METADATA_KEY,o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=Symbol.for("INJECTION");function r(e,t,r,i){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){return i&&!Reflect.hasMetadata(n,this,t)&&Reflect.defineMetadata(n,r(),this,t),Reflect.hasMetadata(n,this,t)?Reflect.getMetadata(n,this,t):r()},set:function(e){Reflect.defineMetadata(n,e,this,t)}})}t.makePropertyInjectDecorator=function(e,t){return function(n){return function(i,o){r(i,o,(function(){return e.get(n)}),t)}}},t.makePropertyInjectNamedDecorator=function(e,t){return function(n,i){return function(o,a){r(o,a,(function(){return e.getNamed(n,i)}),t)}}},t.makePropertyInjectTaggedDecorator=function(e,t){return function(n,i,o){return function(a,s){r(a,s,(function(){return e.getTagged(n,i,o)}),t)}}},t.makePropertyMultiInjectDecorator=function(e,t){return function(n){return function(i,o){r(i,o,(function(){return e.getAll(n)}),t)}}}})));i(te);te.makePropertyInjectDecorator,te.makePropertyInjectNamedDecorator,te.makePropertyInjectTaggedDecorator,te.makePropertyMultiInjectDecorator;var ne=i(o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return void 0===t&&(t=!0),{lazyInject:te.makePropertyInjectDecorator(e,t),lazyInjectNamed:te.makePropertyInjectNamedDecorator(e,t),lazyInjectTagged:te.makePropertyInjectTaggedDecorator(e,t),lazyMultiInject:te.makePropertyMultiInjectDecorator(e,t)}}}))),re=function(e){return e&&e.Math==Math&&e},ie=re("object"==typeof globalThis&&globalThis)||re("object"==typeof window&&window)||re("object"==typeof self&&self)||re("object"==typeof r&&r)||function(){return this}()||Function("return this")(),oe=function(e){try{return!!e()}catch(e){return!0}},ae=!oe((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),se={}.propertyIsEnumerable,ue=Object.getOwnPropertyDescriptor,ce={f:ue&&!se.call({1:2},1)?function(e){var t=ue(this,e);return!!t&&t.enumerable}:se},le=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},fe={}.toString,he=function(e){return fe.call(e).slice(8,-1)},de="".split,pe=oe((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==he(e)?de.call(e,""):Object(e)}:Object,ve=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},ge=function(e){return pe(ve(e))},me=function(e){return"object"==typeof e?null!==e:"function"==typeof e},ye=function(e,t){if(!me(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!me(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!me(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!me(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},be=function(e){return Object(ve(e))},_e={}.hasOwnProperty,xe=Object.hasOwn||function(e,t){return _e.call(be(e),t)},Se=ie.document,we=me(Se)&&me(Se.createElement),Ae=function(e){return we?Se.createElement(e):{}},Te=!ae&&!oe((function(){return 7!=Object.defineProperty(Ae("div"),"a",{get:function(){return 7}}).a})),Ee=Object.getOwnPropertyDescriptor,Ce={f:ae?Ee:function(e,t){if(e=ge(e),t=ye(t,!0),Te)try{return Ee(e,t)}catch(e){}if(xe(e,t))return le(!ce.f.call(e,t),e[t])}},Me=function(e){if(!me(e))throw TypeError(String(e)+" is not an object");return e},ke=Object.defineProperty,Oe={f:ae?ke:function(e,t,n){if(Me(e),t=ye(t,!0),Me(n),Te)try{return ke(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},Ie=ae?function(e,t,n){return Oe.f(e,t,le(1,n))}:function(e,t,n){return e[t]=n,e},Pe=function(e,t){try{Ie(ie,e,t)}catch(n){ie[e]=t}return t},Le=ie["__core-js_shared__"]||Pe("__core-js_shared__",{}),Re=Function.toString;"function"!=typeof Le.inspectSource&&(Le.inspectSource=function(e){return Re.call(e)});var Ne,De,Fe,ze=Le.inspectSource,je=ie.WeakMap,Ue="function"==typeof je&&/native code/.test(ze(je)),Be=o((function(e){(e.exports=function(e,t){return Le[e]||(Le[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.15.2",mode:"global",copyright:" 2021 Denis Pushkarev (zloirock.ru)"})})),Ve=0,He=Math.random(),Ge=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++Ve+He).toString(36)},We=Be("keys"),Ze=function(e){return We[e]||(We[e]=Ge(e))},Ye={},qe=ie.WeakMap;if(Ue||Le.state){var Xe=Le.state||(Le.state=new qe),Ke=Xe.get,Qe=Xe.has,Je=Xe.set;Ne=function(e,t){if(Qe.call(Xe,e))throw new TypeError("Object already initialized");return t.facade=e,Je.call(Xe,e,t),t},De=function(e){return Ke.call(Xe,e)||{}},Fe=function(e){return Qe.call(Xe,e)}}else{var $e=Ze("state");Ye[$e]=!0,Ne=function(e,t){if(xe(e,$e))throw new TypeError("Object already initialized");return t.facade=e,Ie(e,$e,t),t},De=function(e){return xe(e,$e)?e[$e]:{}},Fe=function(e){return xe(e,$e)}}var et,tt,nt={set:Ne,get:De,has:Fe,enforce:function(e){return Fe(e)?De(e):Ne(e,{})},getterFor:function(e){return function(t){var n;if(!me(t)||(n=De(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},rt=o((function(e){var t=nt.get,n=nt.enforce,r=String(String).split("String");(e.exports=function(e,t,i,o){var a,s=!!o&&!!o.unsafe,u=!!o&&!!o.enumerable,c=!!o&&!!o.noTargetGet;"function"==typeof i&&("string"!=typeof t||xe(i,"name")||Ie(i,"name",t),(a=n(i)).source||(a.source=r.join("string"==typeof t?t:""))),e!==ie?(s?!c&&e[t]&&(u=!0):delete e[t],u?e[t]=i:Ie(e,t,i)):u?e[t]=i:Pe(t,i)})(Function.prototype,"toString",(function(){return"function"==typeof this&&t(this).source||ze(this)}))})),it=ie,ot=function(e){return"function"==typeof e?e:void 0},at=function(e,t){return arguments.length<2?ot(it[e])||ot(ie[e]):it[e]&&it[e][t]||ie[e]&&ie[e][t]},st=Math.ceil,ut=Math.floor,ct=function(e){return isNaN(e=+e)?0:(e>0?ut:st)(e)},lt=Math.min,ft=function(e){return e>0?lt(ct(e),9007199254740991):0},ht=Math.max,dt=Math.min,pt=function(e,t){var n=ct(e);return n<0?ht(n+t,0):dt(n,t)},vt=function(e){return function(t,n,r){var i,o=ge(t),a=ft(o.length),s=pt(r,a);if(e&&n!=n){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===n)return e||s||0;return!e&&-1}},gt={includes:vt(!0),indexOf:vt(!1)},mt=gt.indexOf,yt=function(e,t){var n,r=ge(e),i=0,o=[];for(n in r)!xe(Ye,n)&&xe(r,n)&&o.push(n);for(;t.length>i;)xe(r,n=t[i++])&&(~mt(o,n)||o.push(n));return o},bt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],_t=bt.concat("length","prototype"),xt={f:Object.getOwnPropertyNames||function(e){return yt(e,_t)}},St={f:Object.getOwnPropertySymbols},wt=at("Reflect","ownKeys")||function(e){var t=xt.f(Me(e)),n=St.f;return n?t.concat(n(e)):t},At=function(e,t){for(var n=wt(t),r=Oe.f,i=Ce.f,o=0;o<n.length;o++){var a=n[o];xe(e,a)||r(e,a,i(t,a))}},Tt=/#|\.prototype\./,Et=function(e,t){var n=Mt[Ct(e)];return n==Ot||n!=kt&&("function"==typeof t?oe(t):!!t)},Ct=Et.normalize=function(e){return String(e).replace(Tt,".").toLowerCase()},Mt=Et.data={},kt=Et.NATIVE="N",Ot=Et.POLYFILL="P",It=Et,Pt=Ce.f,Lt=function(e,t){var n,r,i,o,a,s=e.target,u=e.global,c=e.stat;if(n=u?ie:c?ie[s]||Pe(s,{}):(ie[s]||{}).prototype)for(r in t){if(o=t[r],i=e.noTargetGet?(a=Pt(n,r))&&a.value:n[r],!It(u?r:s+(c?".":"#")+r,e.forced)&&void 0!==i){if(typeof o==typeof i)continue;At(o,i)}(e.sham||i&&i.sham)&&Ie(o,"sham",!0),rt(n,r,o,e)}},Rt=at("navigator","userAgent")||"",Nt=ie.process,Dt=Nt&&Nt.versions,Ft=Dt&&Dt.v8;Ft?tt=(et=Ft.split("."))[0]<4?1:et[0]+et[1]:Rt&&(!(et=Rt.match(/Edge\/(\d+)/))||et[1]>=74)&&(et=Rt.match(/Chrome\/(\d+)/))&&(tt=et[1]);var zt,jt=tt&&+tt,Ut=!!Object.getOwnPropertySymbols&&!oe((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&jt&&jt<41})),Bt=Ut&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Vt=Array.isArray||function(e){return"Array"==he(e)},Ht=Object.keys||function(e){return yt(e,bt)},Gt=ae?Object.defineProperties:function(e,t){Me(e);for(var n,r=Ht(t),i=r.length,o=0;i>o;)Oe.f(e,n=r[o++],t[n]);return e},Wt=at("document","documentElement"),Zt=Ze("IE_PROTO"),Yt=function(){},qt=function(e){return"<script>"+e+"<\/script>"},Xt=function(){try{zt=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;Xt=zt?function(e){e.write(qt("")),e.close();var t=e.parentWindow.Object;return e=null,t}(zt):((t=Ae("iframe")).style.display="none",Wt.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(qt("document.F=Object")),e.close(),e.F);for(var n=bt.length;n--;)delete Xt.prototype[bt[n]];return Xt()};Ye[Zt]=!0;var Kt=Object.create||function(e,t){var n;return null!==e?(Yt.prototype=Me(e),n=new Yt,Yt.prototype=null,n[Zt]=e):n=Xt(),void 0===t?n:Gt(n,t)},Qt=xt.f,Jt={}.toString,$t="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],en={f:function(e){return $t&&"[object Window]"==Jt.call(e)?function(e){try{return Qt(e)}catch(e){return $t.slice()}}(e):Qt(ge(e))}},tn=Be("wks"),nn=ie.Symbol,rn=Bt?nn:nn&&nn.withoutSetter||Ge,on=function(e){return xe(tn,e)&&(Ut||"string"==typeof tn[e])||(Ut&&xe(nn,e)?tn[e]=nn[e]:tn[e]=rn("Symbol."+e)),tn[e]},an={f:on},sn=Oe.f,un=Oe.f,cn=on("toStringTag"),ln=function(e,t,n){e&&!xe(e=n?e:e.prototype,cn)&&un(e,cn,{configurable:!0,value:t})},fn=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},hn=function(e,t,n){if(fn(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},dn=on("species"),pn=function(e,t){var n;return Vt(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!Vt(n.prototype)?me(n)&&null===(n=n[dn])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)},vn=[].push,gn=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,a=7==e,s=5==e||o;return function(u,c,l,f){for(var h,d,p=be(u),v=pe(p),g=hn(c,l,3),m=ft(v.length),y=0,b=f||pn,_=t?b(u,m):n||a?b(u,0):void 0;m>y;y++)if((s||y in v)&&(d=g(h=v[y],y,p),e))if(t)_[y]=d;else if(d)switch(e){case 3:return!0;case 5:return h;case 6:return y;case 2:vn.call(_,h)}else switch(e){case 4:return!1;case 7:vn.call(_,h)}return o?-1:r||i?i:_}},mn={forEach:gn(0),map:gn(1),filter:gn(2),some:gn(3),every:gn(4),find:gn(5),findIndex:gn(6),filterOut:gn(7)},yn=mn.forEach,bn=Ze("hidden"),_n=on("toPrimitive"),xn=nt.set,Sn=nt.getterFor("Symbol"),wn=Object.prototype,An=ie.Symbol,Tn=at("JSON","stringify"),En=Ce.f,Cn=Oe.f,Mn=en.f,kn=ce.f,On=Be("symbols"),In=Be("op-symbols"),Pn=Be("string-to-symbol-registry"),Ln=Be("symbol-to-string-registry"),Rn=Be("wks"),Nn=ie.QObject,Dn=!Nn||!Nn.prototype||!Nn.prototype.findChild,Fn=ae&&oe((function(){return 7!=Kt(Cn({},"a",{get:function(){return Cn(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=En(wn,t);r&&delete wn[t],Cn(e,t,n),r&&e!==wn&&Cn(wn,t,r)}:Cn,zn=function(e,t){var n=On[e]=Kt(An.prototype);return xn(n,{type:"Symbol",tag:e,description:t}),ae||(n.description=t),n},jn=Bt?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof An},Un=function(e,t,n){e===wn&&Un(In,t,n),Me(e);var r=ye(t,!0);return Me(n),xe(On,r)?(n.enumerable?(xe(e,bn)&&e[bn][r]&&(e[bn][r]=!1),n=Kt(n,{enumerable:le(0,!1)})):(xe(e,bn)||Cn(e,bn,le(1,{})),e[bn][r]=!0),Fn(e,r,n)):Cn(e,r,n)},Bn=function(e,t){Me(e);var n=ge(t),r=Ht(n).concat(Wn(n));return yn(r,(function(t){ae&&!Vn.call(n,t)||Un(e,t,n[t])})),e},Vn=function(e){var t=ye(e,!0),n=kn.call(this,t);return!(this===wn&&xe(On,t)&&!xe(In,t))&&(!(n||!xe(this,t)||!xe(On,t)||xe(this,bn)&&this[bn][t])||n)},Hn=function(e,t){var n=ge(e),r=ye(t,!0);if(n!==wn||!xe(On,r)||xe(In,r)){var i=En(n,r);return!i||!xe(On,r)||xe(n,bn)&&n[bn][r]||(i.enumerable=!0),i}},Gn=function(e){var t=Mn(ge(e)),n=[];return yn(t,(function(e){xe(On,e)||xe(Ye,e)||n.push(e)})),n},Wn=function(e){var t=e===wn,n=Mn(t?In:ge(e)),r=[];return yn(n,(function(e){!xe(On,e)||t&&!xe(wn,e)||r.push(On[e])})),r};if(Ut||(rt((An=function(){if(this instanceof An)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=Ge(e),n=function(e){this===wn&&n.call(In,e),xe(this,bn)&&xe(this[bn],t)&&(this[bn][t]=!1),Fn(this,t,le(1,e))};return ae&&Dn&&Fn(wn,t,{configurable:!0,set:n}),zn(t,e)}).prototype,"toString",(function(){return Sn(this).tag})),rt(An,"withoutSetter",(function(e){return zn(Ge(e),e)})),ce.f=Vn,Oe.f=Un,Ce.f=Hn,xt.f=en.f=Gn,St.f=Wn,an.f=function(e){return zn(on(e),e)},ae&&(Cn(An.prototype,"description",{configurable:!0,get:function(){return Sn(this).description}}),rt(wn,"propertyIsEnumerable",Vn,{unsafe:!0}))),Lt({global:!0,wrap:!0,forced:!Ut,sham:!Ut},{Symbol:An}),yn(Ht(Rn),(function(e){!function(e){var t=it.Symbol||(it.Symbol={});xe(t,e)||sn(t,e,{value:an.f(e)})}(e)})),Lt({target:"Symbol",stat:!0,forced:!Ut},{for:function(e){var t=String(e);if(xe(Pn,t))return Pn[t];var n=An(t);return Pn[t]=n,Ln[n]=t,n},keyFor:function(e){if(!jn(e))throw TypeError(e+" is not a symbol");if(xe(Ln,e))return Ln[e]},useSetter:function(){Dn=!0},useSimple:function(){Dn=!1}}),Lt({target:"Object",stat:!0,forced:!Ut,sham:!ae},{create:function(e,t){return void 0===t?Kt(e):Bn(Kt(e),t)},defineProperty:Un,defineProperties:Bn,getOwnPropertyDescriptor:Hn}),Lt({target:"Object",stat:!0,forced:!Ut},{getOwnPropertyNames:Gn,getOwnPropertySymbols:Wn}),Lt({target:"Object",stat:!0,forced:oe((function(){St.f(1)}))},{getOwnPropertySymbols:function(e){return St.f(be(e))}}),Tn){var Zn=!Ut||oe((function(){var e=An();return"[null]"!=Tn([e])||"{}"!=Tn({a:e})||"{}"!=Tn(Object(e))}));Lt({target:"JSON",stat:!0,forced:Zn},{stringify:function(e,t,n){for(var r,i=[e],o=1;arguments.length>o;)i.push(arguments[o++]);if(r=t,(me(t)||void 0!==e)&&!jn(e))return Vt(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!jn(t))return t}),i[1]=t,Tn.apply(null,i)}})}An.prototype[_n]||Ie(An.prototype,_n,An.prototype.valueOf),ln(An,"Symbol"),Ye[bn]=!0;var Yn=Oe.f,qn=ie.Symbol;if(ae&&"function"==typeof qn&&(!("description"in qn.prototype)||void 0!==qn().description)){var Xn={},Kn=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof Kn?new qn(e):void 0===e?qn():qn(e);return""===e&&(Xn[t]=!0),t};At(Kn,qn);var Qn=Kn.prototype=qn.prototype;Qn.constructor=Kn;var Jn=Qn.toString,$n="Symbol(test)"==String(qn("test")),er=/^Symbol\((.*)\)[^)]+$/;Yn(Qn,"description",{configurable:!0,get:function(){var e=me(this)?this.valueOf():this,t=Jn.call(e);if(xe(Xn,e))return"";var n=$n?t.slice(7,-1):t.replace(er,"$1");return""===n?void 0:n}}),Lt({global:!0,forced:!0},{Symbol:Kn})}var tr={};tr[on("toStringTag")]="z";var nr="[object z]"===String(tr),rr=on("toStringTag"),ir="Arguments"==he(function(){return arguments}()),or=nr?he:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),rr))?n:ir?he(t):"Object"==(r=he(t))&&"function"==typeof t.callee?"Arguments":r},ar=nr?{}.toString:function(){return"[object "+or(this)+"]"};nr||rt(Object.prototype,"toString",ar,{unsafe:!0});var sr={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")};function ur(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function cr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ur(Object(n),!0).forEach((function(t){gr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ur(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function lr(e){return(lr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fr(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function hr(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){fr(o,r,i,a,s,"next",e)}function s(e){fr(o,r,i,a,s,"throw",e)}a(void 0)}))}}function dr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function vr(e,t,n){return t&&pr(e.prototype,t),n&&pr(e,n),e}function gr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mr(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&br(e,t)}function yr(e){return(yr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function br(e,t){return(br=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _r(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function xr(e,t,n){return(xr=_r()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&br(i,n.prototype),i}).apply(null,arguments)}function Sr(e){var t="function"==typeof Map?new Map:void 0;return(Sr=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return xr(e,arguments,yr(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),br(r,e)})(e)}function wr(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function Ar(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Tr(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?Ar(e):t}function Er(e){var t=_r();return function(){var n,r=yr(e);if(t){var i=yr(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Tr(this,n)}}function Cr(e,t,n){return(Cr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=yr(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Mr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}(e,t)||Or(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function kr(e){return function(e){if(Array.isArray(e))return Ir(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Or(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Or(e,t){if(e){if("string"==typeof e)return Ir(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ir(e,t):void 0}}function Ir(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Pr(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Or(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Lr(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function Rr(e,t,n,r,i){var o={};return Object.keys(r).forEach((function(e){o[e]=r[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var Nr=function(e,t,n){var r=ye(t);r in e?Oe.f(e,r,le(0,n)):e[r]=n},Dr=on("species"),Fr=function(e){return jt>=51||!oe((function(){var t=[];return(t.constructor={})[Dr]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},zr=on("isConcatSpreadable"),jr=jt>=51||!oe((function(){var e=[];return e[zr]=!1,e.concat()[0]!==e})),Ur=Fr("concat"),Br=function(e){if(!me(e))return!1;var t=e[zr];return void 0!==t?!!t:Vt(e)};Lt({target:"Array",proto:!0,forced:!jr||!Ur},{concat:function(e){var t,n,r,i,o,a=be(this),s=pn(a,0),u=0;for(t=-1,r=arguments.length;t<r;t++)if(Br(o=-1===t?a:arguments[t])){if(u+(i=ft(o.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<i;n++,u++)n in o&&Nr(s,u,o[n])}else{if(u>=9007199254740991)throw TypeError("Maximum allowed index exceeded");Nr(s,u++,o)}return s.length=u,s}});var Vr=on("unscopables"),Hr=Array.prototype;null==Hr[Vr]&&Oe.f(Hr,Vr,{configurable:!0,value:Kt(null)});var Gr,Wr,Zr,Yr=function(e){Hr[Vr][e]=!0},qr={},Xr=!oe((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Kr=Ze("IE_PROTO"),Qr=Object.prototype,Jr=Xr?Object.getPrototypeOf:function(e){return e=be(e),xe(e,Kr)?e[Kr]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Qr:null},$r=on("iterator"),ei=!1;[].keys&&("next"in(Zr=[].keys())?(Wr=Jr(Jr(Zr)))!==Object.prototype&&(Gr=Wr):ei=!0),(null==Gr||oe((function(){var e={};return Gr[$r].call(e)!==e})))&&(Gr={}),xe(Gr,$r)||Ie(Gr,$r,(function(){return this}));var ti={IteratorPrototype:Gr,BUGGY_SAFARI_ITERATORS:ei},ni=ti.IteratorPrototype,ri=function(){return this},ii=function(e,t,n){var r=t+" Iterator";return e.prototype=Kt(ni,{next:le(1,n)}),ln(e,r,!1),qr[r]=ri,e},oi=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return Me(n),function(e){if(!me(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype")}(r),t?e.call(n,r):n.__proto__=r,n}}():void 0),ai=ti.IteratorPrototype,si=ti.BUGGY_SAFARI_ITERATORS,ui=on("iterator"),ci=function(){return this},li=function(e,t,n,r,i,o,a){ii(n,t,r);var s,u,c,l=function(e){if(e===i&&v)return v;if(!si&&e in d)return d[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}},f=t+" Iterator",h=!1,d=e.prototype,p=d[ui]||d["@@iterator"]||i&&d[i],v=!si&&p||l(i),g="Array"==t&&d.entries||p;if(g&&(s=Jr(g.call(new e)),ai!==Object.prototype&&s.next&&(Jr(s)!==ai&&(oi?oi(s,ai):"function"!=typeof s[ui]&&Ie(s,ui,ci)),ln(s,f,!0))),"values"==i&&p&&"values"!==p.name&&(h=!0,v=function(){return p.call(this)}),d[ui]!==v&&Ie(d,ui,v),qr[t]=v,i)if(u={values:l("values"),keys:o?v:l("keys"),entries:l("entries")},a)for(c in u)(si||h||!(c in d))&&rt(d,c,u[c]);else Lt({target:t,proto:!0,forced:si||h},u);return u},fi=nt.set,hi=nt.getterFor("Array Iterator"),di=li(Array,"Array",(function(e,t){fi(this,{type:"Array Iterator",target:ge(e),index:0,kind:t})}),(function(){var e=hi(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values");qr.Arguments=qr.Array,Yr("keys"),Yr("values"),Yr("entries");var pi=!oe((function(){return Object.isExtensible(Object.preventExtensions({}))})),vi=o((function(e){var t=Oe.f,n=Ge("meta"),r=0,i=Object.isExtensible||function(){return!0},o=function(e){t(e,n,{value:{objectID:"O"+r++,weakData:{}}})},a=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!me(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!xe(e,n)){if(!i(e))return"F";if(!t)return"E";o(e)}return e[n].objectID},getWeakData:function(e,t){if(!xe(e,n)){if(!i(e))return!0;if(!t)return!1;o(e)}return e[n].weakData},onFreeze:function(e){return pi&&a.REQUIRED&&i(e)&&!xe(e,n)&&o(e),e}};Ye[n]=!0})),gi=(vi.REQUIRED,vi.fastKey,vi.getWeakData,vi.onFreeze,on("iterator")),mi=Array.prototype,yi=function(e){return void 0!==e&&(qr.Array===e||mi[gi]===e)},bi=on("iterator"),_i=function(e){if(null!=e)return e[bi]||e["@@iterator"]||qr[or(e)]},xi=function(e){var t=e.return;if(void 0!==t)return Me(t.call(e)).value},Si=function(e,t){this.stopped=e,this.result=t},wi=function(e,t,n){var r,i,o,a,s,u,c,l=n&&n.that,f=!(!n||!n.AS_ENTRIES),h=!(!n||!n.IS_ITERATOR),d=!(!n||!n.INTERRUPTED),p=hn(t,l,1+f+d),v=function(e){return r&&xi(r),new Si(!0,e)},g=function(e){return f?(Me(e),d?p(e[0],e[1],v):p(e[0],e[1])):d?p(e,v):p(e)};if(h)r=e;else{if("function"!=typeof(i=_i(e)))throw TypeError("Target is not iterable");if(yi(i)){for(o=0,a=ft(e.length);a>o;o++)if((s=g(e[o]))&&s instanceof Si)return s;return new Si(!1)}r=i.call(e)}for(u=r.next;!(c=u.call(r)).done;){try{s=g(c.value)}catch(e){throw xi(r),e}if("object"==typeof s&&s&&s instanceof Si)return s}return new Si(!1)},Ai=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},Ti=on("iterator"),Ei=!1;try{var Ci=0,Mi={next:function(){return{done:!!Ci++}},return:function(){Ei=!0}};Mi[Ti]=function(){return this},Array.from(Mi,(function(){throw 2}))}catch(e){}var ki=function(e,t){if(!t&&!Ei)return!1;var n=!1;try{var r={};r[Ti]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},Oi=function(e,t,n){var r,i;return oi&&"function"==typeof(r=t.constructor)&&r!==n&&me(i=r.prototype)&&i!==n.prototype&&oi(e,i),e},Ii=function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),o=r?"set":"add",a=ie[e],s=a&&a.prototype,u=a,c={},l=function(e){var t=s[e];rt(s,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!me(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return i&&!me(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!me(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(It(e,"function"!=typeof a||!(i||s.forEach&&!oe((function(){(new a).entries().next()})))))u=n.getConstructor(t,e,r,o),vi.REQUIRED=!0;else if(It(e,!0)){var f=new u,h=f[o](i?{}:-0,1)!=f,d=oe((function(){f.has(1)})),p=ki((function(e){new a(e)})),v=!i&&oe((function(){for(var e=new a,t=5;t--;)e[o](t,t);return!e.has(-0)}));p||((u=t((function(t,n){Ai(t,u,e);var i=Oi(new a,t,u);return null!=n&&wi(n,i[o],{that:i,AS_ENTRIES:r}),i}))).prototype=s,s.constructor=u),(d||v)&&(l("delete"),l("has"),r&&l("get")),(v||h)&&l(o),i&&s.clear&&delete s.clear}return c[e]=u,Lt({global:!0,forced:u!=a},c),ln(u,e),i||n.setStrong(u,e,r),u},Pi=function(e,t,n){for(var r in t)rt(e,r,t[r],n);return e},Li=on("species"),Ri=function(e){var t=at(e),n=Oe.f;ae&&t&&!t[Li]&&n(t,Li,{configurable:!0,get:function(){return this}})},Ni=Oe.f,Di=vi.fastKey,Fi=nt.set,zi=nt.getterFor,ji={getConstructor:function(e,t,n,r){var i=e((function(e,o){Ai(e,i,t),Fi(e,{type:t,index:Kt(null),first:void 0,last:void 0,size:0}),ae||(e.size=0),null!=o&&wi(o,e[r],{that:e,AS_ENTRIES:n})})),o=zi(t),a=function(e,t,n){var r,i,a=o(e),u=s(e,t);return u?u.value=n:(a.last=u={index:i=Di(t,!0),key:t,value:n,previous:r=a.last,next:void 0,removed:!1},a.first||(a.first=u),r&&(r.next=u),ae?a.size++:e.size++,"F"!==i&&(a.index[i]=u)),e},s=function(e,t){var n,r=o(e),i=Di(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==t)return n};return Pi(i.prototype,{clear:function(){for(var e=o(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,ae?e.size=0:this.size=0},delete:function(e){var t=o(this),n=s(this,e);if(n){var r=n.next,i=n.previous;delete t.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),t.first==n&&(t.first=r),t.last==n&&(t.last=i),ae?t.size--:this.size--}return!!n},forEach:function(e){for(var t,n=o(this),r=hn(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!s(this,e)}}),Pi(i.prototype,n?{get:function(e){var t=s(this,e);return t&&t.value},set:function(e,t){return a(this,0===e?0:e,t)}}:{add:function(e){return a(this,e=0===e?0:e,e)}}),ae&&Ni(i.prototype,"size",{get:function(){return o(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=zi(t),o=zi(r);li(e,t,(function(e,t){Fi(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),Ri(t)}},Ui=(Ii("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),ji),function(e){return function(t,n){var r,i,o=String(ve(t)),a=ct(n),s=o.length;return a<0||a>=s?e?"":void 0:(r=o.charCodeAt(a))<55296||r>56319||a+1===s||(i=o.charCodeAt(a+1))<56320||i>57343?e?o.charAt(a):r:e?o.slice(a,a+2):i-56320+(r-55296<<10)+65536}}),Bi={codeAt:Ui(!1),charAt:Ui(!0)},Vi=Bi.charAt,Hi=nt.set,Gi=nt.getterFor("String Iterator");li(String,"String",(function(e){Hi(this,{type:"String Iterator",string:String(e),index:0})}),(function(){var e,t=Gi(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=Vi(n,r),t.index+=e.length,{value:e,done:!1})}));var Wi={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Zi=on("iterator"),Yi=on("toStringTag"),qi=di.values;for(var Xi in Wi){var Ki=ie[Xi],Qi=Ki&&Ki.prototype;if(Qi){if(Qi[Zi]!==qi)try{Ie(Qi,Zi,qi)}catch(e){Qi[Zi]=qi}if(Qi[Yi]||Ie(Qi,Yi,Xi),Wi[Xi])for(var Ji in di)if(Qi[Ji]!==di[Ji])try{Ie(Qi,Ji,di[Ji])}catch(e){Qi[Ji]=di[Ji]}}}var $i=function(e,t){var n=[][e];return!!n&&oe((function(){n.call(null,t||function(){throw 1},1)}))},eo=mn.forEach,to=$i("forEach")?[].forEach:function(e){return eo(this,e,arguments.length>1?arguments[1]:void 0)};for(var no in Wi){var ro=ie[no],io=ro&&ro.prototype;if(io&&io.forEach!==to)try{Ie(io,"forEach",to)}catch(e){io.forEach=to}}var oo=Oe.f,ao=Function.prototype,so=ao.toString,uo=/^\s*function ([^ (]*)/;ae&&!("name"in ao)&&oo(ao,"name",{configurable:!0,get:function(){try{return so.call(this).match(uo)[1]}catch(e){return""}}});var co=function(){var e=Me(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},lo=function(e,t){return RegExp(e,t)},fo={UNSUPPORTED_Y:oe((function(){var e=lo("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),BROKEN_CARET:oe((function(){var e=lo("^r","gy");return e.lastIndex=2,null!=e.exec("str")}))},ho=oe((function(){var e=RegExp(".","string".charAt(0));return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),po=oe((function(){var e=RegExp("(?<a>b)","string".charAt(5));return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),vo=nt.get,go=RegExp.prototype.exec,mo=Be("native-string-replace",String.prototype.replace),yo=go,bo=function(){var e=/a/,t=/b*/g;return go.call(e,"a"),go.call(t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),_o=fo.UNSUPPORTED_Y||fo.BROKEN_CARET,xo=void 0!==/()??/.exec("")[1];(bo||xo||_o||ho||po)&&(yo=function(e){var t,n,r,i,o,a,s,u=this,c=vo(u),l=c.raw;if(l)return l.lastIndex=u.lastIndex,t=yo.call(l,e),u.lastIndex=l.lastIndex,t;var f=c.groups,h=_o&&u.sticky,d=co.call(u),p=u.source,v=0,g=e;if(h&&(-1===(d=d.replace("y","")).indexOf("g")&&(d+="g"),g=String(e).slice(u.lastIndex),u.lastIndex>0&&(!u.multiline||u.multiline&&"\n"!==e[u.lastIndex-1])&&(p="(?: "+p+")",g=" "+g,v++),n=new RegExp("^(?:"+p+")",d)),xo&&(n=new RegExp("^"+p+"$(?!\\s)",d)),bo&&(r=u.lastIndex),i=go.call(h?n:u,g),h?i?(i.input=i.input.slice(v),i[0]=i[0].slice(v),i.index=u.lastIndex,u.lastIndex+=i[0].length):u.lastIndex=0:bo&&i&&(u.lastIndex=u.global?i.index+i[0].length:r),xo&&i&&i.length>1&&mo.call(i[0],n,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(i[o]=void 0)})),i&&f)for(i.groups=a=Kt(null),o=0;o<f.length;o++)a[(s=f[o])[0]]=i[s[1]];return i});var So=yo;Lt({target:"RegExp",proto:!0,forced:/./.exec!==So},{exec:So});var wo=on("species"),Ao=RegExp.prototype,To=function(e,t,n,r){var i=on(e),o=!oe((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),a=o&&!oe((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[wo]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t}));if(!o||!a||n){var s=/./[i],u=t(i,""[e],(function(e,t,n,r,i){var a=t.exec;return a===So||a===Ao.exec?o&&!i?{done:!0,value:s.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}));rt(String.prototype,e,u[0]),rt(Ao,i,u[1])}r&&Ie(Ao[i],"sham",!0)},Eo=Bi.charAt,Co=function(e,t,n){return t+(n?Eo(e,t).length:1)},Mo=Math.floor,ko="".replace,Oo=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Io=/\$([$&'`]|\d{1,2})/g,Po=function(e,t,n,r,i,o){var a=n+e.length,s=r.length,u=Io;return void 0!==i&&(i=be(i),u=Oo),ko.call(o,u,(function(o,u){var c;switch(u.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,n);case"'":return t.slice(a);case"<":c=i[u.slice(1,-1)];break;default:var l=+u;if(0===l)return o;if(l>s){var f=Mo(l/10);return 0===f?o:f<=s?void 0===r[f-1]?u.charAt(1):r[f-1]+u.charAt(1):o}c=r[l-1]}return void 0===c?"":c}))},Lo=function(e,t){var n=e.exec;if("function"==typeof n){var r=n.call(e,t);if("object"!=typeof r)throw TypeError("RegExp exec method returned something other than an Object or null");return r}if("RegExp"!==he(e))throw TypeError("RegExp#exec called on incompatible receiver");return So.call(e,t)},Ro=on("replace"),No=Math.max,Do=Math.min,Fo="$0"==="a".replace(/./,"$0"),zo=!!/./[Ro]&&""===/./[Ro]("a","$0");To("replace",(function(e,t,n){var r=zo?"$":"$0";return[function(e,n){var r=ve(this),i=null==e?void 0:e[Ro];return void 0!==i?i.call(e,r,n):t.call(String(r),e,n)},function(e,i){if("string"==typeof i&&-1===i.indexOf(r)&&-1===i.indexOf("$<")){var o=n(t,this,e,i);if(o.done)return o.value}var a=Me(this),s=String(e),u="function"==typeof i;u||(i=String(i));var c=a.global;if(c){var l=a.unicode;a.lastIndex=0}for(var f=[];;){var h=Lo(a,s);if(null===h)break;if(f.push(h),!c)break;""===String(h[0])&&(a.lastIndex=Co(s,ft(a.lastIndex),l))}for(var d,p="",v=0,g=0;g<f.length;g++){h=f[g];for(var m=String(h[0]),y=No(Do(ct(h.index),s.length),0),b=[],_=1;_<h.length;_++)b.push(void 0===(d=h[_])?d:String(d));var x=h.groups;if(u){var S=[m].concat(b,y,s);void 0!==x&&S.push(x);var w=String(i.apply(void 0,S))}else w=Po(m,s,y,b,x,i);y>=v&&(p+=s.slice(v,y)+w,v=y+m.length)}return p+s.slice(v)}]}),!!oe((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!Fo||zo);Ii("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),ji);var jo=oe((function(){Ht(1)}));Lt({target:"Object",stat:!0,forced:jo},{keys:function(e){return Ht(be(e))}});var Uo=RegExp.prototype,Bo=Uo.toString,Vo=oe((function(){return"/a/b"!=Bo.call({source:"a",flags:"b"})})),Ho="toString"!=Bo.name;(Vo||Ho)&&rt(RegExp.prototype,"toString",(function(){var e=Me(this),t=String(e.source),n=e.flags;return"/"+t+"/"+String(void 0===n&&e instanceof RegExp&&!("flags"in Uo)?co.call(e):n)}),{unsafe:!0});var Go="\t\n\v\f\r \u2028\u2029\ufeff",Wo="["+Go+"]",Zo=RegExp("^"+Wo+Wo+"*"),Yo=RegExp(Wo+Wo+"*$"),qo=function(e){return function(t){var n=String(ve(t));return 1&e&&(n=n.replace(Zo,"")),2&e&&(n=n.replace(Yo,"")),n}},Xo={start:qo(1),end:qo(2),trim:qo(3)},Ko=Xo.trim;Lt({target:"String",proto:!0,forced:function(e){return oe((function(){return!!Go[e]()||""!=""[e]()||Go[e].name!==e}))}("trim")},{trim:function(){return Ko(this)}});var Qo=on("match"),Jo=function(e){var t;return me(e)&&(void 0!==(t=e[Qo])?!!t:"RegExp"==he(e))},$o=on("species"),ea=function(e,t){var n,r=Me(e).constructor;return void 0===r||null==(n=Me(r)[$o])?t:fn(n)},ta=fo.UNSUPPORTED_Y,na=[].push,ra=Math.min;To("split",(function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=String(ve(this)),i=void 0===n?4294967295:n>>>0;if(0===i)return[];if(void 0===e)return[r];if(!Jo(e))return t.call(r,e,i);for(var o,a,s,u=[],c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),l=0,f=new RegExp(e.source,c+"g");(o=So.call(f,r))&&!((a=f.lastIndex)>l&&(u.push(r.slice(l,o.index)),o.length>1&&o.index<r.length&&na.apply(u,o.slice(1)),s=o[0].length,l=a,u.length>=i));)f.lastIndex===o.index&&f.lastIndex++;return l===r.length?!s&&f.test("")||u.push(""):u.push(r.slice(l)),u.length>i?u.slice(0,i):u}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var i=ve(this),o=null==t?void 0:t[e];return void 0!==o?o.call(t,i,n):r.call(String(i),t,n)},function(e,i){var o=n(r,this,e,i,r!==t);if(o.done)return o.value;var a=Me(this),s=String(e),u=ea(a,RegExp),c=a.unicode,l=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(ta?"g":"y"),f=new u(ta?"^(?:"+a.source+")":a,l),h=void 0===i?4294967295:i>>>0;if(0===h)return[];if(0===s.length)return null===Lo(f,s)?[s]:[];for(var d=0,p=0,v=[];p<s.length;){f.lastIndex=ta?0:p;var g,m=Lo(f,ta?s.slice(p):s);if(null===m||(g=ra(ft(f.lastIndex+(ta?p:0)),s.length))===d)p=Co(s,p,c);else{if(v.push(s.slice(d,p)),v.length===h)return v;for(var y=1;y<=m.length-1;y++)if(v.push(m[y]),v.length===h)return v;p=d=g}}return v.push(s.slice(d)),v}]}),!!oe((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]})),ta);var ia=Oe.f,oa=xt.f,aa=nt.enforce,sa=on("match"),ua=ie.RegExp,ca=ua.prototype,la=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,fa=/a/g,ha=/a/g,da=new ua(fa)!==fa,pa=fo.UNSUPPORTED_Y,va=ae&&(!da||pa||ho||po||oe((function(){return ha[sa]=!1,ua(fa)!=fa||ua(ha)==ha||"/a/i"!=ua(fa,"i")})));if(It("RegExp",va)){for(var ga=function(e,t){var n,r,i,o,a,s,u=this instanceof ga,c=Jo(e),l=void 0===t,f=[],h=e;if(!u&&c&&l&&e.constructor===ga)return e;if((c||e instanceof ga)&&(e=e.source,l&&(t="flags"in h?h.flags:co.call(h))),e=void 0===e?"":String(e),t=void 0===t?"":String(t),h=e,ho&&"dotAll"in fa&&(r=!!t&&t.indexOf("s")>-1)&&(t=t.replace(/s/g,"")),n=t,pa&&"sticky"in fa&&(i=!!t&&t.indexOf("y")>-1)&&(t=t.replace(/y/g,"")),po&&(e=(o=function(e){for(var t,n=e.length,r=0,i="",o=[],a={},s=!1,u=!1,c=0,l="";r<=n;r++){if("\\"===(t=e.charAt(r)))t+=e.charAt(++r);else if("]"===t)s=!1;else if(!s)switch(!0){case"["===t:s=!0;break;case"("===t:la.test(e.slice(r+1))&&(r+=2,u=!0),i+=t,c++;continue;case">"===t&&u:if(""===l||xe(a,l))throw new SyntaxError("Invalid capture group name");a[l]=!0,o.push([l,c]),u=!1,l="";continue}u?l+=t:i+=t}return[i,o]}(e))[0],f=o[1]),a=Oi(ua(e,t),u?this:ca,ga),(r||i||f.length)&&(s=aa(a),r&&(s.dotAll=!0,s.raw=ga(function(e){for(var t,n=e.length,r=0,i="",o=!1;r<=n;r++)"\\"!==(t=e.charAt(r))?o||"."!==t?("["===t?o=!0:"]"===t&&(o=!1),i+=t):i+="[\\s\\S]":i+=t+e.charAt(++r);return i}(e),n)),i&&(s.sticky=!0),f.length&&(s.groups=f)),e!==h)try{Ie(a,"source",""===h?"(?:)":h)}catch(e){}return a},ma=function(e){e in ga||ia(ga,e,{configurable:!0,get:function(){return ua[e]},set:function(t){ua[e]=t}})},ya=oa(ua),ba=0;ya.length>ba;)ma(ya[ba++]);ca.constructor=ga,ga.prototype=ca,rt(ie,"RegExp",ga)}Ri("RegExp");var _a=[].join,xa=pe!=Object,Sa=$i("join",",");Lt({target:"Array",proto:!0,forced:xa||!Sa},{join:function(e){return _a.call(ge(this),void 0===e?",":e)}});var wa=mn.find,Aa=!0;"find"in[]&&Array(1).find((function(){Aa=!1})),Lt({target:"Array",proto:!0,forced:Aa},{find:function(e){return wa(this,e,arguments.length>1?arguments[1]:void 0)}}),Yr("find");var Ta=window.document.documentElement.style;function Ea(e){var t=e;return"string"==typeof e&&(t=document.getElementById(e)),t}function Ca(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Ma(e){return Ca(e).split(/\s+/)}function ka(e,t,n){var r=document.createElement(e);return r.className=t||"",n&&n.appendChild(r),r}function Oa(e){var t=e.parentNode;t&&t.removeChild(e)}function Ia(e,t){if(void 0!==e.classList)for(var n=Ma(t),r=0,i=n.length;r<i;r++)e.classList.add(n[r]);else if(!La(e,t)){var o=Na(e);Ra(e,(o?o+" ":"")+t)}}function Pa(e,t){void 0!==e.classList?e.classList.remove(t):Ra(e,Ca((" "+Na(e)+" ").replace(" "+t+" "," ")))}function La(e,t){if(void 0!==e.classList)return e.classList.contains(t);var n=Na(e);return n.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(n)}function Ra(e,t){e instanceof HTMLElement?e.className=t:e.className.baseVal=t}function Na(e){return e instanceof SVGElement&&(e=e.correspondingElement),void 0===e.className.baseVal?e.className:e.className.baseVal}function Da(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var Fa=function(e){if(!Ta)return e[0];for(var t in e)if(e[t]&&e[t]in Ta)return e[t];return e[0]}(["transform","WebkitTransform"]);function za(e,t){e.style[Fa]=t}function ja(){if("function"==typeof Event)window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}function Ua(){var e,t=document.querySelector('meta[name="viewport"]');if(!t)return 1;var n=(null===(e=t.content)||void 0===e?void 0:e.split(",")).find((function(e){var t=Mr(e.split("="),2),n=t[0];t[1];return"initial-scale"===n}));return n?1*n.split("=")[1]:1}var Ba=Ua()<1?1:window.devicePixelRatio,Va=Object.freeze({__proto__:null,getContainer:Ea,trim:Ca,splitWords:Ma,create:ka,remove:Oa,addClass:Ia,removeClass:Pa,hasClass:La,setClass:Ra,getClass:Na,empty:Da,setTransform:za,triggerResize:ja,printCanvas:function(e){var t=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log("%c\n",t.join(""))},getViewPortScale:Ua,DPR:Ba}),Ha=on("iterator"),Ga=!oe((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n="";return e.pathname="c%20d",t.forEach((function(e,r){t.delete("b"),n+=r+e})),!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[Ha]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://").host||"#%D0%B1"!==new URL("http://a#").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host})),Wa=Object.assign,Za=Object.defineProperty,Ya=!Wa||oe((function(){if(ae&&1!==Wa({b:1},Wa(Za({},"a",{enumerable:!0,get:function(){Za(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!=Wa({},e)[n]||"abcdefghijklmnopqrst"!=Ht(Wa({},t)).join("")}))?function(e,t){for(var n=be(e),r=arguments.length,i=1,o=St.f,a=ce.f;r>i;)for(var s,u=pe(arguments[i++]),c=o?Ht(u).concat(o(u)):Ht(u),l=c.length,f=0;l>f;)s=c[f++],ae&&!a.call(u,s)||(n[s]=u[s]);return n}:Wa,qa=function(e,t,n,r){try{return r?t(Me(n)[0],n[1]):t(n)}catch(t){throw xi(e),t}},Xa=function(e){var t,n,r,i,o,a,s=be(e),u="function"==typeof this?this:Array,c=arguments.length,l=c>1?arguments[1]:void 0,f=void 0!==l,h=_i(s),d=0;if(f&&(l=hn(l,c>2?arguments[2]:void 0,2)),null==h||u==Array&&yi(h))for(n=new u(t=ft(s.length));t>d;d++)a=f?l(s[d],d):s[d],Nr(n,d,a);else for(o=(i=h.call(s)).next,n=new u;!(r=o.call(i)).done;d++)a=f?qa(i,l,[r.value,d],!0):r.value,Nr(n,d,a);return n.length=d,n},Ka=/[^\0-\u007E]/,Qa=/[.\u3002\uFF0E\uFF61]/g,Ja="Overflow: input needs wider integers to process",$a=Math.floor,es=String.fromCharCode,ts=function(e){return e+22+75*(e<26)},ns=function(e,t,n){var r=0;for(e=n?$a(e/700):e>>1,e+=$a(e/t);e>455;r+=36)e=$a(e/35);return $a(r+36*e/(e+38))},rs=function(e){var t,n,r=[],i=(e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var o=e.charCodeAt(n++);56320==(64512&o)?t.push(((1023&i)<<10)+(1023&o)+65536):(t.push(i),n--)}else t.push(i)}return t}(e)).length,o=128,a=0,s=72;for(t=0;t<e.length;t++)(n=e[t])<128&&r.push(es(n));var u=r.length,c=u;for(u&&r.push("-");c<i;){var l=2147483647;for(t=0;t<e.length;t++)(n=e[t])>=o&&n<l&&(l=n);var f=c+1;if(l-o>$a((2147483647-a)/f))throw RangeError(Ja);for(a+=(l-o)*f,o=l,t=0;t<e.length;t++){if((n=e[t])<o&&++a>2147483647)throw RangeError(Ja);if(n==o){for(var h=a,d=36;;d+=36){var p=d<=s?1:d>=s+26?26:d-s;if(h<p)break;var v=h-p,g=36-p;r.push(es(ts(p+v%g))),h=$a(v/g)}r.push(es(ts(h))),s=ns(a,f,c==u),a=0,++c}}++a,++o}return r.join("")},is=function(e){var t=_i(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return Me(t.call(e))},os=at("fetch"),as=at("Headers"),ss=on("iterator"),us=nt.set,cs=nt.getterFor("URLSearchParams"),ls=nt.getterFor("URLSearchParamsIterator"),fs=/\+/g,hs=Array(4),ds=function(e){return hs[e-1]||(hs[e-1]=RegExp("((?:%[\\da-f]{2}){"+e+"})","gi"))},ps=function(e){try{return decodeURIComponent(e)}catch(t){return e}},vs=function(e){var t=e.replace(fs," "),n=4;try{return decodeURIComponent(t)}catch(e){for(;n;)t=t.replace(ds(n--),ps);return t}},gs=/[!'()~]|%20/g,ms={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},ys=function(e){return ms[e]},bs=function(e){return encodeURIComponent(e).replace(gs,ys)},_s=function(e,t){if(t)for(var n,r,i=t.split("&"),o=0;o<i.length;)(n=i[o++]).length&&(r=n.split("="),e.push({key:vs(r.shift()),value:vs(r.join("="))}))},xs=function(e){this.entries.length=0,_s(this.entries,e)},Ss=function(e,t){if(e<t)throw TypeError("Not enough arguments")},ws=ii((function(e,t){us(this,{type:"URLSearchParamsIterator",iterator:is(cs(e).entries),kind:t})}),"Iterator",(function(){var e=ls(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value="keys"===t?r.key:"values"===t?r.value:[r.key,r.value]),n})),As=function(){Ai(this,As,"URLSearchParams");var e,t,n,r,i,o,a,s,u,c=arguments.length>0?arguments[0]:void 0,l=this,f=[];if(us(l,{type:"URLSearchParams",entries:f,updateURL:function(){},updateSearchParams:xs}),void 0!==c)if(me(c))if("function"==typeof(e=_i(c)))for(n=(t=e.call(c)).next;!(r=n.call(t)).done;){if((a=(o=(i=is(Me(r.value))).next).call(i)).done||(s=o.call(i)).done||!o.call(i).done)throw TypeError("Expected sequence with length 2");f.push({key:a.value+"",value:s.value+""})}else for(u in c)xe(c,u)&&f.push({key:u,value:c[u]+""});else _s(f,"string"==typeof c?"?"===c.charAt(0)?c.slice(1):c:c+"")},Ts=As.prototype;Pi(Ts,{append:function(e,t){Ss(arguments.length,2);var n=cs(this);n.entries.push({key:e+"",value:t+""}),n.updateURL()},delete:function(e){Ss(arguments.length,1);for(var t=cs(this),n=t.entries,r=e+"",i=0;i<n.length;)n[i].key===r?n.splice(i,1):i++;t.updateURL()},get:function(e){Ss(arguments.length,1);for(var t=cs(this).entries,n=e+"",r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){Ss(arguments.length,1);for(var t=cs(this).entries,n=e+"",r=[],i=0;i<t.length;i++)t[i].key===n&&r.push(t[i].value);return r},has:function(e){Ss(arguments.length,1);for(var t=cs(this).entries,n=e+"",r=0;r<t.length;)if(t[r++].key===n)return!0;return!1},set:function(e,t){Ss(arguments.length,1);for(var n,r=cs(this),i=r.entries,o=!1,a=e+"",s=t+"",u=0;u<i.length;u++)(n=i[u]).key===a&&(o?i.splice(u--,1):(o=!0,n.value=s));o||i.push({key:a,value:s}),r.updateURL()},sort:function(){var e,t,n,r=cs(this),i=r.entries,o=i.slice();for(i.length=0,n=0;n<o.length;n++){for(e=o[n],t=0;t<n;t++)if(i[t].key>e.key){i.splice(t,0,e);break}t===n&&i.push(e)}r.updateURL()},forEach:function(e){for(var t,n=cs(this).entries,r=hn(e,arguments.length>1?arguments[1]:void 0,3),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new ws(this,"keys")},values:function(){return new ws(this,"values")},entries:function(){return new ws(this,"entries")}},{enumerable:!0}),rt(Ts,ss,Ts.entries),rt(Ts,"toString",(function(){for(var e,t=cs(this).entries,n=[],r=0;r<t.length;)e=t[r++],n.push(bs(e.key)+"="+bs(e.value));return n.join("&")}),{enumerable:!0}),ln(As,"URLSearchParams"),Lt({global:!0,forced:!Ga},{URLSearchParams:As}),Ga||"function"!=typeof os||"function"!=typeof as||Lt({global:!0,enumerable:!0,forced:!0},{fetch:function(e){var t,n,r,i=[e];return arguments.length>1&&(me(t=arguments[1])&&(n=t.body,"URLSearchParams"===or(n)&&((r=t.headers?new as(t.headers):new as).has("content-type")||r.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),t=Kt(t,{body:le(0,String(n)),headers:le(0,r)}))),i.push(t)),os.apply(this,i)}});var Es,Cs={URLSearchParams:As,getState:cs},Ms=Bi.codeAt,ks=ie.URL,Os=Cs.URLSearchParams,Is=Cs.getState,Ps=nt.set,Ls=nt.getterFor("URL"),Rs=Math.floor,Ns=Math.pow,Ds=/[A-Za-z]/,Fs=/[\d+-.A-Za-z]/,zs=/\d/,js=/^0x/i,Us=/^[0-7]+$/,Bs=/^\d+$/,Vs=/^[\dA-Fa-f]+$/,Hs=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Gs=/[\0\t\n\r #/:<>?@[\\\]^|]/,Ws=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,Zs=/[\t\n\r]/g,Ys=function(e,t){var n,r,i;if("["==t.charAt(0)){if("]"!=t.charAt(t.length-1))return"Invalid host";if(!(n=Xs(t.slice(1,-1))))return"Invalid host";e.host=n}else if(ru(e)){if(t=function(e){var t,n,r=[],i=e.toLowerCase().replace(Qa,".").split(".");for(t=0;t<i.length;t++)n=i[t],r.push(Ka.test(n)?"xn--"+rs(n):n);return r.join(".")}(t),Hs.test(t))return"Invalid host";if(null===(n=qs(t)))return"Invalid host";e.host=n}else{if(Gs.test(t))return"Invalid host";for(n="",r=Xa(t),i=0;i<r.length;i++)n+=tu(r[i],Qs);e.host=n}},qs=function(e){var t,n,r,i,o,a,s,u=e.split(".");if(u.length&&""==u[u.length-1]&&u.pop(),(t=u.length)>4)return e;for(n=[],r=0;r<t;r++){if(""==(i=u[r]))return e;if(o=10,i.length>1&&"0"==i.charAt(0)&&(o=js.test(i)?16:8,i=i.slice(8==o?1:2)),""===i)a=0;else{if(!(10==o?Bs:8==o?Us:Vs).test(i))return e;a=parseInt(i,o)}n.push(a)}for(r=0;r<t;r++)if(a=n[r],r==t-1){if(a>=Ns(256,5-t))return null}else if(a>255)return null;for(s=n.pop(),r=0;r<n.length;r++)s+=n[r]*Ns(256,3-r);return s},Xs=function(e){var t,n,r,i,o,a,s,u=[0,0,0,0,0,0,0,0],c=0,l=null,f=0,h=function(){return e.charAt(f)};if(":"==h()){if(":"!=e.charAt(1))return;f+=2,l=++c}for(;h();){if(8==c)return;if(":"!=h()){for(t=n=0;n<4&&Vs.test(h());)t=16*t+parseInt(h(),16),f++,n++;if("."==h()){if(0==n)return;if(f-=n,c>6)return;for(r=0;h();){if(i=null,r>0){if(!("."==h()&&r<4))return;f++}if(!zs.test(h()))return;for(;zs.test(h());){if(o=parseInt(h(),10),null===i)i=o;else{if(0==i)return;i=10*i+o}if(i>255)return;f++}u[c]=256*u[c]+i,2!=++r&&4!=r||c++}if(4!=r)return;break}if(":"==h()){if(f++,!h())return}else if(h())return;u[c++]=t}else{if(null!==l)return;f++,l=++c}}if(null!==l)for(a=c-l,c=7;0!=c&&a>0;)s=u[c],u[c--]=u[l+a-1],u[l+--a]=s;else if(8!=c)return;return u},Ks=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)t.unshift(e%256),e=Rs(e/256);return t.join(".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,o=0;o<8;o++)0!==e[o]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=o),++i);return i>n&&(t=r,n=i),t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=e[n].toString(16),n<7&&(t+=":")));return"["+t+"]"}return e},Qs={},Js=Ya({},Qs,{" ":1,'"':1,"<":1,">":1,"`":1}),$s=Ya({},Js,{"#":1,"?":1,"{":1,"}":1}),eu=Ya({},$s,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),tu=function(e,t){var n=Ms(e,0);return n>32&&n<127&&!xe(t,e)?e:encodeURIComponent(e)},nu={ftp:21,file:null,http:80,https:443,ws:80,wss:443},ru=function(e){return xe(nu,e.scheme)},iu=function(e){return""!=e.username||""!=e.password},ou=function(e){return!e.host||e.cannotBeABaseURL||"file"==e.scheme},au=function(e,t){var n;return 2==e.length&&Ds.test(e.charAt(0))&&(":"==(n=e.charAt(1))||!t&&"|"==n)},su=function(e){var t;return e.length>1&&au(e.slice(0,2))&&(2==e.length||"/"===(t=e.charAt(2))||"\\"===t||"?"===t||"#"===t)},uu=function(e){var t=e.path,n=t.length;!n||"file"==e.scheme&&1==n&&au(t[0],!0)||t.pop()},cu=function(e){return"."===e||"%2e"===e.toLowerCase()},lu={},fu={},hu={},du={},pu={},vu={},gu={},mu={},yu={},bu={},_u={},xu={},Su={},wu={},Au={},Tu={},Eu={},Cu={},Mu={},ku={},Ou={},Iu=function(e,t,n,r){var i,o,a,s,u,c=n||lu,l=0,f="",h=!1,d=!1,p=!1;for(n||(e.scheme="",e.username="",e.password="",e.host=null,e.port=null,e.path=[],e.query=null,e.fragment=null,e.cannotBeABaseURL=!1,t=t.replace(Ws,"")),t=t.replace(Zs,""),i=Xa(t);l<=i.length;){switch(o=i[l],c){case lu:if(!o||!Ds.test(o)){if(n)return"Invalid scheme";c=hu;continue}f+=o.toLowerCase(),c=fu;break;case fu:if(o&&(Fs.test(o)||"+"==o||"-"==o||"."==o))f+=o.toLowerCase();else{if(":"!=o){if(n)return"Invalid scheme";f="",c=hu,l=0;continue}if(n&&(ru(e)!=xe(nu,f)||"file"==f&&(iu(e)||null!==e.port)||"file"==e.scheme&&!e.host))return;if(e.scheme=f,n)return void(ru(e)&&nu[e.scheme]==e.port&&(e.port=null));f="","file"==e.scheme?c=wu:ru(e)&&r&&r.scheme==e.scheme?c=du:ru(e)?c=mu:"/"==i[l+1]?(c=pu,l++):(e.cannotBeABaseURL=!0,e.path.push(""),c=Mu)}break;case hu:if(!r||r.cannotBeABaseURL&&"#"!=o)return"Invalid scheme";if(r.cannotBeABaseURL&&"#"==o){e.scheme=r.scheme,e.path=r.path.slice(),e.query=r.query,e.fragment="",e.cannotBeABaseURL=!0,c=Ou;break}c="file"==r.scheme?wu:vu;continue;case du:if("/"!=o||"/"!=i[l+1]){c=vu;continue}c=yu,l++;break;case pu:if("/"==o){c=bu;break}c=Cu;continue;case vu:if(e.scheme=r.scheme,o==Es)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query;else if("/"==o||"\\"==o&&ru(e))c=gu;else if("?"==o)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query="",c=ku;else{if("#"!=o){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.path.pop(),c=Cu;continue}e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query,e.fragment="",c=Ou}break;case gu:if(!ru(e)||"/"!=o&&"\\"!=o){if("/"!=o){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,c=Cu;continue}c=bu}else c=yu;break;case mu:if(c=yu,"/"!=o||"/"!=f.charAt(l+1))continue;l++;break;case yu:if("/"!=o&&"\\"!=o){c=bu;continue}break;case bu:if("@"==o){h&&(f="%40"+f),h=!0,a=Xa(f);for(var v=0;v<a.length;v++){var g=a[v];if(":"!=g||p){var m=tu(g,eu);p?e.password+=m:e.username+=m}else p=!0}f=""}else if(o==Es||"/"==o||"?"==o||"#"==o||"\\"==o&&ru(e)){if(h&&""==f)return"Invalid authority";l-=Xa(f).length+1,f="",c=_u}else f+=o;break;case _u:case xu:if(n&&"file"==e.scheme){c=Tu;continue}if(":"!=o||d){if(o==Es||"/"==o||"?"==o||"#"==o||"\\"==o&&ru(e)){if(ru(e)&&""==f)return"Invalid host";if(n&&""==f&&(iu(e)||null!==e.port))return;if(s=Ys(e,f))return s;if(f="",c=Eu,n)return;continue}"["==o?d=!0:"]"==o&&(d=!1),f+=o}else{if(""==f)return"Invalid host";if(s=Ys(e,f))return s;if(f="",c=Su,n==xu)return}break;case Su:if(!zs.test(o)){if(o==Es||"/"==o||"?"==o||"#"==o||"\\"==o&&ru(e)||n){if(""!=f){var y=parseInt(f,10);if(y>65535)return"Invalid port";e.port=ru(e)&&y===nu[e.scheme]?null:y,f=""}if(n)return;c=Eu;continue}return"Invalid port"}f+=o;break;case wu:if(e.scheme="file","/"==o||"\\"==o)c=Au;else{if(!r||"file"!=r.scheme){c=Cu;continue}if(o==Es)e.host=r.host,e.path=r.path.slice(),e.query=r.query;else if("?"==o)e.host=r.host,e.path=r.path.slice(),e.query="",c=ku;else{if("#"!=o){su(i.slice(l).join(""))||(e.host=r.host,e.path=r.path.slice(),uu(e)),c=Cu;continue}e.host=r.host,e.path=r.path.slice(),e.query=r.query,e.fragment="",c=Ou}}break;case Au:if("/"==o||"\\"==o){c=Tu;break}r&&"file"==r.scheme&&!su(i.slice(l).join(""))&&(au(r.path[0],!0)?e.path.push(r.path[0]):e.host=r.host),c=Cu;continue;case Tu:if(o==Es||"/"==o||"\\"==o||"?"==o||"#"==o){if(!n&&au(f))c=Cu;else if(""==f){if(e.host="",n)return;c=Eu}else{if(s=Ys(e,f))return s;if("localhost"==e.host&&(e.host=""),n)return;f="",c=Eu}continue}f+=o;break;case Eu:if(ru(e)){if(c=Cu,"/"!=o&&"\\"!=o)continue}else if(n||"?"!=o)if(n||"#"!=o){if(o!=Es&&(c=Cu,"/"!=o))continue}else e.fragment="",c=Ou;else e.query="",c=ku;break;case Cu:if(o==Es||"/"==o||"\\"==o&&ru(e)||!n&&("?"==o||"#"==o)){if(".."===(u=(u=f).toLowerCase())||"%2e."===u||".%2e"===u||"%2e%2e"===u?(uu(e),"/"==o||"\\"==o&&ru(e)||e.path.push("")):cu(f)?"/"==o||"\\"==o&&ru(e)||e.path.push(""):("file"==e.scheme&&!e.path.length&&au(f)&&(e.host&&(e.host=""),f=f.charAt(0)+":"),e.path.push(f)),f="","file"==e.scheme&&(o==Es||"?"==o||"#"==o))for(;e.path.length>1&&""===e.path[0];)e.path.shift();"?"==o?(e.query="",c=ku):"#"==o&&(e.fragment="",c=Ou)}else f+=tu(o,$s);break;case Mu:"?"==o?(e.query="",c=ku):"#"==o?(e.fragment="",c=Ou):o!=Es&&(e.path[0]+=tu(o,Qs));break;case ku:n||"#"!=o?o!=Es&&("'"==o&&ru(e)?e.query+="%27":e.query+="#"==o?"%23":tu(o,Qs)):(e.fragment="",c=Ou);break;case Ou:o!=Es&&(e.fragment+=tu(o,Js))}l++}},Pu=function(e){var t,n,r=Ai(this,Pu,"URL"),i=arguments.length>1?arguments[1]:void 0,o=String(e),a=Ps(r,{type:"URL"});if(void 0!==i)if(i instanceof Pu)t=Ls(i);else if(n=Iu(t={},String(i)))throw TypeError(n);if(n=Iu(a,o,null,t))throw TypeError(n);var s=a.searchParams=new Os,u=Is(s);u.updateSearchParams(a.query),u.updateURL=function(){a.query=String(s)||null},ae||(r.href=Ru.call(r),r.origin=Nu.call(r),r.protocol=Du.call(r),r.username=Fu.call(r),r.password=zu.call(r),r.host=ju.call(r),r.hostname=Uu.call(r),r.port=Bu.call(r),r.pathname=Vu.call(r),r.search=Hu.call(r),r.searchParams=Gu.call(r),r.hash=Wu.call(r))},Lu=Pu.prototype,Ru=function(){var e=Ls(this),t=e.scheme,n=e.username,r=e.password,i=e.host,o=e.port,a=e.path,s=e.query,u=e.fragment,c=t+":";return null!==i?(c+="//",iu(e)&&(c+=n+(r?":"+r:"")+"@"),c+=Ks(i),null!==o&&(c+=":"+o)):"file"==t&&(c+="//"),c+=e.cannotBeABaseURL?a[0]:a.length?"/"+a.join("/"):"",null!==s&&(c+="?"+s),null!==u&&(c+="#"+u),c},Nu=function(){var e=Ls(this),t=e.scheme,n=e.port;if("blob"==t)try{return new Pu(t.path[0]).origin}catch(e){return"null"}return"file"!=t&&ru(e)?t+"://"+Ks(e.host)+(null!==n?":"+n:""):"null"},Du=function(){return Ls(this).scheme+":"},Fu=function(){return Ls(this).username},zu=function(){return Ls(this).password},ju=function(){var e=Ls(this),t=e.host,n=e.port;return null===t?"":null===n?Ks(t):Ks(t)+":"+n},Uu=function(){var e=Ls(this).host;return null===e?"":Ks(e)},Bu=function(){var e=Ls(this).port;return null===e?"":String(e)},Vu=function(){var e=Ls(this),t=e.path;return e.cannotBeABaseURL?t[0]:t.length?"/"+t.join("/"):""},Hu=function(){var e=Ls(this).query;return e?"?"+e:""},Gu=function(){return Ls(this).searchParams},Wu=function(){var e=Ls(this).fragment;return e?"#"+e:""},Zu=function(e,t){return{get:e,set:t,configurable:!0,enumerable:!0}};if(ae&&Gt(Lu,{href:Zu(Ru,(function(e){var t=Ls(this),n=String(e),r=Iu(t,n);if(r)throw TypeError(r);Is(t.searchParams).updateSearchParams(t.query)})),origin:Zu(Nu),protocol:Zu(Du,(function(e){var t=Ls(this);Iu(t,String(e)+":",lu)})),username:Zu(Fu,(function(e){var t=Ls(this),n=Xa(String(e));if(!ou(t)){t.username="";for(var r=0;r<n.length;r++)t.username+=tu(n[r],eu)}})),password:Zu(zu,(function(e){var t=Ls(this),n=Xa(String(e));if(!ou(t)){t.password="";for(var r=0;r<n.length;r++)t.password+=tu(n[r],eu)}})),host:Zu(ju,(function(e){var t=Ls(this);t.cannotBeABaseURL||Iu(t,String(e),_u)})),hostname:Zu(Uu,(function(e){var t=Ls(this);t.cannotBeABaseURL||Iu(t,String(e),xu)})),port:Zu(Bu,(function(e){var t=Ls(this);ou(t)||(""==(e=String(e))?t.port=null:Iu(t,e,Su))})),pathname:Zu(Vu,(function(e){var t=Ls(this);t.cannotBeABaseURL||(t.path=[],Iu(t,e+"",Eu))})),search:Zu(Hu,(function(e){var t=Ls(this);""==(e=String(e))?t.query=null:("?"==e.charAt(0)&&(e=e.slice(1)),t.query="",Iu(t,e,ku)),Is(t.searchParams).updateSearchParams(t.query)})),searchParams:Zu(Gu),hash:Zu(Wu,(function(e){var t=Ls(this);""!=(e=String(e))?("#"==e.charAt(0)&&(e=e.slice(1)),t.fragment="",Iu(t,e,Ou)):t.fragment=null}))}),rt(Lu,"toJSON",(function(){return Ru.call(this)}),{enumerable:!0}),rt(Lu,"toString",(function(){return Ru.call(this)}),{enumerable:!0}),ks){var Yu=ks.createObjectURL,qu=ks.revokeObjectURL;Yu&&rt(Pu,"createObjectURL",(function(e){return Yu.apply(ks,arguments)})),qu&&rt(Pu,"revokeObjectURL",(function(e){return qu.apply(ks,arguments)}))}ln(Pu,"URL"),Lt({global:!0,forced:!Ga,sham:!ae},{URL:Pu});var Xu,Ku="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Qu=Oe.f,Ju=ie.Int8Array,$u=Ju&&Ju.prototype,ec=ie.Uint8ClampedArray,tc=ec&&ec.prototype,nc=Ju&&Jr(Ju),rc=$u&&Jr($u),ic=Object.prototype,oc=ic.isPrototypeOf,ac=on("toStringTag"),sc=Ge("TYPED_ARRAY_TAG"),uc=Ku&&!!oi&&"Opera"!==or(ie.opera),cc=!1,lc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},fc={BigInt64Array:8,BigUint64Array:8},hc=function(e){if(!me(e))return!1;var t=or(e);return xe(lc,t)||xe(fc,t)};for(Xu in lc)ie[Xu]||(uc=!1);if((!uc||"function"!=typeof nc||nc===Function.prototype)&&(nc=function(){throw TypeError("Incorrect invocation")},uc))for(Xu in lc)ie[Xu]&&oi(ie[Xu],nc);if((!uc||!rc||rc===ic)&&(rc=nc.prototype,uc))for(Xu in lc)ie[Xu]&&oi(ie[Xu].prototype,rc);if(uc&&Jr(tc)!==rc&&oi(tc,rc),ae&&!xe(rc,ac))for(Xu in cc=!0,Qu(rc,ac,{get:function(){return me(this)?this[sc]:void 0}}),lc)ie[Xu]&&Ie(ie[Xu],sc,Xu);var dc={NATIVE_ARRAY_BUFFER_VIEWS:uc,TYPED_ARRAY_TAG:cc&&sc,aTypedArray:function(e){if(hc(e))return e;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(e){if(oi){if(oc.call(nc,e))return e}else for(var t in lc)if(xe(lc,Xu)){var n=ie[t];if(n&&(e===n||oc.call(n,e)))return e}throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(e,t,n){if(ae){if(n)for(var r in lc){var i=ie[r];if(i&&xe(i.prototype,e))try{delete i.prototype[e]}catch(e){}}rc[e]&&!n||rt(rc,e,n?t:uc&&$u[e]||t)}},exportTypedArrayStaticMethod:function(e,t,n){var r,i;if(ae){if(oi){if(n)for(r in lc)if((i=ie[r])&&xe(i,e))try{delete i[e]}catch(e){}if(nc[e]&&!n)return;try{return rt(nc,e,n?t:uc&&nc[e]||t)}catch(e){}}for(r in lc)!(i=ie[r])||i[e]&&!n||rt(i,e,t)}},isView:function(e){if(!me(e))return!1;var t=or(e);return"DataView"===t||xe(lc,t)||xe(fc,t)},isTypedArray:hc,TypedArray:nc,TypedArrayPrototype:rc},pc=dc.NATIVE_ARRAY_BUFFER_VIEWS,vc=ie.ArrayBuffer,gc=ie.Int8Array,mc=!pc||!oe((function(){gc(1)}))||!oe((function(){new gc(-1)}))||!ki((function(e){new gc,new gc(null),new gc(1.5),new gc(e)}),!0)||oe((function(){return 1!==new gc(new vc(2),1,void 0).length})),yc=function(e){if(void 0===e)return 0;var t=ct(e),n=ft(t);if(t!==n)throw RangeError("Wrong length or index");return n},bc=Math.abs,_c=Math.pow,xc=Math.floor,Sc=Math.log,wc=Math.LN2,Ac=function(e,t,n){var r,i,o,a=new Array(n),s=8*n-t-1,u=(1<<s)-1,c=u>>1,l=23===t?_c(2,-24)-_c(2,-77):0,f=e<0||0===e&&1/e<0?1:0,h=0;for((e=bc(e))!=e||e===1/0?(i=e!=e?1:0,r=u):(r=xc(Sc(e)/wc),e*(o=_c(2,-r))<1&&(r--,o*=2),(e+=r+c>=1?l/o:l*_c(2,1-c))*o>=2&&(r++,o/=2),r+c>=u?(i=0,r=u):r+c>=1?(i=(e*o-1)*_c(2,t),r+=c):(i=e*_c(2,c-1)*_c(2,t),r=0));t>=8;a[h++]=255&i,i/=256,t-=8);for(r=r<<t|i,s+=t;s>0;a[h++]=255&r,r/=256,s-=8);return a[--h]|=128*f,a},Tc=function(e,t){var n,r=e.length,i=8*r-t-1,o=(1<<i)-1,a=o>>1,s=i-7,u=r-1,c=e[u--],l=127&c;for(c>>=7;s>0;l=256*l+e[u],u--,s-=8);for(n=l&(1<<-s)-1,l>>=-s,s+=t;s>0;n=256*n+e[u],u--,s-=8);if(0===l)l=1-a;else{if(l===o)return n?NaN:c?-1/0:1/0;n+=_c(2,t),l-=a}return(c?-1:1)*n*_c(2,l-t)},Ec=function(e){for(var t=be(this),n=ft(t.length),r=arguments.length,i=pt(r>1?arguments[1]:void 0,n),o=r>2?arguments[2]:void 0,a=void 0===o?n:pt(o,n);a>i;)t[i++]=e;return t},Cc=xt.f,Mc=Oe.f,kc=nt.get,Oc=nt.set,Ic=ie.ArrayBuffer,Pc=Ic,Lc=ie.DataView,Rc=Lc&&Lc.prototype,Nc=Object.prototype,Dc=ie.RangeError,Fc=Ac,zc=Tc,jc=function(e){return[255&e]},Uc=function(e){return[255&e,e>>8&255]},Bc=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},Vc=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},Hc=function(e){return Fc(e,23,4)},Gc=function(e){return Fc(e,52,8)},Wc=function(e,t){Mc(e.prototype,t,{get:function(){return kc(this)[t]}})},Zc=function(e,t,n,r){var i=yc(n),o=kc(e);if(i+t>o.byteLength)throw Dc("Wrong index");var a=kc(o.buffer).bytes,s=i+o.byteOffset,u=a.slice(s,s+t);return r?u:u.reverse()},Yc=function(e,t,n,r,i,o){var a=yc(n),s=kc(e);if(a+t>s.byteLength)throw Dc("Wrong index");for(var u=kc(s.buffer).bytes,c=a+s.byteOffset,l=r(+i),f=0;f<t;f++)u[c+f]=l[o?f:t-f-1]};if(Ku){if(!oe((function(){Ic(1)}))||!oe((function(){new Ic(-1)}))||oe((function(){return new Ic,new Ic(1.5),new Ic(NaN),"ArrayBuffer"!=Ic.name}))){for(var qc,Xc=(Pc=function(e){return Ai(this,Pc),new Ic(yc(e))}).prototype=Ic.prototype,Kc=Cc(Ic),Qc=0;Kc.length>Qc;)(qc=Kc[Qc++])in Pc||Ie(Pc,qc,Ic[qc]);Xc.constructor=Pc}oi&&Jr(Rc)!==Nc&&oi(Rc,Nc);var Jc=new Lc(new Pc(2)),$c=Rc.setInt8;Jc.setInt8(0,2147483648),Jc.setInt8(1,2147483649),!Jc.getInt8(0)&&Jc.getInt8(1)||Pi(Rc,{setInt8:function(e,t){$c.call(this,e,t<<24>>24)},setUint8:function(e,t){$c.call(this,e,t<<24>>24)}},{unsafe:!0})}else Pc=function(e){Ai(this,Pc,"ArrayBuffer");var t=yc(e);Oc(this,{bytes:Ec.call(new Array(t),0),byteLength:t}),ae||(this.byteLength=t)},Lc=function(e,t,n){Ai(this,Lc,"DataView"),Ai(e,Pc,"DataView");var r=kc(e).byteLength,i=ct(t);if(i<0||i>r)throw Dc("Wrong offset");if(i+(n=void 0===n?r-i:ft(n))>r)throw Dc("Wrong length");Oc(this,{buffer:e,byteLength:n,byteOffset:i}),ae||(this.buffer=e,this.byteLength=n,this.byteOffset=i)},ae&&(Wc(Pc,"byteLength"),Wc(Lc,"buffer"),Wc(Lc,"byteLength"),Wc(Lc,"byteOffset")),Pi(Lc.prototype,{getInt8:function(e){return Zc(this,1,e)[0]<<24>>24},getUint8:function(e){return Zc(this,1,e)[0]},getInt16:function(e){var t=Zc(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=Zc(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return Vc(Zc(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return Vc(Zc(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return zc(Zc(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return zc(Zc(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){Yc(this,1,e,jc,t)},setUint8:function(e,t){Yc(this,1,e,jc,t)},setInt16:function(e,t){Yc(this,2,e,Uc,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){Yc(this,2,e,Uc,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){Yc(this,4,e,Bc,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){Yc(this,4,e,Bc,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){Yc(this,4,e,Hc,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){Yc(this,8,e,Gc,t,arguments.length>2?arguments[2]:void 0)}});ln(Pc,"ArrayBuffer"),ln(Lc,"DataView");var el={ArrayBuffer:Pc,DataView:Lc},tl=function(e,t){var n=function(e){var t=ct(e);if(t<0)throw RangeError("The argument can't be less than 0");return t}(e);if(n%t)throw RangeError("Wrong offset");return n},nl=dc.aTypedArrayConstructor,rl=function(e){var t,n,r,i,o,a,s=be(e),u=arguments.length,c=u>1?arguments[1]:void 0,l=void 0!==c,f=_i(s);if(null!=f&&!yi(f))for(a=(o=f.call(s)).next,s=[];!(i=a.call(o)).done;)s.push(i.value);for(l&&u>2&&(c=hn(c,arguments[2],2)),n=ft(s.length),r=new(nl(this))(n),t=0;n>t;t++)r[t]=l?c(s[t],t):s[t];return r},il=o((function(e){var t=xt.f,n=mn.forEach,r=nt.get,i=nt.set,o=Oe.f,a=Ce.f,s=Math.round,u=ie.RangeError,c=el.ArrayBuffer,l=el.DataView,f=dc.NATIVE_ARRAY_BUFFER_VIEWS,h=dc.TYPED_ARRAY_TAG,d=dc.TypedArray,p=dc.TypedArrayPrototype,v=dc.aTypedArrayConstructor,g=dc.isTypedArray,m=function(e,t){for(var n=0,r=t.length,i=new(v(e))(r);r>n;)i[n]=t[n++];return i},y=function(e,t){o(e,t,{get:function(){return r(this)[t]}})},b=function(e){var t;return e instanceof c||"ArrayBuffer"==(t=or(e))||"SharedArrayBuffer"==t},_=function(e,t){return g(e)&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},x=function(e,t){return _(e,t=ye(t,!0))?le(2,e[t]):a(e,t)},S=function(e,t,n){return!(_(e,t=ye(t,!0))&&me(n)&&xe(n,"value"))||xe(n,"get")||xe(n,"set")||n.configurable||xe(n,"writable")&&!n.writable||xe(n,"enumerable")&&!n.enumerable?o(e,t,n):(e[t]=n.value,e)};ae?(f||(Ce.f=x,Oe.f=S,y(p,"buffer"),y(p,"byteOffset"),y(p,"byteLength"),y(p,"length")),Lt({target:"Object",stat:!0,forced:!f},{getOwnPropertyDescriptor:x,defineProperty:S}),e.exports=function(e,a,v){var y=e.match(/\d+$/)[0]/8,_=e+(v?"Clamped":"")+"Array",x="get"+e,S="set"+e,w=ie[_],A=w,T=A&&A.prototype,E={},C=function(e,t){o(e,t,{get:function(){return function(e,t){var n=r(e);return n.view[x](t*y+n.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,n){var i=r(e);v&&(n=(n=s(n))<0?0:n>255?255:255&n),i.view[S](t*y+i.byteOffset,n,!0)}(this,t,e)},enumerable:!0})};f?mc&&(A=a((function(e,t,n,r){return Ai(e,A,_),Oi(me(t)?b(t)?void 0!==r?new w(t,tl(n,y),r):void 0!==n?new w(t,tl(n,y)):new w(t):g(t)?m(A,t):rl.call(A,t):new w(yc(t)),e,A)})),oi&&oi(A,d),n(t(w),(function(e){e in A||Ie(A,e,w[e])})),A.prototype=T):(A=a((function(e,t,n,r){Ai(e,A,_);var o,a,s,f=0,h=0;if(me(t)){if(!b(t))return g(t)?m(A,t):rl.call(A,t);o=t,h=tl(n,y);var d=t.byteLength;if(void 0===r){if(d%y)throw u("Wrong length");if((a=d-h)<0)throw u("Wrong length")}else if((a=ft(r)*y)+h>d)throw u("Wrong length");s=a/y}else s=yc(t),o=new c(a=s*y);for(i(e,{buffer:o,byteOffset:h,byteLength:a,length:s,view:new l(o)});f<s;)C(e,f++)})),oi&&oi(A,d),T=A.prototype=Kt(p)),T.constructor!==A&&Ie(T,"constructor",A),h&&Ie(T,h,_),E[_]=A,Lt({global:!0,forced:A!=w,sham:!f},E),"BYTES_PER_ELEMENT"in A||Ie(A,"BYTES_PER_ELEMENT",y),"BYTES_PER_ELEMENT"in T||Ie(T,"BYTES_PER_ELEMENT",y),Ri(_)}):e.exports=function(){}}));il("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var ol=Math.min,al=[].copyWithin||function(e,t){var n=be(this),r=ft(n.length),i=pt(e,r),o=pt(t,r),a=arguments.length>2?arguments[2]:void 0,s=ol((void 0===a?r:pt(a,r))-o,r-i),u=1;for(o<i&&i<o+s&&(u=-1,o+=s-1,i+=s-1);s-- >0;)o in n?n[i]=n[o]:delete n[i],i+=u,o+=u;return n},sl=dc.aTypedArray;(0,dc.exportTypedArrayMethod)("copyWithin",(function(e,t){return al.call(sl(this),e,t,arguments.length>2?arguments[2]:void 0)}));var ul=mn.every,cl=dc.aTypedArray;(0,dc.exportTypedArrayMethod)("every",(function(e){return ul(cl(this),e,arguments.length>1?arguments[1]:void 0)}));var ll=dc.aTypedArray;(0,dc.exportTypedArrayMethod)("fill",(function(e){return Ec.apply(ll(this),arguments)}));var fl=dc.aTypedArrayConstructor,hl=function(e,t){for(var n=ea(e,e.constructor),r=0,i=t.length,o=new(fl(n))(i);i>r;)o[r]=t[r++];return o},dl=mn.filter,pl=dc.aTypedArray;(0,dc.exportTypedArrayMethod)("filter",(function(e){var t=dl(pl(this),e,arguments.length>1?arguments[1]:void 0);return hl(this,t)}));var vl=mn.find,gl=dc.aTypedArray;(0,dc.exportTypedArrayMethod)("find",(function(e){return vl(gl(this),e,arguments.length>1?arguments[1]:void 0)}));var ml=mn.findIndex,yl=dc.aTypedArray;(0,dc.exportTypedArrayMethod)("findIndex",(function(e){return ml(yl(this),e,arguments.length>1?arguments[1]:void 0)}));var bl=mn.forEach,_l=dc.aTypedArray;(0,dc.exportTypedArrayMethod)("forEach",(function(e){bl(_l(this),e,arguments.length>1?arguments[1]:void 0)}));var xl=gt.includes,Sl=dc.aTypedArray;(0,dc.exportTypedArrayMethod)("includes",(function(e){return xl(Sl(this),e,arguments.length>1?arguments[1]:void 0)}));var wl=gt.indexOf,Al=dc.aTypedArray;(0,dc.exportTypedArrayMethod)("indexOf",(function(e){return wl(Al(this),e,arguments.length>1?arguments[1]:void 0)}));var Tl=on("iterator"),El=ie.Uint8Array,Cl=di.values,Ml=di.keys,kl=di.entries,Ol=dc.aTypedArray,Il=dc.exportTypedArrayMethod,Pl=El&&El.prototype[Tl],Ll=!!Pl&&("values"==Pl.name||null==Pl.name),Rl=function(){return Cl.call(Ol(this))};Il("entries",(function(){return kl.call(Ol(this))})),Il("keys",(function(){return Ml.call(Ol(this))})),Il("values",Rl,!Ll),Il(Tl,Rl,!Ll);var Nl=dc.aTypedArray,Dl=[].join;(0,dc.exportTypedArrayMethod)("join",(function(e){return Dl.apply(Nl(this),arguments)}));var Fl=Math.min,zl=[].lastIndexOf,jl=!!zl&&1/[1].lastIndexOf(1,-0)<0,Ul=$i("lastIndexOf"),Bl=jl||!Ul?function(e){if(jl)return zl.apply(this,arguments)||0;var t=ge(this),n=ft(t.length),r=n-1;for(arguments.length>1&&(r=Fl(r,ct(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}:zl,Vl=dc.aTypedArray;(0,dc.exportTypedArrayMethod)("lastIndexOf",(function(e){return Bl.apply(Vl(this),arguments)}));var Hl=mn.map,Gl=dc.aTypedArray,Wl=dc.aTypedArrayConstructor;(0,dc.exportTypedArrayMethod)("map",(function(e){return Hl(Gl(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(Wl(ea(e,e.constructor)))(t)}))}));var Zl=function(e){return function(t,n,r,i){fn(n);var o=be(t),a=pe(o),s=ft(o.length),u=e?s-1:0,c=e?-1:1;if(r<2)for(;;){if(u in a){i=a[u],u+=c;break}if(u+=c,e?u<0:s<=u)throw TypeError("Reduce of empty array with no initial value")}for(;e?u>=0:s>u;u+=c)u in a&&(i=n(i,a[u],u,o));return i}},Yl={left:Zl(!1),right:Zl(!0)},ql=Yl.left,Xl=dc.aTypedArray;(0,dc.exportTypedArrayMethod)("reduce",(function(e){return ql(Xl(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}));var Kl=Yl.right,Ql=dc.aTypedArray;(0,dc.exportTypedArrayMethod)("reduceRight",(function(e){return Kl(Ql(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}));var Jl=dc.aTypedArray,$l=dc.exportTypedArrayMethod,ef=Math.floor;$l("reverse",(function(){for(var e,t=Jl(this).length,n=ef(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this}));var tf=dc.aTypedArray;(0,dc.exportTypedArrayMethod)("set",(function(e){tf(this);var t=tl(arguments.length>1?arguments[1]:void 0,1),n=this.length,r=be(e),i=ft(r.length),o=0;if(i+t>n)throw RangeError("Wrong length");for(;o<i;)this[t+o]=r[o++]}),oe((function(){new Int8Array(1).set({})})));var nf=dc.aTypedArray,rf=dc.aTypedArrayConstructor,of=[].slice;(0,dc.exportTypedArrayMethod)("slice",(function(e,t){for(var n=of.call(nf(this),e,t),r=ea(this,this.constructor),i=0,o=n.length,a=new(rf(r))(o);o>i;)a[i]=n[i++];return a}),oe((function(){new Int8Array(1).slice()})));var af=mn.some,sf=dc.aTypedArray;(0,dc.exportTypedArrayMethod)("some",(function(e){return af(sf(this),e,arguments.length>1?arguments[1]:void 0)}));var uf=Math.floor,cf=function(e,t){var n=e.length,r=uf(n/2);return n<8?lf(e,t):ff(cf(e.slice(0,r),t),cf(e.slice(r),t),t)},lf=function(e,t){for(var n,r,i=e.length,o=1;o<i;){for(r=o,n=e[o];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==o++&&(e[r]=n)}return e},ff=function(e,t,n){for(var r=e.length,i=t.length,o=0,a=0,s=[];o<r||a<i;)o<r&&a<i?s.push(n(e[o],t[a])<=0?e[o++]:t[a++]):s.push(o<r?e[o++]:t[a++]);return s},hf=cf,df=Rt.match(/firefox\/(\d+)/i),pf=!!df&&+df[1],vf=/MSIE|Trident/.test(Rt),gf=Rt.match(/AppleWebKit\/(\d+)\./),mf=!!gf&&+gf[1],yf=dc.aTypedArray,bf=dc.exportTypedArrayMethod,_f=ie.Uint16Array,xf=_f&&_f.prototype.sort,Sf=!!xf&&!oe((function(){var e=new _f(2);e.sort(null),e.sort({})})),wf=!!xf&&!oe((function(){if(jt)return jt<74;if(pf)return pf<67;if(vf)return!0;if(mf)return mf<602;var e,t,n=new _f(516),r=Array(516);for(e=0;e<516;e++)t=e%4,n[e]=515-e,r[e]=e-2*t+3;for(n.sort((function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(n[e]!==r[e])return!0}));bf("sort",(function(e){if(void 0!==e&&fn(e),wf)return xf.call(this,e);yf(this);var t,n=ft(this.length),r=Array(n);for(t=0;t<n;t++)r[t]=this[t];for(r=hf(this,function(e){return function(t,n){return void 0!==e?+e(t,n)||0:n!=n?-1:t!=t?1:0===t&&0===n?1/t>0&&1/n<0?1:-1:t>n}}(e)),t=0;t<n;t++)this[t]=r[t];return this}),!wf||Sf);var Af=dc.aTypedArray;(0,dc.exportTypedArrayMethod)("subarray",(function(e,t){var n=Af(this),r=n.length,i=pt(e,r);return new(ea(n,n.constructor))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,ft((void 0===t?r:pt(t,r))-i))}));var Tf=ie.Int8Array,Ef=dc.aTypedArray,Cf=dc.exportTypedArrayMethod,Mf=[].toLocaleString,kf=[].slice,Of=!!Tf&&oe((function(){Mf.call(new Tf(1))}));Cf("toLocaleString",(function(){return Mf.apply(Of?kf.call(Ef(this)):Ef(this),arguments)}),oe((function(){return[1,2].toLocaleString()!=new Tf([1,2]).toLocaleString()}))||!oe((function(){Tf.prototype.toLocaleString.call([1,2])})));var If=dc.exportTypedArrayMethod,Pf=ie.Uint8Array,Lf=Pf&&Pf.prototype||{},Rf=[].toString,Nf=[].join;oe((function(){Rf.call({})}))&&(Rf=function(){return Nf.call(this)});var Df=Lf.toString!=Rf;If("toString",Rf,Df);var Ff=function(e){mr(n,e);var t=Er(n);function n(e,r,i){var o;return dr(this,n),gr(Ar(o=t.call(this,e)),"status",void 0),gr(Ar(o),"url",void 0),o.status=r,o.url=i,o.name=o.constructor.name,o.message=e,o}return vr(n,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),n}(Sr(Error));function zf(e){var t=new XMLHttpRequest;for(var n in t.open("GET",e.url,!0),e.headers)e.headers.hasOwnProperty(n)&&t.setRequestHeader(n,e.headers[n]);return t.withCredentials="include"===e.credentials,t}var jf=function(e,t){var n=zf(e);return n.responseType="arraybuffer",n.onerror=function(){t(new Error(n.statusText))},n.onload=function(){var r=n.response;if(0===r.byteLength&&200===n.status)return t(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?t(null,{data:r,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):t(new Ff(n.statusText,n.status,e.url))},n.send(),n},Uf=function(e,t){return jf(e,(function(e,n){if(e)t(e);else if(n){var r=new window.Image;r.crossOrigin="anonymous";var i=window.URL||window.webkitURL;r.onload=function(){t(null,r),i.revokeObjectURL(r.src)};var o=new window.Blob([new Uint8Array(n.data)],{type:"image/png"});r.src=n.data.byteLength?i.createObjectURL(o):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="}}))},Bf=mn.map,Vf=Fr("map");Lt({target:"Array",proto:!0,forced:!Vf},{map:function(e){return Bf(this,e,arguments.length>1?arguments[1]:void 0)}});var Hf=xt.f,Gf=Ce.f,Wf=Oe.f,Zf=Xo.trim,Yf=ie.Number,qf=Yf.prototype,Xf="Number"==he(Kt(qf)),Kf=function(e){var t,n,r,i,o,a,s,u,c=ye(e,!1);if("string"==typeof c&&c.length>2)if(43===(t=(c=Zf(c)).charCodeAt(0))||45===t){if(88===(n=c.charCodeAt(2))||120===n)return NaN}else if(48===t){switch(c.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+c}for(a=(o=c.slice(2)).length,s=0;s<a;s++)if((u=o.charCodeAt(s))<48||u>i)return NaN;return parseInt(o,r)}return+c};if(It("Number",!Yf(" 0o1")||!Yf("0b1")||Yf("+0x1"))){for(var Qf,Jf=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof Jf&&(Xf?oe((function(){qf.valueOf.call(n)})):"Number"!=he(n))?Oi(new Yf(Kf(t)),n,Jf):Kf(t)},$f=ae?Hf(Yf):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),eh=0;$f.length>eh;eh++)xe(Yf,Qf=$f[eh])&&!xe(Jf,Qf)&&Wf(Jf,Qf,Gf(Yf,Qf));Jf.prototype=qf,qf.constructor=Jf,rt(ie,"Number",Jf)}var th=function(e){var t=String(ve(this)),n="",r=ct(e);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n},nh=1..toFixed,rh=Math.floor,ih=function(e,t,n){return 0===t?n:t%2==1?ih(e,t-1,n*e):ih(e*e,t/2,n)},oh=function(e,t,n){for(var r=-1,i=n;++r<6;)i+=t*e[r],e[r]=i%1e7,i=rh(i/1e7)},ah=function(e,t){for(var n=6,r=0;--n>=0;)r+=e[n],e[n]=rh(r/t),r=r%t*1e7},sh=function(e){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==e[t]){var r=String(e[t]);n=""===n?r:n+th.call("0",7-r.length)+r}return n},uh=nh&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!oe((function(){nh.call({})}));Lt({target:"Number",proto:!0,forced:uh},{toFixed:function(e){var t,n,r,i,o=function(e){if("number"!=typeof e&&"Number"!=he(e))throw TypeError("Incorrect invocation");return+e}(this),a=ct(e),s=[0,0,0,0,0,0],u="",c="0";if(a<0||a>20)throw RangeError("Incorrect fraction digits");if(o!=o)return"NaN";if(o<=-1e21||o>=1e21)return String(o);if(o<0&&(u="-",o=-o),o>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(o*ih(2,69,1))-69)<0?o*ih(2,-t,1):o/ih(2,t,1),n*=4503599627370496,(t=52-t)>0){for(oh(s,0,n),r=a;r>=7;)oh(s,1e7,0),r-=7;for(oh(s,ih(10,r,1),0),r=t-1;r>=23;)ah(s,1<<23),r-=23;ah(s,1<<r),oh(s,1,1),ah(s,2),c=sh(s)}else oh(s,0,n),oh(s,1<<-t,0),c=sh(s)+th.call("0",a);return c=a>0?u+((i=c.length)<=a?"0."+th.call("0",a-i)+c:c.slice(0,i-a)+"."+c.slice(i-a)):u+c}});var ch={centimeters:637100880,centimetres:637100880,degrees:6371008.8/111325,feet:20902260.511392,inches:6371008.8*39.37,kilometers:6371.0088,kilometres:6371.0088,meters:6371008.8,metres:6371008.8,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:6371008.8/1852,radians:1,yards:6371008.8*1.0936};function lh(e){return e%360*Math.PI/180}var fh=2*Math.PI*6378137/2;function hh(e){var t=[1/0,1/0,-1/0,-1/0];return e.forEach((function(e){var n=e.coordinates;!function e(t,n){Array.isArray(n[0])?n.forEach((function(n){e(t,n)})):(t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1]));return t}(t,n)})),t}function dh(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{enable:!0,decimal:1},r=(e=gh(e,t))[0],i=e[1],o=r*fh/180,a=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return a=a*fh/180,n.enable&&(o=Number(o.toFixed(n.decimal)),a=Number(a.toFixed(n.decimal))),3===e.length?[o,a,e[2]]:[o,a]}function ph(e){if(null==e)throw new Error("lng is required");return(e>180||e<-180)&&((e%=360)>180&&(e=-360+e),e<-180&&(e=360+e),0===e&&(e=0)),e}function vh(e){if(null==e)throw new Error("lat is required");return(e>90||e<-90)&&((e%=180)>90&&(e=-180+e),e<-90&&(e=180+e),0===e&&(e=0)),e}function gh(e,t){if(!1===t)return e;var n=ph(e[0]),r=vh(e[1]);return r>85&&(r=85),r<-85&&(r=-85),3===e.length?[n,r,e[2]]:[n,r]}function mh(e){var t=Math.max(Math.min(85.0511287798,e[1]),-85.0511287798),n=Math.PI/180,r=e[0]*n,i=t*n;i=Math.log(Math.tan(Math.PI/4+i/2));return r=(256<<20)*(.5/Math.PI*r+.5),i=(256<<20)*(-.5/Math.PI*i+(n=.5)),[Math.floor(r),Math.floor(i)]}function yh(e,t,n){var r=lh(t[1]-e[1]),i=lh(t[0]-e[0]),o=lh(e[1]),a=lh(t[1]),s=Math.pow(Math.sin(r/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(o)*Math.cos(a);return function(e,t){void 0===t&&(t="kilometers");var n=ch[t];if(!n)throw new Error(t+" units is invalid");return e*n}(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),"meters")}function bh(e,t){var n=Math.abs(e[1][1]-e[0][1])*t,r=Math.abs(e[1][0]-e[0][0])*t;return[[e[0][0]-r,e[0][1]-n],[e[1][0]+r,e[1][1]+n]]}function _h(e,t){return e[0][0]<=t[0][0]&&e[0][1]<=t[0][1]&&e[1][0]>=t[1][0]&&e[1][1]>=t[1][1]}function xh(e){return[[e[0],e[1]],[e[2],e[3]]]}var Sh=mn.findIndex,wh=!0;"findIndex"in[]&&Array(1).findIndex((function(){wh=!1})),Lt({target:"Array",proto:!0,forced:wh},{findIndex:function(e){return Sh(this,e,arguments.length>1?arguments[1]:void 0)}}),Yr("findIndex");var Ah=Fr("splice"),Th=Math.max,Eh=Math.min;Lt({target:"Array",proto:!0,forced:!Ah},{splice:function(e,t){var n,r,i,o,a,s,u=be(this),c=ft(u.length),l=pt(e,c),f=arguments.length;if(0===f?n=r=0:1===f?(n=0,r=c-l):(n=f-2,r=Eh(Th(ct(t),0),c-l)),c+n-r>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(i=pn(u,r),o=0;o<r;o++)(a=l+o)in u&&Nr(i,o,u[a]);if(i.length=r,n<r){for(o=l;o<c-r;o++)s=o+n,(a=o+r)in u?u[s]=u[a]:delete u[s];for(o=c;o>c-r+n;o--)delete u[o-1]}else if(n>r)for(o=c-r;o>l;o--)s=o+n-1,(a=o+r-1)in u?u[s]=u[a]:delete u[s];for(o=0;o<n;o++)u[o+l]=arguments[o+2];return u.length=c-r+n,i}});var Ch=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1?arguments[1]:void 0;dr(this,e),gr(this,"limit",void 0),gr(this,"cache",void 0),gr(this,"destroy",void 0),gr(this,"order",void 0),this.limit=t,this.destroy=n||this.defaultDestroy,this.order=[],this.clear()}return vr(e,[{key:"clear",value:function(){var e=this;this.order.forEach((function(t){e.delete(t)})),this.cache={},this.order=[]}},{key:"get",value:function(e){var t=this.cache[e];return t&&(this.deleteOrder(e),this.appendOrder(e)),t}},{key:"set",value:function(e,t){this.cache[e]?(this.delete(e),this.cache[e]=t,this.appendOrder(e)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[e]=t,this.appendOrder(e))}},{key:"delete",value:function(e){var t=this.cache[e];t&&(this.deleteCache(e),this.deleteOrder(e),this.destroy(t,e))}},{key:"deleteCache",value:function(e){delete this.cache[e]}},{key:"deleteOrder",value:function(e){var t=this.order.findIndex((function(t){return t===e}));t>=0&&this.order.splice(t,1)}},{key:"appendOrder",value:function(e){this.order.push(e)}},{key:"defaultDestroy",value:function(e,t){return null}}]),e}();function Mh(e,t){e.forEach((function(e){t[e]&&(t[e]=t[e].bind(t))}))}function kh(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Oh(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Ih(){}il("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}),!0);var Ph,Lh="\\s*([+-]?\\d+)\\s*",Rh="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Nh="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Dh=/^#([0-9a-f]{3,8})$/,Fh=new RegExp("^rgb\\("+[Lh,Lh,Lh]+"\\)$"),zh=new RegExp("^rgb\\("+[Nh,Nh,Nh]+"\\)$"),jh=new RegExp("^rgba\\("+[Lh,Lh,Lh,Rh]+"\\)$"),Uh=new RegExp("^rgba\\("+[Nh,Nh,Nh,Rh]+"\\)$"),Bh=new RegExp("^hsl\\("+[Rh,Nh,Nh]+"\\)$"),Vh=new RegExp("^hsla\\("+[Rh,Nh,Nh,Rh]+"\\)$"),Hh={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Gh(){return this.rgb().formatHex()}function Wh(){return this.rgb().formatRgb()}function Zh(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Dh.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?Yh(t):3===n?new Qh(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?qh(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?qh(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Fh.exec(e))?new Qh(t[1],t[2],t[3],1):(t=zh.exec(e))?new Qh(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=jh.exec(e))?qh(t[1],t[2],t[3],t[4]):(t=Uh.exec(e))?qh(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Bh.exec(e))?td(t[1],t[2]/100,t[3]/100,1):(t=Vh.exec(e))?td(t[1],t[2]/100,t[3]/100,t[4]):Hh.hasOwnProperty(e)?Yh(Hh[e]):"transparent"===e?new Qh(NaN,NaN,NaN,0):null}function Yh(e){return new Qh(e>>16&255,e>>8&255,255&e,1)}function qh(e,t,n,r){return r<=0&&(e=t=n=NaN),new Qh(e,t,n,r)}function Xh(e){return e instanceof Ih||(e=Zh(e)),e?new Qh((e=e.rgb()).r,e.g,e.b,e.opacity):new Qh}function Kh(e,t,n,r){return 1===arguments.length?Xh(e):new Qh(e,t,n,null==r?1:r)}function Qh(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function Jh(){return"#"+ed(this.r)+ed(this.g)+ed(this.b)}function $h(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function ed(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function td(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new rd(e,t,n,r)}function nd(e){if(e instanceof rd)return new rd(e.h,e.s,e.l,e.opacity);if(e instanceof Ih||(e=Zh(e)),!e)return new rd;if(e instanceof rd)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),o=Math.max(t,n,r),a=NaN,s=o-i,u=(o+i)/2;return s?(a=t===o?(n-r)/s+6*(n<r):n===o?(r-t)/s+2:(t-n)/s+4,s/=u<.5?o+i:2-o-i,a*=60):s=u>0&&u<1?0:a,new rd(a,s,u,e.opacity)}function rd(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function id(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function od(e){var t=Zh(e),n=[0,0,0,0];return null!=t&&(n[0]=t.r/255,n[1]=t.g/255,n[2]=t.b/255,n[3]=t.opacity),n}function ad(e){return(e&&e[0])+256*(e&&e[1])+65536*(e&&e[2])-1}function sd(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function ud(e){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var r,i=n.createLinearGradient(0,0,256,1),o=e.positions[0],a=e.positions[e.positions.length-1],s=0;s<e.colors.length;++s){var u=(e.positions[s]-o)/(a-o);i.addColorStop(u,e.colors[s])}return n.fillStyle=i,n.fillRect(0,0,256,1),r=new Uint8ClampedArray(n.getImageData(0,0,256,1).data),new ImageData(r,256,1)}kh(Ih,Zh,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Gh,formatHex:Gh,formatHsl:function(){return nd(this).formatHsl()},formatRgb:Wh,toString:Wh}),kh(Qh,Kh,Oh(Ih,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new Qh(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new Qh(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Jh,formatHex:Jh,formatRgb:$h,toString:$h})),kh(rd,(function(e,t,n,r){return 1===arguments.length?nd(e):new rd(e,t,n,null==r?1:r)}),Oh(Ih,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new rd(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new rd(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Qh(id(e>=240?e-240:e+120,i,r),id(e,i,r),id(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}})),(Ph=e.anchorType||(e.anchorType={})).CENTER="center",Ph.TOP="top",Ph["TOP-LEFT"]="top-left",Ph["TOP-RIGHT"]="top-right",Ph.BOTTOM="bottom",Ph["BOTTOM-LEFT"]="bottom-left",Ph.LEFT="left",Ph.RIGHT="right";var cd={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ld(e,t,n){var r=e.classList;for(var i in cd)cd.hasOwnProperty(i)&&r.remove("l7-".concat(n,"-anchor-").concat(i));r.add("l7-".concat(n,"-anchor-").concat(t))}var fd=[],hd=fd.sort,dd=oe((function(){fd.sort(void 0)})),pd=oe((function(){fd.sort(null)})),vd=$i("sort"),gd=!oe((function(){if(jt)return jt<70;if(!(pf&&pf>3)){if(vf)return!0;if(mf)return mf<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)fd.push({k:t+r,v:n})}for(fd.sort((function(e,t){return t.v-e.v})),r=0;r<fd.length;r++)t=fd[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));function md(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return 1*t}function yd(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return 1*t}function bd(e){if(0===e.length)return 0;for(var t=1*e[0],n=1;n<e.length;n++)t+=1*e[n];return t}function _d(e){if(0===e.length)throw new Error("mean requires at least one data point");return bd(e)/e.length}function xd(e){if(0===e.length)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var t=e[0],n=NaN,r=0,i=1,o=1;o<e.length+1;o++)e[o]!==t?(i>r&&(r=i,n=t),i=1,t=e[o]):i++;return 1*n}Lt({target:"Array",proto:!0,forced:dd||!pd||!vd||!gd},{sort:function(e){void 0!==e&&fn(e);var t=be(this);if(gd)return void 0===e?hd.call(t):hd.call(t,e);var n,r,i=[],o=ft(t.length);for(r=0;r<o;r++)r in t&&i.push(t[r]);for(n=(i=hf(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:String(t)>String(n)?1:-1}}(e))).length,r=0;r<n;)t[r]=i[r++];for(;r<o;)delete t[r++];return t}});var Sd={min:yd,max:md,mean:_d,sum:bd,mode:xd};function wd(e,t){return e.map((function(e){return e[t]}))}function Ad(e,t){return Sd[e](t)}var Td=Object.freeze({__proto__:null,sum:bd,max:md,min:yd,mean:_d,mode:xd,statMap:Sd,getColumn:wd,getSatByColumn:Ad}),Ed=kd,Cd=kd,Md=1e20;function kd(e,t,n,r,i,o){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer,s=a+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Od(e,t,n,r,i,o){for(var a=0;a<t;a++)Id(e,a,t,n,r,i,o);for(var s=0;s<n;s++)Id(e,s*t,1,t,r,i,o)}function Id(e,t,n,r,i,o,a){var s,u,c,l;for(o[0]=0,a[0]=-Md,a[1]=Md,s=0;s<r;s++)i[s]=e[t+s*n];for(s=1,u=0,c=0;s<r;s++){do{l=o[u],c=(i[s]-i[l]+s*s-l*l)/(s-l)/2}while(c<=a[u]&&--u>-1);o[++u]=s,a[u]=c,a[u+1]=Md}for(s=0,u=0;s<r;s++){for(;a[u+1]<s;)u++;l=o[u],e[t+s*n]=i[l]+(s-l)*(s-l)}}kd.prototype._draw=function(e,t){var n,r,i,o,a,s,u,c,l,f=this.ctx.measureText(e),h=f.width,d=2*this.buffer;t&&this.useMetrics?(a=Math.floor(f.actualBoundingBoxAscent),c=this.buffer+Math.ceil(f.actualBoundingBoxAscent),s=this.buffer,u=this.buffer,n=(r=Math.min(this.size,Math.ceil(f.actualBoundingBoxRight-f.actualBoundingBoxLeft)))+d,i=(o=Math.min(this.size-s,Math.ceil(f.actualBoundingBoxAscent+f.actualBoundingBoxDescent)))+d,this.ctx.textBaseline="alphabetic"):(n=r=this.size,i=o=this.size,a=19*this.fontSize/24,s=u=0,c=this.middle,this.ctx.textBaseline="middle"),r&&o&&(this.ctx.clearRect(u,s,r,o),this.ctx.fillText(e,this.buffer,c),l=this.ctx.getImageData(u,s,r,o));var p=new Uint8ClampedArray(n*i);return function(e,t,n,r,i,o,a){o.fill(Md,0,t*n),a.fill(0,0,t*n);for(var s=(t-r)/2,u=0;u<i;u++)for(var c=0;c<r;c++){var l=(u+s)*t+c+s,f=e.data[4*(u*r+c)+3]/255;if(1===f)o[l]=0,a[l]=Md;else if(0===f)o[l]=Md,a[l]=0;else{var h=Math.max(0,.5-f),d=Math.max(0,f-.5);o[l]=h*h,a[l]=d*d}}}(l,n,i,r,o,this.gridOuter,this.gridInner),Od(this.gridOuter,n,i,this.f,this.v,this.z),Od(this.gridInner,n,i,this.f,this.v,this.z),function(e,t,n,r,i,o,a){for(var s=0;s<t*n;s++){var u=Math.sqrt(r[s])-Math.sqrt(i[s]);e[s]=Math.round(255-255*(u/o+a))}}(p,n,i,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:p,metrics:{width:r,height:o,sdfWidth:n,sdfHeight:i,top:a,left:0,advance:h}}},kd.prototype.draw=function(e){return this._draw(e,!1).data},kd.prototype.drawWithMetrics=function(e){return this._draw(e,!0)},Ed.default=Cd;var Pd=!ki((function(e){Array.from(e)}));Lt({target:"Array",stat:!0,forced:Pd},{from:Xa});var Ld=Math.log,Rd=Math.LN2;Lt({target:"Math",stat:!0},{log2:function(e){return Ld(e)/Rd}});var Nd;function Dd(e,t,n){var r,i=Pr(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,a=o.icon,s=o.xOffset;e[a.id]=cr(cr({},a),{},{x:s,y:n,image:a.image,width:a.width,height:a.height})}}catch(e){i.e(e)}finally{i.f()}}function Fd(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var zd=function(){for(var e=[],t=32;t<128;t++)e.push(String.fromCharCode(t));return e}();function jd(e,t,n,r){e.font="".concat(r," ").concat(n,"px ").concat(t),e.fillStyle="black",e.textBaseline="middle"}function Ud(e,t){for(var n=0;n<e.length;n++)t.data[4*n+3]=e[n]}var Bd=$()(Nd=function(){function e(){dr(this,e),gr(this,"fontAtlas",void 0),gr(this,"iconFontMap",void 0),gr(this,"iconFontGlyphs",{}),gr(this,"fontOptions",void 0),gr(this,"key",void 0),gr(this,"cache",new Ch(3))}return vr(e,[{key:"scale",get:function(){return 1}},{key:"canvas",get:function(){var e=this.cache.get(this.key);return e&&e.data}},{key:"mapping",get:function(){var e=this.cache.get(this.key);return e&&e.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:"sans-serif",fontWeight:"normal",characterSet:zd,fontSize:24,buffer:3,sdf:!0,cutoff:.25,radius:8,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(e){var t=this;e.forEach((function(e){t.iconFontGlyphs[e.name]=e.unicode}))}},{key:"addIconFont",value:function(e,t){this.iconFontMap.set(e,t)}},{key:"getIconFontKey",value:function(e){return this.iconFontMap.get(e)||e}},{key:"getGlyph",value:function(e){return this.iconFontGlyphs[e]?String.fromCharCode(parseInt(this.iconFontGlyphs[e],16)):""}},{key:"setFontOptions",value:function(e){this.fontOptions=cr(cr({},this.fontOptions),e),this.key=this.getKey();var t=this.getNewChars(this.key,this.fontOptions.characterSet),n=this.cache.get(this.key);if(!n||0!==t.length){var r=this.generateFontAtlas(this.key,t,n);this.fontAtlas=r,this.cache.set(this.key,r)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(e,t,n){var r=this.fontOptions,i=r.fontFamily,o=r.fontWeight,a=r.fontSize,s=r.buffer,u=r.sdf,c=r.radius,l=r.cutoff,f=r.iconfont,h=n&&n.data;h||((h=document.createElement("canvas")).width=1024);var d=h.getContext("2d");jd(d,i,a,o);var p=function(e){var t=e.characterSet,n=e.getFontWidth,r=e.fontHeight,i=e.buffer,o=e.maxCanvasWidth,a=e.mapping,s=void 0===a?{}:a,u=e.xOffset,c=void 0===u?0:u,l=e.yOffset,f=void 0===l?0:l,h=0,d=c;Array.from(t).forEach((function(e,t){if(!s[e]){var r=n(e,t);d+30>o&&(d=0,h++),s[e]={x:d,y:f+30*h,width:30,height:30,advance:r},d+=30}}));var p=r+2*i;return{mapping:s,xOffset:d,yOffset:f+h*p,canvasHeight:Fd(f+(h+1)*p)}}(cr({getFontWidth:function(e){return d.measureText(e).width},fontHeight:1*a,buffer:s,characterSet:t,maxCanvasWidth:1024},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),v=p.mapping,g=p.canvasHeight,m=p.xOffset,y=p.yOffset,b=d.getImageData(0,0,h.width,h.height);if(h.height=g,d.putImageData(b,0,0),jd(d,i,a,o),u){var _,x=new Ed(a,s,c,l,i,o),S=d.getImageData(0,0,x.size,x.size),w=Pr(t);try{for(w.s();!(_=w.n()).done;){var A=_.value;if(f){var T=String.fromCharCode(parseInt(A.replace("&#x","").replace(";",""),16));Ud(x.draw(T),S)}else Ud(x.draw(A),S);d.putImageData(S,v[A].x,v[A].y)}}catch(e){w.e(e)}finally{w.f()}}else{var E,C=Pr(t);try{for(C.s();!(E=C.n()).done;){var M=E.value;d.fillText(M,v[M].x,v[M].y+1*a)}}catch(e){C.e(e)}finally{C.f()}}return{xOffset:m,yOffset:y,mapping:v,data:h,width:h.width,height:h.height}}},{key:"getKey",value:function(){return"key"}},{key:"getNewChars",value:function(e,t){var n=this.cache.get(e);if(!n)return t;var r=[],i=n.mapping,o=new Set(Object.keys(i));return new Set(t).forEach((function(e){o.has(e)||r.push(e)})),r}}]),e}())||Nd,Vd=mn.filter,Hd=Fr("filter");Lt({target:"Array",proto:!0,forced:!Hd},{filter:function(e){return Vd(this,e,arguments.length>1?arguments[1]:void 0)}});var Gd,Wd,Zd,Yd=ie.Promise,qd=/(?:iphone|ipod|ipad).*applewebkit/i.test(Rt),Xd="process"==he(ie.process),Kd=ie.location,Qd=ie.setImmediate,Jd=ie.clearImmediate,$d=ie.process,ep=ie.MessageChannel,tp=ie.Dispatch,np=0,rp={},ip=function(e){if(rp.hasOwnProperty(e)){var t=rp[e];delete rp[e],t()}},op=function(e){return function(){ip(e)}},ap=function(e){ip(e.data)},sp=function(e){ie.postMessage(e+"",Kd.protocol+"//"+Kd.host)};Qd&&Jd||(Qd=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return rp[++np]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},Gd(np),np},Jd=function(e){delete rp[e]},Xd?Gd=function(e){$d.nextTick(op(e))}:tp&&tp.now?Gd=function(e){tp.now(op(e))}:ep&&!qd?(Zd=(Wd=new ep).port2,Wd.port1.onmessage=ap,Gd=hn(Zd.postMessage,Zd,1)):ie.addEventListener&&"function"==typeof postMessage&&!ie.importScripts&&Kd&&"file:"!==Kd.protocol&&!oe(sp)?(Gd=sp,ie.addEventListener("message",ap,!1)):Gd="onreadystatechange"in Ae("script")?function(e){Wt.appendChild(Ae("script")).onreadystatechange=function(){Wt.removeChild(this),ip(e)}}:function(e){setTimeout(op(e),0)});var up,cp,lp,fp,hp,dp,pp,vp,gp={set:Qd,clear:Jd},mp=/web0s(?!.*chrome)/i.test(Rt),yp=Ce.f,bp=gp.set,_p=ie.MutationObserver||ie.WebKitMutationObserver,xp=ie.document,Sp=ie.process,wp=ie.Promise,Ap=yp(ie,"queueMicrotask"),Tp=Ap&&Ap.value;Tp||(up=function(){var e,t;for(Xd&&(e=Sp.domain)&&e.exit();cp;){t=cp.fn,cp=cp.next;try{t()}catch(e){throw cp?fp():lp=void 0,e}}lp=void 0,e&&e.enter()},qd||Xd||mp||!_p||!xp?wp&&wp.resolve?((pp=wp.resolve(void 0)).constructor=wp,vp=pp.then,fp=function(){vp.call(pp,up)}):fp=Xd?function(){Sp.nextTick(up)}:function(){bp.call(ie,up)}:(hp=!0,dp=xp.createTextNode(""),new _p(up).observe(dp,{characterData:!0}),fp=function(){dp.data=hp=!hp}));var Ep,Cp,Mp,kp,Op,Ip=Tp||function(e){var t={fn:e,next:void 0};lp&&(lp.next=t),cp||(cp=t,fp()),lp=t},Pp=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=fn(t),this.reject=fn(n)},Lp={f:function(e){return new Pp(e)}},Rp=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},Np="object"==typeof window,Dp=gp.set,Fp=on("species"),zp="Promise",jp=nt.get,Up=nt.set,Bp=nt.getterFor(zp),Vp=Yd&&Yd.prototype,Hp=Yd,Gp=Vp,Wp=ie.TypeError,Zp=ie.document,Yp=ie.process,qp=Lp.f,Xp=qp,Kp=!!(Zp&&Zp.createEvent&&ie.dispatchEvent),Qp="function"==typeof PromiseRejectionEvent,Jp=!1,$p=It(zp,(function(){var e=ze(Hp),t=e!==String(Hp);if(!t&&66===jt)return!0;if(jt>=51&&/native code/.test(e))return!1;var n=new Hp((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};return(n.constructor={})[Fp]=r,!(Jp=n.then((function(){}))instanceof r)||!t&&Np&&!Qp})),ev=$p||!ki((function(e){Hp.all(e).catch((function(){}))})),tv=function(e){var t;return!(!me(e)||"function"!=typeof(t=e.then))&&t},nv=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;Ip((function(){for(var r=e.value,i=1==e.state,o=0;n.length>o;){var a,s,u,c=n[o++],l=i?c.ok:c.fail,f=c.resolve,h=c.reject,d=c.domain;try{l?(i||(2===e.rejection&&av(e),e.rejection=1),!0===l?a=r:(d&&d.enter(),a=l(r),d&&(d.exit(),u=!0)),a===c.promise?h(Wp("Promise-chain cycle")):(s=tv(a))?s.call(a,f,h):f(a)):h(r)}catch(e){d&&!u&&d.exit(),h(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&iv(e)}))}},rv=function(e,t,n){var r,i;Kp?((r=Zp.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),ie.dispatchEvent(r)):r={promise:t,reason:n},!Qp&&(i=ie["on"+e])?i(r):"unhandledrejection"===e&&function(e,t){var n=ie.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}("Unhandled promise rejection",n)},iv=function(e){Dp.call(ie,(function(){var t,n=e.facade,r=e.value;if(ov(e)&&(t=Rp((function(){Xd?Yp.emit("unhandledRejection",r,n):rv("unhandledrejection",n,r)})),e.rejection=Xd||ov(e)?2:1,t.error))throw t.value}))},ov=function(e){return 1!==e.rejection&&!e.parent},av=function(e){Dp.call(ie,(function(){var t=e.facade;Xd?Yp.emit("rejectionHandled",t):rv("rejectionhandled",t,e.value)}))},sv=function(e,t,n){return function(r){e(t,r,n)}},uv=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,nv(e,!0))},cv=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw Wp("Promise can't be resolved itself");var r=tv(t);r?Ip((function(){var n={done:!1};try{r.call(t,sv(cv,n,e),sv(uv,n,e))}catch(t){uv(n,t,e)}})):(e.value=t,e.state=1,nv(e,!1))}catch(t){uv({done:!1},t,e)}}};if($p&&(Gp=(Hp=function(e){Ai(this,Hp,zp),fn(e),Ep.call(this);var t=jp(this);try{e(sv(cv,t),sv(uv,t))}catch(e){uv(t,e)}}).prototype,(Ep=function(e){Up(this,{type:zp,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=Pi(Gp,{then:function(e,t){var n=Bp(this),r=qp(ea(this,Hp));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=Xd?Yp.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&nv(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),Cp=function(){var e=new Ep,t=jp(e);this.promise=e,this.resolve=sv(cv,t),this.reject=sv(uv,t)},Lp.f=qp=function(e){return e===Hp||e===Mp?new Cp(e):Xp(e)},"function"==typeof Yd&&Vp!==Object.prototype)){kp=Vp.then,Jp||(rt(Vp,"then",(function(e,t){var n=this;return new Hp((function(e,t){kp.call(n,e,t)})).then(e,t)}),{unsafe:!0}),rt(Vp,"catch",Gp.catch,{unsafe:!0}));try{delete Vp.constructor}catch(e){}oi&&oi(Vp,Gp)}Lt({global:!0,wrap:!0,forced:$p},{Promise:Hp}),ln(Hp,zp,!1),Ri(zp),Mp=at(zp),Lt({target:zp,stat:!0,forced:$p},{reject:function(e){var t=qp(this);return t.reject.call(void 0,e),t.promise}}),Lt({target:zp,stat:!0,forced:$p},{resolve:function(e){return function(e,t){if(Me(e),me(t)&&t.constructor===e)return t;var n=Lp.f(e);return(0,n.resolve)(t),n.promise}(this,e)}}),Lt({target:zp,stat:!0,forced:ev},{all:function(e){var t=this,n=qp(t),r=n.resolve,i=n.reject,o=Rp((function(){var n=fn(t.resolve),o=[],a=0,s=1;wi(e,(function(e){var u=a++,c=!1;o.push(void 0),s++,n.call(t,e).then((function(e){c||(c=!0,o[u]=e,--s||r(o))}),i)})),--s||r(o)}));return o.error&&i(o.value),n.promise},race:function(e){var t=this,n=qp(t),r=n.reject,i=Rp((function(){var i=fn(t.resolve);wi(e,(function(e){i.call(t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var lv=$()(Op=function(e){mr(n,e);var t=Er(n);function n(){var e;dr(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return gr(Ar(e=t.call.apply(t,[this].concat(i))),"canvasHeight",128),gr(Ar(e),"texture",void 0),gr(Ar(e),"canvas",void 0),gr(Ar(e),"iconData",void 0),gr(Ar(e),"iconMap",void 0),gr(Ar(e),"ctx",void 0),gr(Ar(e),"loadingImageCount",0),e}return vr(n,[{key:"isLoading",value:function(){return 0===this.loadingImageCount}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(e,t){var n=this,r=new Image;if(this.loadingImageCount++,this.hasImage(e))throw new Error("Image Id already exists");this.iconData.push({id:e,size:64}),this.updateIconMap(),this.loadImage(t).then((function(t){r=t;var i=n.iconData.find((function(t){return t.id===e}));i&&(i.image=r,i.width=r.width,i.height=r.height),n.update()}))}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(e){return this.iconMap.hasOwnProperty(e)}},{key:"removeImage",value:function(e){this.hasImage(e)&&(this.iconData=this.iconData.filter((function(t){return t.id!==e})),delete this.iconMap[e],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,0===this.loadingImageCount&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var e=this;this.canvas.width=1024,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach((function(t){var n=e.iconMap[t],r=n.x,i=n.y,o=n.image,a=n.width,s=void 0===a?64:a,u=n.height,c=void 0===u?64:u,l=Math.max(s,c)/64,f=c/l,h=s/l;o&&e.ctx.drawImage(o,r+(64-h)/2,i+(64-f)/2,h,f)}))}},{key:"updateIconMap",value:function(){var e=function(e,t,n){var r,i=0,o=0,a=0,s=[],u={},c=Pr(e);try{for(c.s();!(r=c.n()).done;){var l=r.value;if(!u[l.id]){var f=l.size;i+f+t>n&&(Dd(u,s,o),i=0,o=a+o+t,a=0,s=[]),s.push({icon:l,xOffset:i}),i=i+f+t,a=Math.max(a,f)}}}catch(e){c.e(e)}finally{c.f()}return s.length>0&&Dd(u,s,o),{mapping:u,canvasHeight:Fd(a+o+t)}}(this.iconData,3,1024),t=e.mapping,n=e.canvasHeight;this.iconMap=t,this.canvasHeight=n}},{key:"loadImage",value:function(e){return new Promise((function(t,n){if(e instanceof HTMLImageElement)t(e);else{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t(r)},r.onerror=function(){n(new Error("Could not load image at "+e))},r.src=e instanceof File?URL.createObjectURL(e):e}}))}}]),n}(s))||Op,fv=1e-6,hv="undefined"!=typeof Float32Array?Float32Array:Array,dv=Math.random;function pv(){var e=new hv(16);return hv!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function vv(e){var t=new hv(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function gv(e,t,n,r,i,o,a,s,u,c,l,f,h,d,p,v){var g=new hv(16);return g[0]=e,g[1]=t,g[2]=n,g[3]=r,g[4]=i,g[5]=o,g[6]=a,g[7]=s,g[8]=u,g[9]=c,g[10]=l,g[11]=f,g[12]=h,g[13]=d,g[14]=p,g[15]=v,g}function mv(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function yv(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],h=t[10],d=t[11],p=t[12],v=t[13],g=t[14],m=t[15],y=n*s-r*a,b=n*u-i*a,_=n*c-o*a,x=r*u-i*s,S=r*c-o*s,w=i*c-o*u,A=l*v-f*p,T=l*g-h*p,E=l*m-d*p,C=f*g-h*v,M=f*m-d*v,k=h*m-d*g,O=y*k-b*M+_*C+x*E-S*T+w*A;return O?(O=1/O,e[0]=(s*k-u*M+c*C)*O,e[1]=(i*M-r*k-o*C)*O,e[2]=(v*w-g*S+m*x)*O,e[3]=(h*S-f*w-d*x)*O,e[4]=(u*E-a*k-c*T)*O,e[5]=(n*k-i*E+o*T)*O,e[6]=(g*_-p*w-m*b)*O,e[7]=(l*w-h*_+d*b)*O,e[8]=(a*M-s*E+c*A)*O,e[9]=(r*E-n*M-o*A)*O,e[10]=(p*S-v*_+m*y)*O,e[11]=(f*_-l*S-d*y)*O,e[12]=(s*T-a*C-u*A)*O,e[13]=(n*C-r*T+i*A)*O,e[14]=(v*b-p*x-g*y)*O,e[15]=(l*x-f*b+h*y)*O,e):null}function bv(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],h=t[9],d=t[10],p=t[11],v=t[12],g=t[13],m=t[14],y=t[15],b=n[0],_=n[1],x=n[2],S=n[3];return e[0]=b*r+_*s+x*f+S*v,e[1]=b*i+_*u+x*h+S*g,e[2]=b*o+_*c+x*d+S*m,e[3]=b*a+_*l+x*p+S*y,b=n[4],_=n[5],x=n[6],S=n[7],e[4]=b*r+_*s+x*f+S*v,e[5]=b*i+_*u+x*h+S*g,e[6]=b*o+_*c+x*d+S*m,e[7]=b*a+_*l+x*p+S*y,b=n[8],_=n[9],x=n[10],S=n[11],e[8]=b*r+_*s+x*f+S*v,e[9]=b*i+_*u+x*h+S*g,e[10]=b*o+_*c+x*d+S*m,e[11]=b*a+_*l+x*p+S*y,b=n[12],_=n[13],x=n[14],S=n[15],e[12]=b*r+_*s+x*f+S*v,e[13]=b*i+_*u+x*h+S*g,e[14]=b*o+_*c+x*d+S*m,e[15]=b*a+_*l+x*p+S*y,e}function _v(e,t,n){var r,i,o,a,s,u,c,l,f,h,d,p,v=n[0],g=n[1],m=n[2];return t===e?(e[12]=t[0]*v+t[4]*g+t[8]*m+t[12],e[13]=t[1]*v+t[5]*g+t[9]*m+t[13],e[14]=t[2]*v+t[6]*g+t[10]*m+t[14],e[15]=t[3]*v+t[7]*g+t[11]*m+t[15]):(r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],h=t[9],d=t[10],p=t[11],e[0]=r,e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=u,e[6]=c,e[7]=l,e[8]=f,e[9]=h,e[10]=d,e[11]=p,e[12]=r*v+s*g+f*m+t[12],e[13]=i*v+u*g+h*m+t[13],e[14]=o*v+c*g+d*m+t[14],e[15]=a*v+l*g+p*m+t[15]),e}function xv(e,t,n){var r=n[0],i=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Sv(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],l=t[9],f=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+c*r,e[5]=a*i+l*r,e[6]=s*i+f*r,e[7]=u*i+h*r,e[8]=c*i-o*r,e[9]=l*i-a*r,e[10]=f*i-s*r,e[11]=h*i-u*r,e}function wv(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],c=t[8],l=t[9],f=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-c*r,e[1]=a*i-l*r,e[2]=s*i-f*r,e[3]=u*i-h*r,e[8]=o*r+c*i,e[9]=a*r+l*i,e[10]=s*r+f*i,e[11]=u*r+h*i,e}function Av(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],c=t[4],l=t[5],f=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+c*r,e[1]=a*i+l*r,e[2]=s*i+f*r,e[3]=u*i+h*r,e[4]=c*i-o*r,e[5]=l*i-a*r,e[6]=f*i-s*r,e[7]=h*i-u*r,e}function Tv(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Ev(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=r+r,u=i+i,c=o+o,l=r*s,f=r*u,h=r*c,d=i*u,p=i*c,v=o*c,g=a*s,m=a*u,y=a*c;return e[0]=1-(d+v),e[1]=f+y,e[2]=h-m,e[3]=0,e[4]=f-y,e[5]=1-(l+v),e[6]=p+g,e[7]=0,e[8]=h+m,e[9]=p-g,e[10]=1-(l+d),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Cv(e,t){var n=t[0],r=t[1],i=t[2],o=t[4],a=t[5],s=t[6],u=t[8],c=t[9],l=t[10];return e[0]=Math.hypot(n,r,i),e[1]=Math.hypot(o,a,s),e[2]=Math.hypot(u,c,l),e}function Mv(e,t,n,r,i){var o,a=1/Math.tan(t/2);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(r-i),e[10]=(i+r)*o,e[14]=2*i*r*o):(e[10]=-1,e[14]=-2*r),e}function kv(e,t,n,r){var i,o,a,s,u,c,l,f,h,d,p=t[0],v=t[1],g=t[2],m=r[0],y=r[1],b=r[2],_=n[0],x=n[1],S=n[2];return Math.abs(p-_)<fv&&Math.abs(v-x)<fv&&Math.abs(g-S)<fv?mv(e):(l=p-_,f=v-x,h=g-S,i=y*(h*=d=1/Math.hypot(l,f,h))-b*(f*=d),o=b*(l*=d)-m*h,a=m*f-y*l,(d=Math.hypot(i,o,a))?(i*=d=1/d,o*=d,a*=d):(i=0,o=0,a=0),s=f*a-h*o,u=h*i-l*a,c=l*o-f*i,(d=Math.hypot(s,u,c))?(s*=d=1/d,u*=d,c*=d):(s=0,u=0,c=0),e[0]=i,e[1]=s,e[2]=l,e[3]=0,e[4]=o,e[5]=u,e[6]=f,e[7]=0,e[8]=a,e[9]=c,e[10]=h,e[11]=0,e[12]=-(i*p+o*v+a*g),e[13]=-(s*p+u*v+c*g),e[14]=-(l*p+f*v+h*g),e[15]=1,e)}function Ov(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function Iv(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=e[9],h=e[10],d=e[11],p=e[12],v=e[13],g=e[14],m=e[15],y=t[0],b=t[1],_=t[2],x=t[3],S=t[4],w=t[5],A=t[6],T=t[7],E=t[8],C=t[9],M=t[10],k=t[11],O=t[12],I=t[13],P=t[14],L=t[15];return Math.abs(n-y)<=fv*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-b)<=fv*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(i-_)<=fv*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(o-x)<=fv*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-S)<=fv*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(s-w)<=fv*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(u-A)<=fv*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(c-T)<=fv*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(l-E)<=fv*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(f-C)<=fv*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(h-M)<=fv*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(d-k)<=fv*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(p-O)<=fv*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(v-I)<=fv*Math.max(1,Math.abs(v),Math.abs(I))&&Math.abs(g-P)<=fv*Math.max(1,Math.abs(g),Math.abs(P))&&Math.abs(m-L)<=fv*Math.max(1,Math.abs(m),Math.abs(L))}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Pv=bv,Lv=Ov,Rv=Object.freeze({__proto__:null,create:pv,clone:vv,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},fromValues:gv,set:function(e,t,n,r,i,o,a,s,u,c,l,f,h,d,p,v,g){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=u,e[8]=c,e[9]=l,e[10]=f,e[11]=h,e[12]=d,e[13]=p,e[14]=v,e[15]=g,e},identity:mv,transpose:function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=i,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},invert:yv,adjoint:function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],h=t[10],d=t[11],p=t[12],v=t[13],g=t[14],m=t[15];return e[0]=s*(h*m-d*g)-f*(u*m-c*g)+v*(u*d-c*h),e[1]=-(r*(h*m-d*g)-f*(i*m-o*g)+v*(i*d-o*h)),e[2]=r*(u*m-c*g)-s*(i*m-o*g)+v*(i*c-o*u),e[3]=-(r*(u*d-c*h)-s*(i*d-o*h)+f*(i*c-o*u)),e[4]=-(a*(h*m-d*g)-l*(u*m-c*g)+p*(u*d-c*h)),e[5]=n*(h*m-d*g)-l*(i*m-o*g)+p*(i*d-o*h),e[6]=-(n*(u*m-c*g)-a*(i*m-o*g)+p*(i*c-o*u)),e[7]=n*(u*d-c*h)-a*(i*d-o*h)+l*(i*c-o*u),e[8]=a*(f*m-d*v)-l*(s*m-c*v)+p*(s*d-c*f),e[9]=-(n*(f*m-d*v)-l*(r*m-o*v)+p*(r*d-o*f)),e[10]=n*(s*m-c*v)-a*(r*m-o*v)+p*(r*c-o*s),e[11]=-(n*(s*d-c*f)-a*(r*d-o*f)+l*(r*c-o*s)),e[12]=-(a*(f*g-h*v)-l*(s*g-u*v)+p*(s*h-u*f)),e[13]=n*(f*g-h*v)-l*(r*g-i*v)+p*(r*h-i*f),e[14]=-(n*(s*g-u*v)-a*(r*g-i*v)+p*(r*u-i*s)),e[15]=n*(s*h-u*f)-a*(r*h-i*f)+l*(r*u-i*s),e},determinant:function(e){var t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],u=e[7],c=e[8],l=e[9],f=e[10],h=e[11],d=e[12],p=e[13],v=e[14],g=e[15];return(t*a-n*o)*(f*g-h*v)-(t*s-r*o)*(l*g-h*p)+(t*u-i*o)*(l*v-f*p)+(n*s-r*a)*(c*g-h*d)-(n*u-i*a)*(c*v-f*d)+(r*u-i*s)*(c*p-l*d)},multiply:bv,translate:_v,scale:xv,rotate:function(e,t,n,r){var i,o,a,s,u,c,l,f,h,d,p,v,g,m,y,b,_,x,S,w,A,T,E,C,M=r[0],k=r[1],O=r[2],I=Math.hypot(M,k,O);return I<fv?null:(M*=I=1/I,k*=I,O*=I,i=Math.sin(n),a=1-(o=Math.cos(n)),s=t[0],u=t[1],c=t[2],l=t[3],f=t[4],h=t[5],d=t[6],p=t[7],v=t[8],g=t[9],m=t[10],y=t[11],b=M*M*a+o,_=k*M*a+O*i,x=O*M*a-k*i,S=M*k*a-O*i,w=k*k*a+o,A=O*k*a+M*i,T=M*O*a+k*i,E=k*O*a-M*i,C=O*O*a+o,e[0]=s*b+f*_+v*x,e[1]=u*b+h*_+g*x,e[2]=c*b+d*_+m*x,e[3]=l*b+p*_+y*x,e[4]=s*S+f*w+v*A,e[5]=u*S+h*w+g*A,e[6]=c*S+d*w+m*A,e[7]=l*S+p*w+y*A,e[8]=s*T+f*E+v*C,e[9]=u*T+h*E+g*C,e[10]=c*T+d*E+m*C,e[11]=l*T+p*E+y*C,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},rotateX:Sv,rotateY:wv,rotateZ:Av,fromTranslation:Tv,fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotation:function(e,t,n){var r,i,o,a=n[0],s=n[1],u=n[2],c=Math.hypot(a,s,u);return c<fv?null:(a*=c=1/c,s*=c,u*=c,r=Math.sin(t),o=1-(i=Math.cos(t)),e[0]=a*a*o+i,e[1]=s*a*o+u*r,e[2]=u*a*o-s*r,e[3]=0,e[4]=a*s*o-u*r,e[5]=s*s*o+i,e[6]=u*s*o+a*r,e[7]=0,e[8]=a*u*o+s*r,e[9]=s*u*o-a*r,e[10]=u*u*o+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},fromXRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromYRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotationTranslation:Ev,fromQuat2:function(e,t){var n=new hv(3),r=-t[0],i=-t[1],o=-t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=r*r+i*i+o*o+a*a;return f>0?(n[0]=2*(s*a+l*r+u*o-c*i)/f,n[1]=2*(u*a+l*i+c*r-s*o)/f,n[2]=2*(c*a+l*o+s*i-u*r)/f):(n[0]=2*(s*a+l*r+u*o-c*i),n[1]=2*(u*a+l*i+c*r-s*o),n[2]=2*(c*a+l*o+s*i-u*r)),Ev(e,t,n),e},getTranslation:function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},getScaling:Cv,getRotation:function(e,t){var n=new hv(3);Cv(n,t);var r=1/n[0],i=1/n[1],o=1/n[2],a=t[0]*r,s=t[1]*i,u=t[2]*o,c=t[4]*r,l=t[5]*i,f=t[6]*o,h=t[8]*r,d=t[9]*i,p=t[10]*o,v=a+l+p,g=0;return v>0?(g=2*Math.sqrt(v+1),e[3]=.25*g,e[0]=(f-d)/g,e[1]=(h-u)/g,e[2]=(s-c)/g):a>l&&a>p?(g=2*Math.sqrt(1+a-l-p),e[3]=(f-d)/g,e[0]=.25*g,e[1]=(s+c)/g,e[2]=(h+u)/g):l>p?(g=2*Math.sqrt(1+l-a-p),e[3]=(h-u)/g,e[0]=(s+c)/g,e[1]=.25*g,e[2]=(f+d)/g):(g=2*Math.sqrt(1+p-a-l),e[3]=(s-c)/g,e[0]=(h+u)/g,e[1]=(f+d)/g,e[2]=.25*g),e},fromRotationTranslationScale:function(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=t[3],u=i+i,c=o+o,l=a+a,f=i*u,h=i*c,d=i*l,p=o*c,v=o*l,g=a*l,m=s*u,y=s*c,b=s*l,_=r[0],x=r[1],S=r[2];return e[0]=(1-(p+g))*_,e[1]=(h+b)*_,e[2]=(d-y)*_,e[3]=0,e[4]=(h-b)*x,e[5]=(1-(f+g))*x,e[6]=(v+m)*x,e[7]=0,e[8]=(d+y)*S,e[9]=(v-m)*S,e[10]=(1-(f+p))*S,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},fromRotationTranslationScaleOrigin:function(e,t,n,r,i){var o=t[0],a=t[1],s=t[2],u=t[3],c=o+o,l=a+a,f=s+s,h=o*c,d=o*l,p=o*f,v=a*l,g=a*f,m=s*f,y=u*c,b=u*l,_=u*f,x=r[0],S=r[1],w=r[2],A=i[0],T=i[1],E=i[2],C=(1-(v+m))*x,M=(d+_)*x,k=(p-b)*x,O=(d-_)*S,I=(1-(h+m))*S,P=(g+y)*S,L=(p+b)*w,R=(g-y)*w,N=(1-(h+v))*w;return e[0]=C,e[1]=M,e[2]=k,e[3]=0,e[4]=O,e[5]=I,e[6]=P,e[7]=0,e[8]=L,e[9]=R,e[10]=N,e[11]=0,e[12]=n[0]+A-(C*A+O*T+L*E),e[13]=n[1]+T-(M*A+I*T+R*E),e[14]=n[2]+E-(k*A+P*T+N*E),e[15]=1,e},fromQuat:function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n+n,s=r+r,u=i+i,c=n*a,l=r*a,f=r*s,h=i*a,d=i*s,p=i*u,v=o*a,g=o*s,m=o*u;return e[0]=1-f-p,e[1]=l+m,e[2]=h-g,e[3]=0,e[4]=l-m,e[5]=1-c-p,e[6]=d+v,e[7]=0,e[8]=h+g,e[9]=d-v,e[10]=1-c-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},frustum:function(e,t,n,r,i,o,a){var s=1/(n-t),u=1/(i-r),c=1/(o-a);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*u,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(i+r)*u,e[10]=(a+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*c,e[15]=0,e},perspective:Mv,perspectiveFromFieldOfView:function(e,t,n,r){var i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(a+s),c=2/(i+o);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(a-s)*u*.5,e[9]=(i-o)*c*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e},ortho:function(e,t,n,r,i,o,a){var s=1/(t-n),u=1/(r-i),c=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=(a+o)*c,e[15]=1,e},lookAt:kv,targetTo:function(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=r[0],u=r[1],c=r[2],l=i-n[0],f=o-n[1],h=a-n[2],d=l*l+f*f+h*h;d>0&&(l*=d=1/Math.sqrt(d),f*=d,h*=d);var p=u*h-c*f,v=c*l-s*h,g=s*f-u*l;return(d=p*p+v*v+g*g)>0&&(p*=d=1/Math.sqrt(d),v*=d,g*=d),e[0]=p,e[1]=v,e[2]=g,e[3]=0,e[4]=f*g-h*v,e[5]=h*p-l*g,e[6]=l*v-f*p,e[7]=0,e[8]=l,e[9]=f,e[10]=h,e[11]=0,e[12]=i,e[13]=o,e[14]=a,e[15]=1,e},str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e},subtract:Ov,multiplyScalar:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e},multiplyScalarAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},equals:Iv,mul:Pv,sub:Lv});function Nv(){var e=new hv(3);return hv!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Dv(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function Fv(e,t,n){var r=new hv(3);return r[0]=e,r[1]=t,r[2]=n,r}function zv(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function jv(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function Uv(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function Bv(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.hypot(n,r,i)}function Vv(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function Hv(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function Gv(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Wv(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function Zv(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Yv(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[0],s=n[1],u=n[2];return e[0]=i*u-o*s,e[1]=o*a-r*u,e[2]=r*s-i*a,e}var qv,Xv=zv,Kv=jv,Qv=Uv,Jv=Bv,$v=Vv,eg=Dv,tg=Hv,ng=(qv=Nv(),function(e,t,n,r,i,o){var a,s;for(t||(t=3),n||(n=0),s=r?Math.min(r*t+n,e.length):e.length,a=n;a<s;a+=t)qv[0]=e[a],qv[1]=e[a+1],qv[2]=e[a+2],i(qv,qv,o),e[a]=qv[0],e[a+1]=qv[1],e[a+2]=qv[2];return e}),rg=Object.freeze({__proto__:null,create:Nv,clone:function(e){var t=new hv(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},length:Dv,fromValues:Fv,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set:function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},subtract:zv,multiply:jv,divide:Uv,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},min:function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},max:function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},scaleAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},distance:Bv,squaredDistance:Vv,squaredLength:Hv,negate:Gv,inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize:Wv,dot:Zv,cross:Yv,lerp:function(e,t,n,r){var i=t[0],o=t[1],a=t[2];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=a+r*(n[2]-a),e},hermite:function(e,t,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,c=a*(o-1),l=a*(3-2*o);return e[0]=t[0]*s+n[0]*u+r[0]*c+i[0]*l,e[1]=t[1]*s+n[1]*u+r[1]*c+i[1]*l,e[2]=t[2]*s+n[2]*u+r[2]*c+i[2]*l,e},bezier:function(e,t,n,r,i,o){var a=1-o,s=a*a,u=o*o,c=s*a,l=3*o*s,f=3*u*a,h=u*o;return e[0]=t[0]*c+n[0]*l+r[0]*f+i[0]*h,e[1]=t[1]*c+n[1]*l+r[1]*f+i[1]*h,e[2]=t[2]*c+n[2]*l+r[2]*f+i[2]*h,e},random:function(e,t){t=t||1;var n=2*dv()*Math.PI,r=2*dv()-1,i=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=r*t,e},transformMat4:function(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,e},transformMat3:function(e,t,n){var r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[3]+o*n[6],e[1]=r*n[1]+i*n[4]+o*n[7],e[2]=r*n[2]+i*n[5]+o*n[8],e},transformQuat:function(e,t,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=t[0],u=t[1],c=t[2],l=i*c-o*u,f=o*s-r*c,h=r*u-i*s,d=i*h-o*f,p=o*l-r*h,v=r*f-i*l,g=2*a;return l*=g,f*=g,h*=g,d*=2,p*=2,v*=2,e[0]=s+l+d,e[1]=u+f+p,e[2]=c+h+v,e},rotateX:function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},rotateY:function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},rotateZ:function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},angle:function(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],a=t[1],s=t[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+s*s),c=u&&Zv(e,t)/u;return Math.acos(Math.min(Math.max(c,-1),1))},zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e},str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},equals:function(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],a=t[1],s=t[2];return Math.abs(n-o)<=fv*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=fv*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=fv*Math.max(1,Math.abs(i),Math.abs(s))},sub:Xv,mul:Kv,div:Qv,dist:Jv,sqrDist:$v,len:eg,sqrLen:tg,forEach:ng});function ig(){var e=new hv(4);return hv!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function og(e,t,n,r){var i=new hv(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function ag(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,e}!function(){var e=ig()}();function sg(){var e=new hv(2);return hv!=Float32Array&&(e[0]=0,e[1]=0),e}function ug(e,t){var n=new hv(2);return n[0]=e,n[1]=t,n}function cg(e,t){return e[0]=t[0],e[1]=t[1],e}function lg(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function fg(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function hg(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function dg(e,t){return e[0]*t[0]+e[1]*t[1]}function pg(e,t,n,r){var i=t[0],o=t[1];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e}var vg,gg,mg,yg,bg=fg,_g=(function(){var e=sg()}(),$()(vg=function(){function e(){dr(this,e),gr(this,"viewport",void 0),gr(this,"overridedViewProjectionMatrix",void 0),gr(this,"jitteredViewProjectionMatrix",void 0),gr(this,"jitteredProjectionMatrix",void 0),gr(this,"viewMatrixInverse",void 0),gr(this,"cameraPosition",void 0)}return vr(e,[{key:"init",value:function(){}},{key:"update",value:function(e){this.viewport=e,this.viewMatrixInverse=pv(),yv(this.viewMatrixInverse,e.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var e=Mr(this.viewport.getCenter(),2);return[e[0],e[1]]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}},{key:"setViewProjectionMatrix",value:function(e){this.overridedViewProjectionMatrix=e}},{key:"jitterProjectionMatrix",value:function(e,t){var n=Tv(pv(),[e,t,0]);this.jitteredProjectionMatrix=bv(pv(),n,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=bv(pv(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||vg),xg=$()(gg=function(){function e(){dr(this,e),gr(this,"container",void 0),gr(this,"controlCorners",void 0),gr(this,"controlContainer",void 0),gr(this,"scene",void 0),gr(this,"mapsService",void 0),gr(this,"controls",[]),gr(this,"unAddControls",[])}return vr(e,[{key:"init",value:function(e,t){this.container=e.container,this.scene=t,this.mapsService=t.get(sr.IMapService),this.initControlPos()}},{key:"addControl",value:function(e,t){t.get(sr.IMapService).map?(e.addTo(this.scene),this.controls.push(e)):this.unAddControls.push(e)}},{key:"getControlByName",value:function(e){return this.controls.find((function(t){return t.controlOption.name===e}))}},{key:"removeControl",value:function(e){var t=this.controls.indexOf(e);return t>-1&&this.controls.splice(t,1),e.remove(),this}},{key:"addControls",value:function(){var e=this;this.unAddControls.forEach((function(t){t.addTo(e.scene),e.controls.push(t)})),this.unAddControls=[]}},{key:"destroy",value:function(){var e,t=Pr(this.controls);try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(e){t.e(e)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var e=this.controlCorners={},t="l7-",n=this.controlContainer=ka("div","l7-control-container",this.container);function r(r,i){var o=t+r+" "+t+i;e[r+i]=ka("div",o,n)}r("top","left"),r("top","right"),r("bottom","left"),r("bottom","right")}},{key:"clearControlPos",value:function(){for(var e in this.controlCorners)this.controlCorners[e]&&Oa(this.controlCorners[e]);this.controlContainer&&Oa(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||gg,Sg=$()(mg=function(){function e(){dr(this,e),gr(this,"container",void 0),gr(this,"scene",void 0),gr(this,"mapsService",void 0),gr(this,"markers",[]),gr(this,"markerLayers",[]),gr(this,"unAddMarkers",[]),gr(this,"unAddMarkerLayers",[])}return vr(e,[{key:"addMarkerLayer",value:function(e){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(e),e.addTo(this.scene)):this.unAddMarkerLayers.push(e)}},{key:"removeMarkerLayer",value:function(e){e.destroy(),this.markerLayers.indexOf(e);var t=this.markerLayers.indexOf(e);t>-1&&this.markerLayers.splice(t,1)}},{key:"addMarker",value:function(e){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(e),e.addTo(this.scene)):this.unAddMarkers.push(e)}},{key:"addMarkers",value:function(){var e=this;this.unAddMarkers.forEach((function(t){t.addTo(e.scene),e.markers.push(t)})),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var e=this;this.unAddMarkerLayers.forEach((function(t){e.markerLayers.push(t),t.addTo(e.scene)})),this.unAddMarkers=[]}},{key:"removeMarker",value:function(e){e.remove(),this.markers.indexOf(e);var t=this.markers.indexOf(e);t>-1&&this.markers.splice(t,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(e){this.scene=e,this.mapsService=e.get(sr.IMapService)}},{key:"destroy",value:function(){this.markers.forEach((function(e){e.remove()})),this.markers=[],this.markerLayers.forEach((function(e){e.destroy()})),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(e){e.destroy()}}]),e}())||mg,wg=$()(yg=function(){function e(){dr(this,e),gr(this,"scene",void 0),gr(this,"popup",void 0),gr(this,"mapsService",void 0),gr(this,"unAddPopup",void 0)}return vr(e,[{key:"removePopup",value:function(e){e.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(e){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(e.addTo(this.scene),this.popup=e):this.unAddPopup=e}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(e){this.scene=e,this.mapsService=e.get(sr.IMapService)}}]),e}())||yg;var Ag=function(){this.__data__=[],this.size=0};var Tg=function(e,t){return e===t||e!=e&&t!=t};var Eg=function(e,t){for(var n=e.length;n--;)if(Tg(e[n][0],t))return n;return-1},Cg=Array.prototype.splice;var Mg=function(e){var t=this.__data__,n=Eg(t,e);return!(n<0)&&(n==t.length-1?t.pop():Cg.call(t,n,1),--this.size,!0)};var kg=function(e){var t=this.__data__,n=Eg(t,e);return n<0?void 0:t[n][1]};var Og=function(e){return Eg(this.__data__,e)>-1};var Ig=function(e,t){var n=this.__data__,r=Eg(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function Pg(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Pg.prototype.clear=Ag,Pg.prototype.delete=Mg,Pg.prototype.get=kg,Pg.prototype.has=Og,Pg.prototype.set=Ig;var Lg=Pg;var Rg=function(){this.__data__=new Lg,this.size=0};var Ng=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};var Dg=function(e){return this.__data__.get(e)};var Fg=function(e){return this.__data__.has(e)},zg="object"==typeof r&&r&&r.Object===Object&&r,jg="object"==typeof self&&self&&self.Object===Object&&self,Ug=zg||jg||Function("return this")(),Bg=Ug.Symbol,Vg=Object.prototype,Hg=Vg.hasOwnProperty,Gg=Vg.toString,Wg=Bg?Bg.toStringTag:void 0;var Zg=function(e){var t=Hg.call(e,Wg),n=e[Wg];try{e[Wg]=void 0;var r=!0}catch(e){}var i=Gg.call(e);return r&&(t?e[Wg]=n:delete e[Wg]),i},Yg=Object.prototype.toString;var qg=function(e){return Yg.call(e)},Xg=Bg?Bg.toStringTag:void 0;var Kg=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Xg&&Xg in Object(e)?Zg(e):qg(e)};var Qg=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var Jg=function(e){if(!Qg(e))return!1;var t=Kg(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},$g=Ug["__core-js_shared__"],em=function(){var e=/[^.]+$/.exec($g&&$g.keys&&$g.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();var tm=function(e){return!!em&&em in e},nm=Function.prototype.toString;var rm=function(e){if(null!=e){try{return nm.call(e)}catch(e){}try{return e+""}catch(e){}}return""},im=/^\[object .+?Constructor\]$/,om=Function.prototype,am=Object.prototype,sm=om.toString,um=am.hasOwnProperty,cm=RegExp("^"+sm.call(um).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var lm=function(e){return!(!Qg(e)||tm(e))&&(Jg(e)?cm:im).test(rm(e))};var fm=function(e,t){return null==e?void 0:e[t]};var hm=function(e,t){var n=fm(e,t);return lm(n)?n:void 0},dm=hm(Ug,"Map"),pm=hm(Object,"create");var vm=function(){this.__data__=pm?pm(null):{},this.size=0};var gm=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},mm=Object.prototype.hasOwnProperty;var ym=function(e){var t=this.__data__;if(pm){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return mm.call(t,e)?t[e]:void 0},bm=Object.prototype.hasOwnProperty;var _m=function(e){var t=this.__data__;return pm?void 0!==t[e]:bm.call(t,e)};var xm=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=pm&&void 0===t?"__lodash_hash_undefined__":t,this};function Sm(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Sm.prototype.clear=vm,Sm.prototype.delete=gm,Sm.prototype.get=ym,Sm.prototype.has=_m,Sm.prototype.set=xm;var wm=Sm;var Am=function(){this.size=0,this.__data__={hash:new wm,map:new(dm||Lg),string:new wm}};var Tm=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var Em=function(e,t){var n=e.__data__;return Tm(t)?n["string"==typeof t?"string":"hash"]:n.map};var Cm=function(e){var t=Em(this,e).delete(e);return this.size-=t?1:0,t};var Mm=function(e){return Em(this,e).get(e)};var km=function(e){return Em(this,e).has(e)};var Om=function(e,t){var n=Em(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function Im(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Im.prototype.clear=Am,Im.prototype.delete=Cm,Im.prototype.get=Mm,Im.prototype.has=km,Im.prototype.set=Om;var Pm=Im;var Lm=function(e,t){var n=this.__data__;if(n instanceof Lg){var r=n.__data__;if(!dm||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Pm(r)}return n.set(e,t),this.size=n.size,this};function Rm(e){var t=this.__data__=new Lg(e);this.size=t.size}Rm.prototype.clear=Rg,Rm.prototype.delete=Ng,Rm.prototype.get=Dg,Rm.prototype.has=Fg,Rm.prototype.set=Lm;var Nm=Rm,Dm=function(){try{var e=hm(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();var Fm=function(e,t,n){"__proto__"==t&&Dm?Dm(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var zm=function(e,t,n){(void 0!==n&&!Tg(e[t],n)||void 0===n&&!(t in e))&&Fm(e,t,n)};var jm=function(e){return function(t,n,r){for(var i=-1,o=Object(t),a=r(t),s=a.length;s--;){var u=a[e?s:++i];if(!1===n(o[u],u,o))break}return t}}(),Um=o((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n?Ug.Buffer:void 0,o=i?i.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=o?o(n):new e.constructor(n);return e.copy(r),r}})),Bm=Ug.Uint8Array;var Vm=function(e){var t=new e.constructor(e.byteLength);return new Bm(t).set(new Bm(e)),t};var Hm=function(e,t){var n=t?Vm(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};var Gm=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t},Wm=Object.create,Zm=function(){function e(){}return function(t){if(!Qg(t))return{};if(Wm)return Wm(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();var Ym=function(e,t){return function(n){return e(t(n))}},qm=Ym(Object.getPrototypeOf,Object),Xm=Object.prototype;var Km=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Xm)};var Qm=function(e){return"function"!=typeof e.constructor||Km(e)?{}:Zm(qm(e))};var Jm=function(e){return null!=e&&"object"==typeof e};var $m=function(e){return Jm(e)&&"[object Arguments]"==Kg(e)},ey=Object.prototype,ty=ey.hasOwnProperty,ny=ey.propertyIsEnumerable,ry=$m(function(){return arguments}())?$m:function(e){return Jm(e)&&ty.call(e,"callee")&&!ny.call(e,"callee")},iy=Array.isArray;var oy=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var ay=function(e){return null!=e&&oy(e.length)&&!Jg(e)};var sy=function(e){return Jm(e)&&ay(e)};var uy=function(){return!1},cy=o((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n?Ug.Buffer:void 0,o=(i?i.isBuffer:void 0)||uy;e.exports=o})),ly=Function.prototype,fy=Object.prototype,hy=ly.toString,dy=fy.hasOwnProperty,py=hy.call(Object);var vy=function(e){if(!Jm(e)||"[object Object]"!=Kg(e))return!1;var t=qm(e);if(null===t)return!0;var n=dy.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&hy.call(n)==py},gy={};gy["[object Float32Array]"]=gy["[object Float64Array]"]=gy["[object Int8Array]"]=gy["[object Int16Array]"]=gy["[object Int32Array]"]=gy["[object Uint8Array]"]=gy["[object Uint8ClampedArray]"]=gy["[object Uint16Array]"]=gy["[object Uint32Array]"]=!0,gy["[object Arguments]"]=gy["[object Array]"]=gy["[object ArrayBuffer]"]=gy["[object Boolean]"]=gy["[object DataView]"]=gy["[object Date]"]=gy["[object Error]"]=gy["[object Function]"]=gy["[object Map]"]=gy["[object Number]"]=gy["[object Object]"]=gy["[object RegExp]"]=gy["[object Set]"]=gy["[object String]"]=gy["[object WeakMap]"]=!1;var my=function(e){return Jm(e)&&oy(e.length)&&!!gy[Kg(e)]};var yy=function(e){return function(t){return e(t)}},by=o((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n&&zg.process,o=function(){try{var e=r&&r.require&&r.require("util").types;return e||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=o})),_y=by&&by.isTypedArray,xy=_y?yy(_y):my;var Sy=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]},wy=Object.prototype.hasOwnProperty;var Ay=function(e,t,n){var r=e[t];wy.call(e,t)&&Tg(r,n)&&(void 0!==n||t in e)||Fm(e,t,n)};var Ty=function(e,t,n,r){var i=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var s=t[o],u=r?r(n[s],e[s],s,n,e):void 0;void 0===u&&(u=e[s]),i?Fm(n,s,u):Ay(n,s,u)}return n};var Ey=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r},Cy=/^(?:0|[1-9]\d*)$/;var My=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&Cy.test(e))&&e>-1&&e%1==0&&e<t},ky=Object.prototype.hasOwnProperty;var Oy=function(e,t){var n=iy(e),r=!n&&ry(e),i=!n&&!r&&cy(e),o=!n&&!r&&!i&&xy(e),a=n||r||i||o,s=a?Ey(e.length,String):[],u=s.length;for(var c in e)!t&&!ky.call(e,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||My(c,u))||s.push(c);return s};var Iy=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t},Py=Object.prototype.hasOwnProperty;var Ly=function(e){if(!Qg(e))return Iy(e);var t=Km(e),n=[];for(var r in e)("constructor"!=r||!t&&Py.call(e,r))&&n.push(r);return n};var Ry=function(e){return ay(e)?Oy(e,!0):Ly(e)};var Ny=function(e){return Ty(e,Ry(e))};var Dy=function(e,t,n,r,i,o,a){var s=Sy(e,n),u=Sy(t,n),c=a.get(u);if(c)zm(e,n,c);else{var l=o?o(s,u,n+"",e,t,a):void 0,f=void 0===l;if(f){var h=iy(u),d=!h&&cy(u),p=!h&&!d&&xy(u);l=u,h||d||p?iy(s)?l=s:sy(s)?l=Gm(s):d?(f=!1,l=Um(u,!0)):p?(f=!1,l=Hm(u,!0)):l=[]:vy(u)||ry(u)?(l=s,ry(s)?l=Ny(s):Qg(s)&&!Jg(s)||(l=Qm(u))):f=!1}f&&(a.set(u,l),i(l,u,r,o,a),a.delete(u)),zm(e,n,l)}};var Fy=function e(t,n,r,i,o){t!==n&&jm(n,(function(a,s){if(o||(o=new Nm),Qg(a))Dy(t,n,s,r,e,i,o);else{var u=i?i(Sy(t,s),a,s+"",t,n,o):void 0;void 0===u&&(u=a),zm(t,s,u)}}),Ry)};var zy=function(e){return e};var jy=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)},Uy=Math.max;var By=function(e,t,n){return t=Uy(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=Uy(r.length-t,0),a=Array(o);++i<o;)a[i]=r[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=r[i];return s[t]=n(a),jy(e,this,s)}};var Vy=function(e){return function(){return e}},Hy=Dm?function(e,t){return Dm(e,"toString",{configurable:!0,enumerable:!1,value:Vy(t),writable:!0})}:zy,Gy=Date.now;var Wy=function(e){var t=0,n=0;return function(){var r=Gy(),i=16-(r-n);if(n=r,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(Hy);var Zy=function(e,t){return Wy(By(e,t,zy),e+"")};var Yy=function(e,t,n){if(!Qg(n))return!1;var r=typeof t;return!!("number"==r?ay(n)&&My(t,n.length):"string"==r&&t in n)&&Tg(n[t],e)};var qy,Xy=function(e){return Zy((function(t,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,a&&Yy(n[0],n[1],a)&&(o=i<3?void 0:o,i=1),t=Object(t);++r<i;){var s=n[r];s&&e(t,s,r,o)}return t}))},Ky=Xy((function(e,t,n){Fy(e,t,n)})),Qy={MapToken:" DemotokenToken",SDK:"mapbox-gl apiL7"},Jy={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},$y={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},eb=$()(qy=function(){function e(){dr(this,e),gr(this,"sceneConfigCache",{}),gr(this,"layerConfigCache",{})}return vr(e,[{key:"getSceneConfig",value:function(e){return this.sceneConfigCache[e]}},{key:"getSceneWarninfo",value:function(e){return Qy[e]}},{key:"setSceneConfig",value:function(e,t){this.sceneConfigCache[e]=cr(cr({},Jy),t)}},{key:"getLayerConfig",value:function(e){return this.layerConfigCache[e]}},{key:"setLayerConfig",value:function(e,t,n){this.layerConfigCache[t]=cr({},Ky({},this.sceneConfigCache[e],$y,n))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||qy,tb=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1},nb=Math.abs,rb=Math.pow,ib=rb(2,-52),ob=rb(2,-23),ab=rb(2,127)*(2-ob),sb=rb(2,-126),ub=Math.fround||function(e){var t,n,r=nb(e),i=tb(e);return r<sb?i*(r/sb/ob+1/ib-1/ib)*sb*ob:(n=(t=(1+ob/ib)*r)-(t-r))>ab||n!=n?i*(1/0):i*n};Lt({target:"Math",stat:!0},{fround:ub});var cb,lb=Math.PI/180;function fb(e){var t=e.latitude,n=void 0===t?0:t,r=e.zoom,i=void 0===r?0:r,o=e.scale,a=e.highPrecision,s=void 0!==a&&a,u=e.flipY,c=void 0!==u&&u,l={},f=512*(o=void 0!==o?o:Math.pow(2,i)),h=Math.cos(n*lb),d=f/360,p=d/h,v=f/4003e4/h;if(l.pixelsPerMeter=[v,-v,v],l.metersPerPixel=[1/v,-1/v,1/v],l.pixelsPerDegree=[d,-p,v],l.degreesPerPixel=[1/d,-1/p,1/v],s){var g=lb*Math.tan(n*lb)/h,m=d*g/2,y=f/4003e4*g,b=y/p*v;l.pixelsPerDegree2=[0,-m,y],l.pixelsPerMeter2=[b,0,b],c&&(l.pixelsPerDegree2[1]=-l.pixelsPerDegree2[1],l.pixelsPerMeter2[1]=-l.pixelsPerMeter2[1])}return c&&(l.pixelsPerMeter[1]=-l.pixelsPerMeter[1],l.metersPerPixel[1]=-l.metersPerPixel[1],l.pixelsPerDegree[1]=-l.pixelsPerDegree[1],l.degreesPerPixel[1]=-l.degreesPerPixel[1]),l}(cb=e.CoordinateSystem||(e.CoordinateSystem={}))[cb.LNGLAT=1]="LNGLAT",cb[cb.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",cb[cb.VECTOR_TILE=3]="VECTOR_TILE",cb[cb.IDENTITY=4]="IDENTITY",cb[cb.P20=5]="P20",cb[cb.P20_OFFSET=6]="P20_OFFSET",cb[cb.METER_OFFSET=7]="METER_OFFSET",cb[cb.P20_2=8]="P20_2";var hb,db,pb,vb,gb,mb,yb,bb,_b,xb,Sb,wb={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Ab=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Tb=(hb=$(),db=J(sr.ICameraService),hb((gb=Rr((vb=function(){function t(){dr(this,t),gr(this,"needRefresh",!0),Lr(this,"cameraService",gb,this),gr(this,"coordinateSystem",void 0),gr(this,"viewportCenter",void 0),gr(this,"viewportCenterProjection",void 0),gr(this,"pixelsPerDegree",void 0),gr(this,"pixelsPerDegree2",void 0),gr(this,"pixelsPerMeter",void 0)}return vr(t,[{key:"refresh",value:function(){var t=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),r=this.cameraService.getCenter(),i=fb({latitude:r[1],zoom:t}),o=i.pixelsPerMeter,a=i.pixelsPerDegree;this.viewportCenter=r,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===e.CoordinateSystem.LNGLAT||this.coordinateSystem===e.CoordinateSystem.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===e.CoordinateSystem.LNGLAT_OFFSET?this.calculateLnglatOffset(r,t):this.coordinateSystem===e.CoordinateSystem.P20_OFFSET&&this.calculateLnglatOffset(r,t,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(e){this.coordinateSystem=e}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(e,t,n,r){var i=fb({latitude:e[1],zoom:t,scale:n,flipY:r,highPrecision:!0}),o=i.pixelsPerMeter,a=i.pixelsPerDegree,s=i.pixelsPerDegree2,u=this.cameraService.getViewMatrix(),c=this.cameraService.getProjectionMatrix(),l=bv([],c,u),f=this.cameraService.projectFlat([Math.fround(e[0]),Math.fround(e[1])],Math.pow(2,t));this.viewportCenterProjection=ag([],[f[0],f[1],0,1],l),l=bv([],c,u=this.cameraService.getViewMatrixUncentered()||u),l=bv([],l,Ab),this.cameraService.setViewProjectionMatrix(l),this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=s}}]),t}()).prototype,"cameraService",[db],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pb=vb))||pb),Eb=o((function(e){
/*! Hammer.JS - v2.0.7 - 2016-04-22
	 * http://hammerjs.github.io/
	 *
	 * Copyright (c) 2016 Jorik Tangelder;
	 * Licensed under the MIT license */
!function(t,n,r,i){var o,a=["","webkit","Moz","MS","ms","o"],s=n.createElement("div"),u=Math.round,c=Math.abs,l=Date.now;function f(e,t,n){return setTimeout(y(e,n),t)}function h(e,t,n){return!!Array.isArray(e)&&(d(e,n[t],n),!0)}function d(e,t,n){var r;if(e)if(e.forEach)e.forEach(t,n);else if(void 0!==e.length)for(r=0;r<e.length;)t.call(n,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)}function p(e,n,r){var i="DEPRECATED METHOD: "+n+"\n"+r+" AT \n";return function(){var n=new Error("get-stack-trace"),r=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=t.console&&(t.console.warn||t.console.log);return o&&o.call(t.console,i,r),e.apply(this,arguments)}}o="function"!=typeof Object.assign?function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t}:Object.assign;var v=p((function(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;)(!n||n&&void 0===e[r[i]])&&(e[r[i]]=t[r[i]]),i++;return e}),"extend","Use `assign`."),g=p((function(e,t){return v(e,t,!0)}),"merge","Use `assign`.");function m(e,t,n){var r,i=t.prototype;(r=e.prototype=Object.create(i)).constructor=e,r._super=i,n&&o(r,n)}function y(e,t){return function(){return e.apply(t,arguments)}}function b(e,t){return"function"==typeof e?e.apply(t&&t[0]||void 0,t):e}function _(e,t){return void 0===e?t:e}function x(e,t,n){d(T(t),(function(t){e.addEventListener(t,n,!1)}))}function S(e,t,n){d(T(t),(function(t){e.removeEventListener(t,n,!1)}))}function w(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function A(e,t){return e.indexOf(t)>-1}function T(e){return e.trim().split(/\s+/g)}function E(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var r=0;r<e.length;){if(n&&e[r][n]==t||!n&&e[r]===t)return r;r++}return-1}function C(e){return Array.prototype.slice.call(e,0)}function M(e,t,n){for(var r=[],i=[],o=0;o<e.length;){var a=t?e[o][t]:e[o];E(i,a)<0&&r.push(e[o]),i[o]=a,o++}return n&&(r=t?r.sort((function(e,n){return e[t]>n[t]})):r.sort()),r}function k(e,t){for(var n,r,i=t[0].toUpperCase()+t.slice(1),o=0;o<a.length;){if((r=(n=a[o])?n+i:t)in e)return r;o++}}var O=1;function I(e){var n=e.ownerDocument||e;return n.defaultView||n.parentWindow||t}var P="ontouchstart"in t,L=void 0!==k(t,"PointerEvent"),R=P&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),N=["x","y"],D=["clientX","clientY"];function F(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){b(e.options.enable,[e])&&n.handler(t)},this.init()}function z(e,t,n){var r=n.pointers.length,i=n.changedPointers.length,o=1&t&&r-i==0,a=12&t&&r-i==0;n.isFirst=!!o,n.isFinal=!!a,o&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,r=t.pointers,i=r.length;n.firstInput||(n.firstInput=j(t));i>1&&!n.firstMultiple?n.firstMultiple=j(t):1===i&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,s=a?a.center:o.center,u=t.center=U(r);t.timeStamp=l(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=G(s,u),t.distance=H(s,u),function(e,t){var n=t.center,r=e.offsetDelta||{},i=e.prevDelta||{},o=e.prevInput||{};1!==t.eventType&&4!==o.eventType||(i=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=e.offsetDelta={x:n.x,y:n.y});t.deltaX=i.x+(n.x-r.x),t.deltaY=i.y+(n.y-r.y)}(n,t),t.offsetDirection=V(t.deltaX,t.deltaY);var f=B(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=f.x,t.overallVelocityY=f.y,t.overallVelocity=c(f.x)>c(f.y)?f.x:f.y,t.scale=a?(h=a.pointers,d=r,H(d[0],d[1],D)/H(h[0],h[1],D)):1,t.rotation=a?function(e,t){return G(t[1],t[0],D)+G(e[1],e[0],D)}(a.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,r,i,o,a=e.lastInterval||t,s=t.timeStamp-a.timeStamp;if(8!=t.eventType&&(s>25||void 0===a.velocity)){var u=t.deltaX-a.deltaX,l=t.deltaY-a.deltaY,f=B(s,u,l);r=f.x,i=f.y,n=c(f.x)>c(f.y)?f.x:f.y,o=V(u,l),e.lastInterval=t}else n=a.velocity,r=a.velocityX,i=a.velocityY,o=a.direction;t.velocity=n,t.velocityX=r,t.velocityY=i,t.direction=o}(n,t);var h,d;var p=e.element;w(t.srcEvent.target,p)&&(p=t.srcEvent.target);t.target=p}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function j(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:u(e.pointers[n].clientX),clientY:u(e.pointers[n].clientY)},n++;return{timeStamp:l(),pointers:t,center:U(t),deltaX:e.deltaX,deltaY:e.deltaY}}function U(e){var t=e.length;if(1===t)return{x:u(e[0].clientX),y:u(e[0].clientY)};for(var n=0,r=0,i=0;i<t;)n+=e[i].clientX,r+=e[i].clientY,i++;return{x:u(n/t),y:u(r/t)}}function B(e,t,n){return{x:t/e||0,y:n/e||0}}function V(e,t){return e===t?1:c(e)>=c(t)?e<0?2:4:t<0?8:16}function H(e,t,n){n||(n=N);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return Math.sqrt(r*r+i*i)}function G(e,t,n){n||(n=N);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return 180*Math.atan2(i,r)/Math.PI}F.prototype={handler:function(){},init:function(){this.evEl&&x(this.element,this.evEl,this.domHandler),this.evTarget&&x(this.target,this.evTarget,this.domHandler),this.evWin&&x(I(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(I(this.element),this.evWin,this.domHandler)}};var W={mousedown:1,mousemove:2,mouseup:4};function Z(){this.evEl="mousedown",this.evWin="mousemove mouseup",this.pressed=!1,F.apply(this,arguments)}m(Z,F,{handler:function(e){var t=W[e.type];1&t&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var Y={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},q={2:"touch",3:"pen",4:"mouse",5:"kinect"},X="pointerdown",K="pointermove pointerup pointercancel";function Q(){this.evEl=X,this.evWin=K,F.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}t.MSPointerEvent&&!t.PointerEvent&&(X="MSPointerDown",K="MSPointerMove MSPointerUp MSPointerCancel"),m(Q,F,{handler:function(e){var t=this.store,n=!1,r=e.type.toLowerCase().replace("ms",""),i=Y[r],o=q[e.pointerType]||e.pointerType,a="touch"==o,s=E(t,e.pointerId,"pointerId");1&i&&(0===e.button||a)?s<0&&(t.push(e),s=t.length-1):12&i&&(n=!0),s<0||(t[s]=e,this.callback(this.manager,i,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),n&&t.splice(s,1))}});var J={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function $(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,F.apply(this,arguments)}function ee(e,t){var n=C(e.touches),r=C(e.changedTouches);return 12&t&&(n=M(n.concat(r),"identifier",!0)),[n,r]}m($,F,{handler:function(e){var t=J[e.type];if(1===t&&(this.started=!0),this.started){var n=ee.call(this,e,t);12&t&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}}});var te={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function ne(){this.evTarget="touchstart touchmove touchend touchcancel",this.targetIds={},F.apply(this,arguments)}function re(e,t){var n=C(e.touches),r=this.targetIds;if(3&t&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,o,a=C(e.changedTouches),s=[],u=this.target;if(o=n.filter((function(e){return w(e.target,u)})),1===t)for(i=0;i<o.length;)r[o[i].identifier]=!0,i++;for(i=0;i<a.length;)r[a[i].identifier]&&s.push(a[i]),12&t&&delete r[a[i].identifier],i++;return s.length?[M(o.concat(s),"identifier",!0),s]:void 0}m(ne,F,{handler:function(e){var t=te[e.type],n=re.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}});function ie(){F.apply(this,arguments);var e=y(this.handler,this);this.touch=new ne(this.manager,e),this.mouse=new Z(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function oe(e,t){1&e?(this.primaryTouch=t.changedPointers[0].identifier,ae.call(this,t)):12&e&&ae.call(this,t)}function ae(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var e=r.indexOf(n);e>-1&&r.splice(e,1)}),2500)}}function se(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],o=Math.abs(t-i.x),a=Math.abs(n-i.y);if(o<=25&&a<=25)return!0}return!1}m(ie,F,{handler:function(e,t,n){var r="touch"==n.pointerType,i="mouse"==n.pointerType;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)oe.call(this,t,n);else if(i&&se.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ue=k(s.style,"touchAction"),ce=void 0!==ue,le=function(){if(!ce)return!1;var e={},n=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(r){e[r]=!n||t.CSS.supports("touch-action",r)})),e}();function fe(e,t){this.manager=e,this.set(t)}fe.prototype={set:function(e){"compute"==e&&(e=this.compute()),ce&&this.manager.element.style&&le[e]&&(this.manager.element.style[ue]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return d(this.manager.recognizers,(function(t){b(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(A(e,"none"))return"none";var t=A(e,"pan-x"),n=A(e,"pan-y");if(t&&n)return"none";if(t||n)return t?"pan-x":"pan-y";if(A(e,"manipulation"))return"manipulation";return"auto"}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var r=this.actions,i=A(r,"none")&&!le.none,o=A(r,"pan-y")&&!le["pan-y"],a=A(r,"pan-x")&&!le["pan-x"];if(i){var s=1===e.pointers.length,u=e.distance<2,c=e.deltaTime<250;if(s&&u&&c)return}if(!a||!o)return i||o&&6&n||a&&24&n?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};function he(e){this.options=o({},this.defaults,e||{}),this.id=O++,this.manager=null,this.options.enable=_(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function de(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function pe(e){return 16==e?"down":8==e?"up":2==e?"left":4==e?"right":""}function ve(e,t){var n=t.manager;return n?n.get(e):e}function ge(){he.apply(this,arguments)}function me(){ge.apply(this,arguments),this.pX=null,this.pY=null}function ye(){ge.apply(this,arguments)}function be(){he.apply(this,arguments),this._timer=null,this._input=null}function _e(){ge.apply(this,arguments)}function xe(){ge.apply(this,arguments)}function Se(){he.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function we(e,t){return(t=t||{}).recognizers=_(t.recognizers,we.defaults.preset),new Ae(e,t)}he.prototype={defaults:{},set:function(e){return o(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(h(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=ve(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return h(e,"dropRecognizeWith",this)||(e=ve(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(h(e,"requireFailure",this))return this;var t=this.requireFail;return-1===E(t,e=ve(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(h(e,"dropRequireFailure",this))return this;e=ve(e,this);var t=E(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function r(n){t.manager.emit(n,e)}n<8&&r(t.options.event+de(n)),r(t.options.event),e.additionalEvent&&r(e.additionalEvent),n>=8&&r(t.options.event+de(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=32},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},recognize:function(e){var t=o({},e);if(!b(this.options.enable,[this,t]))return this.reset(),void(this.state=32);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},m(ge,he,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,r=6&t,i=this.attrTest(e);return r&&(8&n||!i)?16|t:r||i?4&n?8|t:2&t?4|t:2:32}}),m(me,ge,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return 6&e&&t.push("pan-y"),24&e&&t.push("pan-x"),t},directionTest:function(e){var t=this.options,n=!0,r=e.distance,i=e.direction,o=e.deltaX,a=e.deltaY;return i&t.direction||(6&t.direction?(i=0===o?1:o<0?2:4,n=o!=this.pX,r=Math.abs(e.deltaX)):(i=0===a?1:a<0?8:16,n=a!=this.pY,r=Math.abs(e.deltaY))),e.direction=i,n&&r>t.threshold&&i&t.direction},attrTest:function(e){return ge.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=pe(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),m(ye,ge,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),m(be,he,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return["auto"]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime>t.time;if(this._input=e,!r||!n||12&e.eventType&&!i)this.reset();else if(1&e.eventType)this.reset(),this._timer=f((function(){this.state=8,this.tryEmit()}),t.time,this);else if(4&e.eventType)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&4&e.eventType?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=l(),this.manager.emit(this.options.event,this._input)))}}),m(_e,ge,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),m(xe,ge,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return me.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return 30&n?t=e.overallVelocity:6&n?t=e.overallVelocityX:24&n&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&c(t)>this.options.velocity&&4&e.eventType},emit:function(e){var t=pe(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),m(Se,he,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return["manipulation"]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),1&e.eventType&&0===this.count)return this.failTimeout();if(r&&i&&n){if(4!=e.eventType)return this.failTimeout();var o=!this.pTime||e.timeStamp-this.pTime<t.interval,a=!this.pCenter||H(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,a&&o?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=f((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return 32},failTimeout:function(){return this._timer=f((function(){this.state=32}),this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),we.VERSION="2.0.7",we.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[_e,{enable:!1}],[ye,{enable:!1},["rotate"]],[xe,{direction:6}],[me,{direction:6},["swipe"]],[Se],[Se,{event:"doubletap",taps:2},["tap"]],[be]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function Ae(e,t){var n;this.options=o({},we.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new((n=this).options.inputClass||(L?Q:R?ne:P?ie:Z))(n,z),this.touchAction=new fe(this,this.options.touchAction),Te(this,!0),d(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function Te(e,t){var n,r=e.element;r.style&&(d(e.options.cssProps,(function(i,o){n=k(r.style,o),t?(e.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=e.oldCssProps[n]||""})),t||(e.oldCssProps={}))}Ae.prototype={set:function(e){return o(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var r=this.recognizers,i=t.curRecognizer;(!i||i&&8&i.state)&&(i=t.curRecognizer=null);for(var o=0;o<r.length;)n=r[o],2===t.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(e),!i&&14&n.state&&(i=t.curRecognizer=n),o++}},get:function(e){if(e instanceof he)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(h(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(h(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=E(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(void 0!==e&&void 0!==t){var n=this.handlers;return d(T(e),(function(e){n[e]=n[e]||[],n[e].push(t)})),this}},off:function(e,t){if(void 0!==e){var n=this.handlers;return d(T(e),(function(e){t?n[e]&&n[e].splice(E(n[e],t),1):delete n[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var r=n.createEvent("Event");r.initEvent(e,!0,!0),r.gesture=t,t.target.dispatchEvent(r)}(e,t);var r=this.handlers[e]&&this.handlers[e].slice();if(r&&r.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var i=0;i<r.length;)r[i](t),i++}},destroy:function(){this.element&&Te(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},o(we,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:Ae,Input:F,TouchAction:fe,TouchInput:ne,MouseInput:Z,PointerEventInput:Q,TouchMouseInput:ie,SingleTouchInput:$,Recognizer:he,AttrRecognizer:ge,Tap:Se,Pan:me,Swipe:xe,Pinch:ye,Rotate:_e,Press:be,on:x,off:S,each:d,merge:g,extend:v,assign:o,inherit:m,bindFn:y,prefixed:k}),(void 0!==t?t:"undefined"!=typeof self?self:{}).Hammer=we,e.exports?e.exports=we:t.Hammer=we}(window,document)}));(mb=e.InteractionEvent||(e.InteractionEvent={})).Hover="hover",mb.Click="click",mb.Select="select",mb.Active="active",mb.Drag="drag";var Cb,Mb,kb,Ob,Ib,Pb,Lb,Rb,Nb,Db,Fb,zb,jb={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Ub=(yb=$(),bb=J(sr.IMapService),yb((Sb=Rr((xb=function(t){mr(r,t);var n=Er(r);function r(){var t;dr(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return Lr(Ar(t=n.call.apply(n,[this].concat(o))),"mapService",Sb,Ar(t)),gr(Ar(t),"hammertime",void 0),gr(Ar(t),"lastClickTime",0),gr(Ar(t),"lastClickXY",[-1,-1]),gr(Ar(t),"clickTimer",void 0),gr(Ar(t),"$containter",void 0),gr(Ar(t),"onDrag",(function(n){var r=t.interactionEvent(n);r.type=jb[r.type],t.emit(e.InteractionEvent.Drag,r)})),gr(Ar(t),"onHammer",(function(n){n.srcEvent.stopPropagation();var r=t.interactionEvent(n);t.emit(e.InteractionEvent.Hover,r)})),gr(Ar(t),"onTouch",(function(e){var n=e.touches[0];t.onHover({x:n.pageX,y:n.pageY,type:"touch"})})),gr(Ar(t),"onHover",(function(n){var r=n.clientX,i=n.clientY,o=n.type,a=t.mapService.getMapContainer();if(a){var s=a.getBoundingClientRect(),u=s.top;r=r-s.left-a.clientLeft,i=i-u-a.clientTop}var c=t.mapService.containerToLngLat([r,i]);if("click"!==o)"touch"!==o?"click"!==o&&"dblclick"!==o&&t.emit(e.InteractionEvent.Hover,{x:r,y:i,lngLat:c,type:o,target:n}):t.isDoubleTap(r,i,c);else{if("ontouchstart"in document.documentElement==!0)return;t.isDoubleTap(r,i,c)}})),t}return vr(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(e.InteractionEvent.Hover)}},{key:"triggerHover",value:function(t){var n=t.x,r=t.y;this.emit(e.InteractionEvent.Hover,{x:n,y:r})}},{key:"triggerSelect",value:function(t){this.emit(e.InteractionEvent.Select,{featureId:t})}},{key:"triggerActive",value:function(t){this.emit(e.InteractionEvent.Active,{featureId:t})}},{key:"addEventListenerOnMap",value:function(){var e=this.mapService.getMapContainer();if(e){var t=new Eb.Manager(e);t.add(new Eb.Tap({event:"dblclick",taps:2})),t.add(new Eb.Tap({event:"click"})),t.add(new Eb.Pan({threshold:0,pointers:0})),t.add(new Eb.Press({})),t.on("dblclick click",this.onHammer),t.on("panstart panmove panend pancancel",this.onDrag),e.addEventListener("mousemove",this.onHover),e.addEventListener("mousedown",this.onHover,!0),e.addEventListener("mouseup",this.onHover),e.addEventListener("contextmenu",this.onHover),this.hammertime=t}}},{key:"removeEventListenerOnMap",value:function(){var e=this.mapService.getMapContainer();e&&(e.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),e.removeEventListener("mousedown",this.onHover),e.removeEventListener("mouseup",this.onHover),e.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(e){var t,n,r=e.type;"touch"===e.pointerType?(n=Math.floor(e.pointers[0].clientY),t=Math.floor(e.pointers[0].clientX)):(n=Math.floor(e.srcEvent.y),t=Math.floor(e.srcEvent.x));var i=this.mapService.getMapContainer();if(i){var o=i.getBoundingClientRect(),a=o.top;t-=o.left,n-=a}return{x:t,y:n,lngLat:this.mapService.containerToLngLat([t,n]),type:r,target:e.srcEvent}}},{key:"isDoubleTap",value:function(t,n,r){var i=this,o=(new Date).getTime(),a="click";o-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-n)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),a="dblclick",this.emit(e.InteractionEvent.Hover,{x:t,y:n,lngLat:r,type:a})):(this.lastClickTime=o,this.lastClickXY=[t,n],this.clickTimer=setTimeout((function(){a="click",i.emit(e.InteractionEvent.Hover,{x:t,y:n,lngLat:r,type:a})}),400))}}]),r}(a)).prototype,"mapService",[bb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_b=xb))||_b),Bb=(o((function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var i=t&&t.prototype instanceof f?t:f,o=Object.create(i.prototype),a=new w(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return T()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=_(a,n);if(s){if(s===l)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=c(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,a),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var l={};function f(){}function h(){}function d(){}var p={};p[i]=function(){return this};var v=Object.getPrototypeOf,g=v&&v(v(A([])));g&&g!==t&&n.call(g,i)&&(p=g);var m=d.prototype=f.prototype=Object.create(p);function y(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var r;this._invoke=function(i,o){function a(){return new t((function(r,a){!function r(i,o,a,s){var u=c(e[i],e,o);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==typeof f&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(f).then((function(e){l.value=e,a(l)}),(function(e){return r("throw",e,a,s)}))}s(u.arg)}(i,o,r,a)}))}return r=r?r.then(a,a):a()}}function _(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=c(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function A(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return h.prototype=m.constructor=d,d.constructor=h,h.displayName=s(d,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},y(b.prototype),b.prototype[o]=function(){return this},e.AsyncIterator=b,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new b(u(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(m),s(m,a,"Generator"),m[i]=function(){return this},m.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=A,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;S(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:A(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}})),Fr("slice")),Vb=on("species"),Hb=[].slice,Gb=Math.max;Lt({target:"Array",proto:!0,forced:!Bb},{slice:function(e,t){var n,r,i,o=ge(this),a=ft(o.length),s=pt(e,a),u=pt(void 0===t?a:t,a);if(Vt(o)&&("function"!=typeof(n=o.constructor)||n!==Array&&!Vt(n.prototype)?me(n)&&null===(n=n[Vb])&&(n=void 0):n=void 0,n===Array||void 0===n))return Hb.call(o,s,u);for(r=new(void 0===n?Array:n)(Gb(u-s,0)),i=0;s<u;s++,i++)s in o&&Nr(r,i,o[s]);return r.length=i,r}}),(Cb=e.gl||(e.gl={}))[Cb.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",Cb[Cb.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",Cb[Cb.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",Cb[Cb.POINTS=0]="POINTS",Cb[Cb.LINES=1]="LINES",Cb[Cb.LINE_LOOP=2]="LINE_LOOP",Cb[Cb.LINE_STRIP=3]="LINE_STRIP",Cb[Cb.TRIANGLES=4]="TRIANGLES",Cb[Cb.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",Cb[Cb.TRIANGLE_FAN=6]="TRIANGLE_FAN",Cb[Cb.ZERO=0]="ZERO",Cb[Cb.ONE=1]="ONE",Cb[Cb.SRC_COLOR=768]="SRC_COLOR",Cb[Cb.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",Cb[Cb.SRC_ALPHA=770]="SRC_ALPHA",Cb[Cb.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",Cb[Cb.DST_ALPHA=772]="DST_ALPHA",Cb[Cb.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",Cb[Cb.DST_COLOR=774]="DST_COLOR",Cb[Cb.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",Cb[Cb.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",Cb[Cb.FUNC_ADD=32774]="FUNC_ADD",Cb[Cb.BLEND_EQUATION=32777]="BLEND_EQUATION",Cb[Cb.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",Cb[Cb.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",Cb[Cb.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",Cb[Cb.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",Cb[Cb.MAX_EXT=32776]="MAX_EXT",Cb[Cb.MIN_EXT=32775]="MIN_EXT",Cb[Cb.BLEND_DST_RGB=32968]="BLEND_DST_RGB",Cb[Cb.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",Cb[Cb.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",Cb[Cb.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",Cb[Cb.CONSTANT_COLOR=32769]="CONSTANT_COLOR",Cb[Cb.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",Cb[Cb.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",Cb[Cb.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",Cb[Cb.BLEND_COLOR=32773]="BLEND_COLOR",Cb[Cb.ARRAY_BUFFER=34962]="ARRAY_BUFFER",Cb[Cb.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",Cb[Cb.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",Cb[Cb.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",Cb[Cb.STREAM_DRAW=35040]="STREAM_DRAW",Cb[Cb.STATIC_DRAW=35044]="STATIC_DRAW",Cb[Cb.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",Cb[Cb.BUFFER_SIZE=34660]="BUFFER_SIZE",Cb[Cb.BUFFER_USAGE=34661]="BUFFER_USAGE",Cb[Cb.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",Cb[Cb.FRONT=1028]="FRONT",Cb[Cb.BACK=1029]="BACK",Cb[Cb.FRONT_AND_BACK=1032]="FRONT_AND_BACK",Cb[Cb.CULL_FACE=2884]="CULL_FACE",Cb[Cb.BLEND=3042]="BLEND",Cb[Cb.DITHER=3024]="DITHER",Cb[Cb.STENCIL_TEST=2960]="STENCIL_TEST",Cb[Cb.DEPTH_TEST=2929]="DEPTH_TEST",Cb[Cb.SCISSOR_TEST=3089]="SCISSOR_TEST",Cb[Cb.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",Cb[Cb.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",Cb[Cb.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",Cb[Cb.NO_ERROR=0]="NO_ERROR",Cb[Cb.INVALID_ENUM=1280]="INVALID_ENUM",Cb[Cb.INVALID_VALUE=1281]="INVALID_VALUE",Cb[Cb.INVALID_OPERATION=1282]="INVALID_OPERATION",Cb[Cb.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",Cb[Cb.CW=2304]="CW",Cb[Cb.CCW=2305]="CCW",Cb[Cb.LINE_WIDTH=2849]="LINE_WIDTH",Cb[Cb.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",Cb[Cb.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",Cb[Cb.CULL_FACE_MODE=2885]="CULL_FACE_MODE",Cb[Cb.FRONT_FACE=2886]="FRONT_FACE",Cb[Cb.DEPTH_RANGE=2928]="DEPTH_RANGE",Cb[Cb.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",Cb[Cb.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",Cb[Cb.DEPTH_FUNC=2932]="DEPTH_FUNC",Cb[Cb.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",Cb[Cb.STENCIL_FUNC=2962]="STENCIL_FUNC",Cb[Cb.STENCIL_FAIL=2964]="STENCIL_FAIL",Cb[Cb.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",Cb[Cb.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",Cb[Cb.STENCIL_REF=2967]="STENCIL_REF",Cb[Cb.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",Cb[Cb.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",Cb[Cb.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",Cb[Cb.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",Cb[Cb.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",Cb[Cb.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",Cb[Cb.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",Cb[Cb.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",Cb[Cb.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",Cb[Cb.VIEWPORT=2978]="VIEWPORT",Cb[Cb.SCISSOR_BOX=3088]="SCISSOR_BOX",Cb[Cb.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",Cb[Cb.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",Cb[Cb.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",Cb[Cb.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",Cb[Cb.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",Cb[Cb.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",Cb[Cb.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",Cb[Cb.RED_BITS=3410]="RED_BITS",Cb[Cb.GREEN_BITS=3411]="GREEN_BITS",Cb[Cb.BLUE_BITS=3412]="BLUE_BITS",Cb[Cb.ALPHA_BITS=3413]="ALPHA_BITS",Cb[Cb.DEPTH_BITS=3414]="DEPTH_BITS",Cb[Cb.STENCIL_BITS=3415]="STENCIL_BITS",Cb[Cb.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",Cb[Cb.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",Cb[Cb.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",Cb[Cb.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",Cb[Cb.SAMPLES=32937]="SAMPLES",Cb[Cb.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",Cb[Cb.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",Cb[Cb.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",Cb[Cb.DONT_CARE=4352]="DONT_CARE",Cb[Cb.FASTEST=4353]="FASTEST",Cb[Cb.NICEST=4354]="NICEST",Cb[Cb.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",Cb[Cb.BYTE=5120]="BYTE",Cb[Cb.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",Cb[Cb.SHORT=5122]="SHORT",Cb[Cb.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",Cb[Cb.INT=5124]="INT",Cb[Cb.UNSIGNED_INT=5125]="UNSIGNED_INT",Cb[Cb.FLOAT=5126]="FLOAT",Cb[Cb.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",Cb[Cb.ALPHA=6406]="ALPHA",Cb[Cb.RGB=6407]="RGB",Cb[Cb.RGBA=6408]="RGBA",Cb[Cb.LUMINANCE=6409]="LUMINANCE",Cb[Cb.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",Cb[Cb.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",Cb[Cb.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",Cb[Cb.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",Cb[Cb.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",Cb[Cb.VERTEX_SHADER=35633]="VERTEX_SHADER",Cb[Cb.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",Cb[Cb.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",Cb[Cb.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",Cb[Cb.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",Cb[Cb.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",Cb[Cb.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",Cb[Cb.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",Cb[Cb.SHADER_TYPE=35663]="SHADER_TYPE",Cb[Cb.DELETE_STATUS=35712]="DELETE_STATUS",Cb[Cb.LINK_STATUS=35714]="LINK_STATUS",Cb[Cb.VALIDATE_STATUS=35715]="VALIDATE_STATUS",Cb[Cb.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",Cb[Cb.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",Cb[Cb.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",Cb[Cb.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",Cb[Cb.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",Cb[Cb.NEVER=512]="NEVER",Cb[Cb.LESS=513]="LESS",Cb[Cb.EQUAL=514]="EQUAL",Cb[Cb.LEQUAL=515]="LEQUAL",Cb[Cb.GREATER=516]="GREATER",Cb[Cb.NOTEQUAL=517]="NOTEQUAL",Cb[Cb.GEQUAL=518]="GEQUAL",Cb[Cb.ALWAYS=519]="ALWAYS",Cb[Cb.KEEP=7680]="KEEP",Cb[Cb.REPLACE=7681]="REPLACE",Cb[Cb.INCR=7682]="INCR",Cb[Cb.DECR=7683]="DECR",Cb[Cb.INVERT=5386]="INVERT",Cb[Cb.INCR_WRAP=34055]="INCR_WRAP",Cb[Cb.DECR_WRAP=34056]="DECR_WRAP",Cb[Cb.VENDOR=7936]="VENDOR",Cb[Cb.RENDERER=7937]="RENDERER",Cb[Cb.VERSION=7938]="VERSION",Cb[Cb.NEAREST=9728]="NEAREST",Cb[Cb.LINEAR=9729]="LINEAR",Cb[Cb.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",Cb[Cb.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",Cb[Cb.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",Cb[Cb.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",Cb[Cb.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",Cb[Cb.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",Cb[Cb.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",Cb[Cb.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",Cb[Cb.TEXTURE_2D=3553]="TEXTURE_2D",Cb[Cb.TEXTURE=5890]="TEXTURE",Cb[Cb.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",Cb[Cb.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",Cb[Cb.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",Cb[Cb.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",Cb[Cb.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",Cb[Cb.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",Cb[Cb.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",Cb[Cb.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",Cb[Cb.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",Cb[Cb.TEXTURE0=33984]="TEXTURE0",Cb[Cb.TEXTURE1=33985]="TEXTURE1",Cb[Cb.TEXTURE2=33986]="TEXTURE2",Cb[Cb.TEXTURE3=33987]="TEXTURE3",Cb[Cb.TEXTURE4=33988]="TEXTURE4",Cb[Cb.TEXTURE5=33989]="TEXTURE5",Cb[Cb.TEXTURE6=33990]="TEXTURE6",Cb[Cb.TEXTURE7=33991]="TEXTURE7",Cb[Cb.TEXTURE8=33992]="TEXTURE8",Cb[Cb.TEXTURE9=33993]="TEXTURE9",Cb[Cb.TEXTURE10=33994]="TEXTURE10",Cb[Cb.TEXTURE11=33995]="TEXTURE11",Cb[Cb.TEXTURE12=33996]="TEXTURE12",Cb[Cb.TEXTURE13=33997]="TEXTURE13",Cb[Cb.TEXTURE14=33998]="TEXTURE14",Cb[Cb.TEXTURE15=33999]="TEXTURE15",Cb[Cb.TEXTURE16=34e3]="TEXTURE16",Cb[Cb.TEXTURE17=34001]="TEXTURE17",Cb[Cb.TEXTURE18=34002]="TEXTURE18",Cb[Cb.TEXTURE19=34003]="TEXTURE19",Cb[Cb.TEXTURE20=34004]="TEXTURE20",Cb[Cb.TEXTURE21=34005]="TEXTURE21",Cb[Cb.TEXTURE22=34006]="TEXTURE22",Cb[Cb.TEXTURE23=34007]="TEXTURE23",Cb[Cb.TEXTURE24=34008]="TEXTURE24",Cb[Cb.TEXTURE25=34009]="TEXTURE25",Cb[Cb.TEXTURE26=34010]="TEXTURE26",Cb[Cb.TEXTURE27=34011]="TEXTURE27",Cb[Cb.TEXTURE28=34012]="TEXTURE28",Cb[Cb.TEXTURE29=34013]="TEXTURE29",Cb[Cb.TEXTURE30=34014]="TEXTURE30",Cb[Cb.TEXTURE31=34015]="TEXTURE31",Cb[Cb.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",Cb[Cb.REPEAT=10497]="REPEAT",Cb[Cb.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",Cb[Cb.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",Cb[Cb.FLOAT_VEC2=35664]="FLOAT_VEC2",Cb[Cb.FLOAT_VEC3=35665]="FLOAT_VEC3",Cb[Cb.FLOAT_VEC4=35666]="FLOAT_VEC4",Cb[Cb.INT_VEC2=35667]="INT_VEC2",Cb[Cb.INT_VEC3=35668]="INT_VEC3",Cb[Cb.INT_VEC4=35669]="INT_VEC4",Cb[Cb.BOOL=35670]="BOOL",Cb[Cb.BOOL_VEC2=35671]="BOOL_VEC2",Cb[Cb.BOOL_VEC3=35672]="BOOL_VEC3",Cb[Cb.BOOL_VEC4=35673]="BOOL_VEC4",Cb[Cb.FLOAT_MAT2=35674]="FLOAT_MAT2",Cb[Cb.FLOAT_MAT3=35675]="FLOAT_MAT3",Cb[Cb.FLOAT_MAT4=35676]="FLOAT_MAT4",Cb[Cb.SAMPLER_2D=35678]="SAMPLER_2D",Cb[Cb.SAMPLER_CUBE=35680]="SAMPLER_CUBE",Cb[Cb.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",Cb[Cb.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",Cb[Cb.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",Cb[Cb.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",Cb[Cb.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",Cb[Cb.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",Cb[Cb.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",Cb[Cb.COMPILE_STATUS=35713]="COMPILE_STATUS",Cb[Cb.LOW_FLOAT=36336]="LOW_FLOAT",Cb[Cb.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",Cb[Cb.HIGH_FLOAT=36338]="HIGH_FLOAT",Cb[Cb.LOW_INT=36339]="LOW_INT",Cb[Cb.MEDIUM_INT=36340]="MEDIUM_INT",Cb[Cb.HIGH_INT=36341]="HIGH_INT",Cb[Cb.FRAMEBUFFER=36160]="FRAMEBUFFER",Cb[Cb.RENDERBUFFER=36161]="RENDERBUFFER",Cb[Cb.RGBA4=32854]="RGBA4",Cb[Cb.RGB5_A1=32855]="RGB5_A1",Cb[Cb.RGB565=36194]="RGB565",Cb[Cb.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",Cb[Cb.STENCIL_INDEX=6401]="STENCIL_INDEX",Cb[Cb.STENCIL_INDEX8=36168]="STENCIL_INDEX8",Cb[Cb.DEPTH_STENCIL=34041]="DEPTH_STENCIL",Cb[Cb.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",Cb[Cb.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",Cb[Cb.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",Cb[Cb.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",Cb[Cb.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",Cb[Cb.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",Cb[Cb.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",Cb[Cb.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",Cb[Cb.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",Cb[Cb.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",Cb[Cb.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",Cb[Cb.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",Cb[Cb.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",Cb[Cb.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",Cb[Cb.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",Cb[Cb.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",Cb[Cb.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",Cb[Cb.NONE=0]="NONE",Cb[Cb.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",Cb[Cb.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",Cb[Cb.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",Cb[Cb.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",Cb[Cb.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",Cb[Cb.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",Cb[Cb.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",Cb[Cb.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",Cb[Cb.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",Cb[Cb.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",Cb[Cb.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",Cb[Cb.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",Cb[Cb.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",Cb[Cb.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL";var Wb,Zb,Yb,qb,Xb,Kb,Qb,Jb=(Mb=$(),kb=J(sr.IRendererService),Ob=J(sr.IGlobalConfigService),Ib=J(sr.IInteractionService),Pb=J(sr.ILayerService),Mb((Nb=Rr((Rb=function(){function t(){var e=this;dr(this,t),Lr(this,"rendererService",Nb,this),Lr(this,"configService",Db,this),Lr(this,"interactionService",Fb,this),Lr(this,"layerService",zb,this),gr(this,"pickingFBO",void 0),gr(this,"width",0),gr(this,"height",0),gr(this,"alreadyInPicking",!1),gr(this,"pickBufferScale",1),gr(this,"pickFromPickingFBO",(function(t,n){var r,i=n.x,o=n.y,a=n.lngLat,s=n.type,u=n.target,c=!1,l=e.rendererService,f=(l.getViewportSize,l.readPixels),h=(0,l.getContainer)().getBoundingClientRect(),d=h.width,p=h.height;d*=Ba,p*=Ba;var v,g=t.getLayerConfig(),m=g.enableHighlight,y=g.enableSelect,b=i*Ba,_=o*Ba;if(b>d-1*Ba||b<0||_>p-1*Ba||_<0)return!1;if(0!==(v=f({x:Math.floor(b/e.pickBufferScale),y:Math.floor((p-(o+1)*Ba)/e.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO}))[0]||0!==v[1]||0!==v[2]){var x=ad(v),S=t.getSource().getFeatureById(x);x!==t.getCurrentPickId()&&"mousemove"===s&&(s="mouseenter");var w={x:i,y:o,type:s,lngLat:a,featureId:x,feature:S,target:u};S&&(c=!0,t.setCurrentPickId(x),e.triggerHoverOnLayer(t,w))}else{var A={x:i,y:o,lngLat:a,type:null!==t.getCurrentPickId()&&"mousemove"===s?"mouseout":"un"+s,featureId:null,target:u,feature:null};e.triggerHoverOnLayer(t,cr(cr({},A),{},{type:"unpick"})),e.triggerHoverOnLayer(t,A),t.setCurrentPickId(null)}if(m&&e.highlightPickedFeature(t,v),y&&"click"===s&&(null===(r=v)||void 0===r?void 0:r.toString())!==[0,0,0,0].toString()){var T=ad(v);null===t.getCurrentSelectedId()||T!==t.getCurrentSelectedId()?(e.selectFeature(t,v),t.setCurrentSelectedId(T)):(e.selectFeature(t,new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null))}return c}))}var n,r,i;return vr(t,[{key:"init",value:function(t){var n=this.rendererService,r=n.createTexture2D,i=n.createFramebuffer,o=(n.getViewportSize,(0,n.getContainer)().getBoundingClientRect()),a=o.width,s=o.height;a*=Ba,s*=Ba,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=i({color:r({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale),wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.interactionService.on(e.InteractionEvent.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:(i=hr(regeneratorRuntime.mark((function e(t,n,r){var i,o,a,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=this.rendererService,o=i.useFramebuffer,a=i.clear,i.getContainer,this.resizePickingFBO(),o(this.pickingFBO,(function(){a({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.hooks.beforePickingEncode.call(),t.renderModels(),t.hooks.afterPickingEncode.call();var e=s.pickBox(t,n);r(e)}));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"pickBox",value:function(e,t){var n,r=this,i=Mr(t.map((function(e){var t=e<0?0:e;return Math.floor(t*Ba/r.pickBufferScale)})),4),o=i[0],a=i[1],s=i[2],u=i[3],c=this.rendererService,l=(c.getViewportSize,c.readPixels),f=(0,c.getContainer)().getBoundingClientRect(),h=f.width,d=f.height;if(d*=Ba,o>((h*=Ba)-1)*Ba/this.pickBufferScale||s<0||a>(d-1)*Ba/this.pickBufferScale||u<0)return[];var p=Math.min(h/this.pickBufferScale,s)-o,v=Math.min(d/this.pickBufferScale,u)-a;n=l({x:o,y:Math.floor(d/this.pickBufferScale-(u+1)),width:p,height:v,data:new Uint8Array(p*v*4),framebuffer:this.pickingFBO});for(var g=[],m={},y=0;y<n.length/4;y+=1){var b=ad(n.slice(4*y,4*y+4));if(-1!==b&&!m[b]){var _=e.getSource().getFeatureById(b);g.push(_),m[b]=!0}}return g}},{key:"pickingAllLayer",value:(r=hr(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.alreadyInPicking&&!this.layerService.alreadyInRendering){e.next=2;break}return e.abrupt("return");case 2:return this.alreadyInPicking=!0,e.next=5,this.pickingLayers(t);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"resizePickingFBO",value:function(){var e=(0,this.rendererService.getContainer)().getBoundingClientRect(),t=e.width,n=e.height;t*=Ba,n*=Ba,this.width===t&&this.height===n||(this.pickingFBO.resize({width:Math.round(t/this.pickBufferScale),height:Math.round(n/this.pickBufferScale)}),this.width=t,this.height=n)}},{key:"pickingLayers",value:(n=hr(regeneratorRuntime.mark((function e(t){var n,r,i,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=this.rendererService).getViewportSize,r=n.useFramebuffer,i=n.clear,n.getContainer,this.resizePickingFBO(),r(this.pickingFBO,(function(){o.layerService.getLayers().filter((function(e){return e.needPick(t.type)})).reverse().some((function(e){return i({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),e.hooks.beforePickingEncode.call(),e.renderModels(),e.hooks.afterPickingEncode.call(),o.pickFromPickingFBO(e,t)&&!e.getLayerConfig().enablePropagation}))}));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"triggerHoverOnLayer",value:function(e,t){e.emit(t.type,t)}},{key:"isEventCrash",value:function(e){var t=!0;return e.target.path.map((function(e){e.classList&&e.classList.forEach((function(e){"l7-marker"!==e&&"l7-popup"!==e||(t=!1)}))})),t}},{key:"highlightPickedFeature",value:function(e,t){var n=Mr(t,3),r=n[0],i=n[1],o=n[2];e.hooks.beforeHighlight.call([r,i,o])}},{key:"selectFeature",value:function(e,t){var n=Mr(t,3),r=n[0],i=n[1],o=n[2];e.hooks.beforeSelect.call([r,i,o])}}]),t}()).prototype,"rendererService",[kb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Db=Rr(Rb.prototype,"configService",[Ob],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fb=Rr(Rb.prototype,"interactionService",[Ib],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zb=Rr(Rb.prototype,"layerService",[Pb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lb=Rb))||Lb),$b=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];dr(this,e),gr(this,"autoStart",void 0),gr(this,"startTime",0),gr(this,"oldTime",0),gr(this,"running",!1),gr(this,"elapsedTime",0),this.autoStart=t}return vr(e,[{key:"start",value:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),e}(),e_=(Wb=$(),Zb=J(sr.IRendererService),Yb=J(sr.IGlobalConfigService),Wb((Kb=Rr((Xb=function(){function e(){dr(this,e),gr(this,"clock",new $b),gr(this,"alreadyInRendering",!1),gr(this,"layers",[]),gr(this,"layerRenderID",void 0),gr(this,"sceneInited",!1),gr(this,"animateInstanceCount",0),Lr(this,"renderService",Kb,this),Lr(this,"configService",Qb,this)}return vr(e,[{key:"add",value:function(e){this.sceneInited&&e.init(),this.layers.push(e)}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach((function(e){e.inited||e.init()}))}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(e){return this.layers.find((function(t){return t.id===e}))}},{key:"getLayerByName",value:function(e){return this.layers.find((function(t){return t.name===e}))}},{key:"remove",value:function(e){var t=this.layers.indexOf(e);t>-1&&this.layers.splice(t,1),e.emit("remove",null),e.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(){this.alreadyInRendering||(this.alreadyInRendering=!0,this.clear(),this.updateRenderOrder(),this.layers.filter((function(e){return e.inited})).filter((function(e){return e.isVisible()})).forEach((function(e){e.hooks.beforeRenderData.call(),e.hooks.beforeRender.call(),e.render(),e.hooks.afterRender.call()})),this.alreadyInRendering=!1)}},{key:"updateRenderOrder",value:function(){this.layers.sort((function(e,t){return e.zIndex-t.zIndex}))}},{key:"destroy",value:function(){this.layers.forEach((function(e){return e.destroy()})),this.layers=[],this.renderLayers()}},{key:"startAnimate",value:function(){0==this.animateInstanceCount++&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){0==--this.animateInstanceCount&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"clear",value:function(){this.renderService.clear({color:[0,0,0,0],depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){cancelAnimationFrame(this.layerRenderID)}}]),e}()).prototype,"renderService",[Zb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qb=Rr(Xb.prototype,"configService",[Yb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qb=Xb))||qb),t_=Yl.left,n_=$i("reduce");Lt({target:"Array",proto:!0,forced:!n_||!Xd&&jt>79&&jt<83},{reduce:function(e){return t_(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}});var r_=function(e){return null==e};Lt({target:"Object",stat:!0,forced:Object.assign!==Ya},{assign:Ya});var i_,o_,a_,s_,u_,c_,l_=function(){function e(t){var n=this;dr(this,e),gr(this,"name",void 0),gr(this,"type",void 0),gr(this,"scale",void 0),gr(this,"descriptor",void 0),gr(this,"featureBufferLayout",[]),gr(this,"needRescale",!1),gr(this,"needRemapping",!1),gr(this,"needRegenerateVertices",!1),gr(this,"featureRange",{startIndex:0,endIndex:1/0}),gr(this,"vertexAttribute",void 0),gr(this,"defaultCallback",(function(e){var t;return 0===e.length?(null===(t=n.scale)||void 0===t?void 0:t.defaultValues)||[]:e.map((function(e,t){var r;return(null===(r=n.scale)||void 0===r?void 0:r.scalers[t].func)(e)}))})),this.setProps(t)}return vr(e,[{key:"setProps",value:function(e){Object.assign(this,e)}},{key:"mapping",value:function(e){var t;if(null!==(t=this.scale)&&void 0!==t&&t.callback){var n,r=null===(n=this.scale)||void 0===n?void 0:n.callback.apply(n,kr(e));if(!r_(r))return[r]}return this.defaultCallback(e)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),f_=["buffer","update","name"],h_=(gr(i_={},e.gl.FLOAT,4),gr(i_,e.gl.UNSIGNED_BYTE,1),gr(i_,e.gl.UNSIGNED_SHORT,2),i_),d_=(o_=$(),a_=J(sr.IRendererService),o_((c_=Rr((u_=function(){function t(){dr(this,t),gr(this,"attributesAndIndices",void 0),Lr(this,"rendererService",c_,this),gr(this,"attributes",[]),gr(this,"triangulation",void 0),gr(this,"featureLayout",{sizePerElement:0,elements:[]})}return vr(t,[{key:"registerStyleAttribute",value:function(e){var t=this.getLayerStyleAttribute(e.name||"");return t?t.setProps(e):(t=new l_(e),this.attributes.push(t)),t}},{key:"updateStyleAttribute",value:function(e,t,n){var r=this.getLayerStyleAttribute(e);r||(r=this.registerStyleAttribute(cr(cr({},t),{},{name:e})));var i=t.scale;i&&r&&(r.scale=i,r.needRescale=!0,r.needRemapping=!0,r.needRegenerateVertices=!0,n&&n.featureRange&&(r.featureRange=n.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(e){return this.attributes.find((function(t){return t.name===e}))}},{key:"getLayerAttributeScale",value:function(e){var t,n=this.getLayerStyleAttribute(e),r=null==n||null===(t=n.scale)||void 0===t?void 0:t.scalers;return r&&r[0]?r[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,o=this.attributes.find((function(e){return e.name===t}));if(o&&o.descriptor){var a=o.descriptor,s=a.update,u=a.buffer,c=a.size,l=void 0===c?0:c,f=h_[u.type||e.gl.FLOAT];if(s){var h=this.featureLayout,d=h.elements,p=h.sizePerElement,v=d.slice(r,i);if(!v.length)return;var g=v[0].offset,m=g*l*f,y=v.map((function(e,t){for(var r=e.featureIdx,i=e.vertices,o=e.normals,a=i.length/p,u=[],c=0;c<a;c++){var l=o?o.slice(3*c,3*c+3):[];u.push.apply(u,kr(s(n[r],r,i.slice(c*p,c*p+p),t,l)))}return u})).reduce((function(e,t){return e.push.apply(e,kr(t)),e}),[]);o.vertexAttribute.updateBuffer({data:y,offset:m})}}}},{key:"createAttributesAndIndices",value:function(t,n){var r=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var i=this.attributes.map((function(e){return e.resetDescriptor(),e.descriptor})),o=0,a=[],s=3;t.forEach((function(e,t){var n=r.triangulation(e),u=n.indices,c=n.vertices,l=n.normals,f=n.size;u.forEach((function(e){a.push(e+o)})),s=f;var h=c.length/f;r.featureLayout.sizePerElement=s,r.featureLayout.elements.push({featureIdx:t,vertices:c,normals:l,offset:o}),o+=h;for(var d=function(n){var r=(null==l?void 0:l.slice(3*n,3*n+3))||[],o=c.slice(n*f,n*f+f);i.forEach((function(i,a){var s;i&&i.update&&(s=i.buffer.data).push.apply(s,kr(i.update(e,t,o,n,r)))}))},p=0;p<h;p++)d(p)}));var u=this.rendererService,c=u.createAttribute,l=u.createBuffer,f=u.createElements,h={};i.forEach((function(e,t){if(e){var n=e.buffer,i=(e.update,e.name,wr(e,f_)),o=c(cr({buffer:l(n)},i));h[e.name||""]=o,r.attributes[t].vertexAttribute=o}}));var d=f({data:a,type:e.gl.UNSIGNED_INT,count:a.length});return this.attributesAndIndices={attributes:h,elements:d},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var e;this.attributes.forEach((function(e){e.vertexAttribute&&e.vertexAttribute.destroy()})),null===(e=this.attributesAndIndices)||void 0===e||e.elements.destroy(),this.attributes=[]}}]),t}()).prototype,"rendererService",[a_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s_=u_))||s_);
/*! *****************************************************************************
	Copyright (c) Microsoft Corporation. All rights reserved.
	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
	this file except in compliance with the License. You may obtain a copy of the
	License at http://www.apache.org/licenses/LICENSE-2.0

	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
	MERCHANTABLITY OR NON-INFRINGEMENT.

	See the Apache Version 2.0 License for specific language governing permissions
	and limitations under the License.
	***************************************************************************** */
function p_(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function v_(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function g_(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function m_(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function y_(e,t){return e(t={exports:{}},t.exports),t.exports}var b_=y_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e&&"number"==typeof e.length&&e.length>=0&&e.length%1==0},e.exports=t.default}));m_(b_);var __=y_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var r=t.pop();return e.call(this,t,r)}},e.exports=t.default}));m_(__);var x_=y_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.fallback=o,t.wrap=a;var n,r=t.hasSetImmediate="function"==typeof setImmediate&&setImmediate,i=t.hasNextTick="object"==typeof process&&"function"==typeof process.nextTick;function o(e){setTimeout(e,0)}function a(e){return function(t){for(var n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return e((function(){return t.apply(void 0,n)}))}}n=r?setImmediate:i?process.nextTick:o,t.default=a(n)}));m_(x_);x_.fallback,x_.wrap,x_.hasSetImmediate,x_.hasNextTick;var S_=y_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,w_.isAsync)(e))return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var r=t.pop(),i=e.apply(this,t);return o(i,r)};return(0,n.default)((function(t,n){var r;try{r=e.apply(this,t)}catch(e){return n(e)}if(r&&"function"==typeof r.then)return o(r,n);n(null,r)}))};var n=i(__),r=i(x_);function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){return e.then((function(e){a(t,null,e)}),(function(e){a(t,e&&e.message?e:new Error(e))}))}function a(e,t,n){try{e(t,n)}catch(e){(0,r.default)((function(e){throw e}),e)}}e.exports=t.default}));m_(S_);var w_=y_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isAsyncIterable=t.isAsyncGenerator=t.isAsync=void 0;var n,r=(n=S_)&&n.__esModule?n:{default:n};function i(e){return"AsyncFunction"===e[Symbol.toStringTag]}t.default=function(e){if("function"!=typeof e)throw new Error("expected a function");return i(e)?(0,r.default)(e):e},t.isAsync=i,t.isAsyncGenerator=function(e){return"AsyncGenerator"===e[Symbol.toStringTag]},t.isAsyncIterable=function(e){return"function"==typeof e[Symbol.asyncIterator]}}));m_(w_);w_.isAsyncIterable,w_.isAsyncGenerator,w_.isAsync;var A_=y_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){void 0===t&&(t=e.length);if(!t)throw new Error("arity is undefined");function n(){for(var n=this,r=[],i=arguments.length;i--;)r[i]=arguments[i];return"function"==typeof r[t-1]?e.apply(this,r):new Promise((function(i,o){r[t-1]=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];if(e)return o(e);i(t.length>1?t:t[0])},e.apply(n,r)}))}return Object.defineProperty(n,"name",{configurable:!0,value:"awaitable("+e.name+")"}),n},e.exports=t.default}));m_(A_);var T_=y_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(b_),r=o(w_),i=o(A_);function o(e){return e&&e.__esModule?e:{default:e}}t.default=(0,i.default)((function(e,t,i){var o=(0,n.default)(t)?[]:{};e(t,(function(e,t,n){(0,r.default)(e)((function(e){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];r.length<2&&(r=r[0]),o[t]=r,n(e)}))}),(function(e){return i(e,o)}))}),3),e.exports=t.default}));m_(T_);var E_=y_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(null!==e){var r=e;e=null,r.apply(this,t)}}return Object.assign(t,e),t},e.exports=t.default}));m_(E_);var C_=y_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e[Symbol.iterator]&&e[Symbol.iterator]()},e.exports=t.default}));m_(C_);var M_=y_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,n.default)(e))return function(e){var t=-1,n=e.length;return function(){return++t<n?{value:e[t],key:t}:null}}(e);var t=(0,r.default)(e);return t?function(e){var t=-1;return function(){var n=e.next();return n.done?null:(t++,{value:n.value,key:t})}}(t):function(e){var t=e?Object.keys(e):[],n=-1,r=t.length;return function(){var i=t[++n];return n<r?{value:e[i],key:i}:null}}(e)};var n=i(b_),r=i(C_);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}));m_(M_);var k_=y_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(null===e)throw new Error("Callback was already called.");var r=e;e=null,r.apply(this,t)}},e.exports=t.default}));m_(k_);var O_=y_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default={},e.exports=t.default}));m_(O_);var I_=y_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,i){var o=!1,a=!1,s=!1,u=0,c=0;function l(){u>=t||s||o||(s=!0,e.next().then((function(e){var t=e.value,r=e.done;if(!a&&!o){if(s=!1,r)return o=!0,void(u<=0&&i(null));u++,n(t,c,f),c++,l()}})).catch(h))}function f(e,t){if(u-=1,!a)return e?h(e):!1===e?(o=!0,void(a=!0)):t===r.default||o&&u<=0?(o=!0,i(null)):void l()}function h(e){a||(s=!1,o=!0,i(e))}l()};var n,r=(n=O_)&&n.__esModule?n:{default:n};e.exports=t.default}));m_(I_);var P_=y_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=s(E_),r=s(M_),i=s(k_),o=s(I_),a=s(O_);function s(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){return function(t,s,u){if(u=(0,n.default)(u),e<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!t)return u(null);if((0,w_.isAsyncGenerator)(t))return(0,o.default)(t,e,s,u);if((0,w_.isAsyncIterable)(t))return(0,o.default)(t[Symbol.asyncIterator](),e,s,u);var c=(0,r.default)(t),l=!1,f=!1,h=0,d=!1;function p(e,t){if(!f)if(h-=1,e)l=!0,u(e);else if(!1===e)l=!0,f=!0;else{if(t===a.default||l&&h<=0)return l=!0,u(null);d||v()}}function v(){for(d=!0;h<e&&!l;){var t=c();if(null===t)return l=!0,void(h<=0&&u(null));h+=1,s(t.value,t.key,(0,i.default)(p))}d=!1}v()}},e.exports=t.default}));m_(P_);var L_=y_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(P_),r=o(w_),i=o(A_);function o(e){return e&&e.__esModule?e:{default:e}}t.default=(0,i.default)((function(e,t,i,o){return(0,n.default)(t)(e,(0,r.default)(i),o)}),4),e.exports=t.default}));m_(L_);var R_=y_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(L_),r=i(A_);function i(e){return e&&e.__esModule?e:{default:e}}t.default=(0,r.default)((function(e,t,r){return(0,n.default)(e,1,t,r)}),3),e.exports=t.default}));m_(R_);var N_=m_(y_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,n.default)(r.default,e,t)};var n=i(T_),r=i(R_);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}))),D_=function(){function e(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,N_(this.tasks)},e.prototype.tap=function(e,t){var n=this;this.tasks.push((function(r){t.apply(void 0,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(g_(arguments[t]));return e}(n.args)),r(null,e)}))},e}(),F_=y_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=c(b_),r=c(O_),i=c(L_),o=c(E_),a=c(k_),s=c(w_),u=c(A_);function c(e){return e&&e.__esModule?e:{default:e}}function l(e,t,n){n=(0,o.default)(n);var i=0,s=0,u=e.length,c=!1;function l(e,t){!1===e&&(c=!0),!0!==c&&(e?n(e):++s!==u&&t!==r.default||n(null))}for(0===u&&n(null);i<u;i++)t(e[i],i,(0,a.default)(l))}function f(e,t,n){return(0,i.default)(e,1/0,t,n)}t.default=(0,u.default)((function(e,t,r){return((0,n.default)(e)?l:f)(e,(0,s.default)(t),r)}),3),e.exports=t.default}));m_(F_);var z_=m_(y_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,r.default)(n.default,e,t)};var n=i(F_),r=i(T_);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}))),j_=function(){function e(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];this.tasks=[]}return e.prototype.promise=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return z_(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push((function(r){return p_(n,void 0,void 0,(function(){return v_(this,(function(n){switch(n.label){case 0:return[4,t()];case 1:return n.sent(),r(null,e),[2]}}))}))}))},e}(),U_=m_(y_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(E_),r=a(k_),i=a(w_),o=a(A_);function a(e){return e&&e.__esModule?e:{default:e}}t.default=(0,o.default)((function(e,t){if(t=(0,n.default)(t),!Array.isArray(e))return t(new Error("First argument to waterfall must be an array of functions"));if(!e.length)return t();var o=0;function a(t){(0,i.default)(e[o++]).apply(void 0,t.concat([(0,r.default)(s)]))}function s(n){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];if(!1!==n)return n||o===e.length?t.apply(void 0,[n].concat(r)):void a(r)}a([])})),e.exports=t.default}))),B_=function(){function e(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];this.tasks=[]}return e.prototype.call=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return U_(this.tasks)},e.prototype.tap=function(e,t){0===this.tasks.length?this.tasks.push((function(e){var n=t();e(!!n&&null,n)})):this.tasks.push((function(n,r){r(!!t()&&null,e)}))},e}(),V_=function(){function e(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];this.tasks=[]}return e.prototype.call=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return N_(this.tasks)},e.prototype.tap=function(e,t){this.tasks.push((function(n){n(t(),e)}))},e}();function H_(e){var t=e.target||e.srcElement;t.__resizeRAF__&&cancelAnimationFrame(t.__resizeRAF__),t.__resizeRAF__=requestAnimationFrame((function(){var n=t.__resizeTrigger__,r=n&&n.__resizeListeners__;r&&r.forEach((function(t){t.call(n,e)}))}))}var G_=function(e,t){var n,r=this.document,i=r.attachEvent;if("undefined"!=typeof navigator&&(n=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/)),!e.__resizeListeners__)if(e.__resizeListeners__=[],i)e.__resizeTrigger__=e,e.attachEvent("onresize",H_);else{"static"===getComputedStyle(e).position&&(e.style.position="relative");var o=e.__resizeTrigger__=r.createElement("object");o.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),o.setAttribute("class","resize-sensor"),o.setAttribute("tabindex","-1"),o.setAttribute("title",""),o.__resizeElement__=e,o.onload=function(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",H_)},o.type="text/html",n&&e.appendChild(o),o.data="about:blank",n||e.appendChild(o)}e.__resizeListeners__.push(t)},W_="undefined"==typeof window?G_:G_.bind(window),Z_=function(e,t){var n=document.attachEvent,r=e.__resizeListeners__||[];if(t){var i=r.indexOf(t);-1!==i&&r.splice(i,1)}else r=e.__resizeListeners__=[];if(!r.length){if(n)e.detachEvent("onresize",H_);else if(e.__resizeTrigger__){var o=e.__resizeTrigger__.contentDocument,a=o&&o.defaultView;a&&(a.removeEventListener("resize",H_),delete a.__resizeTrigger__),e.__resizeTrigger__=!e.removeChild(e.__resizeTrigger__)}delete e.__resizeListeners__}};W_.unbind=Z_;window.document.documentElement.style;var Y_,q_,X_,K_,Q_,J_,$_,ex,tx,nx,rx,ix,ox,ax,sx,ux,cx,lx,fx,hx,dx,px,vx,gx,mx,yx,bx,_x,xx,Sx,wx,Ax,Tx,Ex=0;function Cx(e){var t=e;if("string"==typeof e&&(t=document.getElementById(e)),t){var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      z-index:2;\n      height: 100%;\n      width: 100%;\n      pointer-events: none;\n    ",n.id="l7-scene-".concat(Ex++),n.classList.add("l7-scene"),t.appendChild(n),n}return null}var Mx=(Y_=$(),q_=J(sr.SceneID),X_=J(sr.IIconService),K_=J(sr.IFontService),Q_=J(sr.IControlService),J_=J(sr.IGlobalConfigService),$_=J(sr.IMapService),ex=J(sr.ICoordinateSystemService),tx=J(sr.IRendererService),nx=J(sr.ILayerService),rx=J(sr.ICameraService),ix=J(sr.IInteractionService),ox=J(sr.IPickingService),ax=J(sr.IShaderModuleService),sx=J(sr.IMarkerService),ux=J(sr.IPopupService),Y_((fx=Rr((lx=function(t){mr(i,t);var n,r=Er(i);function i(){var e;return dr(this,i),gr(Ar(e=r.call(this)),"destroyed",!1),gr(Ar(e),"loaded",!1),gr(Ar(e),"loadFont",!1),gr(Ar(e),"fontFamily",""),Lr(Ar(e),"id",fx,Ar(e)),Lr(Ar(e),"iconService",hx,Ar(e)),Lr(Ar(e),"fontService",dx,Ar(e)),Lr(Ar(e),"controlService",px,Ar(e)),Lr(Ar(e),"configService",vx,Ar(e)),Lr(Ar(e),"map",gx,Ar(e)),Lr(Ar(e),"coordinateSystemService",mx,Ar(e)),Lr(Ar(e),"rendererService",yx,Ar(e)),Lr(Ar(e),"layerService",bx,Ar(e)),Lr(Ar(e),"cameraService",_x,Ar(e)),Lr(Ar(e),"interactionService",xx,Ar(e)),Lr(Ar(e),"pickingService",Sx,Ar(e)),Lr(Ar(e),"shaderModuleService",wx,Ar(e)),Lr(Ar(e),"markerService",Ax,Ar(e)),Lr(Ar(e),"popupService",Tx,Ar(e)),gr(Ar(e),"inited",!1),gr(Ar(e),"initPromise",void 0),gr(Ar(e),"rendering",!1),gr(Ar(e),"$container",void 0),gr(Ar(e),"canvas",void 0),gr(Ar(e),"markerContainer",void 0),gr(Ar(e),"hooks",void 0),gr(Ar(e),"handleWindowResized",(function(){e.emit("resize"),e.$container&&(e.initContainer(),ja(),e.coordinateSystemService.needRefresh=!0,e.render())})),gr(Ar(e),"handleMapCameraChanged",(function(t){e.cameraService.update(t),e.render()})),e.hooks={init:new j_},e}return vr(i,[{key:"init",value:function(t){var n=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",hr(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(e){n.map.onCameraChanged((function(t){n.cameraService.init(),n.cameraService.update(t),"GAODE2.x"!==n.map.version&&e()})),"GAODE2.x"!==n.map.version?n.map.init():e()}));case 2:if("GAODE2.x"!==n.map.version||!n.map.initViewPort){t.next=6;break}return t.next=5,n.map.init();case 5:n.map.initViewPort();case 6:n.map.onCameraChanged(n.handleMapCameraChanged),n.map.addMarkerContainer(),n.markerService.addMarkers(),n.markerService.addMarkerLayers(),n.popupService.initPopup(),n.interactionService.init(),n.interactionService.on(e.InteractionEvent.Drag,n.addSceneEvent.bind(n));case 13:case"end":return t.stop()}}),t)})))),this.hooks.init.tapPromise("initRenderer",hr(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Cx(n.configService.getSceneConfig(n.id).id||""),n.$container=t,!t){e.next=11;break}return n.canvas=ka("canvas","",t),n.setCanvas(),e.next=7,n.rendererService.init(n.canvas,n.configService.getSceneConfig(n.id));case 7:W_(n.$container,n.handleWindowResized),window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)").addListener(n.handleWindowResized),e.next=12;break;case 11:console.error(" id ");case 12:n.pickingService.init(n.id);case 13:case"end":return e.stop()}}),e)})))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(e){this.layerService.add(e),this.render()}},{key:"render",value:(n=hr(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rendering&&!this.destroyed){e.next=2;break}return e.abrupt("return");case 2:if(this.rendering=!0,this.inited){e.next=15;break}return e.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!this.loadFont||!document.fonts){e.next=10;break}return e.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.renderLayers(),this.rendering=!1;case 17:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"addFontFace",value:function(e,t){this.fontFamily=e;var n=document.createElement("style");n.type="text/css",n.innerText="\n        @font-face{\n            font-family: '".concat(e,"';\n            src: url('").concat(t,"') format('woff2'),\n            url('").concat(t,"') format('woff'),\n            url('").concat(t,"') format('truetype');\n        }"),document.getElementsByTagName("head")[0].appendChild(n),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(e){var t,n=null===(t=this.$container)||void 0===t?void 0:t.getElementsByTagName("canvas")[0];return this.render(),"jpg"===e?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var e=this.$container.parentElement;null!==e&&(this.markerContainer=ka("div","l7-marker-container",e))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){this.inited?(this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.removeAllListeners(),this.inited=!1,Z_(this.$container,this.handleWindowResized),window.matchMedia("screen and (min-resolution: 2dppx)").removeListener(this.handleWindowResized)):this.destroyed=!0}},{key:"initContainer",value:function(){var e,t,n=Ba,r=(null===(e=this.$container)||void 0===e?void 0:e.clientWidth)||400,i=(null===(t=this.$container)||void 0===t?void 0:t.clientHeight)||300,o=this.canvas;o&&(o.width=r*n,o.height=i*n,o.style.width="".concat(r,"px"),o.style.height="".concat(i,"px")),this.rendererService.viewport({x:0,y:0,width:n*r,height:n*i})}},{key:"setCanvas",value:function(){var e,t,n=Ba,r=(null===(e=this.$container)||void 0===e?void 0:e.clientWidth)||400,i=(null===(t=this.$container)||void 0===t?void 0:t.clientHeight)||300,o=this.canvas;o.width=r*n,o.height=i*n,o.style.width="".concat(r,"px"),o.style.height="".concat(i,"px")}},{key:"addSceneEvent",value:function(e){this.emit(e.type,e)}}]),i}(s)).prototype,"id",[q_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hx=Rr(lx.prototype,"iconService",[X_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dx=Rr(lx.prototype,"fontService",[K_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),px=Rr(lx.prototype,"controlService",[Q_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vx=Rr(lx.prototype,"configService",[J_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gx=Rr(lx.prototype,"map",[$_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mx=Rr(lx.prototype,"coordinateSystemService",[ex],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yx=Rr(lx.prototype,"rendererService",[tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bx=Rr(lx.prototype,"layerService",[nx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_x=Rr(lx.prototype,"cameraService",[rx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xx=Rr(lx.prototype,"interactionService",[ix],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sx=Rr(lx.prototype,"pickingService",[ox],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wx=Rr(lx.prototype,"shaderModuleService",[ax],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ax=Rr(lx.prototype,"markerService",[sx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tx=Rr(lx.prototype,"popupService",[ux],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cx=lx))||cx);var kx=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var Ox=function(e){return this.__data__.has(e)};function Ix(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Pm;++t<n;)this.add(e[t])}Ix.prototype.add=Ix.prototype.push=kx,Ix.prototype.has=Ox;var Px=Ix;var Lx=function(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1};var Rx=function(e){return e!=e};var Nx=function(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1};var Dx=function(e,t,n){return t==t?Nx(e,t,n):Lx(e,Rx,n)};var Fx=function(e,t){return!!(null==e?0:e.length)&&Dx(e,t,0)>-1};var zx=function(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1};var jx=function(e,t){return e.has(t)},Ux=hm(Ug,"Set");var Bx=function(){};var Vx=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n},Hx=Ux&&1/Vx(new Ux([,-0]))[1]==1/0?function(e){return new Ux(e)}:Bx;var Gx=function(e,t,n){var r=-1,i=Fx,o=e.length,a=!0,s=[],u=s;if(n)a=!1,i=zx;else if(o>=200){var c=t?null:Hx(e);if(c)return Vx(c);a=!1,i=jx,u=new Px}else u=t?[]:s;e:for(;++r<o;){var l=e[r],f=t?t(l):l;if(l=n||0!==l?l:0,a&&f==f){for(var h=u.length;h--;)if(u[h]===f)continue e;t&&u.push(f),s.push(l)}else i(u,f,n)||(u!==s&&u.push(f),s.push(l))}return s};var Wx=function(e){return e&&e.length?Gx(e):[]};Lt({target:"Array",proto:!0},{fill:Ec}),Yr("fill");var Zx=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Yx(e){var t={};return{content:e=e.replace(Zx,(function(e,n,r){var i=r.split(":"),o=i[0].trim(),a="";switch(i.length>1&&(a=i[1].trim()),n){case"bool":a="true"===a;break;case"float":case"int":a=Number(a);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":a=a?a.replace("[","").replace("]","").split(",").reduce((function(e,t){return e.push(Number(t.trim())),e}),[]):new Array(function(e){var t=0;switch(e){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16}return t}(n)).fill(0)}return t[o]=a,"uniform ".concat(n," ").concat(o,";\n")})),uniforms:t}}var qx,Xx,Kx,Qx,Jx,$x,eS,tS="#define PI 3.14159265359",nS=/precision\s+(high|low|medium)p\s+float/,rS=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,iS=$()(qx=function(){function e(){dr(this,e),gr(this,"moduleCache",{}),gr(this,"rawContentCache",{})}return vr(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:tS,fs:tS}),this.registerModule("decode",{vs:"#define SHIFT_RIGHT17 1.0 / 131072.0\n#define SHIFT_RIGHT18 1.0 / 262144.0\n#define SHIFT_RIGHT19 1.0 / 524288.0\n#define SHIFT_RIGHT20 1.0 / 1048576.0\n#define SHIFT_RIGHT21 1.0 / 2097152.0\n#define SHIFT_RIGHT22 1.0 / 4194304.0\n#define SHIFT_RIGHT23 1.0 / 8388608.0\n#define SHIFT_RIGHT24 1.0 / 16777216.0\n#define SHIFT_LEFT17 131072.0\n#define SHIFT_LEFT18 262144.0\n#define SHIFT_LEFT19 524288.0\n#define SHIFT_LEFT20 1048576.0\n#define SHIFT_LEFT21 2097152.0\n#define SHIFT_LEFT22 4194304.0\n#define SHIFT_LEFT23 8388608.0\n#define SHIFT_LEFT24 16777216.0\nvec2 unpack_float(float packedValue) {\nint packedIntValue = int(packedValue);\nint v0 = packedIntValue / 256;\nreturn vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(vec2 encodedColor) {\nreturn vec4(\nunpack_float(encodedColor[0]) / 255.0,\nunpack_float(encodedColor[1]) / 255.0\n);\n}",fs:""}),this.registerModule("projection",{vs:"#define TILE_SIZE 512.0\n#define PI 3.1415926536\n#define WORLD_SCALE TILE_SIZE / (PI * 2.0)\n#define COORDINATE_SYSTEM_LNGLAT 1.0\n#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0\n#define COORDINATE_SYSTEM_VECTOR_TILE 3.0\n#define COORDINATE_SYSTEM_IDENTITY 4.0\n#define COORDINATE_SYSTEM_P20 5.0\n#define COORDINATE_SYSTEM_P20_OFFSET 6.0\n#define COORDINATE_SYSTEM_METER_OFFSET 7.0\n#define COORDINATE_SYSTEM_P20_2 8.0\nuniform mat4 u_ViewMatrix;\nuniform mat4 u_ProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrix;\nuniform float u_Zoom : 1;\nuniform float u_ZoomScale : 1;\nuniform float u_CoordinateSystem;\nuniform vec2 u_ViewportCenter;\nuniform vec4 u_ViewportCenterProjection;\nuniform vec3 u_PixelsPerDegree;\nuniform vec3 u_PixelsPerDegree2;\nuniform vec3 u_PixelsPerMeter;\nuniform vec2 u_ViewportSize;\nuniform float u_DevicePixelRatio;\nuniform float u_FocalDistance;\nuniform vec3 u_CameraPosition;\nvec2 project_mercator(vec2 lnglat) {\nfloat x = lnglat.x;\nreturn vec2(\nradians(x) + PI,\nPI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))\n);\n}\nfloat project_scale(float meters) {\nreturn meters * u_PixelsPerMeter.z;\n}\nvec4 project_offset(vec4 offset) {\nfloat dy = offset.y;\ndy = clamp(dy, -1., 1.);\nvec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;\nreturn vec4(offset.xyz * pixels_per_unit, offset.w);\n}\nvec3 project_normal(vec3 normal) {\nvec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);\nreturn normalize(normal_modelspace.xyz * u_PixelsPerMeter);\n}\nvec3 project_offset_normal(vec3 vector) {\nif (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01\n|| u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nreturn normalize(vector * u_PixelsPerDegree);\n}\nreturn project_normal(vector);\n}\nvec3 reverse_offset_normal(vec3 vector) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {\nreturn vector * vec3(1.0, -1.0, 1.0);\n}\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn vector;\n}\nreturn vector;\n}\nvec4 project_position(vec4 position) {\nfloat a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\nfloat b = COORDINATE_SYSTEM_P20_OFFSET;\nfloat c = COORDINATE_SYSTEM_LNGLAT;\nif (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n|| u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nfloat X = position.x - u_ViewportCenter.x;\nfloat Y = position.y - u_ViewportCenter.y;\nreturn project_offset(vec4(X, Y, position.z, position.w));\n}\nif (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\nreturn vec4(\nproject_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\nproject_scale(position.z),\nposition.w\n);\n}\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\nreturn vec4(\n(project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),\nproject_scale(position.z),\nposition.w\n);\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn vec4(\nposition.xy, \nproject_scale(position.z), \nposition.w);\n}\nreturn position;\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\nvec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;\nreturn offset * u_FocalDistance;\n}\nfloat project_pixel_allmap(float pixel) {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn pixel * pow(2.0, u_Zoom);\n}\nreturn pixel;\n}\nfloat project_pixel(float pixel) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nreturn pixel * pow(2.0, (19.0 - u_Zoom));\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n}\nreturn pixel;\n}\nvec2 project_pixel(vec2 pixel) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nreturn pixel * pow(2.0, (19.0 - u_Zoom));\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n}\nreturn pixel * -1.;\n}\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\nu_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nposition.w *= u_PixelsPerMeter.z;\n}\nreturn viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\nreturn project_common_position_to_clipspace(\nposition,\nu_ViewProjectionMatrix,\nu_ViewportCenterProjection\n);\n}\nvec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {\nvec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);\nif (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\nu_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\npos.w = pos.w / u_PixelsPerMeter.z;\n}\nreturn pos;\n}\nbool isEqual( float a,  float b) {\nreturn  a< b + 0.001 && a > b - 0.001;\n}",fs:""}),this.registerModule("project",{vs:"#define E 2.718281828459045\nvec2 ProjectFlat(vec2 lnglat){\nfloat maxs=85.0511287798;\nfloat lat=max(min(maxs,lnglat.y),-maxs);\nfloat scale= 268435456.;\nfloat d=PI/180.;\nfloat x=lnglat.x*d;\nfloat y=lat*d;\ny=log(tan((PI/4.)+(y/2.)));\nfloat a=.5/PI,\nb=.5,\nc=-.5/PI;\nd=.5;\nx=scale*(a*x+b);\ny=scale*(c*y+d);\nreturn vec2(x,y);\n}\nvec2 unProjectFlat(vec2 px){\nfloat a=.5/PI;\nfloat b=.5;\nfloat c=-.5/PI;\nfloat d=.5;\nfloat scale = 268435456.;\nfloat x=(px.x/scale-b)/a;\nfloat y=(px.y/scale-d)/c;\ny=(atan(pow(E,y))-(PI/4.))*2.;\nd=PI/180.;\nfloat lat=y/d;\nfloat lng=x/d;\nreturn vec2(lng,lat);\n}\nfloat pixelDistance(vec2 from, vec2 to) {\nvec2 a1 = ProjectFlat(from);\nvec2 b1 = ProjectFlat(to);\nreturn distance(a1, b1);\n}\nvec2 customProject(vec2 lnglat) {\nfloat t = lnglat.x;\nfloat e = lnglat.y;\nfloat Sm = 180.0 / PI;\nfloat Tm = 6378137.0;\nfloat Rm = PI / 180.0;\nfloat r = 85.0511287798;\ne = max(min(r, e), -r);\nt *= Rm;\ne *= Rm;\ne = log(tan(PI / 4.0 + e / 2.0));\nreturn vec2(t * Tm, e * Tm);\n}\nvec2 unProjCustomCoord(vec2 point) {\nfloat Sm = 57.29577951308232;\nfloat Tm = 6378137.0;\nfloat t = point.x;\nfloat e = point.y;\nreturn vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);\n}\nfloat customPixelDistance(vec2 from, vec2 to) {\nvec2 a1 = ProjectFlat(from);\nvec2 b1 = ProjectFlat(to);\nreturn distance(a1, b1);\n}",fs:""}),this.registerModule("sdf_2d",{vs:"",fs:"\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\nfloat sdCircle(vec2 p, float r) {\nreturn length(p) - r;\n}\nfloat sdEquilateralTriangle(vec2 p) {\nfloat k = sqrt(3.0);\np.x = abs(p.x) - 1.0;\np.y = p.y + 1.0/k;\nif( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\np.x -= clamp( p.x, -2.0, 0.0 );\nreturn -length(p)*sign(p.y);\n}\nfloat sdBox(vec2 p, vec2 b) {\nvec2 d = abs(p)-b;\nreturn length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\nfloat sdPentagon(vec2 p, float r) {\nvec3 k = vec3(0.809016994,0.587785252,0.726542528);\np.x = abs(p.x);\np -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\np -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\np -= vec2(clamp(p.x,-r*k.z,r*k.z),r);\nreturn length(p)*sign(p.y);\n}\nfloat sdHexagon(vec2 p, float r) {\nvec3 k = vec3(-0.866025404,0.5,0.577350269);\np = abs(p);\np -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\np -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\nreturn length(p)*sign(p.y);\n}\nfloat sdOctogon(vec2 p, float r) {\nvec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\np = abs(p);\np -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\np -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\np -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\nreturn length(p)*sign(p.y);\n}\nfloat sdHexagram(vec2 p, float r) {\nvec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\np = abs(p);\np -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\np -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\np -= vec2(clamp(p.x,r*k.z,r*k.w),r);\nreturn length(p)*sign(p.y);\n}\nfloat sdRhombus(vec2 p, vec2 b) {\nvec2 q = abs(p);\nfloat h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\nfloat d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\nreturn d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\nfloat sdVesica(vec2 p, float r, float d) {\np = abs(p);\nfloat b = sqrt(r*r-d*d);\nreturn ((p.y-b)*d>p.x*b)\n? length(p-vec2(0.0,b))\n: length(p-vec2(-d,0.0))-r;\n}"}),this.registerModule("lighting",{vs:"\nuniform float u_Ambient : 1.0;\nuniform float u_Diffuse : 1.0;\nuniform float u_Specular : 1.0;\nuniform int u_NumOfDirectionalLights : 1;\nuniform int u_NumOfSpotLights : 0;\n#define SHININESS 32.0\n#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3\n#define MAX_NUM_OF_SPOT_LIGHTS 3\nstruct DirectionalLight {\nvec3 direction;\nvec3 ambient;\nvec3 diffuse;\nvec3 specular;\n};\nstruct SpotLight {\nvec3 position;\nvec3 direction;\nvec3 ambient;\nvec3 diffuse;\nvec3 specular;\nfloat constant;\nfloat linear;\nfloat quadratic;\nfloat angle;\nfloat blur;\nfloat exponent;\n};\nuniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];\nuniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];\nvec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {\nvec3 lightDir = normalize(light.direction);\nfloat diff = max(dot(normal, lightDir), 0.0);\nvec3 halfwayDir = normalize(lightDir + viewDir);\nfloat spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);\nvec3 ambient = light.ambient * u_Ambient;\nvec3 diffuse = light.diffuse * diff * u_Diffuse;\nvec3 specular = light.specular * spec * u_Specular;\nreturn ambient + diffuse + specular;\n}\nvec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {\nvec3 weight = vec3(0.0);\nfor (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {\nif (i >= u_NumOfDirectionalLights) {\nbreak;\n}\nweight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);\n}\nreturn weight;\n}",fs:""}),this.registerModule("light",{vs:"#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nfloat calc_lighting(vec4 pos) {\nvec3 worldPos = vec3(pos * u_ModelMatrix);\nvec3 worldNormal = a_Normal;\nvec3 viewDir = normalize(u_CameraPosition - worldPos);\nvec3 lightDir = normalize(vec3(1, -10.5, 12));\nvec3 halfDir = normalize(viewDir+lightDir);\nfloat lambert = dot(worldNormal, lightDir);\nfloat specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\nfloat lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;\nreturn lightWeight;\n}",fs:""}),this.registerModule("picking",{vs:"attribute vec3 a_PickingColor;\nvarying vec4 v_PickingResult;\nuniform vec3 u_PickingColor : [0, 0, 0];\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_PickingThreshold : 1.0;\nuniform float u_PickingBuffer: 0.0;\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\nbool isVertexPicked(vec3 vertexColor) {\nreturn\nabs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&\nabs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&\nabs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;\n}\nvoid setPickingColor(vec3 pickingColor) {\nv_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));\nv_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\nfloat setPickingSize(float x) {\nreturn u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;\n}\nfloat setPickingOrder(float z) {\nbool selected = bool(v_PickingResult.a);\nreturn selected ? z + 1. : 0.;\n}",fs:"varying vec4 v_PickingResult;\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\nvec4 filterHighlightColor(vec4 color) {\nbool selected = bool(v_PickingResult.a);\nif (selected) {\nvec4 highLightColor = u_HighlightColor * COLOR_SCALE;\nfloat highLightAlpha = highLightColor.a;\nfloat highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));\nvec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\nreturn vec4(resultRGB, color.a);\n} else {\nreturn color;\n}\n}\nvec4 filterPickingColor(vec4 color) {\nvec3 pickingColor = v_PickingResult.rgb;\nif (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {\ndiscard;\n}\nreturn u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;\n}\nvec4 filterColor(vec4 color) {\nreturn filterPickingColor(filterHighlightColor(color));\n}"}),this.registerModule("styleMapping",{vs:"attribute float a_vertexId;\nuniform mat4 u_cellTypeLayout;\nuniform sampler2D u_dataTexture;\nbool hasOpacity() {\nreturn u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\nbool hasStrokeOpacity() {\nreturn u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\nbool hasStrokeWidth() {\nreturn u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\nbool hasStroke() {\nreturn u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\nbool hasOffsets() {\nreturn u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\nfloat pos2value(vec2 pos, float columnWidth, float rowHeight) {\nfloat u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;\nfloat v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);\nreturn texture2D(u_dataTexture, vec2(u, v)).r;\n}\nvec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {\nfloat nextColumn = currentColumn;\nfloat nextRow = currentRow;\nif(currentColumn + nextStep <= columnCount){\nnextColumn = currentColumn + nextStep;\n} else {\nnextColumn = mod(currentColumn + nextStep, columnCount);\nnextRow = currentRow + 1.0;\n}\nreturn vec2(nextColumn, nextRow);\n}\nfloat calCellCount() {\nreturn  u_cellTypeLayout[1][0] +\nu_cellTypeLayout[1][1] +\nu_cellTypeLayout[1][2] +\nu_cellTypeLayout[1][3] * 4.0 +\nu_cellTypeLayout[2][0] * 2.0;\n}",fs:""}),this.registerModule("styleMappingCalOpacity",{vs:"\nvec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\nif(!hasOpacity()) {\nreturn vec2(u_opacity, textureOffset);\n} else {\nvec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nfloat textureOpacity = pos2value(valuePos, columnWidth, rowHeight);\nreturn vec2(textureOpacity, textureOffset + 1.0);\n}\n}",fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:"\nvec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\nif(!hasStrokeOpacity()) {\nreturn vec2(u_stroke_opacity, textureOffset);\n} else {\nvec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nfloat textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);\nreturn vec2(textureStrokeOpacity, textureOffset + 1.0);\n}\n}",fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:"\nvec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\nif(!hasStrokeWidth()) {\nreturn vec2(u_stroke_width, textureOffset);\n} else {\nvec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nfloat textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);\nreturn vec2(textureStrokeWidth, textureOffset + 1.0);\n}\n}",fs:""})}},{key:"registerModule",value:function(e,t){if(!this.rawContentCache[e]){var n=t.vs,r=t.fs,i=t.uniforms,o=Yx(n),a=o.content,s=o.uniforms,u=Yx(r),c=u.content,l=u.uniforms;this.rawContentCache[e]={fs:c,uniforms:cr(cr(cr({},s),l),i),vs:a}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(e){var t=this;if(this.moduleCache[e])return this.moduleCache[e];var n=this.rawContentCache[e].vs,r=this.rawContentCache[e].fs,i=this.processModule(n,[],"vs"),o=i.content,a=i.includeList,s=this.processModule(r,[],"fs"),u=s.content,c=s.includeList,l=u,f=Wx(a.concat(c).concat(e)).reduce((function(e,n){return cr(cr({},e),t.rawContentCache[n].uniforms)}),{});return nS.test(u)||(l="#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif\n"+u),this.moduleCache[e]={fs:l.trim(),uniforms:f,vs:o.trim()},this.moduleCache[e]}},{key:"processModule",value:function(e,t,n){var r=this;return{content:e.replace(rS,(function(e,i){var o=i.split(" ")[0].replace(/"/g,"");if(t.indexOf(o)>-1)return"";var a=r.rawContentCache[o][n];return t.push(o),r.processModule(a,t,n).content})),includeList:t}}}]),e}())||qx;(Xx=e.PassType||(e.PassType={})).Normal="normal",Xx.PostProcessing="post-processing";var oS,aS,sS,uS,cS,lS,fS,hS=(Kx=$(),Qx=J(sr.IShaderModuleService),Kx((eS=Rr(($x=function(){function t(){dr(this,t),Lr(this,"shaderModuleService",eS,this),gr(this,"rendererService",void 0),gr(this,"cameraService",void 0),gr(this,"mapService",void 0),gr(this,"interactionService",void 0),gr(this,"layerService",void 0),gr(this,"config",void 0)}return vr(t,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return e.PassType.Normal}},{key:"init",value:function(e,t){this.config=t,this.rendererService=e.getContainer().get(sr.IRendererService),this.cameraService=e.getContainer().get(sr.ICameraService),this.mapService=e.getContainer().get(sr.IMapService),this.interactionService=e.getContainer().get(sr.IInteractionService),this.layerService=e.getContainer().get(sr.ILayerService)}},{key:"render",value:function(e){}}]),t}()).prototype,"shaderModuleService",[Qx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jx=$x))||Jx),dS=$()(oS=function(e){mr(n,e);var t=Er(n);function n(){return dr(this,n),t.apply(this,arguments)}return vr(n,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(e,t){Cr(yr(n.prototype),"init",this).call(this,e,t)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),n}(hS))||oS,pS=(aS=$(),sS=J(sr.IPostProcessor),aS((lS=Rr((cS=function(){function t(){dr(this,t),gr(this,"passes",[]),Lr(this,"postProcessor",lS,this),gr(this,"layer",void 0),gr(this,"renderFlag",void 0),gr(this,"width",0),gr(this,"height",0)}var n;return vr(t,[{key:"setLayer",value:function(e){this.layer=e}},{key:"setRenderFlag",value:function(e){this.renderFlag=e}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:(n=hr(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Pr(this.passes),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,r.render(this.layer);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:this.layer.renderModels();case 18:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))),function(){return n.apply(this,arguments)})},{key:"resize",value:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t)}},{key:"add",value:function(t,n){t.getType()===e.PassType.PostProcessing?this.postProcessor.add(t,this.layer,n):(t.init(this.layer,n),this.passes.push(t))}},{key:"insert",value:function(e,t,n){e.init(this.layer,t),this.passes.splice(n,0,e)}},{key:"destroy",value:function(){this.passes.length=0}}]),t}()).prototype,"postProcessor",[sS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uS=cS))||uS),vS=$()(fS=function(t){mr(r,t);var n=Er(r);function r(){var e;dr(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return gr(Ar(e=n.call.apply(n,[this].concat(i))),"pickingFBO",void 0),gr(Ar(e),"layer",void 0),gr(Ar(e),"width",0),gr(Ar(e),"height",0),gr(Ar(e),"alreadyInRendering",!1),gr(Ar(e),"pickFromPickingFBO",(function(t){var n=t.x,r=t.y,i=t.lngLat,o=t.type;if(e.layer.isVisible()&&e.layer.needPick(o)){var a,s=e.rendererService,u=s.getViewportSize,c=s.readPixels,l=s.useFramebuffer,f=u(),h=f.width,d=f.height,p=e.layer.getLayerConfig(),v=p.enableHighlight,g=p.enableSelect,m=n*Ba,y=r*Ba;if(!(m>h||m<0||y>d||y<0))l(e.pickingFBO,(function(){var t;if(0!==(a=c({x:Math.round(m),y:Math.round(d-(r+1)*Ba),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO}))[0]||0!==a[1]||0!==a[2]){var s=ad(a),u=e.layer.getSource().getFeatureById(s),l={x:n,y:r,type:o,lngLat:i,featureId:s,feature:u};u&&(e.layer.setCurrentPickId(s),e.triggerHoverOnLayer(l))}else{var f={x:n,y:r,lngLat:i,type:null===e.layer.getCurrentPickId()?"un"+o:"mouseout",featureId:null,feature:null};e.triggerHoverOnLayer(cr(cr({},f),{},{type:"unpick"})),e.triggerHoverOnLayer(f),e.layer.setCurrentPickId(null)}v&&e.highlightPickedFeature(a),g&&"click"===o&&(null===(t=a)||void 0===t?void 0:t.toString())!==[0,0,0,0].toString()&&e.selectFeature(a)}))}})),e}return vr(r,[{key:"getType",value:function(){return e.PassType.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(t,n){Cr(yr(r.prototype),"init",this).call(this,t,n),this.layer=t;var i=this.rendererService,o=i.createTexture2D,a=i.createFramebuffer,s=(0,i.getViewportSize)(),u=s.width,c=s.height;this.pickingFBO=a({color:o({width:u,height:c,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.interactionService.on(e.InteractionEvent.Hover,this.pickFromPickingFBO),this.interactionService.on(e.InteractionEvent.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(e.InteractionEvent.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(e){var t=this;if(!this.alreadyInRendering){var n=this.rendererService,r=n.getViewportSize,i=n.useFramebuffer,o=n.clear,a=r(),s=a.width,u=a.height;this.alreadyInRendering=!0,this.width===s&&this.height===u||(this.pickingFBO.resize({width:s,height:u}),this.width=s,this.height=u),i(this.pickingFBO,(function(){o({framebuffer:t.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var n=t.layer.multiPassRenderer.getRenderFlag();t.layer.multiPassRenderer.setRenderFlag(!1),e.hooks.beforePickingEncode.call(),e.render(),e.hooks.afterPickingEncode.call(),t.layer.multiPassRenderer.setRenderFlag(n),t.alreadyInRendering=!1}))}}},{key:"triggerHoverOnLayer",value:function(e){this.layer.emit(e.type,e)}},{key:"highlightPickedFeature",value:function(e){var t=Mr(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeHighlight.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(e){var t=Mr(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeSelect.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(e){var t=sd(e.featureId);this.selectFeature(new Uint8Array(t))}},{key:"highlightFeatureHandle",value:function(e){var t=sd(e.featureId);this.highlightPickedFeature(new Uint8Array(t))}}]),r}(hS))||fS,gS="varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\nvec4 color = vec4(0.0);\nvec2 off1 = vec2(1.3846153846) * direction;\nvec2 off2 = vec2(3.2307692308) * direction;\ncolor += texture2D(image, uv) * 0.2270270270;\ncolor += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\ncolor += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\ncolor += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\ncolor += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\nreturn color;\n}\nvoid main() {\ngl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}",mS="attribute vec2 a_Position;\nvarying vec2 v_UV;\nvoid main() {\nv_UV = 0.5 * (a_Position + 1.0);\ngl_Position = vec4(a_Position, 0., 1.);\n}";var yS=function(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var o=Array(i);++r<i;)o[r]=e[r+t];return o};var bS=function(e,t,n){var r=e.length;return n=void 0===n?r:n,!t&&n>=r?e:yS(e,t,n)},_S=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var xS=function(e){return _S.test(e)};var SS=function(e){return e.split("")},wS="[\\ud800-\\udfff]",AS="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",TS="\\ud83c[\\udffb-\\udfff]",ES="[^\\ud800-\\udfff]",CS="(?:\\ud83c[\\udde6-\\uddff]){2}",MS="[\\ud800-\\udbff][\\udc00-\\udfff]",kS="(?:"+AS+"|"+TS+")"+"?",OS="[\\ufe0e\\ufe0f]?"+kS+("(?:\\u200d(?:"+[ES,CS,MS].join("|")+")[\\ufe0e\\ufe0f]?"+kS+")*"),IS="(?:"+[ES+AS+"?",AS,CS,MS,wS].join("|")+")",PS=RegExp(TS+"(?="+TS+")|"+IS+OS,"g");var LS=function(e){return e.match(PS)||[]};var RS=function(e){return xS(e)?LS(e):SS(e)};var NS=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i};var DS=function(e){return"symbol"==typeof e||Jm(e)&&"[object Symbol]"==Kg(e)},FS=Bg?Bg.prototype:void 0,zS=FS?FS.toString:void 0;var jS=function e(t){if("string"==typeof t)return t;if(iy(t))return NS(t,e)+"";if(DS(t))return zS?zS.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};var US=function(e){return null==e?"":jS(e)};var BS=function(e){return function(t){t=US(t);var n=xS(t)?RS(t):void 0,r=n?n[0]:t.charAt(0),i=n?bS(n,1).join(""):t.slice(1);return r[e]()+i}}("toUpperCase");var VS=function(e){return BS(US(e).toLowerCase())};var HS=function(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n};var GS=function(e){return function(t){return null==e?void 0:e[t]}}({"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"s"}),WS=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ZS=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");var YS=function(e){return(e=US(e))&&e.replace(WS,GS).replace(ZS,"")},qS=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var XS=function(e){return e.match(qS)||[]},KS=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var QS=function(e){return KS.test(e)},JS="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",$S="["+JS+"]",ew="\\d+",tw="[\\u2700-\\u27bf]",nw="[a-z\\xdf-\\xf6\\xf8-\\xff]",rw="[^\\ud800-\\udfff"+JS+ew+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",iw="(?:\\ud83c[\\udde6-\\uddff]){2}",ow="[\\ud800-\\udbff][\\udc00-\\udfff]",aw="[A-Z\\xc0-\\xd6\\xd8-\\xde]",sw="(?:"+nw+"|"+rw+")",uw="(?:"+aw+"|"+rw+")",cw="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",lw="[\\ufe0e\\ufe0f]?"+cw+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",iw,ow].join("|")+")[\\ufe0e\\ufe0f]?"+cw+")*"),fw="(?:"+[tw,iw,ow].join("|")+")"+lw,hw=RegExp([aw+"?"+nw+"+(?:['](?:d|ll|m|re|s|t|ve))?(?="+[$S,aw,"$"].join("|")+")",uw+"+(?:['](?:D|LL|M|RE|S|T|VE))?(?="+[$S,aw+sw,"$"].join("|")+")",aw+"?"+sw+"+(?:['](?:d|ll|m|re|s|t|ve))?",aw+"+(?:['](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ew,fw].join("|"),"g");var dw=function(e){return e.match(hw)||[]};var pw=function(e,t,n){return e=US(e),void 0===(t=n?void 0:t)?QS(e)?dw(e):XS(e):e.match(t)||[]},vw=RegExp("[']","g");var gw,mw,yw,bw,_w,xw,Sw,ww,Aw,Tw,Ew,Cw,Mw,kw,Ow,Iw,Pw,Lw,Rw,Nw=function(e){return function(t){return HS(pw(YS(t).replace(vw,"")),e,"")}}((function(e,t,n){return t=t.toLowerCase(),e+(n?VS(t):t)})),Dw=(gw=$(),mw=J(sr.IShaderModuleService),gw((_w=Rr((bw=function(){function t(){dr(this,t),Lr(this,"shaderModuleService",_w,this),gr(this,"rendererService",void 0),gr(this,"config",void 0),gr(this,"quad",mS),gr(this,"enabled",!0),gr(this,"renderToScreen",!1),gr(this,"model",void 0),gr(this,"name",void 0),gr(this,"optionsToUpdate",{})}return vr(t,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(e){this.name=e}},{key:"getType",value:function(){return e.PassType.PostProcessing}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(sr.IRendererService);var r=this.rendererService,i=r.createAttribute,o=r.createBuffer,a=r.createModel,s=this.setupShaders(),u=s.vs,c=s.fs,l=s.uniforms;this.model=a({vs:u,fs:c,attributes:{a_Position:i({buffer:o({data:[-4,-4,4,-4,0,4],type:e.gl.FLOAT}),size:2})},uniforms:cr(cr({u_Texture:null},l),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:"copy"===this.getName()}})}},{key:"render",value:function(e){var t=this,n=e.multiPassRenderer.getPostProcessor(),r=this.rendererService,i=r.useFramebuffer,o=r.getViewportSize,a=r.clear,s=o(),u=s.width,c=s.height;i(this.renderToScreen?null:n.getWriteFBO(),(function(){a({framebuffer:n.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),t.model.draw({uniforms:cr({u_Texture:n.getReadFBO(),u_ViewportSize:[u,c]},t.convertOptionsToUniforms(t.optionsToUpdate))})}))}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(e){this.enabled=e}},{key:"setRenderToScreen",value:function(e){this.renderToScreen=e}},{key:"updateOptions",value:function(e){this.optionsToUpdate=cr(cr({},this.optionsToUpdate),e)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(e){var t={};return Object.keys(e).forEach((function(n){r_(e[n])||(t["u_".concat(BS(Nw(n)))]=e[n])})),t}}]),t}()).prototype,"shaderModuleService",[mw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yw=bw))||yw),Fw=$()(xw=function(e){mr(n,e);var t=Er(n);function n(){return dr(this,n),t.apply(this,arguments)}return vr(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:mS,fs:gS});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:cr(cr({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return r_(e.blurRadius)||(t.u_BlurDir=[e.blurRadius,0]),t}}]),n}(Dw))||xw,zw=$()(Sw=function(e){mr(n,e);var t=Er(n);function n(){return dr(this,n),t.apply(this,arguments)}return vr(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:mS,fs:gS});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:cr(cr({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return r_(e.blurRadius)||(t.u_BlurDir=[0,e.blurRadius]),t}}]),n}(Dw))||Sw,jw=$()(ww=function(e){mr(n,e);var t=Er(n);function n(){return dr(this,n),t.apply(this,arguments)}return vr(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:mS,fs:'varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Angle : 0;\nuniform float u_Size : 8;\n#pragma include "common"\nfloat scale = PI / u_Size;\nfloat pattern(float u_Angle, vec2 texSize, vec2 texCoord) {\nfloat s = sin(u_Angle), c = cos(u_Angle);\nvec2 tex = texCoord * texSize - u_Center * texSize;\nvec2 point = vec2(\nc * tex.x - s * tex.y,\ns * tex.x + c * tex.y\n) * scale;\nreturn (sin(point.x) * sin(point.y)) * 4.0;\n}\nvec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\nvec3 cmy = 1.0 - color.rgb;\nfloat k = min(cmy.x, min(cmy.y, cmy.z));\ncmy = (cmy - k) / (1.0 - k);\ncmy = clamp(\ncmy * 10.0 - 3.0 + vec3(\npattern(u_Angle + 0.26179, texSize, texCoord),\npattern(u_Angle + 1.30899, texSize, texCoord),\npattern(u_Angle, texSize, texCoord)\n),\n0.0,\n1.0\n);\nk = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);\nreturn vec4(1.0 - cmy - k, color.a);\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);\n}'});var e=this.shaderModuleService.getModule("colorhalftone-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:cr(cr({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(Dw))||ww,Uw="varying vec2 v_UV;\nuniform sampler2D u_Texture;\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}",Bw=$()(Aw=function(e){mr(n,e);var t=Er(n);function n(){return dr(this,n),t.apply(this,arguments)}return vr(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:mS,fs:Uw}),this.shaderModuleService.getModule("copy-pass")}}]),n}(Dw))||Aw,Vw=$()(Tw=function(e){mr(n,e);var t=Er(n);function n(){return dr(this,n),t.apply(this,arguments)}return vr(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:mS,fs:"varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Scale : 10;\nvec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\nvec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;\ntex.y /= 0.866025404;\ntex.x -= tex.y * 0.5;\nvec2 a;\nif (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\na = vec2(floor(tex.x), floor(tex.y));\n}\nelse a = vec2(ceil(tex.x), ceil(tex.y));\nvec2 b = vec2(ceil(tex.x), floor(tex.y));\nvec2 c = vec2(floor(tex.x), ceil(tex.y));\nvec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\nvec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\nvec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\nvec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\nfloat alen = length(TEX - A);\nfloat blen = length(TEX - B);\nfloat clen = length(TEX - C);\nvec2 choice;\nif (alen < blen) {\nif (alen < clen) choice = a;\nelse choice = c;\n} else {\nif (blen < clen) choice = b;\nelse choice = c;\n}\nchoice.x += choice.y * 0.5;\nchoice.y *= 0.866025404;\nchoice *= u_Scale / texSize;\nreturn texture2D(texture, choice + u_Center);\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var e=this.shaderModuleService.getModule("hexagonalpixelate-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:cr(cr({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(Dw))||Tw,Hw=$()(Ew=function(e){mr(n,e);var t=Er(n);function n(){return dr(this,n),t.apply(this,arguments)}return vr(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:mS,fs:"varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_Strength : 0.6;\nvec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\nvec2 dx = vec2(1.0 / texSize.x, 0.0);\nvec2 dy = vec2(0.0, 1.0 / texSize.y);\nvec4 color = texture2D(texture, texCoord);\nfloat bigTotal = 0.0;\nfloat smallTotal = 0.0;\nvec3 bigAverage = vec3(0.0);\nvec3 smallAverage = vec3(0.0);\nfor (float x = -2.0; x <= 2.0; x += 1.0) {\nfor (float y = -2.0; y <= 2.0; y += 1.0) {\nvec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\nbigAverage += sample;\nbigTotal += 1.0;\nif (abs(x) + abs(y) < 2.0) {\nsmallAverage += sample;\nsmallTotal += 1.0;\n}\n}\n}\nvec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\nfloat power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;\nreturn vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var e=this.shaderModuleService.getModule("ink-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:cr(cr({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(Dw))||Ew,Gw=$()(Cw=function(e){mr(n,e);var t=Er(n);function n(){return dr(this,n),t.apply(this,arguments)}return vr(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:mS,fs:"varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform float u_Amount : 0.5;\nfloat rand(vec2 co) {\nreturn fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\nvec4 noise_filterColor(vec4 color, vec2 texCoord) {\nfloat diff = (rand(texCoord) - 0.5) * u_Amount;\ncolor.r += diff;\ncolor.g += diff;\ncolor.b += diff;\nreturn color;\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = noise_filterColor(gl_FragColor, v_UV);\n}"}),this.shaderModuleService.getModule("noise-pass")}}]),n}(Dw))||Cw,Ww=$()(Mw=function(e){mr(n,e);var t=Er(n);function n(){return dr(this,n),t.apply(this,arguments)}return vr(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:mS,fs:"varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform float u_Amount : 0.5;\nvec4 sepia_filterColor(vec4 color) {\nfloat r = color.r;\nfloat g = color.g;\nfloat b = color.b;\ncolor.r =\nmin(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));\ncolor.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));\ncolor.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));\nreturn color;\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = sepia_filterColor(gl_FragColor);\n}"}),this.shaderModuleService.getModule("sepia-pass")}}]),n}(Dw))||Mw,Zw=Ce.f,Yw=oe((function(){Zw(1)}));Lt({target:"Object",stat:!0,forced:!ae||Yw,sham:!ae},{getOwnPropertyDescriptor:function(e,t){return Zw(ge(e),t)}});var qw,Xw,Kw,Qw,Jw,$w,eA=(kw=$(),Ow=J(sr.IRendererService),Iw=Q(),kw((Rw=Rr((Lw=function(){function e(){dr(this,e),Lr(this,"rendererService",Rw,this),gr(this,"passes",[]),gr(this,"readFBO",void 0),gr(this,"writeFBO",void 0)}var t;return vr(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:(t=hr(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<this.passes.length)){e.next=10;break}return(r=this.passes[n]).setRenderToScreen(this.isLastEnabledPass(n)),e.next=6,r.render(t);case 6:n!==this.passes.length-1&&this.swap();case 7:n++,e.next=1;break;case 10:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resize",value:function(e,t){this.readFBO.resize({width:e,height:t}),this.writeFBO.resize({width:e,height:t})}},{key:"add",value:function(e,t,n){e.init(t,n),this.passes.push(e)}},{key:"insert",value:function(e,t,n,r){e.init(n,r),this.passes.splice(t,0,e)}},{key:"getPostProcessingPassByName",value:function(e){return this.passes.find((function(t){return t.getName()===e}))}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].isEnabled())return!1;return!0}},{key:"swap",value:function(){var e=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=e}}]),e}()).prototype,"rendererService",[Ow],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rr(Lw.prototype,"init",[Iw],Object.getOwnPropertyDescriptor(Lw.prototype,"init"),Lw.prototype),Pw=Lw))||Pw),tA=$()(qw=function(t){mr(r,t);var n=Er(r);function r(){return dr(this,r),n.apply(this,arguments)}return vr(r,[{key:"getType",value:function(){return e.PassType.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(e,t){Cr(yr(r.prototype),"init",this).call(this,e,t)}},{key:"render",value:function(e){var t=this.rendererService,n=t.useFramebuffer,r=t.clear;n(null,(function(){r({color:[0,0,0,0],depth:1,stencil:0}),e.multiPassRenderer.setRenderFlag(!1),e.render(),e.multiPassRenderer.setRenderFlag(!0)}))}}]),r}(hS))||qw;function nA(e,t){for(var n=0,r=1/t,i=e;i>0;)n+=r*(i%t),i=Math.floor(i/t),r/=t;return n}var rA=1,iA=(Xw=$(),Kw=J(sr.IShaderModuleService),Xw(($w=Rr((Jw=function(t){mr(r,t);var n=Er(r);function r(){var e;dr(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return Lr(Ar(e=n.call.apply(n,[this].concat(i))),"shaderModuleService",$w,Ar(e)),gr(Ar(e),"haltonSequence",[]),gr(Ar(e),"accumulatingId",0),gr(Ar(e),"frame",0),gr(Ar(e),"timer",void 0),gr(Ar(e),"sampleRenderTarget",void 0),gr(Ar(e),"prevRenderTarget",void 0),gr(Ar(e),"outputRenderTarget",void 0),gr(Ar(e),"copyRenderTarget",void 0),gr(Ar(e),"blendModel",void 0),gr(Ar(e),"outputModel",void 0),gr(Ar(e),"copyModel",void 0),e}return vr(r,[{key:"getType",value:function(){return e.PassType.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(t,n){Cr(yr(r.prototype),"init",this).call(this,t,n);var i=this.rendererService,o=i.createFramebuffer,a=i.createTexture2D;this.sampleRenderTarget=o({color:a({width:1,height:1,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.prevRenderTarget=o({color:a({width:1,height:1,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.outputRenderTarget=o({color:a({width:1,height:1,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.copyRenderTarget=o({color:a({width:1,height:1,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})});for(var s=0;s<30;s++)this.haltonSequence.push([nA(s,2),nA(s,3)]);this.blendModel=this.createTriangleModel("blend-pass","uniform float u_opacity : 1.0;\nuniform float u_MixRatio : 0.5;\nuniform sampler2D u_Diffuse1;\nuniform sampler2D u_Diffuse2;\nvarying vec2 v_UV;\nvoid main() {\nvec4 texel1 = texture2D(u_Diffuse1, v_UV);\nvec4 texel2 = texture2D(u_Diffuse2, v_UV);\ngl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);\n}"),this.outputModel=this.createTriangleModel("copy-pass",Uw,{blend:{enable:!0,func:{srcRGB:e.gl.ONE,dstRGB:e.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:e.gl.ONE,dstAlpha:e.gl.ONE_MINUS_SRC_ALPHA},equation:{rgb:e.gl.FUNC_ADD,alpha:e.gl.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",Uw)}},{key:"render",value:function(e){var t=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height;this.sampleRenderTarget.resize({width:s,height:u}),this.prevRenderTarget.resize({width:s,height:u}),this.outputRenderTarget.resize({width:s,height:u}),this.copyRenderTarget.resize({width:s,height:u}),this.resetFrame(),this.stopAccumulating();var c=e.multiPassRenderer.getPostProcessor().getReadFBO();o(c,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:c}),e.multiPassRenderer.setRenderFlag(!1),e.render(),e.multiPassRenderer.setRenderFlag(!0)}));this.accumulatingId=rA++,this.timer=window.setTimeout((function(){!function n(r){t.accumulatingId&&r===t.accumulatingId&&(t.isFinished()||(t.doRender(e),requestAnimationFrame((function(){n(r)}))))}(t.accumulatingId)}),50)}},{key:"doRender",value:function(e){var t=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height,c=e.getLayerConfig().jitterScale,l=void 0===c?1:c,f=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((2*f[0]-1)/s*l,(2*f[1]-1)/u*l),e.multiPassRenderer.setRenderFlag(!1),e.hooks.beforeRender.call(),o(this.sampleRenderTarget,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:t.sampleRenderTarget}),e.render()})),e.hooks.afterRender.call(),e.multiPassRenderer.setRenderFlag(!0);var h=e.getLayerConfig();o(this.outputRenderTarget,(function(){t.blendModel.draw({uniforms:{u_opacity:h.opacity||1,u_MixRatio:0===t.frame?1:.9,u_Diffuse1:t.sampleRenderTarget,u_Diffuse2:0===t.frame?e.multiPassRenderer.getPostProcessor().getReadFBO():t.prevRenderTarget}})})),0===this.frame&&r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(o(this.copyRenderTarget,(function(){t.outputModel.draw({uniforms:{u_Texture:t.outputRenderTarget}})})),o(e.multiPassRenderer.getPostProcessor().getReadFBO(),(function(){t.copyModel.draw({uniforms:{u_Texture:t.copyRenderTarget}})})),e.multiPassRenderer.getPostProcessor().render(e));var d=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=d,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(t,n,r){this.shaderModuleService.registerModule(t,{vs:mS,fs:n});var i=this.shaderModuleService.getModule(t),o=i.vs,a=i.fs,s=i.uniforms,u=this.rendererService,c=u.createAttribute,l=u.createBuffer;return(0,u.createModel)(cr({vs:o,fs:a,attributes:{a_Position:c({buffer:l({data:[-4,-4,4,-4,0,4],type:e.gl.FLOAT}),size:2})},uniforms:cr({},s),depth:{enable:!1},count:3},r))}}]),r}(hS)).prototype,"shaderModuleService",[Kw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qw=Jw))||Qw),oA=new ee;oA.bind(sr.IGlobalConfigService).to(eb).inSingletonScope(),oA.bind(sr.IShaderModuleService).to(iS).inSingletonScope(),K($(),s),oA.bind(sr.IEventEmitter).to(s);var aA=ne(oA,!1),sA=function(e){var t=aA.lazyInject(e);return function(e,n,r){t.call(this,e,n),r&&(r.initializer=function(){return e[n]})}},uA=0;function cA(){var e=new ee;return e.parent=oA,e.bind(sr.SceneID).toConstantValue("".concat(uA++)),e.bind(sr.ILayerService).to(e_).inSingletonScope(),e.bind(sr.ISceneService).to(Mx).inSingletonScope(),e.bind(sr.ICameraService).to(_g).inSingletonScope(),e.bind(sr.ICoordinateSystemService).to(Tb).inSingletonScope(),e.bind(sr.IInteractionService).to(Ub).inSingletonScope(),e.bind(sr.IPickingService).to(Jb).inSingletonScope(),e.bind(sr.IControlService).to(xg).inSingletonScope(),e.bind(sr.IMarkerService).to(Sg).inSingletonScope(),e.bind(sr.IIconService).to(lv).inSingletonScope(),e.bind(sr.IFontService).to(Bd).inSingletonScope(),e.bind(sr.IPopupService).to(wg).inSingletonScope(),e.bind(sr.INormalPass).to(dS).whenTargetNamed("clear"),e.bind(sr.INormalPass).to(vS).whenTargetNamed("pixelPicking"),e.bind(sr.INormalPass).to(tA).whenTargetNamed("render"),e.bind(sr.INormalPass).to(iA).whenTargetNamed("taa"),e.bind(sr.IFactoryNormalPass).toFactory((function(e){return function(t){return e.container.getNamed(sr.INormalPass,t)}})),e.bind(sr.IPostProcessingPass).to(Bw).whenTargetNamed("copy"),e.bind(sr.IPostProcessingPass).to(Fw).whenTargetNamed("blurH"),e.bind(sr.IPostProcessingPass).to(zw).whenTargetNamed("blurV"),e.bind(sr.IPostProcessingPass).to(Gw).whenTargetNamed("noise"),e.bind(sr.IPostProcessingPass).to(Ww).whenTargetNamed("sepia"),e.bind(sr.IPostProcessingPass).to(jw).whenTargetNamed("colorHalftone"),e.bind(sr.IPostProcessingPass).to(Vw).whenTargetNamed("hexagonalPixelate"),e.bind(sr.IPostProcessingPass).to(Hw).whenTargetNamed("ink"),e.bind(sr.IFactoryPostProcessingPass).toFactory((function(e){return function(t){var n=e.container.getNamed(sr.IPostProcessingPass,t);return n.setName(t),n}})),e}function lA(e){var t=new ee;return t.parent=e,t.bind(sr.IStyleAttributeService).to(d_).inSingletonScope(),t.bind(sr.IMultiPassRenderer).to(pS).inSingletonScope(),t.bind(sr.IPostProcessor).to(eA).inSingletonScope(),t}var fA=function(e,t,n){return e==e&&(void 0!==n&&(e=e<=n?e:n),void 0!==t&&(e=e>=t?e:t)),e},hA=/\s/;var dA=function(e){for(var t=e.length;t--&&hA.test(e.charAt(t)););return t},pA=/^\s+/;var vA=function(e){return e?e.slice(0,dA(e)+1).replace(pA,""):e},gA=/^[-+]0x[0-9a-f]+$/i,mA=/^0b[01]+$/i,yA=/^0o[0-7]+$/i,bA=parseInt;var _A=function(e){if("number"==typeof e)return e;if(DS(e))return NaN;if(Qg(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Qg(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=vA(e);var n=mA.test(e);return n||yA.test(e)?bA(e.slice(2),n?2:8):gA.test(e)?NaN:+e};var xA=function(e,t,n){return void 0===n&&(n=t,t=void 0),void 0!==n&&(n=(n=_A(n))==n?n:0),void 0!==t&&(t=(t=_A(t))==t?t:0),fA(_A(e),t,n)},SA=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"];function wA(e){return SA.indexOf(e)}var AA,TA,EA,CA;function MA(e,t){return 256*(e=xA(Math.floor(e),0,255))+(t=xA(Math.floor(t),0,255))}(AA=e.BlendType||(e.BlendType={})).normal="normal",AA.additive="additive",AA.subtractive="subtractive",AA.min="min",AA.max="max",AA.none="none",(TA=e.ScaleTypes||(e.ScaleTypes={})).LINEAR="linear",TA.POWER="power",TA.LOG="log",TA.IDENTITY="identity",TA.TIME="time",TA.QUANTILE="quantile",TA.QUANTIZE="quantize",TA.THRESHOLD="threshold",TA.CAT="cat",(EA=e.StyleScaleType||(e.StyleScaleType={})).CONSTANT="constant",EA.VARIABLE="variable",(CA=e.AttributeType||(e.AttributeType={}))[CA.Attribute=0]="Attribute",CA[CA.InstancedAttribute=1]="InstancedAttribute",CA[CA.Uniform=2]="Uniform";var kA,OA=["mapload"],IA={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},PA=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"];!function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft"}(e.PositionType||(e.PositionType={})),function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft"}(kA||(kA={}));var LA=0,RA=function(e){mr(n,e);var t=Er(n);function n(e){var r;return dr(this,n),gr(Ar(r=t.call(this)),"controlOption",void 0),gr(Ar(r),"container",void 0),gr(Ar(r),"sceneContainer",void 0),gr(Ar(r),"mapsService",void 0),gr(Ar(r),"renderService",void 0),gr(Ar(r),"layerService",void 0),gr(Ar(r),"controlService",void 0),gr(Ar(r),"isShow",void 0),r.controlOption=cr(cr({},r.getDefault()),e||{}),r}return vr(n,[{key:"getDefault",value:function(){return{position:kA.TOPRIGHT,name:"".concat(LA++)}}},{key:"setPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"bottomright",t=this.controlService;return t&&t.removeControl(this),this.controlOption.position=e,t&&t.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(e){this.mapsService=e.get(sr.IMapService),this.renderService=e.get(sr.IRendererService),this.layerService=e.get(sr.ILayerService),this.controlService=e.get(sr.IControlService),this.sceneContainer=e,this.isShow=!0,this.container=this.onAdd();var t=this.container,n=this.controlOption.position,r=this.controlService.controlCorners[n];return Ia(t,"l7-control"),-1!==n.indexOf("bottom")?r.insertBefore(t,r.firstChild):r.appendChild(t),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){Ia(this.container,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){Pa(this.container,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;Oa(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(e){if(this.mapsService&&e&&e.screenX>0&&e.screenY>0){var t=this.mapsService.getContainer();null!==t&&t.focus()}}}]),n}(s),NA=function(t){mr(r,t);var n=Er(r);function r(e){var t;return dr(this,r),gr(Ar(t=n.call(this,e)),"layerControlInputs",void 0),gr(Ar(t),"layers",void 0),gr(Ar(t),"lastZIndex",void 0),gr(Ar(t),"handlingClick",void 0),gr(Ar(t),"layersLink",void 0),gr(Ar(t),"baseLayersList",void 0),gr(Ar(t),"separator",void 0),gr(Ar(t),"overlaysList",void 0),gr(Ar(t),"form",void 0),t.layerControlInputs=[],t.layers=[],t.lastZIndex=0,t.handlingClick=!1,t.initLayers(),Mh(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],Ar(t)),t}return vr(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:e.PositionType.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var e=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach((function(t){t.layer.on("remove",e.onLayerChange),t.layer.on("add",e.onLayerChange)})),this.container}},{key:"addVisualLayer",value:function(e,t){return this.addLayer(e,t,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var e=this.renderService.getViewportSize().height;Ia(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var t=e-(this.container.offsetTop+50);return t<this.form.clientHeight?(Ia(this.form,"l7-control-layers-scrollbar"),this.form.style.height=t+"px"):Pa(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Pa(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var e=this;this.mapsService&&(this.mapsService.off("click",this.collapse),this.layers.forEach((function(t){t.layer.off("remove",e.onLayerChange),t.layer.off("add",e.onLayerChange)})))}},{key:"initLayout",value:function(){var e="l7-control-layers",t=this.container=ka("div",e),n=this.controlOption.collapsed;t.setAttribute("aria-haspopup","true");var r=this.form=ka("form",e+"-list");n&&(this.mapsService.on("click",this.collapse),t.addEventListener("mouseenter",this.expand),t.addEventListener("mouseleave",this.collapse)),this.layersLink=ka("a",e+"-toggle",t),this.layersLink.title="Layers",n||this.expand(),this.baseLayersList=ka("div",e+"-base",r),this.separator=ka("div",e+"-separator",r),this.overlaysList=ka("div",e+"-overlays",r),t.appendChild(r)}},{key:"initLayers",value:function(){var e=this,t=this.controlOption,n=t.baseLayers,r=void 0===n?{}:n,i=t.overlayers,o=void 0===i?{}:i;Object.keys(r).forEach((function(t,n){e.addLayer(r[t],t,!1)})),Object.keys(o).forEach((function(t,n){e.addLayer(o[t],t,!0)}))}},{key:"update",value:function(){if(!this.container)return this;var e,t,n,r;Da(this.baseLayersList),Da(this.overlaysList),this.layerControlInputs=[];var i=0;for(n=0;n<this.layers.length;n++)r=this.layers[n],this.addItem(r),t=t||r.overlay,e=e||!r.overlay,i+=r.overlay?0:1;return this.controlOption.hideSingleBase&&(e=e&&i>1,this.baseLayersList.style.display=e?"":"none"),this.separator.style.display=t&&e?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var e,t,n=this.layerControlInputs,r=this.mapsService.getZoom(),i=n.length-1;i>=0;i--)if(e=n[i],(t=this.layerService.getLayer(e.layerId))&&t.inited){var o=t.getMinZoom(),a=t.getMaxZoom();e.disabled=r<o||r>a}}},{key:"addLayer",value:function(e,t,n){this.mapsService&&(e.on("add",this.onLayerChange),e.on("remove",this.onLayerChange)),this.layers.push({layer:e,name:t,overlay:n});var r=this.controlOption,i=r.sortLayers,o=r.sortFunction,a=r.autoZIndex;i&&this.layers.sort((function(e,t){return o(e.layer,t.layer,e.name,t.name)})),a&&e.setZIndex&&(this.lastZIndex++,e.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(e){this.handlingClick||this.update();var t=this.layerService.getLayer(e.target.layerId),n=null!=t&&t.overlay?"add"===e.type?"overlayadd":"overlayremove":"add"===e.type?"baselayerchange":null;n&&this.emit(n,t)}},{key:"createRadioElement",value:function(e,t){var n='<input type="radio" class="l7-control-layers-selector" name="'+e+'"'+(t?' checked="checked"':"")+"/>",r=document.createElement("div");return r.innerHTML=n,r.firstChild}},{key:"addItem",value:function(e){var t,n=document.createElement("label"),r=this.layerService.getLayer(e.layer.id),i=r&&r.inited&&e.layer.isVisible();e.overlay?((t=document.createElement("input")).type="checkbox",t.className="l7-control-layers-selector",t.defaultChecked=i):t=this.createRadioElement("l7-base-layers",i),this.layerControlInputs.push(t),t.layerId=e.layer.id,t.addEventListener("click",this.onInputClick);var o=document.createElement("span");o.innerHTML=" "+e.name;var a=document.createElement("div");return n.appendChild(a),a.appendChild(t),a.appendChild(o),(e.overlay?this.overlaysList:this.baseLayersList).appendChild(n),this.checkDisabledLayers(),n}},{key:"onInputClick",value:function(){var e,t,n=this.layerControlInputs,r=[],i=[];this.handlingClick=!0;for(var o=n.length-1;o>=0;o--)e=n[o],t=this.layerService.getLayer(e.layerId),e.checked?r.push(t):e.checked||i.push(t);i.forEach((function(e){e.hide()})),r.forEach((function(e){e.show()})),this.handlingClick=!1}}]),r}(RA),DA=function(e){mr(n,e);var t=Er(n);function n(){return dr(this,n),t.apply(this,arguments)}return vr(n,[{key:"getDefault",value:function(){return{position:kA.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var e=ka("div","l7-control-logo"),t=ka("a","l7-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://antv.alipay.com/l7",t.setAttribute("aria-label","AntV logo"),t.setAttribute("rel","noopener nofollow"),e.appendChild(t),e}},{key:"onRemove",value:function(){return null}}]),n}(RA),FA=function(e){mr(n,e);var t=Er(n);function n(e){var r;return dr(this,n),gr(Ar(r=t.call(this,e)),"mScale",void 0),gr(Ar(r),"iScale",void 0),Mh(["update"],Ar(r)),r}return vr(n,[{key:"getDefault",value:function(){return{position:kA.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var e=ka("div","l7-control-scale");this.addScales("l7-control-scale-line",e);var t=this.controlOption.updateWhenIdle;return this.mapsService.on(t?"moveend":"mapmove",this.update),this.mapsService.on(t?"zoomend":"zoomchange",this.update),this.update(),e}},{key:"onRemove",value:function(){var e=this.controlOption.updateWhenIdle;this.mapsService.off(e?"zoomend":"zoomchange",this.update),this.mapsService.off(e?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var e=this.mapsService,t=this.controlOption.maxWidth,n=e.getSize()[1]/2,r=e.containerToLngLat([0,n]),i=e.containerToLngLat([t,n]),o=yh([r.lng,r.lat],[i.lng,i.lat]);this.updateScales(o)}},{key:"updateScales",value:function(e){var t=this.controlOption,n=t.metric,r=t.imperial;n&&e&&this.updateMetric(e),r&&e&&this.updateImperial(e)}},{key:"updateMetric",value:function(e){var t=this.getRoundNum(e),n=t<1e3?t+" m":t/1e3+" km";this.updateScale(this.mScale,n,t/e)}},{key:"updateImperial",value:function(e){var t,n,r,i=3.2808399*e;i>5280?(t=i/5280,n=this.getRoundNum(t),this.updateScale(this.iScale,n+" mi",n/t)):(r=this.getRoundNum(i),this.updateScale(this.iScale,r+" ft",r/i))}},{key:"updateScale",value:function(e,t,n){var r=this.controlOption.maxWidth;e.style.width=Math.round(r*n)+"px",e.innerHTML=t}},{key:"getRoundNum",value:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),n=e/t;return t*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}},{key:"addScales",value:function(e,t){var n=this.controlOption,r=n.metric,i=n.imperial;r&&(this.mScale=ka("div",e,t)),i&&(this.iScale=ka("div",e,t))}}]),n}(RA),zA=function(e){mr(n,e);var t=Er(n);function n(e){var r;return dr(this,n),gr(Ar(r=t.call(this,e)),"disabled",void 0),gr(Ar(r),"zoomInButton",void 0),gr(Ar(r),"zoomOutButton",void 0),Mh(["updateDisabled","zoomIn","zoomOut"],Ar(r)),r}return vr(n,[{key:"getDefault",value:function(){return{position:kA.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var e=ka("div","l7-control-zoom l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-control-zoom-in",e,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-control-zoom-out",e,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),e}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(e,t,n,r,i){var o=ka("a",n,r);return o.innerHTML=e,o.title=t,o.href="javascript:void(0)",o.addEventListener("click",i),o}},{key:"updateDisabled",value:function(){var e=this.mapsService;Pa(this.zoomInButton,"l7-disabled"),Pa(this.zoomOutButton,"l7-disabled"),(this.disabled||e.getZoom()<=e.getMinZoom())&&Ia(this.zoomOutButton,"l7-disabled"),(this.disabled||e.getZoom()>=e.getMaxZoom())&&Ia(this.zoomInButton,"l7-disabled")}}]),n}(RA),jA=/"/g,UA=function(e,t,n,r){var i=String(ve(e)),o="<"+t;return""!==n&&(o+=" "+n+'="'+String(r).replace(jA,"&quot;")+'"'),o+">"+i+"</"+t+">"},BA=function(e){return oe((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))};Lt({target:"String",proto:!0,forced:BA("anchor")},{anchor:function(e){return UA(this,"a","name",e)}});var VA=function(t){mr(r,t);var n=Er(r);function r(e){var t;return dr(this,r),gr(Ar(t=n.call(this)),"markerOption",void 0),gr(Ar(t),"defaultMarker",void 0),gr(Ar(t),"popup",void 0),gr(Ar(t),"mapsService",void 0),gr(Ar(t),"sceneSerive",void 0),gr(Ar(t),"lngLat",void 0),gr(Ar(t),"scene",void 0),gr(Ar(t),"added",!1),gr(Ar(t),"eventHandle",(function(e){t.emit(e.type,{target:e,data:t.markerOption.extData,lngLat:t.lngLat})})),t.markerOption=cr(cr({},t.getDefault()),e),Mh(["update","onMove","onUp","addDragHandler","onMapClick"],Ar(t)),t.init(),t}return vr(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:e.anchorType.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(e){this.scene=e,this.mapsService=e.get(sr.IMapService),this.sceneSerive=e.get(sr.ISceneService);var t=this.markerOption,n=t.element;t.draggable;return this.mapsService.getMarkerContainer().appendChild(n),this.registerMarkerEvent(n),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var e=this.markerOption.element;return e&&Oa(e),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(e){return this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(e){var t=this;if(!this.added)return this.once("added",(function(){t.setElement(e)})),this;var n=this.markerOption.element;return n&&Oa(n),this.markerOption.element=e,this.init(),this.mapsService.getMarkerContainer().appendChild(e),this.registerMarkerEvent(e),this.update(),this}},{key:"openPopup",value:function(){var e=this;if(!this.added)return this.once("added",(function(){e.openPopup()})),this;var t=this.popup;return t?(t.isOpen()||t.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var e=this;this.added||this.once("added",(function(){e.closePopup()}));var t=this.popup;return t&&t.remove(),this}},{key:"setPopup",value:function(e){return this.popup=e,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var e=this.popup;return e?(e.isOpen()?e.remove():e.addTo(this.scene),this):this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(e){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(e){this.markerOption.extData=e}},{key:"update",value:function(){if(this.mapsService){var e=this.markerOption,t=e.element,n=e.anchor;this.updatePosition(),za(t,"".concat(cd[n]))}}},{key:"onMapClick",value:function(e){var t=this.markerOption.element;this.popup&&t&&this.togglePopup()}},{key:"updatePosition",value:function(){if(this.mapsService){var e=this.markerOption,t=e.element,n=e.offsets,r=this.lngLat,i=r.lng,o=r.lat,a=this.mapsService.getBounds(),s=this.mapsService.lngLatToContainer([i,o]);if(t){t.style.display="block";var u=this.mapsService.getContainer(),c=0,l=0;if(u&&(c=u.scrollWidth,l=u.scrollHeight),Math.abs(a[0][0])>180||Math.abs(a[1][0])>180){if(s.x>c){var f=this.mapsService.lngLatToContainer([i-360,o]);s.x=f.x}if(s.x<0){var h=this.mapsService.lngLatToContainer([i+360,o]);s.x=h.x}}(s.x>c||s.x<0||s.y>l||s.y<0)&&(t.style.display="none"),t.style.left=s.x+n[0]+"px",t.style.top=s.y-n[1]+"px"}}}},{key:"init",value:function(){var e=this,t=this.markerOption.element,n=this.markerOption,r=n.color,i=n.anchor;if(!t){this.defaultMarker=!0,t=ka("div"),this.markerOption.element=t;var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","48px"),o.setAttributeNS(null,"width","48px"),o.setAttributeNS(null,"viewBox","0 0 1024 1024");var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),a.setAttributeNS(null,"fill",r),o.appendChild(a),t.appendChild(o)}Ia(t,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach((function(n){var r,i,o=(null===(r=e.markerOption)||void 0===r?void 0:r.style)&&(null===(i=e.markerOption)||void 0===i?void 0:i.style[n]);t&&(t.style[n]=o)})),t.addEventListener("click",(function(t){e.onMapClick(t)})),t.addEventListener("click",this.eventHandle),ld(t,i,"marker")}},{key:"registerMarkerEvent",value:function(e){e.addEventListener("mousemove",this.eventHandle),e.addEventListener("click",this.eventHandle),e.addEventListener("mousedown",this.eventHandle),e.addEventListener("mouseup",this.eventHandle),e.addEventListener("dblclick",this.eventHandle),e.addEventListener("contextmenu",this.eventHandle),e.addEventListener("mouseover",this.eventHandle),e.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var e=this.getElement();e.removeEventListener("mousemove",this.eventHandle),e.removeEventListener("click",this.eventHandle),e.removeEventListener("mousedown",this.eventHandle),e.removeEventListener("mouseup",this.eventHandle),e.removeEventListener("dblclick",this.eventHandle),e.removeEventListener("contextmenu",this.eventHandle),e.removeEventListener("mouseover",this.eventHandle),e.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(e){throw new Error("Method not implemented.")}},{key:"onUp",value:function(e){throw new Error("Method not implemented.")}}]),r}(s),HA=o((function(e,t){e.exports=function(){function e(n,r,i,o,a,s){if(!(a-o<=i)){var u=o+a>>1;!function e(n,r,i,o,a,s){for(;a>o;){if(a-o>600){var u=a-o+1,c=i-o+1,l=Math.log(u),f=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*f*(u-f)/u)*(c-u/2<0?-1:1),d=Math.max(o,Math.floor(i-c*f/u+h)),p=Math.min(a,Math.floor(i+(u-c)*f/u+h));e(n,r,i,d,p,s)}var v=r[2*i+s],g=o,m=a;for(t(n,r,o,i),r[2*a+s]>v&&t(n,r,o,a);g<m;){for(t(n,r,g,m),g++,m--;r[2*g+s]<v;)g++;for(;r[2*m+s]>v;)m--}r[2*o+s]===v?t(n,r,o,m):(m++,t(n,r,m,a)),m<=i&&(o=m+1),i<=m&&(a=m-1)}}(n,r,u,o,a,s%2),e(n,r,i,o,u-1,s+1),e(n,r,i,u+1,a,s+1)}}function t(e,t,r,i){n(e,r,i),n(t,2*r,2*i),n(t,2*r+1,2*i+1)}function n(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function r(e,t,n,r){var i=e-n,o=t-r;return i*i+o*o}var i=function(e){return e[0]},o=function(e){return e[1]},a=function(t,n,r,a,s){void 0===n&&(n=i),void 0===r&&(r=o),void 0===a&&(a=64),void 0===s&&(s=Float64Array),this.nodeSize=a,this.points=t;for(var u=t.length<65536?Uint16Array:Uint32Array,c=this.ids=new u(t.length),l=this.coords=new s(2*t.length),f=0;f<t.length;f++)c[f]=f,l[2*f]=n(t[f]),l[2*f+1]=r(t[f]);e(c,l,a,0,c.length-1,0)};a.prototype.range=function(e,t,n,r){return function(e,t,n,r,i,o,a){for(var s,u,c=[0,e.length-1,0],l=[];c.length;){var f=c.pop(),h=c.pop(),d=c.pop();if(h-d<=a)for(var p=d;p<=h;p++)s=t[2*p],u=t[2*p+1],s>=n&&s<=i&&u>=r&&u<=o&&l.push(e[p]);else{var v=Math.floor((d+h)/2);s=t[2*v],u=t[2*v+1],s>=n&&s<=i&&u>=r&&u<=o&&l.push(e[v]);var g=(f+1)%2;(0===f?n<=s:r<=u)&&(c.push(d),c.push(v-1),c.push(g)),(0===f?i>=s:o>=u)&&(c.push(v+1),c.push(h),c.push(g))}}return l}(this.ids,this.coords,e,t,n,r,this.nodeSize)},a.prototype.within=function(e,t,n){return function(e,t,n,i,o,a){for(var s=[0,e.length-1,0],u=[],c=o*o;s.length;){var l=s.pop(),f=s.pop(),h=s.pop();if(f-h<=a)for(var d=h;d<=f;d++)r(t[2*d],t[2*d+1],n,i)<=c&&u.push(e[d]);else{var p=Math.floor((h+f)/2),v=t[2*p],g=t[2*p+1];r(v,g,n,i)<=c&&u.push(e[p]);var m=(l+1)%2;(0===l?n-o<=v:i-o<=g)&&(s.push(h),s.push(p-1),s.push(m)),(0===l?n+o>=v:i+o>=g)&&(s.push(p+1),s.push(f),s.push(m))}}return u}(this.ids,this.coords,e,t,n,this.nodeSize)};var s={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(e){return e}},u=Math.fround||function(e){return function(t){return e[0]=+t,e[0]}}(new Float32Array(1)),c=function(e){this.options=g(Object.create(s),e),this.trees=new Array(this.options.maxZoom+1)};function l(e,t,n,r,i){return{x:u(e),y:u(t),zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function f(e,t){var n=e.geometry.coordinates,r=n[0],i=n[1];return{x:u(p(r)),y:u(v(i)),zoom:1/0,index:t,parentId:-1}}function h(e){return{type:"Feature",id:e.id,properties:d(e),geometry:{type:"Point",coordinates:[(r=e.x,360*(r-.5)),(t=e.y,n=(180-360*t)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var t,n,r}function d(e){var t=e.numPoints,n=t>=1e4?Math.round(t/1e3)+"k":t>=1e3?Math.round(t/100)/10+"k":t;return g(g({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:n})}function p(e){return e/360+.5}function v(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function g(e,t){for(var n in t)e[n]=t[n];return e}function m(e){return e.x}function y(e){return e.y}return c.prototype.load=function(e){var t=this.options,n=t.log,r=t.minZoom,i=t.maxZoom,o=t.nodeSize;n&&console.time("total time");var s="prepare "+e.length+" points";n&&console.time(s),this.points=e;for(var u=[],c=0;c<e.length;c++)e[c].geometry&&u.push(f(e[c],c));this.trees[i+1]=new a(u,m,y,o,Float32Array),n&&console.timeEnd(s);for(var l=i;l>=r;l--){var h=+Date.now();u=this._cluster(u,l),this.trees[l]=new a(u,m,y,o,Float32Array),n&&console.log("z%d: %d clusters in %dms",l,u.length,+Date.now()-h)}return n&&console.timeEnd("total time"),this},c.prototype.getClusters=function(e,t){var n=((e[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,e[1])),i=180===e[2]?180:((e[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],t),s=this.getClusters([-180,r,i,o],t);return a.concat(s)}for(var u=this.trees[this._limitZoom(t)],c=[],l=0,f=u.range(p(n),v(o),p(i),v(r));l<f.length;l+=1){var d=f[l],g=u.points[d];c.push(g.numPoints?h(g):this.points[g.index])}return c},c.prototype.getChildren=function(e){var t=this._getOriginId(e),n=this._getOriginZoom(e),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var o=i.points[t];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,c=i.within(o.x,o.y,a);u<c.length;u+=1){var l=c[u],f=i.points[l];f.parentId===e&&s.push(f.numPoints?h(f):this.points[f.index])}if(0===s.length)throw new Error(r);return s},c.prototype.getLeaves=function(e,t,n){t=t||10,n=n||0;var r=[];return this._appendLeaves(r,e,t,n,0),r},c.prototype.getTile=function(e,t,n){var r=this.trees[this._limitZoom(e)],i=Math.pow(2,e),o=this.options,a=o.extent,s=o.radius/a,u=(n-s)/i,c=(n+1+s)/i,l={features:[]};return this._addTileFeatures(r.range((t-s)/i,u,(t+1+s)/i,c),r.points,t,n,i,l),0===t&&this._addTileFeatures(r.range(1-s/i,u,1,c),r.points,i,n,i,l),t===i-1&&this._addTileFeatures(r.range(0,u,s/i,c),r.points,-1,n,i,l),l.features.length?l:null},c.prototype.getClusterExpansionZoom=function(e){for(var t=this._getOriginZoom(e)-1;t<=this.options.maxZoom;){var n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t},c.prototype._appendLeaves=function(e,t,n,r,i){for(var o=0,a=this.getChildren(t);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(e,u.cluster_id,n,r,i):i<r?i++:e.push(s),e.length===n)break}return i},c.prototype._addTileFeatures=function(e,t,n,r,i,o){for(var a=0,s=e;a<s.length;a+=1){var u=t[s[a]],c=u.numPoints,l=void 0,f=void 0,h=void 0;if(c)l=d(u),f=u.x,h=u.y;else{var g=this.points[u.index];l=g.properties,f=p(g.geometry.coordinates[0]),h=v(g.geometry.coordinates[1])}var m={type:1,geometry:[[Math.round(this.options.extent*(f*i-n)),Math.round(this.options.extent*(h*i-r))]],tags:l},y=void 0;c?y=u.id:this.options.generateId?y=u.index:this.points[u.index].id&&(y=this.points[u.index].id),void 0!==y&&(m.id=y),o.features.push(m)}},c.prototype._limitZoom=function(e){return Math.max(this.options.minZoom,Math.min(+e,this.options.maxZoom+1))},c.prototype._cluster=function(e,t){for(var n=[],r=this.options,i=r.radius,o=r.extent,a=r.reduce,s=r.minPoints,u=i/(o*Math.pow(2,t)),c=0;c<e.length;c++){var f=e[c];if(!(f.zoom<=t)){f.zoom=t;for(var h=this.trees[t+1],d=h.within(f.x,f.y,u),p=f.numPoints||1,v=p,g=0,m=d;g<m.length;g+=1){var y=m[g],b=h.points[y];b.zoom>t&&(v+=b.numPoints||1)}if(v>=s){for(var _=f.x*p,x=f.y*p,S=a&&p>1?this._map(f,!0):null,w=(c<<5)+(t+1)+this.points.length,A=0,T=d;A<T.length;A+=1){var E=T[A],C=h.points[E];if(!(C.zoom<=t)){C.zoom=t;var M=C.numPoints||1;_+=C.x*M,x+=C.y*M,C.parentId=w,a&&(S||(S=this._map(f,!0)),a(S,this._map(C)))}}f.parentId=w,n.push(l(_/v,x/v,w,v,S))}else if(n.push(f),v>1)for(var k=0,O=d;k<O.length;k+=1){var I=O[k],P=h.points[I];P.zoom<=t||(P.zoom=t,n.push(P))}}}return n},c.prototype._getOriginId=function(e){return e-this.points.length>>5},c.prototype._getOriginZoom=function(e){return(e-this.points.length)%32},c.prototype._map=function(e,t){if(e.numPoints)return t?g({},e.properties):e.properties;var n=this.points[e.index].properties,r=this.options.map(n);return t&&r===n?g({},r):r},c}()})),GA=function(e){mr(n,e);var t=Er(n);function n(e){var r,i;return dr(this,n),gr(Ar(i=t.call(this)),"markers",[]),gr(Ar(i),"markerLayerOption",void 0),gr(Ar(i),"clusterIndex",void 0),gr(Ar(i),"points",[]),gr(Ar(i),"clusterMarkers",[]),gr(Ar(i),"mapsService",void 0),gr(Ar(i),"scene",void 0),gr(Ar(i),"zoom",void 0),gr(Ar(i),"bbox",void 0),i.markerLayerOption=Ky(i.getDefault(),e),Mh(["update"],Ar(i)),i.zoom=(null===(r=i.markerLayerOption.clusterOption)||void 0===r?void 0:r.zoom)||-99,i}return vr(n,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(e){return this.scene=e,this.mapsService=e.get(sr.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(e){this.markerLayerOption.cluster&&this.addPoint(e,this.markers.length),this.markers.push(e)}},{key:"removeMarker",value:function(e){this.markers.indexOf(e);var t=this.markers.indexOf(e);t>-1&&this.markers.splice(t,1)}},{key:"hide",value:function(){this.markers.map((function(e){e.getElement().style.opacity="0"}))}},{key:"show",value:function(){this.markers.map((function(e){e.getElement().style.opacity="1"}))}},{key:"getMarkers",value:function(){return this.markerLayerOption.cluster?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var e=this;this.getMarkers().forEach((function(t){t.addTo(e.scene)}))}},{key:"clear",value:function(){this.markers.forEach((function(e){e.remove()})),this.clusterMarkers.forEach((function(e){e.remove()})),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(e,t){var n=e.getLnglat(),r={geometry:{type:"Point",coordinates:[n.lng,n.lat]},properties:cr(cr({},e.getExtData()),{},{marker_id:t})};this.points.push(r)}},{key:"initCluster",value:function(){if(this.markerLayerOption.cluster){var e=this.markerLayerOption.clusterOption,t=e.radius,n=e.minZoom,r=void 0===n?0:n,i=e.maxZoom;this.clusterIndex=new HA({radius:t,minZoom:r,maxZoom:i}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(e,t){var n=this,r=e[0].concat(e[1]),i=this.clusterIndex.getClusters(r,t);this.clusterMarkers.forEach((function(e){e.remove()})),this.clusterMarkers=[],i.forEach((function(e){var t,r=n.markerLayerOption.clusterOption,i=r.field,o=r.method;if(e.properties&&null!==(t=e.properties)&&void 0!==t&&t.cluster_id){var a,s=n.getLeaves(null===(a=e.properties)||void 0===a?void 0:a.cluster_id);if(e.properties.clusterData=s,i&&o){var u=Ad(o,wd(null==s?void 0:s.map((function(e){return gr({},i,e.properties[i])})),i)),c="point_"+o;e.properties[c]=u.toFixed(2)}}var l=n.clusterMarker(e);n.clusterMarkers.push(l),l.addTo(n.scene)}))}},{key:"getLeaves",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e?this.clusterIndex.getLeaves(e,t,n):null}},{key:"clusterMarker",value:function(e){var t=this.markerLayerOption.clusterOption.element,n=void 0===t?this.generateElement.bind(this):t;return new VA({element:n(e)}).setLnglat({lng:e.geometry.coordinates[0],lat:e.geometry.coordinates[1]})}},{key:"normalMarker",value:function(e){var t=e.properties.marker_id;return this.markers[t]}},{key:"update",value:function(){var e=this.mapsService.getZoom(),t=this.mapsService.getBounds();(!this.bbox||Math.abs(e-this.zoom)>=1||!_h(this.bbox,t))&&(this.bbox=bh(t,.5),this.zoom=Math.floor(e),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(e){var t=ka("div","l7-marker-cluster"),n=ka("div","",t),r=ka("span","",n),i=this.markerLayerOption.clusterOption,o=i.field,a=i.method;e.properties.point_count=e.properties.point_count||1;var s=o&&a?e.properties["point_"+a]||e.properties[o]:e.properties.point_count;return r.textContent=s,t}}]),n}(s),WA=function(t){mr(r,t);var n=Er(r);function r(e){var t;return dr(this,r),gr(Ar(t=n.call(this)),"popupOption",void 0),gr(Ar(t),"mapsService",void 0),gr(Ar(t),"sceneSerive",void 0),gr(Ar(t),"lngLat",void 0),gr(Ar(t),"content",void 0),gr(Ar(t),"closeButton",void 0),gr(Ar(t),"timeoutInstance",void 0),gr(Ar(t),"container",void 0),gr(Ar(t),"tip",void 0),gr(Ar(t),"scene",void 0),t.popupOption=cr(cr({},t.getdefault()),e),Mh(["update","onClickClose","remove"],Ar(t)),t}return vr(r,[{key:"addTo",value:function(e){var t=this;return this.mapsService=e.get(sr.IMapService),this.sceneSerive=e.get(sr.ISceneService),this.mapsService.on("camerachange",this.update),this.scene=e,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout((function(){t.mapsService.on("click",t.onClickClose)}),30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(e){var t,n=window.document.createDocumentFragment(),r=window.document.createElement("body");for(r.innerHTML=e;t=r.firstChild;)n.appendChild(t);return this.setDOMContent(n)}},{key:"setLnglat",value:function(e){return this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.mapsService&&this.mapsService.on("camerachange",this.update),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(e){return this.setDOMContent(window.document.createTextNode(e))}},{key:"setMaxWidth",value:function(e){return this.popupOption.maxWidth=e,this.update(),this}},{key:"setDOMContent",value:function(e){return this.createContent(),this.content.appendChild(e),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&Oa(this.content),this.content=ka("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=ka("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(e,t,n){var r=window.document.createElement(e);return void 0!==t&&(r.className=t),n&&n.appendChild(r),r}},{key:"removeDom",value:function(e){e.parentNode&&e.parentNode.removeChild(e)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:e.anchorType.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(e){e.stopPropagation&&e.stopPropagation(),this.remove()}},{key:"update",value:function(){var e=this,t=this.lngLat,n=this.popupOption,r=n.className,i=n.maxWidth,o=n.anchor;if(this.mapsService&&t&&this.content){var a=this.mapsService.getMarkerContainer();if(!this.container&&a)this.container=this.creatDom("div","l7-popup",a),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),r&&r.split(" ").forEach((function(t){return e.container.classList.add(t)})),this.popupOption.stopPropagation&&["mousemove","mousedown","mouseup","click","dblclick"].forEach((function(t){e.container.addEventListener(t,(function(e){e.stopPropagation()}))}));i&&this.container.style.maxWidth!==i&&(this.container.style.maxWidth=i),this.updatePosition(),za(this.container,"".concat(cd[o])),ld(this.container,o,"popup")}}},{key:"updatePosition",value:function(){if(this.mapsService){var e=this.lngLat,t=e.lng,n=e.lat,r=this.popupOption.offsets,i=this.mapsService.lngLatToContainer([t,n]);this.container.style.left=i.x+r[0]+"px",this.container.style.top=i.y-r[1]+"px"}}}]),r}(s);function ZA(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}ZA('.l7-marker-container {\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  position: absolute;\n }\n\n.l7-marker {\n\tposition: absolute !important;\n\ttop: 0;\n\tleft: 0;\n  z-index: 5;\n  cursor: pointer;\n}\n\n.l7-marker-cluster {\n  background-clip: padding-box;\n  border-radius: 20px;\n  background-color: rgba(181, 226, 140, 0.6);\n  width: 40px;\n  height: 40px;\n}\n.l7-marker-cluster div {\n  width: 30px;\n  height: 30px;\n  margin-left: 5px;\n  margin-top: 5px;\n  text-align: center;\n  border-radius: 15px;\n  font: 12px "Helvetica Neue", Arial, Helvetica, sans-serif;\n  background-color: rgba(110, 204, 57, 0.6);\n}\n.l7-marker-cluster span {\n  line-height: 30px;\n}\n\n.l7-popup-anchor-bottom,\n.l7-popup-anchor-bottom-left,\n.l7-popup-anchor-bottom-right {\n    -webkit-flex-direction: column-reverse;\n    flex-direction: column-reverse;\n}\n\n.l7-popup-close-button {\n  position: absolute;\n  right: 0;\n  top: 0;\n  border: 0;\n  border-radius: 0 3px 0 0;\n  cursor: pointer;\n  background-color: transparent;\n}\n\n.l7-popup-close-button:hover {\n  background-color: rgba(0, 0, 0, 0.05);\n}\n\n.l7-popup-content {\n  position: relative;\n  background: #fff;\n  border-radius: 3px;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n  padding: 10px 10px 15px;\n  pointer-events: auto;\n}\n\n\t/* layers control */\n\n.l7-control-layers {\n\tbox-shadow: 0 1px 5px rgba(0,0,0,0.4);\n\tbackground: #fff;\n\tborder-radius: 5px;\n\t}\n.l7-popup-anchor-top,\n.l7-popup-anchor-top-left,\n.l7-popup-anchor-top-right {\n    -webkit-flex-direction: column;\n    flex-direction: column;\n}\n\n\n.l7-popup-anchor-left {\n    -webkit-flex-direction: row;\n    flex-direction: row;\n}\n\n.l7-popup-anchor-right {\n    -webkit-flex-direction: row-reverse;\n    flex-direction: row-reverse;\n}\n.l7-popup {\n  position: absolute;\n  top: 0;\n  left: 0;\n  display: -webkit-flex;\n  display: flex;\n  will-change: transform;\n  pointer-events: none;\n  z-index: 5;\n}\n.l7-popup-tip {\n  width: 0;\n  height: 0;\n  border: 10px solid transparent;\n  z-index: 1;\n}\n.l7-popup-anchor-top .l7-popup-tip {\n\t-webkit-align-self: center;\n\talign-self: center;\n\tborder-top: none;\n\tborder-bottom-color: #fff;\n}\n\n.l7-popup-anchor-top-left .l7-popup-tip {\n\t-webkit-align-self: flex-start;\n\talign-self: flex-start;\n\tborder-top: none;\n\tborder-left: none;\n\tborder-bottom-color: #fff;\n}\n\n.l7-popup-anchor-top-right .l7-popup-tip {\n\t-webkit-align-self: flex-end;\n\talign-self: flex-end;\n\tborder-top: none;\n\tborder-right: none;\n\tborder-bottom-color: #fff;\n}\n\n.l7-popup-anchor-bottom .l7-popup-tip {\n\t-webkit-align-self: center;\n\talign-self: center;\n\tborder-bottom: none;\n\tborder-top-color: #fff;\n}\n\n.l7-popup-anchor-bottom-left .l7-popup-tip {\n\t-webkit-align-self: flex-start;\n\talign-self: flex-start;\n\tborder-bottom: none;\n\tborder-left: none;\n\tborder-top-color: #fff;\n}\n\n.l7-popup-anchor-bottom-right .l7-popup-tip {\n\t-webkit-align-self: flex-end;\n\talign-self: flex-end;\n\tborder-bottom: none;\n\tborder-right: none;\n\tborder-top-color: #fff;\n}\n\n.l7-popup-anchor-left .l7-popup-tip {\n\t-webkit-align-self: center;\n\talign-self: center;\n\tborder-left: none;\n\tborder-right-color: #fff;\n}\n\n.l7-popup-anchor-right .l7-popup-tip {\n\t-webkit-align-self: center;\n\talign-self: center;\n\tborder-right: none;\n\tborder-left-color: #fff;\n}\n\n.l7-popup-close-button {\n\tposition: absolute;\n\tright: 0;\n\ttop: 0;\n\tborder: 0;\n\tpadding: 0;\n\tfont-size: 25px;\n\tline-height: 20px;\n\tborder-radius: 0 3px 0 0;\n\tcursor: pointer;\n\tbackground-color: transparent;\n}\n\n.l7-popup-close-button:hover {\n\tbackground-color: rgba(0, 0, 0, 0.05);\n}\n\n.l7-popup-content {\n\tposition: relative;\n\tbackground: #fff;\n\tborder-radius: 3px;\n\tbox-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n\tpadding: 10px 10px 15px;\n\tpointer-events: auto;\n}\n\n.l7-popup-anchor-top-left .l7-popup-content {\n\tborder-top-left-radius: 0;\n}\n\n.l7-popup-anchor-top-right .l7-popup-content {\n\tborder-top-right-radius: 0;\n}\n\n.l7-popup-anchor-bottom-left .l7-popup-content {\n\tborder-bottom-left-radius: 0;\n}\n\n.l7-popup-anchor-bottom-right .l7-popup-content {\n\tborder-bottom-right-radius: 0;\n}\n\n.l7-popup-track-pointer {\n\tdisplay: none;\n}\n\n.l7-popup-track-pointer * {\n\tpointer-events: none;\n\tuser-select: none;\n}\n\n.l7-map:hover .l7-popup-track-pointer {\n\tdisplay: flex;\n}\n\n.l7-map:active .l7-popup-track-pointer {\n\tdisplay: none;\n}\n\n\n.l7-popup-close-button:hover {\n  background-color: rgba(0, 0, 0, 0.05);\n}\n\n.l7-popup-content {\n  position: relative;\n  background: #fff;\n  border-radius: 3px;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n  padding: 10px 10px 15px;\n  pointer-events: auto;\n}\n\n/* general toolbar styles */\n\n.l7-bar {\n\tbox-shadow: 0 1px 5px rgba(0,0,0,0.65);\n\tborder-radius: 4px;\n\t}\n.l7-bar a,\n.l7-bar a:hover {\n\tbackground-color: #fff;\n\twidth: 30px;\n\theight: 30px;\n  font-size: 20px;\n\tdisplay: block;\n\ttext-align: center;\n\ttext-decoration: none;\n\tcolor: #8E9DAB;\n\t}\n.l7-bar a,\n.l7-control-layers-toggle {\n\tbackground-position: 50% 50%;\n\tbackground-repeat: no-repeat;\n\tdisplay: block;\n\t}\n.l7-bar a:hover {\n\tbackground-color: #f4f4f4;\n\t}\n.l7-bar a:first-child {\n\tborder-top-left-radius: 2px;\n\tborder-top-right-radius: 2px;\n\t}\n.l7-bar a:last-child {\n\tborder-bottom-left-radius: 2px;\n\tborder-bottom-right-radius: 2px;\n\tborder-bottom: none;\n\t}\n.l7-bar a.l7-disabled {\n\tcursor: default;\n\tbackground-color: #f4f4f4;\n\tcolor: #bbb;\n\t}\n\n\n/* control positioning */\n\n.l7-control-container {\n\tfont: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;\n}\n.l7-control-hide {\n\tdisplay: none;\n}\n.l7-control {\n\tposition: relative;\n\tz-index: 800;\n\tpointer-events: visiblePainted; /* IE 9-10 doesn\'t have auto */\n\tpointer-events: auto;\n\t}\n.l7-control {\n\tfloat: left;\n\tclear: both;\n\t}.l7-top,\n  .l7-bottom {\n    position: absolute;\n    z-index: 1000;\n    pointer-events: none;\n    }\n  .l7-top {\n    top: 0;\n    }\n  .l7-right {\n    right: 0;\n    }\n  .l7-bottom {\n    bottom: 0;\n    }\n  .l7-left {\n    left: 0;\n    }\n\n  .l7-control {\n    float: left;\n    clear: both;\n    }\n  .l7-right .l7-control {\n    float: right;\n    }\n  .l7-top .l7-control {\n    margin-top: 10px;\n    }\n  .l7-bottom .l7-control {\n    margin-bottom: 10px;\n    }\n  .l7-left .l7-control {\n    margin-left: 10px;\n    }\n  .l7-right .l7-control {\n    margin-right: 10px;\n    }\n\n  /* attribution and scale controls */\n\n.l7-control-container .l7-control-attribution {\n\tbackground: #fff;\n\tbackground: rgba(255, 255, 255, 0.7);\n\tmargin: 0;\n\t}\n.l7-control-attribution,\n.l7-control-scale-line {\n\tpadding: 0 5px;\n  color: #333;\n\t}\n.l7-control-attribution a {\n\ttext-decoration: none;\n\t}\n.l7-control-attribution a:hover {\n\ttext-decoration: underline;\n\t}\n.l7-container .l7-control-attribution,\n.l7-container .l7-control-scale {\n  font-size: 11px;\n  padding: 5px 5px 2px 5px;\n  background: rgba(255, 255, 255, 0.7);\n\t}\n.l7-left .l7-control-scale {\n\tmargin-left: 5px;\n\t}\n.l7-bottom .l7-control-scale {\n\tmargin-bottom: 5px;\n\t}\n.l7-control-scale-line {\n\tborder: 2px solid #000;\n  border-top: none;\n  color: #000;\n\tline-height: 1.1;\n\tpadding: 2px 5px 1px;\n\tfont-size: 11px;\n\twhite-space: nowrap;\n\toverflow: hidden;\n\t-moz-box-sizing: border-box;\n\t     box-sizing: border-box;\n\n\tbackground: #fff;\n\t}\n.l7-control-scale-line:not(:first-child) {\n\tborder-top: 2px solid #777;\n\tborder-bottom: none;\n\tmargin-top: -2px;\n\t}\n.l7-control-scale-line:not(:first-child):not(:last-child) {\n\tborder-bottom: 2px solid #777;\n\t}\n\n.l7-touch .l7-control-attribution,\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n\tbox-shadow: none;\n\t}\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n\tborder: 2px solid rgba(0,0,0,0.2);\n\tbackground-clip: padding-box;\n  }\n  /*logo */\n\n  .l7-ctrl-logo {\n    background-size: 100% 100%;\n    width: 89px;\n    height: 16px;\n    margin: 0 0 -3px -3px;\n    display: flex;\n    background-repeat: no-repeat;\n    cursor: pointer;\n    background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC\');\n}\n\n\n\t/* layers control */\n\n.l7-control-layers {\n\tbox-shadow: 0 1px 8px rgba(0,0,0,0.4);\n\tbackground: #fff;\n\tborder-radius: 2px;\n\t}\n.l7-control-layers-toggle {\n\tbackground-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC\');\n\twidth: 30px;\n  height: 30px;\n  background-size: 20px 20px;\n\t}\n\n.l7-touch .l7-control-layers-toggle {\n\twidth: 44px;\n\theight: 44px;\n\t}\n.l7-control-layers .l7-control-layers-list,\n.l7-control-layers-expanded .l7-control-layers-toggle {\n\tdisplay: none;\n\t}\n.l7-control-layers-expanded .l7-control-layers-list {\n\tdisplay: block;\n\tposition: relative;\n\t}\n.l7-control-layers-expanded {\n\tpadding: 6px 10px 6px 6px;\n\tcolor: #59626B;\n\tbackground: #fff;\n\t}\n.l7-control-layers-scrollbar {\n\toverflow-y: scroll;\n\toverflow-x: hidden;\n\tpadding-right: 5px;\n\t}\n.l7-control-layers-selector {\n\tmargin-top: 2px;\n\tposition: relative;\n\ttop: 1px;\n\t}\n.l7-control-layers label {\n  display: block;\n  padding: 8px;\n  }\n  .l7-control-layers label input[type="radio"],\n  .l7-control-layers label input[type="checkbox"] {\n  width: 14px;\n  height: 14px;\n  margin: 0;\n}\n.l7-control-layers-separator {\n\theight: 0;\n\tborder-top: 1px solid #D8D8D8;\n\tmargin: 5px -10px 5px -6px;\n}\n.mapboxgl-ctrl-logo {\n  display: none !important;\n }\n .amap-logo{\n  display: none !important;\n }\n');var YA,qA,XA,KA,QA,JA,$A,eT,tT,nT,rT,iT,oT,aT,sT=o((function(e,t){e.exports=function(){var e=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},t=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e};function n(e){return"undefined"!=typeof atob?atob(e):"base64:"+e}function r(e){var t=new Error("(regl) "+e);throw console.error(t),t}function i(e,t){e||r(t)}function o(e){return e?": "+e:""}function a(e,t){switch(t){case"number":return"number"==typeof e;case"object":return"object"==typeof e;case"string":return"string"==typeof e;case"boolean":return"boolean"==typeof e;case"function":return"function"==typeof e;case"undefined":return void 0===e;case"symbol":return"symbol"==typeof e}}function s(e,t,n){t.indexOf(e)<0&&r("invalid value"+o(n)+". must be one of: "+t)}var u=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function c(e,t){for(e+="";e.length<t;)e=" "+e;return e}function l(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function f(e,t){this.number=e,this.line=t,this.errors=[]}function h(e,t,n){this.file=e,this.line=t,this.message=n}function d(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function p(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function v(e,t){var r=e.split("\n"),i=1,o=0,a={unknown:new l,0:new l};a.unknown.name=a[0].name=t||d(),a.unknown.lines.push(new f(0,""));for(var s=0;s<r.length;++s){var u=r[s],c=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(c)switch(c[1]){case"line":var h=/(\d+)(\s+\d+)?/.exec(c[2]);h&&(i=0|h[1],h[2]&&((o=0|h[2])in a||(a[o]=new l)));break;case"define":var p=/SHADER_NAME(_B64)?\s+(.*)$/.exec(c[2]);p&&(a[o].name=p[1]?n(p[2]):p[2])}a[o].lines.push(new f(i++,u))}return Object.keys(a).forEach((function(e){var t=a[e];t.lines.forEach((function(e){t.index[e.number]=e}))})),a}function g(e){e._commandRef=d()}function m(e,t){var n=p();r(e+" in command "+(t||d())+("unknown"===n?"":" called from "+n))}function y(e,t,n,r){a(e,t)||m("invalid parameter type"+o(n)+". expected "+t+", got "+typeof e,r||d())}var b={};function _(e,t){return 32820===e||32819===e||33635===e?2:34042===e?4:b[e]*t}function x(e){return!(e&e-1||!e)}b[5120]=b[5121]=1,b[5122]=b[5123]=b[36193]=b[33635]=b[32819]=b[32820]=2,b[5124]=b[5125]=b[5126]=b[34042]=4;var S=t(i,{optional:function(e){e()},raise:r,commandRaise:m,command:function(e,t,n){e||m(t,n||d())},parameter:function(e,t,n){e in t||r("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join())},commandParameter:function(e,t,n,r){e in t||m("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join(),r||d())},constructor:function(e){Object.keys(e).forEach((function(e){u.indexOf(e)<0&&r('invalid regl constructor argument "'+e+'". must be one of '+u)}))},type:function(e,t,n){a(e,t)||r("invalid parameter type"+o(n)+". expected "+t+", got "+typeof e)},commandType:y,isTypedArray:function(t,n){e(t)||r("invalid parameter type"+o(n)+". must be a typed array")},nni:function(e,t){e>=0&&(0|e)===e||r("invalid parameter type, ("+e+")"+o(t)+". must be a nonnegative integer")},oneOf:s,shaderError:function(e,t,n,r,o){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var a=e.getShaderInfoLog(t),s=r===e.FRAGMENT_SHADER?"fragment":"vertex";y(n,"string",s+" shader source must be a string",o);var u=v(n,o),l=function(e){var t=[];return e.split("\n").forEach((function(e){if(!(e.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(e);n?t.push(new h(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new h("unknown",0,e))}})),t}(a);!function(e,t){t.forEach((function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)}))}(u,l),Object.keys(u).forEach((function(e){var t=u[e];if(t.hasErrors){var n=[""],r=[""];i("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach((function(e){if(e.errors.length>0){i(c(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),i(e.line+"\n","color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach((function(n){var r=n.message,o=/^\s*'(.*)'\s*:\s*(.*)$/.exec(r);if(o){var a=o[1];switch(r=o[2],a){case"assign":a="="}t=Math.max(e.line.indexOf(a,t),0)}else t=0;i(c("| ",6)),i(c("^^^",t+3)+"\n","font-weight:bold"),i(c("| ",6)),i(r+"\n","font-weight:bold")})),i(c("| ",6)+"\n")}else i(c(e.number,4)+"|  "),i(e.line+"\n","color:red")})),"undefined"==typeof document||window.chrome?console.log(n.join("")):(r[0]=n.join("%c"),console.log.apply(console,r))}function i(e,t){n.push(e),r.push(t||"")}})),i.raise("Error compiling "+s+" shader, "+u[0].name)}},linkError:function(e,t,n,r,o){if(!e.getProgramParameter(t,e.LINK_STATUS)){var a=e.getProgramInfoLog(t),s=v(n,o),u='Error linking program with vertex shader, "'+v(r,o)[0].name+'", and fragment shader "'+s[0].name+'"';"undefined"!=typeof document?console.log("%c"+u+"\n%c"+a,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(u+"\n"+a),i.raise(u)}},callSite:p,saveCommandRef:g,saveDrawInfo:function(e,t,n,r){function i(e){return e?r.id(e):0}function o(e,t){Object.keys(t).forEach((function(t){e[r.id(t)]=!0}))}g(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var a=e._uniformSet={};o(a,t.static),o(a,t.dynamic);var s=e._attributeSet={};o(s,n.static),o(s,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic},framebufferFormat:function(e,t,n){e.texture?s(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):s(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")},guessCommand:d,texture2D:function(e,t,n){var r,o=t.width,a=t.height,s=t.channels;i(o>0&&o<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),33071===e.wrapS&&33071===e.wrapT||i(x(o)&&x(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==o&&1!==a&&i(9984!==e.minFilter&&9986!==e.minFilter&&9985!==e.minFilter&&9987!==e.minFilter,"min filter requires mipmap"):(i(x(o)&&x(a),"texture must be a square power of 2 to support mipmapping"),i(t.mipmask===(o<<1)-1,"missing or incomplete mipmap data")),5126===t.type&&(n.extensions.indexOf("oes_texture_float_linear")<0&&i(9728===e.minFilter&&9728===e.magFilter,"filter not supported, must enable oes_texture_float_linear"),i(!e.genMipmaps,"mipmap generation not supported with float textures"));var u=t.images;for(r=0;r<16;++r)if(u[r]){var c=o>>r,l=a>>r;i(t.mipmask&1<<r,"missing mipmap data");var f=u[r];if(i(f.width===c&&f.height===l,"invalid shape for mip images"),i(f.format===t.format&&f.internalformat===t.internalformat&&f.type===t.type,"incompatible type for mip image"),f.compressed);else if(f.data){var h=Math.ceil(_(f.type,s)*c/f.unpackAlignment)*f.unpackAlignment;i(f.data.byteLength===h*l,"invalid data for image, buffer size is inconsistent with image format")}else f.element||f.copy}else e.genMipmaps||i(0==(t.mipmask&1<<r),"extra mipmap data");t.compressed&&i(!e.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(e,t,n,r){var o=e.width,a=e.height,s=e.channels;i(o>0&&o<=r.maxTextureSize&&a>0&&a<=r.maxTextureSize,"invalid texture shape"),i(o===a,"cube map must be square"),i(33071===t.wrapS&&33071===t.wrapT,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var c=n[u];i(c.width===o&&c.height===a,"inconsistent cube map face shape"),t.genMipmaps&&(i(!c.compressed,"can not generate mipmap for compressed textures"),i(1===c.mipmask,"can not specify mipmaps and generate mipmaps"));for(var l=c.images,f=0;f<16;++f){var h=l[f];if(h){var d=o>>f,p=a>>f;i(c.mipmask&1<<f,"missing mipmap data"),i(h.width===d&&h.height===p,"invalid shape for mip images"),i(h.format===e.format&&h.internalformat===e.internalformat&&h.type===e.type,"incompatible type for mip image"),h.compressed||(h.data?i(h.data.byteLength===d*p*Math.max(_(h.type,s),h.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):h.element||h.copy)}}}}}),w=0;function A(e,t){this.id=w++,this.type=e,this.data=t}function T(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function E(e){return"["+function e(t){if(0===t.length)return[];var n=t.charAt(0),r=t.charAt(t.length-1);if(t.length>1&&n===r&&('"'===n||"'"===n))return['"'+T(t.substr(1,t.length-2))+'"'];var i=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(i)return e(t.substr(0,i.index)).concat(e(i[1])).concat(e(t.substr(i.index+i[0].length)));var o=t.split(".");if(1===o.length)return['"'+T(t)+'"'];for(var a=[],s=0;s<o.length;++s)a=a.concat(e(o[s]));return a}(e).join("][")+"]"}var C={DynamicVariable:A,define:function(e,t){return new A(e,E(t+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof A},unbox:function e(t,n){return"function"==typeof t?new A(0,t):"number"==typeof t||"boolean"==typeof t?new A(5,t):Array.isArray(t)?new A(6,t.map((t,r)=>e(t,n+"["+r+"]"))):t instanceof A?t:void S(!1,"invalid option type in uniform "+n)},accessor:E},M={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},k="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function O(e){return"string"==typeof e?e.split():(S(Array.isArray(e),"invalid extension array"),e)}function I(e){return"string"==typeof e?(S("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function P(e){var n,r,i,o,a,s=e||{},u={},c=[],l=[],f="undefined"==typeof window?1:window.devicePixelRatio,h=!1,d=function(e){e&&S.raise(e)},p=function(){};if("string"==typeof s?(S("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),n=document.querySelector(s),S(n,"invalid query string for element")):"object"==typeof s?"string"==typeof(a=s).nodeName&&"function"==typeof a.appendChild&&"function"==typeof a.getBoundingClientRect?n=s:function(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}(s)?i=(o=s).canvas:(S.constructor(s),"gl"in s?o=s.gl:"canvas"in s?i=I(s.canvas):"container"in s&&(r=I(s.container)),"attributes"in s&&(u=s.attributes,S.type(u,"object","invalid context attributes")),"extensions"in s&&(c=O(s.extensions)),"optionalExtensions"in s&&(l=O(s.optionalExtensions)),"onDone"in s&&(S.type(s.onDone,"function","invalid or missing onDone callback"),d=s.onDone),"profile"in s&&(h=!!s.profile),"pixelRatio"in s&&(f=+s.pixelRatio,S(f>0,"invalid pixel ratio"))):S.raise("invalid arguments to regl"),n&&("canvas"===n.nodeName.toLowerCase()?i=n:r=n),!o){if(!i){S("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var v=function(e,n,r){var i,o=document.createElement("canvas");function a(){var n=window.innerWidth,i=window.innerHeight;if(e!==document.body){var a=e.getBoundingClientRect();n=a.right-a.left,i=a.bottom-a.top}o.width=r*n,o.height=r*i,t(o.style,{width:n+"px",height:i+"px"})}return t(o.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(o),e===document.body&&(o.style.position="absolute",t(e.style,{margin:0,padding:0})),e!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(a)}))).observe(e):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:function(){i?i.disconnect():window.removeEventListener("resize",a),e.removeChild(o)}}}(r||document.body,0,f);if(!v)return null;i=v.canvas,p=v.onDestroy}void 0===u.premultipliedAlpha&&(u.premultipliedAlpha=!0),o=function(e,t){function n(n){try{return e.getContext(n,t)}catch(e){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}(i,u)}return o?{gl:o,canvas:i,container:r,extensions:c,optionalExtensions:l,pixelRatio:f,profile:h,onDone:d,onDestroy:p}:(p(),d("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function L(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}function R(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function N(){var e=L(8,(function(){return[]}));function t(t){var n=function(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}(t),r=e[R(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(t){e[R(t.byteLength)>>2].push(t)}return{alloc:t,free:n,allocType:function(e,n){var r=null;switch(e){case 5120:r=new Int8Array(t(n),0,n);break;case 5121:r=new Uint8Array(t(n),0,n);break;case 5122:r=new Int16Array(t(2*n),0,n);break;case 5123:r=new Uint16Array(t(2*n),0,n);break;case 5124:r=new Int32Array(t(4*n),0,n);break;case 5125:r=new Uint32Array(t(4*n),0,n);break;case 5126:r=new Float32Array(t(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r},freeType:function(e){n(e.buffer)}}}var D=N();function F(t){return!!t&&"object"==typeof t&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}D.zero=N();var z=function(e){return Object.keys(e).map((function(t){return e[t]}))},j={shape:function(e){for(var t=[],n=e;n.length;n=n[0])t.push(n.length);return t},flatten:function(e,t,n,r){var i=1;if(t.length)for(var o=0;o<t.length;++o)i*=t[o];else i=0;var a=r||D.allocType(n,i);switch(t.length){case 0:break;case 1:!function(e,t,n){for(var r=0;r<t;++r)n[r]=e[r]}(e,t[0],a);break;case 2:!function(e,t,n,r){for(var i=0,o=0;o<t;++o)for(var a=e[o],s=0;s<n;++s)r[i++]=a[s]}(e,t[0],t[1],a);break;case 3:U(e,t[0],t[1],t[2],a,0);break;default:!function e(t,n,r,i,o){for(var a=1,s=r+1;s<n.length;++s)a*=n[s];var u=n[r];if(n.length-r==4){var c=n[r+1],l=n[r+2],f=n[r+3];for(s=0;s<u;++s)U(t[s],c,l,f,i,o),o+=a}else for(s=0;s<u;++s)e(t[s],n,r+1,i,o),o+=a}(e,t,0,a,0)}return a}};function U(e,t,n,r,i,o){for(var a=o,s=0;s<t;++s)for(var u=e[s],c=0;c<n;++c)for(var l=u[c],f=0;f<r;++f)i[a++]=l[f]}var B={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},V={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},H={dynamic:35048,stream:35040,static:35044},G=j.flatten,W=j.shape,Z=[];function Y(e){return 0|B[Object.prototype.toString.call(e)]}function q(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function X(e,t,n,r,i,o,a){for(var s=0,u=0;u<n;++u)for(var c=0;c<r;++c)e[s++]=t[i*u+o*c+a]}Z[5120]=1,Z[5122]=2,Z[5124]=4,Z[5121]=1,Z[5123]=2,Z[5125]=4,Z[5126]=4;var K={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Q=new Float32Array(1),J=new Uint32Array(Q.buffer);function $(e){for(var t=D.allocType(5123,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-1/0)t[n]=64512;else{Q[0]=e[n];var r=J[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)t[n]=i;else if(o<-14){var s=-14-o;t[n]=i+(a+1024>>s)}else t[n]=o>15?i+31744:i+(o+15<<10)+a}return t}function ee(t){return Array.isArray(t)||e(t)}var te=function(e){return!(e&e-1||!e)},ne=[9984,9986,9985,9987],re=[0,6409,6410,6407,6408],ie={};function oe(e){return"[object "+e+"]"}ie[6409]=ie[6406]=ie[6402]=1,ie[34041]=ie[6410]=2,ie[6407]=ie[35904]=3,ie[6408]=ie[35906]=4;var ae=oe("HTMLCanvasElement"),se=oe("OffscreenCanvas"),ue=oe("CanvasRenderingContext2D"),ce=oe("ImageBitmap"),le=oe("HTMLImageElement"),fe=oe("HTMLVideoElement"),he=Object.keys(B).concat([ae,se,ue,ce,le,fe]),de=[];de[5121]=1,de[5126]=4,de[36193]=2,de[5123]=2,de[5125]=4;var pe=[];function ve(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function ge(e){return!!Array.isArray(e)&&!(0===e.length||!ee(e[0]))}function me(e){return Object.prototype.toString.call(e)}function ye(e){return me(e)===ae}function be(e){return me(e)===se}function _e(e){if(!e)return!1;var t=me(e);return he.indexOf(t)>=0||ve(e)||ge(e)||F(e)}function xe(e){return 0|B[Object.prototype.toString.call(e)]}function Se(e,t){return D.allocType(36193===e.type?5126:e.type,t)}function we(e,t){36193===e.type?(e.data=$(t),D.freeType(t)):e.data=t}function Ae(e,t,n,r,i,o){var a;if(a=void 0!==pe[e]?pe[e]:ie[e]*de[t],o&&(a*=6),i){for(var s=0,u=n;u>=1;)s+=a*u*u,u/=2;return s}return a*n*r}function Te(n,r,i,o,a,s,u){var c={"don't care":4352,"dont care":4352,nice:4354,fast:4353},l={repeat:10497,clamp:33071,mirror:33648},f={nearest:9728,linear:9729},h=t({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},f),d={none:0,browser:37444},p={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},v={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},g={};r.ext_srgb&&(v.srgb=35904,v.srgba=35906),r.oes_texture_float&&(p.float32=p.float=5126),r.oes_texture_half_float&&(p.float16=p["half float"]=36193),r.webgl_depth_texture&&(t(v,{depth:6402,"depth stencil":34041}),t(p,{uint16:5123,uint32:5125,"depth stencil":34042})),r.webgl_compressed_texture_s3tc&&t(g,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779}),r.webgl_compressed_texture_atc&&t(g,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),r.webgl_compressed_texture_pvrtc&&t(g,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),r.webgl_compressed_texture_etc1&&(g["rgb etc1"]=36196);var m=Array.prototype.slice.call(n.getParameter(34467));Object.keys(g).forEach((function(e){var t=g[e];m.indexOf(t)>=0&&(v[e]=t)}));var y=Object.keys(v);i.textureFormats=y;var b=[];Object.keys(v).forEach((function(e){var t=v[e];b[t]=e}));var _=[];Object.keys(p).forEach((function(e){var t=p[e];_[t]=e}));var x=[];Object.keys(f).forEach((function(e){x[f[e]]=e}));var w=[];Object.keys(h).forEach((function(e){var t=h[e];w[t]=e}));var A=[];Object.keys(l).forEach((function(e){A[l[e]]=e}));var T=y.reduce((function(e,t){var n=v[t];return 6409===n||6406===n||6409===n||6410===n||6402===n||34041===n||r.ext_srgb&&(35904===n||35906===n)?e[n]=n:32855===n||t.indexOf("rgba")>=0?e[n]=6408:e[n]=6407,e}),{});function E(){this.internalformat=6408,this.format=6408,this.type=5121,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=37444,this.width=0,this.height=0,this.channels=0}function C(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function M(e,t){if("object"==typeof t&&t){if("premultiplyAlpha"in t&&(S.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(S.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(S.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(S.parameter(t.colorSpace,d,"invalid colorSpace"),e.colorSpace=d[t.colorSpace]),"type"in t){var n=t.type;S(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),S(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),S(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),S.parameter(n,p,"invalid texture type"),e.type=p[n]}var o=e.width,a=e.height,s=e.channels,u=!1;"shape"in t?(S(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),o=t.shape[0],a=t.shape[1],3===t.shape.length&&(s=t.shape[2],S(s>0&&s<=4,"invalid number of channels"),u=!0),S(o>=0&&o<=i.maxTextureSize,"invalid width"),S(a>=0&&a<=i.maxTextureSize,"invalid height")):("radius"in t&&(o=a=t.radius,S(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in t&&(o=t.width,S(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in t&&(a=t.height,S(a>=0&&a<=i.maxTextureSize,"invalid height")),"channels"in t&&(s=t.channels,S(s>0&&s<=4,"invalid number of channels"),u=!0)),e.width=0|o,e.height=0|a,e.channels=0|s;var c=!1;if("format"in t){var l=t.format;S(r.webgl_depth_texture||!("depth"===l||"depth stencil"===l),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),S.parameter(l,v,"invalid texture format");var f=e.internalformat=v[l];e.format=T[f],l in p&&("type"in t||(e.type=p[l])),l in g&&(e.compressed=!0),c=!0}!u&&c?e.channels=ie[e.format]:u&&!c?e.channels!==re[e.format]&&(e.format=e.internalformat=re[e.channels]):c&&u&&S(e.channels===ie[e.format],"number of channels inconsistent with specified format")}}function k(e){n.pixelStorei(37440,e.flipY),n.pixelStorei(37441,e.premultiplyAlpha),n.pixelStorei(37443,e.colorSpace),n.pixelStorei(3317,e.unpackAlignment)}function O(){E.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function I(t,n){var r=null;if(_e(n)?r=n:n&&(S.type(n,"object","invalid pixel data type"),M(t,n),"x"in n&&(t.xOffset=0|n.x),"y"in n&&(t.yOffset=0|n.y),_e(n.data)&&(r=n.data)),S(!t.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){S(!r,"can not specify copy and data field for the same texture");var o=a.viewportWidth,s=a.viewportHeight;t.width=t.width||o-t.xOffset,t.height=t.height||s-t.yOffset,t.needsCopy=!0,S(t.xOffset>=0&&t.xOffset<o&&t.yOffset>=0&&t.yOffset<s&&t.width>0&&t.width<=o&&t.height>0&&t.height<=s,"copy texture read out of bounds")}else if(r){if(e(r))t.channels=t.channels||4,t.data=r,"type"in n||5121!==t.type||(t.type=xe(r));else if(ve(r))t.channels=t.channels||4,function(e,t){var n=t.length;switch(e.type){case 5121:case 5123:case 5125:case 5126:var r=D.allocType(e.type,n);r.set(t),e.data=r;break;case 36193:e.data=$(t);break;default:S.raise("unsupported texture type, must specify a typed array")}}(t,r),t.alignment=1,t.needsFree=!0;else if(F(r)){var u=r.data;Array.isArray(u)||5121!==t.type||(t.type=xe(u));var c,l,f,h,d,p,v=r.shape,g=r.stride;3===v.length?(f=v[2],p=g[2]):(S(2===v.length,"invalid ndarray pixel data, must be 2 or 3D"),f=1,p=1),c=v[0],l=v[1],h=g[0],d=g[1],t.alignment=1,t.width=c,t.height=l,t.channels=f,t.format=t.internalformat=re[f],t.needsFree=!0,function(e,t,n,r,i,o){for(var a=e.width,s=e.height,u=e.channels,c=Se(e,a*s*u),l=0,f=0;f<s;++f)for(var h=0;h<a;++h)for(var d=0;d<u;++d)c[l++]=t[n*h+r*f+i*d+o];we(e,c)}(t,u,h,d,p,r.offset)}else if(ye(r)||be(r)||function(e){return me(e)===ue}(r))ye(r)||be(r)?t.element=r:t.element=r.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(function(e){return me(e)===ce}(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(function(e){return me(e)===le}(r))t.element=r,t.width=r.naturalWidth,t.height=r.naturalHeight,t.channels=4;else if(function(e){return me(e)===fe}(r))t.element=r,t.width=r.videoWidth,t.height=r.videoHeight,t.channels=4;else if(ge(r)){var m=t.width||r[0].length,y=t.height||r.length,b=t.channels;b=ee(r[0][0])?b||r[0][0].length:b||1;for(var _=j.shape(r),x=1,w=0;w<_.length;++w)x*=_[w];var A=Se(t,x);j.flatten(r,_,"",A),we(t,A),t.alignment=1,t.width=m,t.height=y,t.channels=b,t.format=t.internalformat=re[b],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;5126===t.type?S(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):36193===t.type&&S(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function P(e,t,r){var i=e.element,a=e.data,s=e.internalformat,u=e.format,c=e.type,l=e.width,f=e.height;k(e),i?n.texImage2D(t,r,u,u,c,i):e.compressed?n.compressedTexImage2D(t,r,s,l,f,0,a):e.needsCopy?(o(),n.copyTexImage2D(t,r,u,e.xOffset,e.yOffset,l,f,0)):n.texImage2D(t,r,u,l,f,0,u,c,a||null)}function L(e,t,r,i,a){var s=e.element,u=e.data,c=e.internalformat,l=e.format,f=e.type,h=e.width,d=e.height;k(e),s?n.texSubImage2D(t,a,r,i,l,f,s):e.compressed?n.compressedTexSubImage2D(t,a,r,i,c,h,d,u):e.needsCopy?(o(),n.copyTexSubImage2D(t,a,r,i,e.xOffset,e.yOffset,h,d)):n.texSubImage2D(t,a,r,i,h,d,l,f,u)}var R=[];function N(){return R.pop()||new O}function U(e){e.needsFree&&D.freeType(e.data),O.call(e),R.push(e)}function B(){E.call(this),this.genMipmaps=!1,this.mipmapHint=4352,this.mipmask=0,this.images=Array(16)}function V(e,t,n){var r=e.images[0]=N();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function H(e,t){var n=null;if(_e(t))C(n=e.images[0]=N(),e),I(n,t),e.mipmask=1;else if(M(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)C(n=e.images[i]=N(),e),n.width>>=i,n.height>>=i,I(n,r[i]),e.mipmask|=1<<i;else C(n=e.images[0]=N(),e),I(n,t),e.mipmask=1;C(e,e.images[0]),!e.compressed||33776!==e.internalformat&&33777!==e.internalformat&&33778!==e.internalformat&&33779!==e.internalformat||S(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function G(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;P(n[r],t,r)}}var W=[];function Z(){var e=W.pop()||new B;E.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function Y(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&U(t[n]),t[n]=null;W.push(e)}function q(){this.minFilter=9728,this.magFilter=9728,this.wrapS=33071,this.wrapT=33071,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=4352}function X(e,t){if("min"in t){var n=t.min;S.parameter(n,h),e.minFilter=h[n],ne.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var r=t.mag;S.parameter(r,f),e.magFilter=f[r]}var o=e.wrapS,a=e.wrapT;if("wrap"in t){var s=t.wrap;"string"==typeof s?(S.parameter(s,l),o=a=l[s]):Array.isArray(s)&&(S.parameter(s[0],l),S.parameter(s[1],l),o=l[s[0]],a=l[s[1]])}else{if("wrapS"in t){var u=t.wrapS;S.parameter(u,l),o=l[u]}if("wrapT"in t){var d=t.wrapT;S.parameter(d,l),a=l[d]}}if(e.wrapS=o,e.wrapT=a,"anisotropic"in t){var p=t.anisotropic;S("number"==typeof p&&p>=1&&p<=i.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var v=!1;switch(typeof t.mipmap){case"string":S.parameter(t.mipmap,c,"invalid mipmap hint"),e.mipmapHint=c[t.mipmap],e.genMipmaps=!0,v=!0;break;case"boolean":v=e.genMipmaps=t.mipmap;break;case"object":S(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,v=!0;break;default:S.raise("invalid mipmap type")}v&&!("min"in t)&&(e.minFilter=9984)}}function K(e,t){n.texParameteri(t,10241,e.minFilter),n.texParameteri(t,10240,e.magFilter),n.texParameteri(t,10242,e.wrapS),n.texParameteri(t,10243,e.wrapT),r.ext_texture_filter_anisotropic&&n.texParameteri(t,34046,e.anisotropic),e.genMipmaps&&(n.hint(33170,e.mipmapHint),n.generateMipmap(t))}var Q=0,J={},oe=i.maxTextureUnits,ae=Array(oe).map((function(){return null}));function se(e){E.call(this),this.mipmask=0,this.internalformat=6408,this.id=Q++,this.refCount=1,this.target=e,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new q,u.profile&&(this.stats={size:0})}function he(e){n.activeTexture(33984),n.bindTexture(e.target,e.texture)}function de(){var e=ae[0];e?n.bindTexture(e.target,e.texture):n.bindTexture(3553,null)}function pe(e){var t=e.texture;S(t,"must not double destroy texture");var r=e.unit,i=e.target;r>=0&&(n.activeTexture(33984+r),n.bindTexture(i,null),ae[r]=null),n.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete J[e.id],s.textureCount--}return t(se.prototype,{bind:function(){this.bindCount+=1;var e=this.unit;if(e<0){for(var t=0;t<oe;++t){var r=ae[t];if(r){if(r.bindCount>0)continue;r.unit=-1}ae[t]=this,e=t;break}e>=oe&&S.raise("insufficient number of texture units"),u.profile&&s.maxTextureUnits<e+1&&(s.maxTextureUnits=e+1),this.unit=e,n.activeTexture(33984+e),n.bindTexture(this.target,this.texture)}return e},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&pe(this)}}),u.profile&&(s.getTotalTextureSize=function(){var e=0;return Object.keys(J).forEach((function(t){e+=J[t].stats.size})),e}),{create2D:function(e,t){var r=new se(3553);function o(e,t){var n=r.texInfo;q.call(n);var a=Z();return"number"==typeof e?V(a,0|e,"number"==typeof t?0|t:0|e):e?(S.type(e,"object","invalid arguments to regl.texture"),X(n,e),H(a,e)):V(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,C(r,a),S.texture2D(n,a,i),r.internalformat=a.internalformat,o.width=a.width,o.height=a.height,he(r),G(a,3553),K(n,3553),de(),Y(a),u.profile&&(r.stats.size=Ae(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),o.format=b[r.internalformat],o.type=_[r.type],o.mag=x[n.magFilter],o.min=w[n.minFilter],o.wrapS=A[n.wrapS],o.wrapT=A[n.wrapT],o}return J[r.id]=r,s.textureCount++,o(e,t),o.subimage=function(e,t,n,i){S(!!e,"must specify image data");var a=0|t,s=0|n,u=0|i,c=N();return C(c,r),c.width=0,c.height=0,I(c,e),c.width=c.width||(r.width>>u)-a,c.height=c.height||(r.height>>u)-s,S(r.type===c.type&&r.format===c.format&&r.internalformat===c.internalformat,"incompatible format for texture.subimage"),S(a>=0&&s>=0&&a+c.width<=r.width&&s+c.height<=r.height,"texture.subimage write out of bounds"),S(r.mipmask&1<<u,"missing mipmap data"),S(c.data||c.element||c.needsCopy,"missing image data"),he(r),L(c,3553,a,s,u),de(),U(c),o},o.resize=function(e,t){var i=0|e,a=0|t||i;if(i===r.width&&a===r.height)return o;o.width=r.width=i,o.height=r.height=a,he(r);for(var s=0;r.mipmask>>s;++s){var c=i>>s,l=a>>s;if(!c||!l)break;n.texImage2D(3553,s,r.format,c,l,0,r.format,r.type,null)}return de(),u.profile&&(r.stats.size=Ae(r.internalformat,r.type,i,a,!1,!1)),o},o._reglType="texture2d",o._texture=r,u.profile&&(o.stats=r.stats),o.destroy=function(){r.decRef()},o},createCube:function(e,t,r,o,a,c){var l=new se(34067);J[l.id]=l,s.cubeCount++;var f=new Array(6);function h(e,t,n,r,o,a){var s,c=l.texInfo;for(q.call(c),s=0;s<6;++s)f[s]=Z();if("number"!=typeof e&&e)if("object"==typeof e)if(t)H(f[0],e),H(f[1],t),H(f[2],n),H(f[3],r),H(f[4],o),H(f[5],a);else if(X(c,e),M(l,e),"faces"in e){var d=e.faces;for(S(Array.isArray(d)&&6===d.length,"cube faces must be a length 6 array"),s=0;s<6;++s)S("object"==typeof d[s]&&!!d[s],"invalid input for cube map face"),C(f[s],l),H(f[s],d[s])}else for(s=0;s<6;++s)H(f[s],e);else S.raise("invalid arguments to cube map");else{var p=0|e||1;for(s=0;s<6;++s)V(f[s],p,p)}for(C(l,f[0]),i.npotTextureCube||S(te(l.width)&&te(l.height),"your browser does not support non power or two texture dimensions"),c.genMipmaps?l.mipmask=(f[0].width<<1)-1:l.mipmask=f[0].mipmask,S.textureCube(l,c,f,i),l.internalformat=f[0].internalformat,h.width=f[0].width,h.height=f[0].height,he(l),s=0;s<6;++s)G(f[s],34069+s);for(K(c,34067),de(),u.profile&&(l.stats.size=Ae(l.internalformat,l.type,h.width,h.height,c.genMipmaps,!0)),h.format=b[l.internalformat],h.type=_[l.type],h.mag=x[c.magFilter],h.min=w[c.minFilter],h.wrapS=A[c.wrapS],h.wrapT=A[c.wrapT],s=0;s<6;++s)Y(f[s]);return h}return h(e,t,r,o,a,c),h.subimage=function(e,t,n,r,i){S(!!t,"must specify image data"),S("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var o=0|n,a=0|r,s=0|i,u=N();return C(u,l),u.width=0,u.height=0,I(u,t),u.width=u.width||(l.width>>s)-o,u.height=u.height||(l.height>>s)-a,S(l.type===u.type&&l.format===u.format&&l.internalformat===u.internalformat,"incompatible format for texture.subimage"),S(o>=0&&a>=0&&o+u.width<=l.width&&a+u.height<=l.height,"texture.subimage write out of bounds"),S(l.mipmask&1<<s,"missing mipmap data"),S(u.data||u.element||u.needsCopy,"missing image data"),he(l),L(u,34069+e,o,a,s),de(),U(u),h},h.resize=function(e){var t=0|e;if(t!==l.width){h.width=l.width=t,h.height=l.height=t,he(l);for(var r=0;r<6;++r)for(var i=0;l.mipmask>>i;++i)n.texImage2D(34069+r,i,l.format,t>>i,t>>i,0,l.format,l.type,null);return de(),u.profile&&(l.stats.size=Ae(l.internalformat,l.type,h.width,h.height,!1,!0)),h}},h._reglType="textureCube",h._texture=l,u.profile&&(h.stats=l.stats),h.destroy=function(){l.decRef()},h},clear:function(){for(var e=0;e<oe;++e)n.activeTexture(33984+e),n.bindTexture(3553,null),ae[e]=null;z(J).forEach(pe),s.cubeCount=0,s.textureCount=0},getTexture:function(e){return null},restore:function(){for(var e=0;e<oe;++e){var t=ae[e];t&&(t.bindCount=0,t.unit=-1,ae[e]=null)}z(J).forEach((function(e){e.texture=n.createTexture(),n.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!=(e.mipmask&1<<t))if(3553===e.target)n.texImage2D(3553,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)n.texImage2D(34069+r,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);K(e.texInfo,e.target)}))},refresh:function(){for(var e=0;e<oe;++e){var t=ae[e];t&&(t.bindCount=0,t.unit=-1,ae[e]=null),n.activeTexture(33984+e),n.bindTexture(3553,null),n.bindTexture(34067,null)}}}}pe[32854]=2,pe[32855]=2,pe[36194]=2,pe[34041]=4,pe[33776]=.5,pe[33777]=.5,pe[33778]=1,pe[33779]=1,pe[35986]=.5,pe[35987]=1,pe[34798]=1,pe[35840]=.5,pe[35841]=.25,pe[35842]=.5,pe[35843]=.25,pe[36196]=.5;var Ee=[];function Ce(e,t,n){return Ee[e]*t*n}Ee[32854]=2,Ee[32855]=2,Ee[36194]=2,Ee[33189]=2,Ee[36168]=1,Ee[34041]=4,Ee[35907]=4,Ee[34836]=16,Ee[34842]=8,Ee[34843]=6;var Me=[6407,6408],ke=[];ke[6408]=4,ke[6407]=3;var Oe=[];Oe[5121]=1,Oe[5126]=4,Oe[36193]=2;var Ie=[32854,32855,36194,35907,34842,34843,34836],Pe={};function Le(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.offset=0,this.stride=0,this.divisor=0}function Re(t,n,r,i,o,a,s){function u(u){var c;null===n.next?(S(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),c=5121):(S(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),c=n.next.colorAttachments[0].texture._texture.type,a.oes_texture_float?(S(5121===c||5126===c,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),5126===c&&S(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):S(5121===c,"Reading from a framebuffer is only allowed for the type 'uint8'"));var l=0,f=0,h=i.framebufferWidth,d=i.framebufferHeight,p=null;e(u)?p=u:u&&(S.type(u,"object","invalid arguments to regl.read()"),l=0|u.x,f=0|u.y,S(l>=0&&l<i.framebufferWidth,"invalid x offset for regl.read"),S(f>=0&&f<i.framebufferHeight,"invalid y offset for regl.read"),h=0|(u.width||i.framebufferWidth-l),d=0|(u.height||i.framebufferHeight-f),p=u.data||null),p&&(5121===c?S(p instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):5126===c&&S(p instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),S(h>0&&h+l<=i.framebufferWidth,"invalid width for read pixels"),S(d>0&&d+f<=i.framebufferHeight,"invalid height for read pixels"),r();var v=h*d*4;return p||(5121===c?p=new Uint8Array(v):5126===c&&(p=p||new Float32Array(v))),S.isTypedArray(p,"data buffer for regl.read() must be a typedarray"),S(p.byteLength>=v,"data buffer for regl.read() too small"),t.pixelStorei(3333,4),t.readPixels(l,f,h,d,6408,c,p),p}return function(e){return e&&"framebuffer"in e?function(e){var t;return n.setFBO({framebuffer:e.framebuffer},(function(){t=u(e)})),t}(e):u(e)}}function Ne(e){return Array.prototype.slice.call(e)}function De(e){return Ne(e).join("")}Pe[36053]="complete",Pe[36054]="incomplete attachment",Pe[36057]="incomplete dimensions",Pe[36055]="incomplete, missing attachment",Pe[36061]="unsupported";var Fe="xyzw".split(""),ze="profile",je="framebuffer",Ue="vert",Be="frag",Ve="elements",He="primitive",Ge="count",We="offset",Ze="instances",Ye="vao",qe=je+"Width",Xe=je+"Height",Ke=["blend.func","blend.equation","stencil.func","stencil.opFront","stencil.opBack","sample.coverage","viewport","scissor.box","polygonOffset.offset"],Qe={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Je=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],$e={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},et={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},tt={frag:35632,vert:35633},nt={cw:2304,ccw:2305};function rt(t){return Array.isArray(t)||e(t)||F(t)}function it(e){return e.sort((function(e,t){return"viewport"===e?-1:"viewport"===t?1:e<t?-1:1}))}function ot(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function at(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function st(e){return new ot(!1,!1,!1,e)}function ut(e,t){var n=e.type;if(0===n){var r=e.data.length;return new ot(!0,r>=1,r>=2,t)}if(4===n){var i=e.data;return new ot(i.thisDep,i.contextDep,i.propDep,t)}if(5===n)return new ot(!1,!1,!1,t);if(6===n){for(var o=!1,a=!1,s=!1,u=0;u<e.data.length;++u){var c=e.data[u];if(1===c.type)s=!0;else if(2===c.type)a=!0;else if(3===c.type)o=!0;else if(0===c.type){o=!0;var l=c.data;l>=1&&(a=!0),l>=2&&(s=!0)}else 4===c.type&&(o=o||c.data.thisDep,a=a||c.data.contextDep,s=s||c.data.propDep)}return new ot(o,a,s,t)}return new ot(3===n,2===n,1===n,t)}var ct=new ot(!1,!1,!1,(function(){}));function lt(e,n,r,i,o,a,s,u,c,l,f,h,d,p,v){var g=l.Record,m={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(m.min=32775,m.max=32776);var y=r.angle_instanced_arrays,b=r.webgl_draw_buffers,_={dirty:!0,profile:v.profile},x={},w=[],A={},T={};function E(e){return e.replace(".","_")}function M(e,t,n){var r=E(e);w.push(e),x[r]=_[r]=!!n,A[r]=t}function k(e,t,n){var r=E(e);w.push(e),Array.isArray(n)?(_[r]=n.slice(),x[r]=n.slice()):_[r]=x[r]=n,T[r]=t}M("dither",3024),M("blend.enable",3042),k("blend.color","blendColor",[0,0,0,0]),k("blend.equation","blendEquationSeparate",[32774,32774]),k("blend.func","blendFuncSeparate",[1,0,1,0]),M("depth.enable",2929,!0),k("depth.func","depthFunc",513),k("depth.range","depthRange",[0,1]),k("depth.mask","depthMask",!0),k("colorMask","colorMask",[!0,!0,!0,!0]),M("cull.enable",2884),k("cull.face","cullFace",1029),k("frontFace","frontFace",2305),k("lineWidth","lineWidth",1),M("polygonOffset.enable",32823),k("polygonOffset.offset","polygonOffset",[0,0]),M("sample.alpha",32926),M("sample.enable",32928),k("sample.coverage","sampleCoverage",[1,!1]),M("stencil.enable",2960),k("stencil.mask","stencilMask",-1),k("stencil.func","stencilFunc",[519,0,-1]),k("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]),k("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]),M("scissor.enable",3089),k("scissor.box","scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),k("viewport","viewport",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var O={gl:e,context:d,strings:n,next:x,current:_,draw:h,elements:a,buffer:o,shader:f,attributes:l.state,vao:l,uniforms:c,framebuffer:u,extensions:r,timer:p,isBufferArgs:rt},I={primTypes:K,compareFuncs:$e,blendFuncs:Qe,blendEquations:m,stencilOps:et,glTypes:V,orientationType:nt};S.optional((function(){O.isArrayLike=ee})),b&&(I.backBuffer=[1029],I.drawBuffer=L(i.maxDrawbuffers,(function(e){return 0===e?[0]:L(e,(function(e){return 36064+e}))})));var P=0;function R(){var e=function(){var e=0,n=[],r=[];function i(){var n=[],r=[];return t((function(){n.push.apply(n,Ne(arguments))}),{def:function(){var t="v"+e++;return r.push(t),arguments.length>0&&(n.push(t,"="),n.push.apply(n,Ne(arguments)),n.push(";")),t},toString:function(){return De([r.length>0?"var "+r.join(",")+";":"",De(n)])}})}function o(){var e=i(),n=i(),r=e.toString,o=n.toString;function a(t,r){n(t,r,"=",e.def(t,r),";")}return t((function(){e.apply(e,Ne(arguments))}),{def:e.def,entry:e,exit:n,save:a,set:function(t,n,r){a(t,n),e(t,n,"=",r,";")},toString:function(){return r()+o()}})}var a=i(),s={};return{global:a,link:function(t){for(var i=0;i<r.length;++i)if(r[i]===t)return n[i];var o="g"+e++;return n.push(o),r.push(t),o},block:i,proc:function(e,n){var r=[];function i(){var e="a"+r.length;return r.push(e),e}n=n||0;for(var a=0;a<n;++a)i();var u=o(),c=u.toString;return s[e]=t(u,{arg:i,toString:function(){return De(["function(",r.join(),"){",c(),"}"])}})},scope:o,cond:function(){var e=De(arguments),n=o(),r=o(),i=n.toString,a=r.toString;return t(n,{then:function(){return n.apply(n,Ne(arguments)),this},else:function(){return r.apply(r,Ne(arguments)),this},toString:function(){var t=a();return t&&(t="else{"+t+"}"),De(["if(",e,"){",i(),"}",t])}})},compile:function(){var e=['"use strict";',a,"return {"];Object.keys(s).forEach((function(t){e.push('"',t,'":',s[t].toString(),",")})),e.push("}");var t=De(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(t)).apply(null,r)}}}(),r=e.link,i=e.global;e.id=P++,e.batchId="0";var o=r(O),a=e.shared={props:"a0"};Object.keys(O).forEach((function(e){a[e]=i.def(o,".",e)})),S.optional((function(){e.CHECK=r(S),e.commandStr=S.guessCommand(),e.command=r(e.commandStr),e.assert=function(e,t,n){e("if(!(",t,"))",this.CHECK,".commandRaise(",r(n),",",this.command,");")},I.invalidBlendCombinations=Je}));var s=e.next={},u=e.current={};Object.keys(T).forEach((function(e){Array.isArray(_[e])&&(s[e]=i.def(a.next,".",e),u[e]=i.def(a.current,".",e))}));var c=e.constants={};Object.keys(I).forEach((function(e){c[e]=i.def(JSON.stringify(I[e]))})),e.invoke=function(t,n){switch(n.type){case 0:var i=["this",a.context,a.props,e.batchId];return t.def(r(n.data),".call(",i.slice(0,Math.max(n.data.length+1,4)),")");case 1:return t.def(a.props,n.data);case 2:return t.def(a.context,n.data);case 3:return t.def("this",n.data);case 4:return n.data.append(e,t),n.data.ref;case 5:return n.data.toString();case 6:return n.data.map((function(n){return e.invoke(t,n)}))}},e.attribCache={};var f={};return e.scopeAttrib=function(e){var t=n.id(e);if(t in f)return f[t];var i=l.scope[t];return i||(i=l.scope[t]=new g),f[t]=r(i)},e}function N(e,t,s,c,h){var d=e.static,p=e.dynamic;S.optional((function(){var e=[je,Ue,Be,Ve,He,We,Ge,Ze,ze,Ye].concat(w);function t(t){Object.keys(t).forEach((function(t){S.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',h.commandStr)}))}t(d),t(p)}));var v=function(e,t){var n=e.static;if("string"==typeof n[Be]&&"string"==typeof n[Ue]){if(Object.keys(t.dynamic).length>0)return null;var r=t.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var o=[],a=0;a<i.length;++a)S("number"==typeof r[i[a]],"must specify all vertex attribute locations when using vaos"),o.push([0|r[i[a]],i[a]]);return o}}return null}(e,t),b=function(e,t){var n=e.static,r=e.dynamic;if(je in n){var i=n[je];return i?(i=u.getFramebuffer(i),S.command(i,"invalid framebuffer object"),st((function(e,t){var n=e.link(i),r=e.shared;t.set(r.framebuffer,".next",n);var o=r.context;return t.set(o,"."+qe,n+".width"),t.set(o,"."+Xe,n+".height"),n}))):st((function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+qe,r+".drawingBufferWidth"),t.set(r,"."+Xe,r+".drawingBufferHeight"),"null"}))}if(je in r){var o=r[je];return ut(o,(function(e,t){var n=e.invoke(t,o),r=e.shared,i=r.framebuffer,a=t.def(i,".getFramebuffer(",n,")");S.optional((function(){e.assert(t,"!"+n+"||"+a,"invalid framebuffer object")})),t.set(i,".next",a);var s=r.context;return t.set(s,"."+qe,a+"?"+a+".width:"+s+".drawingBufferWidth"),t.set(s,"."+Xe,a+"?"+a+".height:"+s+".drawingBufferHeight"),a}))}return null}(e),_=function(e,t,n){var r=e.static,i=e.dynamic;function o(e){if(e in r){var o=r[e];S.commandType(o,"object","invalid "+e,n.commandStr);var a,s,u=!0,c=0|o.x,l=0|o.y;return"width"in o?(a=0|o.width,S.command(a>=0,"invalid "+e,n.commandStr)):u=!1,"height"in o?(s=0|o.height,S.command(s>=0,"invalid "+e,n.commandStr)):u=!1,new ot(!u&&t&&t.thisDep,!u&&t&&t.contextDep,!u&&t&&t.propDep,(function(e,t){var n=e.shared.context,r=a;"width"in o||(r=t.def(n,".",qe,"-",c));var i=s;return"height"in o||(i=t.def(n,".",Xe,"-",l)),[c,l,r,i]}))}if(e in i){var f=i[e],h=ut(f,(function(t,n){var r=t.invoke(n,f);S.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}));var i=t.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",qe,"-",o,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",Xe,"-",a,")");return S.optional((function(){t.assert(n,s+">=0&&"+u+">=0","invalid "+e)})),[o,a,s,u]}));return t&&(h.thisDep=h.thisDep||t.thisDep,h.contextDep=h.contextDep||t.contextDep,h.propDep=h.propDep||t.propDep),h}return t?new ot(t.thisDep,t.contextDep,t.propDep,(function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",qe),t.def(n,".",Xe)]})):null}var a=o("viewport");if(a){var s=a;a=new ot(a.thisDep,a.contextDep,a.propDep,(function(e,t){var n=s.append(e,t),r=e.shared.context;return t.set(r,".viewportWidth",n[2]),t.set(r,".viewportHeight",n[3]),n}))}return{viewport:a,scissor_box:o("scissor.box")}}(e,b,h),x=function(e,t){var n=e.static,r=e.dynamic,i=function(){if(Ve in n){var e=n[Ve];rt(e)?e=a.getElements(a.create(e,!0)):e&&(e=a.getElements(e),S.command(e,"invalid elements",t.commandStr));var i=st((function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null}));return i.value=e,i}if(Ve in r){var o=r[Ve];return ut(o,(function(e,t){var n=e.shared,r=n.isBufferArgs,i=n.elements,a=e.invoke(t,o),s=t.def("null"),u=t.def(r,"(",a,")"),c=e.cond(u).then(s,"=",i,".createStream(",a,");").else(s,"=",i,".getElements(",a,");");return S.optional((function(){e.assert(c.else,"!"+a+"||"+s,"invalid elements")})),t.entry(c),t.exit(e.cond(u).then(i,".destroyStream(",s,");")),e.ELEMENTS=s,s}))}return null}();function o(e,o){if(e in n){var a=0|n[e];return S.command(!o||a>=0,"invalid "+e,t.commandStr),st((function(e,t){return o&&(e.OFFSET=a),a}))}if(e in r){var s=r[e];return ut(s,(function(t,n){var r=t.invoke(n,s);return o&&(t.OFFSET=r,S.optional((function(){t.assert(n,r+">=0","invalid "+e)}))),r}))}return o&&i?st((function(e,t){return e.OFFSET="0",0})):null}var s=o(We,!0);return{elements:i,primitive:function(){if(He in n){var e=n[He];return S.commandParameter(e,K,"invalid primitve",t.commandStr),st((function(t,n){return K[e]}))}if(He in r){var o=r[He];return ut(o,(function(e,t){var n=e.constants.primTypes,r=e.invoke(t,o);return S.optional((function(){e.assert(t,r+" in "+n,"invalid primitive, must be one of "+Object.keys(K))})),t.def(n,"[",r,"]")}))}return i?at(i)?i.value?st((function(e,t){return t.def(e.ELEMENTS,".primType")})):st((function(){return 4})):new ot(i.thisDep,i.contextDep,i.propDep,(function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",4)})):null}(),count:function(){if(Ge in n){var e=0|n[Ge];return S.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),st((function(){return e}))}if(Ge in r){var o=r[Ge];return ut(o,(function(e,t){var n=e.invoke(t,o);return S.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(i){if(at(i)){if(i)return s?new ot(s.thisDep,s.contextDep,s.propDep,(function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return S.optional((function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")})),n})):st((function(e,t){return t.def(e.ELEMENTS,".vertCount")}));var a=st((function(){return-1}));return S.optional((function(){a.MISSING=!0})),a}var u=new ot(i.thisDep||s.thisDep,i.contextDep||s.contextDep,i.propDep||s.propDep,(function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")}));return S.optional((function(){u.DYNAMIC=!0})),u}return null}(),instances:o(Ze,!1),offset:s}}(e,h),A=function(e,t){var n=e.static,r=e.dynamic,o={};return w.forEach((function(e){var a=E(e);function s(t,i){if(e in n){var s=t(n[e]);o[a]=st((function(){return s}))}else if(e in r){var u=r[e];o[a]=ut(u,(function(e,t){return i(e,t,e.invoke(t,u))}))}}switch(e){case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"depth.mask":return s((function(n){return S.commandType(n,"boolean",e,t.commandStr),n}),(function(t,n,r){return S.optional((function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e,t.commandStr)})),r}));case"depth.func":return s((function(n){return S.commandParameter(n,$e,"invalid "+e,t.commandStr),$e[n]}),(function(t,n,r){var i=t.constants.compareFuncs;return S.optional((function(){t.assert(n,r+" in "+i,"invalid "+e+", must be one of "+Object.keys($e))})),n.def(i,"[",r,"]")}));case"depth.range":return s((function(e){return S.command(ee(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e}),(function(e,t,n){return S.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[t.def("+",n,"[0]"),t.def("+",n,"[1]")]}));case"blend.func":return s((function(e){S.commandType(e,"object","blend.func",t.commandStr);var n="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,i="dstRGB"in e?e.dstRGB:e.dst,o="dstAlpha"in e?e.dstAlpha:e.dst;return S.commandParameter(n,Qe,a+".srcRGB",t.commandStr),S.commandParameter(r,Qe,a+".srcAlpha",t.commandStr),S.commandParameter(i,Qe,a+".dstRGB",t.commandStr),S.commandParameter(o,Qe,a+".dstAlpha",t.commandStr),S.command(-1===Je.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",t.commandStr),[Qe[n],Qe[i],Qe[r],Qe[o]]}),(function(t,n,r){var i=t.constants.blendFuncs;function o(o,a){var s=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return S.optional((function(){t.assert(n,s+" in "+i,"invalid "+e+"."+o+a+", must be one of "+Object.keys(Qe))})),s}S.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var a=o("src","RGB"),s=o("dst","RGB");S.optional((function(){var e=t.constants.invalidBlendCombinations;t.assert(n,e+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",a,"]"),c=n.def(i,"[",o("src","Alpha"),"]");return[u,n.def(i,"[",s,"]"),c,n.def(i,"[",o("dst","Alpha"),"]")]}));case"blend.equation":return s((function(n){return"string"==typeof n?(S.commandParameter(n,m,"invalid "+e,t.commandStr),[m[n],m[n]]):"object"==typeof n?(S.commandParameter(n.rgb,m,e+".rgb",t.commandStr),S.commandParameter(n.alpha,m,e+".alpha",t.commandStr),[m[n.rgb],m[n.alpha]]):void S.commandRaise("invalid blend.equation",t.commandStr)}),(function(t,n,r){var i=t.constants.blendEquations,o=n.def(),a=n.def(),s=t.cond("typeof ",r,'==="string"');return S.optional((function(){function n(e,n,r){t.assert(e,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(m))}n(s.then,e,r),t.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(s.else,e+".rgb",r+".rgb"),n(s.else,e+".alpha",r+".alpha")})),s.then(o,"=",a,"=",i,"[",r,"];"),s.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(s),[o,a]}));case"blend.color":return s((function(e){return S.command(ee(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),L(4,(function(t){return+e[t]}))}),(function(e,t,n){return S.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),L(4,(function(e){return t.def("+",n,"[",e,"]")}))}));case"stencil.mask":return s((function(e){return S.commandType(e,"number",a,t.commandStr),0|e}),(function(e,t,n){return S.optional((function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")})),t.def(n,"|0")}));case"stencil.func":return s((function(n){S.commandType(n,"object",a,t.commandStr);var r=n.cmp||"keep",i=n.ref||0,o="mask"in n?n.mask:-1;return S.commandParameter(r,$e,e+".cmp",t.commandStr),S.commandType(i,"number",e+".ref",t.commandStr),S.commandType(o,"number",e+".mask",t.commandStr),[$e[r],i,o]}),(function(e,t,n){var r=e.constants.compareFuncs;return S.optional((function(){function i(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",7680),t.def(n,".ref|0"),t.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case"stencil.opFront":case"stencil.opBack":return s((function(n){S.commandType(n,"object",a,t.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",o=n.zpass||"keep";return S.commandParameter(r,et,e+".fail",t.commandStr),S.commandParameter(i,et,e+".zfail",t.commandStr),S.commandParameter(o,et,e+".zpass",t.commandStr),["stencil.opBack"===e?1029:1028,et[r],et[i],et[o]]}),(function(t,n,r){var i=t.constants.stencilOps;function o(o){return S.optional((function(){t.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+e+"."+o+", must be one of "+Object.keys(et))})),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",7680)}return S.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),["stencil.opBack"===e?1029:1028,o("fail"),o("zfail"),o("zpass")]}));case"polygonOffset.offset":return s((function(e){S.commandType(e,"object",a,t.commandStr);var n=0|e.factor,r=0|e.units;return S.commandType(n,"number",a+".factor",t.commandStr),S.commandType(r,"number",a+".units",t.commandStr),[n,r]}),(function(t,n,r){return S.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case"cull.face":return s((function(e){var n=0;return"front"===e?n=1028:"back"===e&&(n=1029),S.command(!!n,a,t.commandStr),n}),(function(e,t,n){return S.optional((function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),t.def(n,'==="front"?',1028,":",1029)}));case"lineWidth":return s((function(e){return S.command("number"==typeof e&&e>=i.lineWidthDims[0]&&e<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],t.commandStr),e}),(function(e,t,n){return S.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+i.lineWidthDims[0]+"&&"+n+"<="+i.lineWidthDims[1],"invalid line width")})),n}));case"frontFace":return s((function(e){return S.commandParameter(e,nt,a,t.commandStr),nt[e]}),(function(e,t,n){return S.optional((function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),t.def(n+'==="cw"?2304:2305')}));case"colorMask":return s((function(e){return S.command(ee(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map((function(e){return!!e}))}),(function(e,t,n){return S.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),L(4,(function(e){return"!!"+n+"["+e+"]"}))}));case"sample.coverage":return s((function(e){S.command("object"==typeof e&&e,a,t.commandStr);var n="value"in e?e.value:1,r=!!e.invert;return S.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[n,r]}),(function(e,t,n){return S.optional((function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[t.def('"value" in ',n,"?+",n,".value:1"),t.def("!!",n,".invert")]}))}})),o}(e,h),T=function(e,t,r){var i=e.static,o=e.dynamic;function a(e){if(e in i){var t=n.id(i[e]);S.optional((function(){f.shader(tt[e],t,S.guessCommand())}));var r=st((function(){return t}));return r.id=t,r}if(e in o){var a=o[e];return ut(a,(function(t,n){var r=t.invoke(n,a),i=n.def(t.shared.strings,".id(",r,")");return S.optional((function(){n(t.shared.shader,".shader(",tt[e],",",i,",",t.command,");")})),i}))}return null}var s,u=a(Be),c=a(Ue),l=null;return at(u)&&at(c)?(l=f.program(c.id,u.id,null,r),s=st((function(e,t){return e.link(l)}))):s=new ot(u&&u.thisDep||c&&c.thisDep,u&&u.contextDep||c&&c.contextDep,u&&u.propDep||c&&c.propDep,(function(e,t){var n,r=e.shared.shader;n=u?u.append(e,t):t.def(r,".",Be);var i=r+".program("+(c?c.append(e,t):t.def(r,".",Ue))+","+n;return S.optional((function(){i+=","+e.command})),t.def(i+")")})),{frag:u,vert:c,progVar:s,program:l}}(e,0,v);function C(e){var t=_[e];t&&(A[e]=t)}C("viewport"),C(E("scissor.box"));var M=Object.keys(A).length>0,k={framebuffer:b,draw:x,shader:T,state:A,dirty:M,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(k.profile=function(e){var t,n=e.static,r=e.dynamic;if(ze in n){var i=!!n[ze];(t=st((function(e,t){return i}))).enable=i}else if(ze in r){var o=r[ze];t=ut(o,(function(e,t){return e.invoke(t,o)}))}return t}(e),k.uniforms=function(e,t){var n=e.static,r=e.dynamic,i={};return Object.keys(n).forEach((function(e){var r,o=n[e];if("number"==typeof o||"boolean"==typeof o)r=st((function(){return o}));else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=st((function(e){return e.link(o)})):"framebuffer"===a||"framebufferCube"===a?(S.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),r=st((function(e){return e.link(o.color[0])}))):S.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else ee(o)?r=st((function(t){return t.global.def("[",L(o.length,(function(n){return S.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+e,t.commandStr),o[n]})),"]")})):S.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);r.value=o,i[e]=r})),Object.keys(r).forEach((function(e){var t=r[e];i[e]=ut(t,(function(e,n){return e.invoke(n,t)}))})),i}(s,h),k.drawVAO=k.scopeVAO=function(e,t){var n=e.static,r=e.dynamic;if(Ye in n){var i=n[Ye];return null!==i&&null===l.getVAO(i)&&(i=l.createVAO(i)),st((function(e){return e.link(l.getVAO(i))}))}if(Ye in r){var o=r[Ye];return ut(o,(function(e,t){var n=e.invoke(t,o);return t.def(e.shared.vao+".getVAO("+n+")")}))}return null}(e),!k.drawVAO&&T.program&&!v&&r.angle_instanced_arrays){var O=!0,I=T.program.attributes.map((function(e){var n=t.static[e];return O=O&&!!n,n}));if(O&&I.length>0){var P=l.getVAO(l.createVAO(I));k.drawVAO=new ot(null,null,null,(function(e,t){return e.link(P)})),k.useVAO=!0}}return v?k.useVAO=!0:k.attributes=function(e,t){var r=e.static,i=e.dynamic,a={};return Object.keys(r).forEach((function(e){var i=r[e],s=n.id(e),u=new g;if(rt(i))u.state=1,u.buffer=o.getBuffer(o.create(i,34962,!1,!0)),u.type=0;else{var c=o.getBuffer(i);if(c)u.state=1,u.buffer=c,u.type=0;else if(S.command("object"==typeof i&&i,"invalid data for attribute "+e,t.commandStr),"constant"in i){var l=i.constant;u.buffer="null",u.state=2,"number"==typeof l?u.x=l:(S.command(ee(l)&&l.length>0&&l.length<=4,"invalid constant for attribute "+e,t.commandStr),Fe.forEach((function(e,t){t<l.length&&(u[e]=l[t])})))}else{c=rt(i.buffer)?o.getBuffer(o.create(i.buffer,34962,!1,!0)):o.getBuffer(i.buffer),S.command(!!c,'missing buffer for attribute "'+e+'"',t.commandStr);var f=0|i.offset;S.command(f>=0,'invalid offset for attribute "'+e+'"',t.commandStr);var h=0|i.stride;S.command(h>=0&&h<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',t.commandStr);var d=0|i.size;S.command(!("size"in i)||d>0&&d<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',t.commandStr);var p=!!i.normalized,v=0;"type"in i&&(S.commandParameter(i.type,V,"invalid type for attribute "+e,t.commandStr),v=V[i.type]);var m=0|i.divisor;"divisor"in i&&(S.command(0===m||y,'cannot specify divisor for attribute "'+e+'", instancing not supported',t.commandStr),S.command(m>=0,'invalid divisor for attribute "'+e+'"',t.commandStr)),S.optional((function(){var n=t.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(t){S.command(r.indexOf(t)>=0,'unknown parameter "'+t+'" for attribute pointer "'+e+'" (valid parameters are '+r+")",n)}))})),u.buffer=c,u.state=1,u.size=d,u.normalized=p,u.type=v||c.dtype,u.offset=f,u.stride=h,u.divisor=m}}a[e]=st((function(e,t){var n=e.attribCache;if(s in n)return n[s];var r={isStream:!1};return Object.keys(u).forEach((function(e){r[e]=u[e]})),u.buffer&&(r.buffer=e.link(u.buffer),r.type=r.type||r.buffer+".dtype"),n[s]=r,r}))})),Object.keys(i).forEach((function(e){var t=i[e];a[e]=ut(t,(function(n,r){var i=n.invoke(r,t),o=n.shared,a=n.constants,s=o.isBufferArgs,u=o.buffer;S.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+e+'"')}));var c={isStream:r.def(!1)},l=new g;l.state=1,Object.keys(l).forEach((function(e){c[e]=r.def(""+l[e])}));var f=c.buffer,h=c.type;function d(e){r(c[e],"=",i,".",e,"|0;")}return r("if(",s,"(",i,")){",c.isStream,"=true;",f,"=",u,".createStream(",34962,",",i,");",h,"=",f,".dtype;","}else{",f,"=",u,".getBuffer(",i,");","if(",f,"){",h,"=",f,".dtype;",'}else if("constant" in ',i,"){",c.state,"=",2,";","if(typeof "+i+'.constant === "number"){',c[Fe[0]],"=",i,".constant;",Fe.slice(1).map((function(e){return c[e]})).join("="),"=0;","}else{",Fe.map((function(e,t){return c[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",f,"=",u,".createStream(",34962,",",i,".buffer);","}else{",f,"=",u,".getBuffer(",i,".buffer);","}",h,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",f,".dtype;",c.normalized,"=!!",i,".normalized;"),d("size"),d("offset"),d("stride"),d("divisor"),r("}}"),r.exit("if(",c.isStream,"){",u,".destroyStream(",f,");","}"),c}))})),a}(t,h),k.context=function(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach((function(e){var n=t[e];r[e]=st((function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)}))})),Object.keys(n).forEach((function(e){var t=n[e];r[e]=ut(t,(function(e,n){return e.invoke(n,t)}))})),r}(c),k}function D(e,t,n){var r=e.shared.context,i=e.scope();Object.keys(n).forEach((function(o){t.save(r,"."+o);var a=n[o].append(e,t);Array.isArray(a)?i(r,".",o,"=[",a.join(),"];"):i(r,".",o,"=",a,";")})),t(i)}function F(e,t,n,r){var i,o=e.shared,a=o.gl,s=o.framebuffer;b&&(i=t.def(o.extensions,".webgl_draw_buffers"));var u,c=e.constants,l=c.drawBuffer,f=c.backBuffer;u=n?n.append(e,t):t.def(s,".next"),r||t("if(",u,"!==",s,".cur){"),t("if(",u,"){",a,".bindFramebuffer(",36160,",",u,".framebuffer);"),b&&t(i,".drawBuffersWEBGL(",l,"[",u,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",36160,",null);"),b&&t(i,".drawBuffersWEBGL(",f,");"),t("}",s,".cur=",u,";"),r||t("}")}function z(e,t,n){var r=e.shared,i=r.gl,o=e.current,a=e.next,s=r.current,u=r.next,c=e.cond(s,".dirty");w.forEach((function(t){var r,l,f=E(t);if(!(f in n.state))if(f in a){r=a[f],l=o[f];var h=L(_[f].length,(function(e){return c.def(r,"[",e,"]")}));c(e.cond(h.map((function(e,t){return e+"!=="+l+"["+t+"]"})).join("||")).then(i,".",T[f],"(",h,");",h.map((function(e,t){return l+"["+t+"]="+e})).join(";"),";"))}else{r=c.def(u,".",f);var d=e.cond(r,"!==",s,".",f);c(d),f in A?d(e.cond(r).then(i,".enable(",A[f],");").else(i,".disable(",A[f],");"),s,".",f,"=",r,";"):d(i,".",T[f],"(",r,");",s,".",f,"=",r,";")}})),0===Object.keys(n.state).length&&c(s,".dirty=false;"),t(c)}function j(e,t,n,r){var i=e.shared,o=e.current,a=i.current,s=i.gl;it(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var c=u.append(e,t);if(A[i]){var l=A[i];at(u)?t(s,c?".enable(":".disable(",l,");"):t(e.cond(c).then(s,".enable(",l,");").else(s,".disable(",l,");")),t(a,".",i,"=",c,";")}else if(ee(c)){var f=o[i];t(s,".",T[i],"(",c,");",c.map((function(e,t){return f+"["+t+"]="+e})).join(";"),";")}else t(s,".",T[i],"(",c,");",a,".",i,"=",c,";")}}))}function U(e,t){y&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function B(e,t,n,r,i){var o,a,s,u=e.shared,c=e.stats,l=u.current,f=u.timer,h=n.profile;function d(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function v(e){e(o=t.def(),"=",d(),";"),"string"==typeof i?e(c,".count+=",i,";"):e(c,".count++;"),p&&(r?e(a=t.def(),"=",f,".getNumPendingQueries();"):e(f,".beginQuery(",c,");"))}function g(e){e(c,".cpuTime+=",d(),"-",o,";"),p&&(r?e(f,".pushScopeStats(",a,",",f,".getNumPendingQueries(),",c,");"):e(f,".endQuery();"))}function m(e){var n=t.def(l,".profile");t(l,".profile=",e,";"),t.exit(l,".profile=",n,";")}if(h){if(at(h))return void(h.enable?(v(t),g(t.exit),m("true")):m("false"));m(s=h.append(e,t))}else s=t.def(l,".profile");var y=e.block();v(y),t("if(",s,"){",y,"}");var b=e.block();g(b),t.exit("if(",s,"){",b,"}")}function H(e,t,n,r,i){var o=e.shared;r.forEach((function(r){var a,s=r.name,u=n.attributes[s];if(u){if(!i(u))return;a=u.append(e,t)}else{if(!i(ct))return;var c=e.scopeAttrib(s);S.optional((function(){e.assert(t,c+".state","missing attribute "+s)})),a={},Object.keys(new g).forEach((function(e){a[e]=t.def(c,".",e)}))}!function(n,r,i){var a=o.gl,s=t.def(n,".location"),u=t.def(o.attributes,"[",s,"]"),c=i.state,l=i.buffer,f=[i.x,i.y,i.z,i.w],h=["buffer","normalized","offset","stride"];function d(){t("if(!",u,".buffer){",a,".enableVertexAttribArray(",s,");}");var n,o=i.type;if(n=i.size?t.def(i.size,"||",r):r,t("if(",u,".type!==",o,"||",u,".size!==",n,"||",h.map((function(e){return u+"."+e+"!=="+i[e]})).join("||"),"){",a,".bindBuffer(",34962,",",l,".buffer);",a,".vertexAttribPointer(",[s,n,o,i.normalized,i.stride,i.offset],");",u,".type=",o,";",u,".size=",n,";",h.map((function(e){return u+"."+e+"="+i[e]+";"})).join(""),"}"),y){var c=i.divisor;t("if(",u,".divisor!==",c,"){",e.instancing,".vertexAttribDivisorANGLE(",[s,c],");",u,".divisor=",c,";}")}}function p(){t("if(",u,".buffer){",a,".disableVertexAttribArray(",s,");",u,".buffer=null;","}if(",Fe.map((function(e,t){return u+"."+e+"!=="+f[t]})).join("||"),"){",a,".vertexAttrib4f(",s,",",f,");",Fe.map((function(e,t){return u+"."+e+"="+f[t]+";"})).join(""),"}")}1===c?d():2===c?p():(t("if(",c,"===",1,"){"),d(),t("}else{"),p(),t("}"))}(e.link(r),function(e){switch(e){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}(r.info.type),a)}))}function G(e,t,r,i,o){for(var a,s=e.shared,u=s.gl,c=0;c<i.length;++c){var l,f=i[c],h=f.name,d=f.info.type,p=r.uniforms[h],v=e.link(f)+".location";if(p){if(!o(p))continue;if(at(p)){var g=p.value;if(S.command(null!=g,'missing uniform "'+h+'"',e.commandStr),35678===d||35680===d){S.command("function"==typeof g&&(35678===d&&("texture2d"===g._reglType||"framebuffer"===g._reglType)||35680===d&&("textureCube"===g._reglType||"framebufferCube"===g._reglType)),"invalid texture for uniform "+h,e.commandStr);var m=e.link(g._texture||g.color[0]._texture);t(u,".uniform1i(",v,",",m+".bind());"),t.exit(m,".unbind();")}else if(35674===d||35675===d||35676===d){S.optional((function(){S.command(ee(g),"invalid matrix for uniform "+h,e.commandStr),S.command(35674===d&&4===g.length||35675===d&&9===g.length||35676===d&&16===g.length,"invalid length for matrix uniform "+h,e.commandStr)}));var y=e.global.def("new Float32Array(["+Array.prototype.slice.call(g)+"])"),b=2;35675===d?b=3:35676===d&&(b=4),t(u,".uniformMatrix",b,"fv(",v,",false,",y,");")}else{switch(d){case 5126:S.commandType(g,"number","uniform "+h,e.commandStr),a="1f";break;case 35664:S.command(ee(g)&&2===g.length,"uniform "+h,e.commandStr),a="2f";break;case 35665:S.command(ee(g)&&3===g.length,"uniform "+h,e.commandStr),a="3f";break;case 35666:S.command(ee(g)&&4===g.length,"uniform "+h,e.commandStr),a="4f";break;case 35670:S.commandType(g,"boolean","uniform "+h,e.commandStr),a="1i";break;case 5124:S.commandType(g,"number","uniform "+h,e.commandStr),a="1i";break;case 35671:case 35667:S.command(ee(g)&&2===g.length,"uniform "+h,e.commandStr),a="2i";break;case 35672:case 35668:S.command(ee(g)&&3===g.length,"uniform "+h,e.commandStr),a="3i";break;case 35673:case 35669:S.command(ee(g)&&4===g.length,"uniform "+h,e.commandStr),a="4i"}t(u,".uniform",a,"(",v,",",ee(g)?Array.prototype.slice.call(g):g,");")}continue}l=p.append(e,t)}else{if(!o(ct))continue;l=t.def(s.uniforms,"[",n.id(h),"]")}35678===d?(S(!Array.isArray(l),"must specify a scalar prop for textures"),t("if(",l,"&&",l,'._reglType==="framebuffer"){',l,"=",l,".color[0];","}")):35680===d&&(S(!Array.isArray(l),"must specify a scalar prop for cube maps"),t("if(",l,"&&",l,'._reglType==="framebufferCube"){',l,"=",l,".color[0];","}")),S.optional((function(){function n(n,r){e.assert(t,n,'bad data or missing for uniform "'+h+'".  '+r)}function r(e){S(!Array.isArray(l),"must not specify an array type for uniform"),n("typeof "+l+'==="'+e+'"',"invalid type, expected "+e)}function i(t,r){Array.isArray(l)?S(l.length===t,"must have length "+t):n(s.isArrayLike+"("+l+")&&"+l+".length==="+t,"invalid vector, should have length "+t,e.commandStr)}function o(t){S(!Array.isArray(l),"must not specify a value type"),n("typeof "+l+'==="function"&&'+l+'._reglType==="texture'+(3553===t?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(d){case 5124:r("number");break;case 35667:i(2);break;case 35668:i(3);break;case 35669:i(4);break;case 5126:r("number");break;case 35664:i(2);break;case 35665:i(3);break;case 35666:i(4);break;case 35670:r("boolean");break;case 35671:i(2);break;case 35672:i(3);break;case 35673:case 35674:i(4);break;case 35675:i(9);break;case 35676:i(16);break;case 35678:o(3553);break;case 35680:o(34067)}}));var _=1;switch(d){case 35678:case 35680:var x=t.def(l,"._texture");t(u,".uniform1i(",v,",",x,".bind());"),t.exit(x,".unbind();");continue;case 5124:case 35670:a="1i";break;case 35667:case 35671:a="2i",_=2;break;case 35668:case 35672:a="3i",_=3;break;case 35669:case 35673:a="4i",_=4;break;case 5126:a="1f";break;case 35664:a="2f",_=2;break;case 35665:a="3f",_=3;break;case 35666:a="4f",_=4;break;case 35674:a="Matrix2fv";break;case 35675:a="Matrix3fv";break;case 35676:a="Matrix4fv"}if(t(u,".uniform",a,"(",v,","),"M"===a.charAt(0)){var w=Math.pow(d-35674+2,2),A=e.global.def("new Float32Array(",w,")");Array.isArray(l)?t("false,(",L(w,(function(e){return A+"["+e+"]="+l[e]})),",",A,")"):t("false,(Array.isArray(",l,")||",l," instanceof Float32Array)?",l,":(",L(w,(function(e){return A+"["+e+"]="+l+"["+e+"]"})),",",A,")")}else _>1?t(L(_,(function(e){return Array.isArray(l)?l[e]:l+"["+e+"]"}))):(S(!Array.isArray(l),"uniform value must not be an array"),t(l));t(");")}}function W(e,t,n,r){var i=e.shared,o=i.gl,a=i.draw,s=r.draw,u=function(){var i,u=s.elements,c=t;return u?((u.contextDep&&r.contextDynamic||u.propDep)&&(c=n),i=u.append(e,c)):i=c.def(a,".",Ve),i&&c("if("+i+")"+o+".bindBuffer(34963,"+i+".buffer.buffer);"),i}();function c(i){var o=s[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(e,n):o.append(e,t):t.def(a,".",i)}var l,f,h=c(He),d=c(We),p=function(){var i,o=s.count,u=t;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(u=n),i=o.append(e,u),S.optional((function(){o.MISSING&&e.assert(t,"false","missing vertex count"),o.DYNAMIC&&e.assert(u,i+">=0","missing vertex count")}))):(i=u.def(a,".",Ge),S.optional((function(){e.assert(u,i+">=0","missing vertex count")}))),i}();if("number"==typeof p){if(0===p)return}else n("if(",p,"){"),n.exit("}");y&&(l=c(Ze),f=e.instancing);var v=u+".type",g=s.elements&&at(s.elements);function m(){function e(){n(f,".drawElementsInstancedANGLE(",[h,p,v,d+"<<(("+v+"-5121)>>1)",l],");")}function t(){n(f,".drawArraysInstancedANGLE(",[h,d,p,l],");")}u?g?e():(n("if(",u,"){"),e(),n("}else{"),t(),n("}")):t()}function b(){function e(){n(o+".drawElements("+[h,p,v,d+"<<(("+v+"-5121)>>1)"]+");")}function t(){n(o+".drawArrays("+[h,d,p]+");")}u?g?e():(n("if(",u,"){"),e(),n("}else{"),t(),n("}")):t()}y&&("number"!=typeof l||l>=0)?"string"==typeof l?(n("if(",l,">0){"),m(),n("}else if(",l,"<0){"),b(),n("}")):m():b()}function Z(e,t,n,r,i){var o=R(),a=o.proc("body",i);return S.optional((function(){o.commandStr=t.commandStr,o.command=o.link(t.commandStr)})),y&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),e(o,a,n,r),o.compile().body}function Y(e,t,n,r){U(e,t),n.useVAO?n.drawVAO?t(e.shared.vao,".setVAO(",n.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),H(e,t,n,r.attributes,(function(){return!0}))),G(e,t,n,r.uniforms,(function(){return!0})),W(e,t,t,n)}function q(e,t,n,r){function i(){return!0}e.batchId="a1",U(e,t),H(e,t,n,r.attributes,i),G(e,t,n,r.uniforms,i),W(e,t,t,n)}function X(e,t,n,r){U(e,t);var i=n.contextDep,o=t.def(),a=t.def();e.shared.props=a,e.batchId=o;var s=e.scope(),u=e.scope();function c(e){return e.contextDep&&i||e.propDep}function l(e){return!c(e)}if(t(s.entry,"for(",o,"=0;",o,"<","a1",";++",o,"){",a,"=","a0","[",o,"];",u,"}",s.exit),n.needsContext&&D(e,u,n.context),n.needsFramebuffer&&F(e,u,n.framebuffer),j(e,u,n.state,c),n.profile&&c(n.profile)&&B(e,u,n,!1,!0),r)n.useVAO?n.drawVAO?c(n.drawVAO)?u(e.shared.vao,".setVAO(",n.drawVAO.append(e,u),");"):s(e.shared.vao,".setVAO(",n.drawVAO.append(e,s),");"):s(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(s(e.shared.vao,".setVAO(null);"),H(e,s,n,r.attributes,l),H(e,u,n,r.attributes,c)),G(e,s,n,r.uniforms,l),G(e,u,n,r.uniforms,c),W(e,s,u,n);else{var f=e.global.def("{}"),h=n.shader.progVar.append(e,u),d=u.def(h,".id"),p=u.def(f,"[",d,"]");u(e.shared.gl,".useProgram(",h,".program);","if(!",p,"){",p,"=",f,"[",d,"]=",e.link((function(t){return Z(q,e,n,t,2)})),"(",h,");}",p,".call(this,a0[",o,"],",o,");")}}function Q(e,t,n){var r=t.static[n];if(r&&function(e){if("object"==typeof e&&!ee(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(C.isDynamic(e[t[n]]))return!0;return!1}}(r)){var i=e.global,o=Object.keys(r),a=!1,s=!1,u=!1,c=e.global.def("{}");o.forEach((function(t){var n=r[t];if(C.isDynamic(n)){"function"==typeof n&&(n=r[t]=C.unbox(n));var o=ut(n,null);a=a||o.thisDep,u=u||o.propDep,s=s||o.contextDep}else{switch(i(c,".",t,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(e.link(n))}i(";")}})),t.dynamic[n]=new C.DynamicVariable(4,{thisDep:a,contextDep:s,propDep:u,ref:c,append:function(e,t){o.forEach((function(n){var i=r[n];if(C.isDynamic(i)){var o=e.invoke(t,i);t(c,".",n,"=",o,";")}}))}}),delete t.static[n]}}return{next:x,current:_,procs:function(){var e=R(),t=e.proc("poll"),n=e.proc("refresh"),o=e.block();t(o),n(o);var a,s=e.shared,u=s.gl,c=s.next,l=s.current;o(l,".dirty=false;"),F(e,t),F(e,n,null,!0),y&&(a=e.link(y)),r.oes_vertex_array_object&&n(e.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var f=0;f<i.maxAttributes;++f){var h=n.def(s.attributes,"[",f,"]"),d=e.cond(h,".buffer");d.then(u,".enableVertexAttribArray(",f,");",u,".bindBuffer(",34962,",",h,".buffer.buffer);",u,".vertexAttribPointer(",f,",",h,".size,",h,".type,",h,".normalized,",h,".stride,",h,".offset);").else(u,".disableVertexAttribArray(",f,");",u,".vertexAttrib4f(",f,",",h,".x,",h,".y,",h,".z,",h,".w);",h,".buffer=null;"),n(d),y&&n(a,".vertexAttribDivisorANGLE(",f,",",h,".divisor);")}return n(e.shared.vao,".currentVAO=null;",e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"),Object.keys(A).forEach((function(r){var i=A[r],a=o.def(c,".",r),s=e.block();s("if(",a,"){",u,".enable(",i,")}else{",u,".disable(",i,")}",l,".",r,"=",a,";"),n(s),t("if(",a,"!==",l,".",r,"){",s,"}")})),Object.keys(T).forEach((function(r){var i,a,s=T[r],f=_[r],h=e.block();if(h(u,".",s,"("),ee(f)){var d=f.length;i=e.global.def(c,".",r),a=e.global.def(l,".",r),h(L(d,(function(e){return i+"["+e+"]"})),");",L(d,(function(e){return a+"["+e+"]="+i+"["+e+"];"})).join("")),t("if(",L(d,(function(e){return i+"["+e+"]!=="+a+"["+e+"]"})).join("||"),"){",h,"}")}else i=o.def(c,".",r),a=o.def(l,".",r),h(i,");",l,".",r,"=",i,";"),t("if(",i,"!==",a,"){",h,"}");n(h)})),e.compile()}(),compile:function(e,r,i,o,a){var s=R();s.stats=s.link(a),Object.keys(r.static).forEach((function(e){Q(s,r,e)})),Ke.forEach((function(t){Q(s,e,t)}));var u=N(e,r,i,o,s);return function(e,t){var n=e.proc("draw",1);U(e,n),D(e,n,t.context),F(e,n,t.framebuffer),z(e,n,t),j(e,n,t.state),B(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)Y(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var i=e.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(e.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",e.link((function(n){return Z(Y,e,t,n,1)})),"(",r,");",a,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}(s,u),function(e,t){var r=e.proc("scope",3);e.batchId="a2";var i=e.shared,o=i.current;function a(n){var o=t.shader[n];o&&r.set(i.shader,"."+n,o.append(e,r))}D(e,r,t.context),t.framebuffer&&t.framebuffer.append(e,r),it(Object.keys(t.state)).forEach((function(n){var o=t.state[n].append(e,r);ee(o)?o.forEach((function(t,i){r.set(e.next[n],"["+i+"]",t)})):r.set(i.next,"."+n,o)})),B(e,r,t,!0,!0),[Ve,We,Ge,Ze,He].forEach((function(n){var o=t.draw[n];o&&r.set(i.draw,"."+n,""+o.append(e,r))})),Object.keys(t.uniforms).forEach((function(o){var a=t.uniforms[o].append(e,r);Array.isArray(a)&&(a="["+a.join()+"]"),r.set(i.uniforms,"["+n.id(o)+"]",a)})),Object.keys(t.attributes).forEach((function(n){var i=t.attributes[n].append(e,r),o=e.scopeAttrib(n);Object.keys(new g).forEach((function(e){r.set(o,"."+e,i[e])}))})),t.scopeVAO&&r.set(i.vao,".targetVAO",t.scopeVAO.append(e,r)),a(Ue),a(Be),Object.keys(t.state).length>0&&(r(o,".dirty=true;"),r.exit(o,".dirty=true;")),r("a1(",e.shared.context,",a0,",e.batchId,");")}(s,u),function(e,t){var n=e.proc("batch",2);e.batchId="0",U(e,n);var r=!1,i=!0;Object.keys(t.context).forEach((function(e){r=r||t.context[e].propDep})),r||(D(e,n,t.context),i=!1);var o=t.framebuffer,a=!1;function s(e){return e.contextDep&&r||e.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||F(e,n,o)):F(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(r=!0),z(e,n,t),j(e,n,t.state,(function(e){return!s(e)})),t.profile&&s(t.profile)||B(e,n,t,!1,"a1"),t.contextDep=r,t.needsContext=i,t.needsFramebuffer=a;var u=t.shader.progVar;if(u.contextDep&&r||u.propDep)X(e,n,t,null);else{var c=u.append(e,n);if(n(e.shared.gl,".useProgram(",c,".program);"),t.shader.program)X(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var l=e.global.def("{}"),f=n.def(c,".id"),h=n.def(l,"[",f,"]");n(e.cond(h).then(h,".call(this,a0,a1);").else(h,"=",l,"[",f,"]=",e.link((function(n){return Z(X,e,t,n,2)})),"(",c,");",h,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}(s,u),t(s.compile(),{destroy:function(){u.shader.program.destroy()}})}}}var ft=function(e,t){if(!t.ext_disjoint_timer_query)return null;var n=[];function r(e){n.push(e)}var i=[];function o(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var a=[];function s(e){a.push(e)}var u=[];function c(e,t,n){var r=a.pop()||new o;r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,u.push(r)}var l=[],f=[];return{beginQuery:function(e){var r=n.pop()||t.ext_disjoint_timer_query.createQueryEXT();t.ext_disjoint_timer_query.beginQueryEXT(35007,r),i.push(r),c(i.length-1,i.length,e)},endQuery:function(){t.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:c,update:function(){var e,n,o=i.length;if(0!==o){f.length=Math.max(f.length,o+1),l.length=Math.max(l.length,o+1),l[0]=0,f[0]=0;var a=0;for(e=0,n=0;n<i.length;++n){var c=i[n];t.ext_disjoint_timer_query.getQueryObjectEXT(c,34919)?(a+=t.ext_disjoint_timer_query.getQueryObjectEXT(c,34918),r(c)):i[e++]=c,l[n+1]=a,f[n+1]=e}for(i.length=e,e=0,n=0;n<u.length;++n){var h=u[n],d=h.startQueryIndex,p=h.endQueryIndex;h.sum+=l[p]-l[d];var v=f[d],g=f[p];g===v?(h.stats.gpuTime+=h.sum/1e6,s(h)):(h.startQueryIndex=v,h.endQueryIndex=g,u[e++]=h)}u.length=e}},getNumPendingQueries:function(){return i.length},clear:function(){n.push.apply(n,i);for(var e=0;e<n.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(n[e]);i.length=0,n.length=0},restore:function(){i.length=0,n.length=0}}};function ht(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}return function(n){var r=P(n);if(!r)return null;var i=r.gl,o=i.getContextAttributes(),a=i.isContextLost(),s=function(e,t){var n={};function r(t){S.type(t,"string","extension name must be string");var r,i=t.toLowerCase();try{r=n[i]=e.getExtension(i)}catch(e){}return!!r}for(var i=0;i<t.extensions.length;++i){var o=t.extensions[i];if(!r(o))return t.onDestroy(),t.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(e){if(n[e]&&!r(e))throw new Error("(regl): error restoring extension "+e)}))}}}(i,r);if(!s)return null;var u,c,l=(u={"":0},c=[""],{id:function(e){var t=u[e];return t||(t=u[e]=c.length,c.push(e),t)},str:function(e){return c[e]}}),f={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},h=s.extensions,d=ft(0,h),p=k(),v=i.drawingBufferWidth,g=i.drawingBufferHeight,m={tick:0,time:0,viewportWidth:v,viewportHeight:g,framebufferWidth:v,framebufferHeight:g,drawingBufferWidth:v,drawingBufferHeight:g,pixelRatio:r.pixelRatio},y=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(34047));var r=1,i=1;t.webgl_draw_buffers&&(r=e.getParameter(34852),i=e.getParameter(36063));var o=!!t.oes_texture_float;if(o){var a=e.createTexture();e.bindTexture(3553,a),e.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var s=e.createFramebuffer();if(e.bindFramebuffer(36160,s),e.framebufferTexture2D(36160,36064,3553,a,0),e.bindTexture(3553,null),36053!==e.checkFramebufferStatus(36160))o=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var u=D.allocType(5126,4);e.readPixels(0,0,1,1,6408,5126,u),e.getError()?o=!1:(e.deleteFramebuffer(s),e.deleteTexture(a),o=1===u[0]),D.freeType(u)}}var c=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var l=e.createTexture(),f=D.allocType(5121,36);e.activeTexture(33984),e.bindTexture(34067,l),e.texImage2D(34069,0,6408,3,3,0,6408,5121,f),D.freeType(f),e.bindTexture(34067,null),e.deleteTexture(l),c=!e.getError()}return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter((function(e){return!!t[e]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:o,npotTextureCube:c}}(i,h),b=function(t,n,r,i){var o=0,a={};function s(e){this.id=o++,this.buffer=t.createBuffer(),this.type=e,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=5121,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){f(this)};var u=[];function c(e,n,r){e.byteLength=n.byteLength,t.bufferData(e.type,n,r)}function l(t,n,r,i,o,a){var s,u;if(t.usage=r,Array.isArray(n)){if(t.dtype=i||5126,n.length>0)if(Array.isArray(n[0])){s=W(n);for(var l=1,f=1;f<s.length;++f)l*=s[f];t.dimension=l,c(t,u=G(n,s,t.dtype),r),a?t.persistentData=u:D.freeType(u)}else if("number"==typeof n[0]){t.dimension=o;var h=D.allocType(t.dtype,n.length);q(h,n),c(t,h,r),a?t.persistentData=h:D.freeType(h)}else e(n[0])?(t.dimension=n[0].length,t.dtype=i||Y(n[0])||5126,c(t,u=G(n,[n.length,n[0].length],t.dtype),r),a?t.persistentData=u:D.freeType(u)):S.raise("invalid buffer data")}else if(e(n))t.dtype=i||Y(n),t.dimension=o,c(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(F(n)){s=n.shape;var d=n.stride,p=n.offset,v=0,g=0,m=0,y=0;1===s.length?(v=s[0],g=1,m=d[0],y=0):2===s.length?(v=s[0],g=s[1],m=d[0],y=d[1]):S.raise("invalid shape"),t.dtype=i||Y(n.data)||5126,t.dimension=g;var b=D.allocType(t.dtype,v*g);X(b,n.data,v,g,m,y,p),c(t,b,r),a?t.persistentData=b:D.freeType(b)}else n instanceof ArrayBuffer?(t.dtype=5121,t.dimension=o,c(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n)))):S.raise("invalid buffer data")}function f(e){n.bufferCount--,i(e);var r=e.buffer;S(r,"buffer must not be deleted already"),t.deleteBuffer(r),e.buffer=null,delete a[e.id]}return r.profile&&(n.getTotalBufferSize=function(){var e=0;return Object.keys(a).forEach((function(t){e+=a[t].stats.size})),e}),{create:function(i,o,u,c){n.bufferCount++;var h=new s(o);function d(n){var i=35044,o=null,a=0,s=0,u=1;return Array.isArray(n)||e(n)||F(n)||n instanceof ArrayBuffer?o=n:"number"==typeof n?a=0|n:n&&(S.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(S(null===o||Array.isArray(o)||e(o)||F(o),"invalid data for buffer"),o=n.data),"usage"in n&&(S.parameter(n.usage,H,"invalid buffer usage"),i=H[n.usage]),"type"in n&&(S.parameter(n.type,V,"invalid buffer type"),s=V[n.type]),"dimension"in n&&(S.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(S.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),h.bind(),o?l(h,o,i,s,u,c):(a&&t.bufferData(h.type,a,i),h.dtype=s||5121,h.usage=i,h.dimension=u,h.byteLength=a),r.profile&&(h.stats.size=h.byteLength*Z[h.dtype]),d}function p(e,n){S(n+e.byteLength<=h.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+n+" to a buffer of size "+h.byteLength),t.bufferSubData(h.type,n,e)}return a[h.id]=h,u||d(i),d._reglType="buffer",d._buffer=h,d.subdata=function(t,n){var r,i=0|(n||0);if(h.bind(),e(t)||t instanceof ArrayBuffer)p(t,i);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var o=D.allocType(h.dtype,t.length);q(o,t),p(o,i),D.freeType(o)}else if(Array.isArray(t[0])||e(t[0])){r=W(t);var a=G(t,r,h.dtype);p(a,i),D.freeType(a)}else S.raise("invalid buffer data")}else if(F(t)){r=t.shape;var s=t.stride,u=0,c=0,l=0,f=0;1===r.length?(u=r[0],c=1,l=s[0],f=0):2===r.length?(u=r[0],c=r[1],l=s[0],f=s[1]):S.raise("invalid shape");var v=Array.isArray(t.data)?h.dtype:Y(t.data),g=D.allocType(v,u*c);X(g,t.data,u,c,l,f,t.offset),p(g,i),D.freeType(g)}else S.raise("invalid data for buffer subdata");return d},r.profile&&(d.stats=h.stats),d.destroy=function(){f(h)},d},createStream:function(e,t){var n=u.pop();return n||(n=new s(e)),n.bind(),l(n,t,35040,0,1,!1),n},destroyStream:function(e){u.push(e)},clear:function(){z(a).forEach(f),u.forEach(f)},getBuffer:function(e){return e&&e._buffer instanceof s?e._buffer:null},restore:function(){z(a).forEach((function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)}))},_initBuffer:l}}(i,f,r,(function(e){return _.destroyBuffer(e)})),_=function(t,n,r,i,o){for(var a=r.maxAttributes,s=new Array(a),u=0;u<a;++u)s[u]=new Le;var c=0,l={},f={Record:Le,scope:{},state:s,currentVAO:null,targetVAO:null,restore:h()?function(){h()&&z(l).forEach((function(e){e.refresh()}))}:function(){},createVAO:function(t){var r=new p;function s(t){S(Array.isArray(t),"arguments to vertex array constructor must be an array"),S(t.length<a,"too many attributes"),S(t.length>0,"must specify at least one attribute");var i={},u=r.attributes;u.length=t.length;for(var c=0;c<t.length;++c){var l,f=t[c],h=u[c]=new Le,d=f.data||f;Array.isArray(d)||e(d)||F(d)?(r.buffers[c]&&(l=r.buffers[c],e(d)&&l._buffer.byteLength>=d.byteLength?l.subdata(d):(l.destroy(),r.buffers[c]=null)),r.buffers[c]||(l=r.buffers[c]=o.create(f,34962,!1,!0)),h.buffer=o.getBuffer(l),h.size=0|h.buffer.dimension,h.normalized=!1,h.type=h.buffer.dtype,h.offset=0,h.stride=0,h.divisor=0,h.state=1,i[c]=1):o.getBuffer(f)?(h.buffer=o.getBuffer(f),h.size=0|h.buffer.dimension,h.normalized=!1,h.type=h.buffer.dtype,h.offset=0,h.stride=0,h.divisor=0,h.state=1):o.getBuffer(f.buffer)?(h.buffer=o.getBuffer(f.buffer),h.size=0|(+f.size||h.buffer.dimension),h.normalized=!!f.normalized||!1,"type"in f?(S.parameter(f.type,V,"invalid buffer type"),h.type=V[f.type]):h.type=h.buffer.dtype,h.offset=0|(f.offset||0),h.stride=0|(f.stride||0),h.divisor=0|(f.divisor||0),h.state=1,S(h.size>=1&&h.size<=4,"size must be between 1 and 4"),S(h.offset>=0,"invalid offset"),S(h.stride>=0&&h.stride<=255,"stride must be between 0 and 255"),S(h.divisor>=0,"divisor must be positive"),S(!h.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in f?(S(c>0,"first attribute must not be a constant"),h.x=+f.x||0,h.y=+f.y||0,h.z=+f.z||0,h.w=+f.w||0,h.state=2):S(!1,"invalid attribute spec for location "+c)}for(var p=0;p<r.buffers.length;++p)!i[p]&&r.buffers[p]&&(r.buffers[p].destroy(),r.buffers[p]=null);return r.refresh(),s}return i.vaoCount+=1,s.destroy=function(){for(var e=0;e<r.buffers.length;++e)r.buffers[e]&&r.buffers[e].destroy();r.buffers.length=0,r.destroy()},s._vao=r,s._reglType="vao",s(t)},getVAO:function(e){return"function"==typeof e&&e._vao?e._vao:null},destroyBuffer:function(e){for(var n=0;n<s.length;++n){var r=s[n];r.buffer===e&&(t.disableVertexAttribArray(n),r.buffer=null)}},setVAO:h()?function(e){if(e!==f.currentVAO){var t=h();e?t.bindVertexArrayOES(e.vao):t.bindVertexArrayOES(null),f.currentVAO=e}}:function(e){if(e!==f.currentVAO){if(e)e.bindAttrs();else for(var n=d(),r=0;r<s.length;++r){var i=s[r];i.buffer?(t.enableVertexAttribArray(r),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&i.divisor&&n.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}f.currentVAO=e}},clear:h()?function(){z(l).forEach((function(e){e.destroy()}))}:function(){}};function h(){return n.oes_vertex_array_object}function d(){return n.angle_instanced_arrays}function p(){this.id=++c,this.attributes=[];var e=h();this.vao=e?e.createVertexArrayOES():null,l[this.id]=this,this.buffers=[]}return p.prototype.bindAttrs=function(){for(var e=d(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(t.enableVertexAttribArray(r),t.bindBuffer(34962,i.buffer.buffer),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),e&&i.divisor&&e.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var o=n.length;o<a;++o)t.disableVertexAttribArray(o)},p.prototype.refresh=function(){var e=h();e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),f.currentVAO=this)},p.prototype.destroy=function(){if(this.vao){var e=h();this===f.currentVAO&&(f.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}l[this.id]&&(delete l[this.id],i.vaoCount-=1)},f}(i,h,y,f,b),x=function(t,n,r,i){var o={},a=0,s={uint8:5121,uint16:5123};function u(e){this.id=a++,o[this.id]=this,this.buffer=e,this.primType=4,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=5125),u.prototype.bind=function(){this.buffer.bind()};var c=[];function l(i,o,a,s,u,c,l){var f;if(i.buffer.bind(),o){var h=l;l||e(o)&&(!F(o)||e(o.data))||(h=n.oes_element_index_uint?5125:5123),r._initBuffer(i.buffer,o,a,h,3)}else t.bufferData(34963,c,a),i.buffer.dtype=f||5121,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=c;if(f=l,!l){switch(i.buffer.dtype){case 5121:case 5120:f=5121;break;case 5123:case 5122:f=5123;break;case 5125:case 5124:f=5125;break;default:S.raise("unsupported type for element array")}i.buffer.dtype=f}i.type=f,S(5125!==f||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var d=u;d<0&&(d=i.buffer.byteLength,5123===f?d>>=1:5125===f&&(d>>=2)),i.vertCount=d;var p=s;if(s<0){p=4;var v=i.buffer.dimension;1===v&&(p=0),2===v&&(p=1),3===v&&(p=4)}i.primType=p}function f(e){i.elementsCount--,S(null!==e.buffer,"must not double destroy elements"),delete o[e.id],e.buffer.destroy(),e.buffer=null}return{create:function(t,n){var o=r.create(null,34963,!0),a=new u(o._buffer);function c(t){if(t)if("number"==typeof t)o(t),a.primType=4,a.vertCount=0|t,a.type=5121;else{var n=null,r=35044,i=-1,u=-1,f=0,h=0;Array.isArray(t)||e(t)||F(t)?n=t:(S.type(t,"object","invalid arguments for elements"),"data"in t&&(n=t.data,S(Array.isArray(n)||e(n)||F(n),"invalid data for element buffer")),"usage"in t&&(S.parameter(t.usage,H,"invalid element buffer usage"),r=H[t.usage]),"primitive"in t&&(S.parameter(t.primitive,K,"invalid element buffer primitive"),i=K[t.primitive]),"count"in t&&(S("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),u=0|t.count),"type"in t&&(S.parameter(t.type,s,"invalid buffer type"),h=s[t.type]),"length"in t?f=0|t.length:(f=u,5123===h||5122===h?f*=2:5125!==h&&5124!==h||(f*=4))),l(a,n,r,i,u,f,h)}else o(),a.primType=4,a.vertCount=0,a.type=5121;return c}return i.elementsCount++,c(t),c._reglType="elements",c._elements=a,c.subdata=function(e,t){return o.subdata(e,t),c},c.destroy=function(){f(a)},c},createStream:function(e){var t=c.pop();return t||(t=new u(r.create(null,34963,!0,!1)._buffer)),l(t,e,35040,-1,-1,0,0),t},destroyStream:function(e){c.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof u?e._elements:null},clear:function(){z(o).forEach(f)}}}(i,h,b,f),w=function(e,n,r,i){var o={},a={};function s(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function u(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function c(t,r,i){var s=35632===t?o:a,u=s[r];if(!u){var c=n.str(r);u=e.createShader(t),e.shaderSource(u,c),e.compileShader(u),S.shaderError(e,u,c,t,i),s[r]=u}return u}var l={},f=[],h=0;function d(e,t){this.id=h++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function p(t,r,o){var a,l,f=c(35632,t.fragId),h=c(35633,t.vertId),d=t.program=e.createProgram();if(e.attachShader(d,f),e.attachShader(d,h),o)for(a=0;a<o.length;++a){var p=o[a];e.bindAttribLocation(d,p[0],p[1])}e.linkProgram(d),S.linkError(e,d,n.str(t.fragId),n.str(t.vertId),r);var v=e.getProgramParameter(d,35718);i.profile&&(t.stats.uniformsCount=v);var g=t.uniforms;for(a=0;a<v;++a)if(l=e.getActiveUniform(d,a))if(l.size>1)for(var m=0;m<l.size;++m){var y=l.name.replace("[0]","["+m+"]");u(g,new s(y,n.id(y),e.getUniformLocation(d,y),l))}else u(g,new s(l.name,n.id(l.name),e.getUniformLocation(d,l.name),l));var b=e.getProgramParameter(d,35721);i.profile&&(t.stats.attributesCount=b);var _=t.attributes;for(a=0;a<b;++a)(l=e.getActiveAttrib(d,a))&&u(_,new s(l.name,n.id(l.name),e.getAttribLocation(d,l.name),l))}return i.profile&&(r.getMaxUniformsCount=function(){var e=0;return f.forEach((function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)})),e},r.getMaxAttributesCount=function(){var e=0;return f.forEach((function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)})),e}),{clear:function(){var t=e.deleteShader.bind(e);z(o).forEach(t),o={},z(a).forEach(t),a={},f.forEach((function(t){e.deleteProgram(t.program)})),f.length=0,l={},r.shaderCount=0},program:function(n,i,s,u){S.command(n>=0,"missing vertex shader",s),S.command(i>=0,"missing fragment shader",s);var c=l[i];c||(c=l[i]={});var h=c[n];if(h&&(h.refCount++,!u))return h;var v=new d(i,n);return r.shaderCount++,p(v,s,u),h||(c[n]=v),f.push(v),t(v,{destroy:function(){if(v.refCount--,v.refCount<=0){e.deleteProgram(v.program);var t=f.indexOf(v);f.splice(t,1),r.shaderCount--}c[v.vertId].refCount<=0&&(e.deleteShader(a[v.vertId]),delete a[v.vertId],delete l[v.fragId][v.vertId]),Object.keys(l[v.fragId]).length||(e.deleteShader(o[v.fragId]),delete o[v.fragId],delete l[v.fragId])}})},restore:function(){o={},a={};for(var e=0;e<f.length;++e)p(f[e],null,f[e].attributes.map((function(e){return[e.location,e.name]})))},shader:c,frag:-1,vert:-1}}(i,l,f,r),A=Te(i,h,y,(function(){O.procs.poll()}),m,f,r),T=function(e,t,n,r,i){var o={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(o.srgba=35907),t.ext_color_buffer_half_float&&(o.rgba16f=34842,o.rgb16f=34843),t.webgl_color_buffer_float&&(o.rgba32f=34836);var a=[];Object.keys(o).forEach((function(e){var t=o[e];a[t]=e}));var s=0,u={};function c(e){this.id=s++,this.refCount=1,this.renderbuffer=e,this.format=32854,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function l(t){var n=t.renderbuffer;S(n,"must not double destroy renderbuffer"),e.bindRenderbuffer(36161,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete u[t.id],r.renderbufferCount--}return c.prototype.decRef=function(){--this.refCount<=0&&l(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(u).forEach((function(t){e+=u[t].stats.size})),e}),{create:function(t,s){var l=new c(e.createRenderbuffer());function f(t,r){var s=0,u=0,c=32854;if("object"==typeof t&&t){var h=t;if("shape"in h){var d=h.shape;S(Array.isArray(d)&&d.length>=2,"invalid renderbuffer shape"),s=0|d[0],u=0|d[1]}else"radius"in h&&(s=u=0|h.radius),"width"in h&&(s=0|h.width),"height"in h&&(u=0|h.height);"format"in h&&(S.parameter(h.format,o,"invalid renderbuffer format"),c=o[h.format])}else"number"==typeof t?(s=0|t,u="number"==typeof r?0|r:s):t?S.raise("invalid arguments to renderbuffer constructor"):s=u=1;if(S(s>0&&u>0&&s<=n.maxRenderbufferSize&&u<=n.maxRenderbufferSize,"invalid renderbuffer size"),s!==l.width||u!==l.height||c!==l.format)return f.width=l.width=s,f.height=l.height=u,l.format=c,e.bindRenderbuffer(36161,l.renderbuffer),e.renderbufferStorage(36161,c,s,u),S(0===e.getError(),"invalid render buffer format"),i.profile&&(l.stats.size=Ce(l.format,l.width,l.height)),f.format=a[l.format],f}return u[l.id]=l,r.renderbufferCount++,f(t,s),f.resize=function(t,r){var o=0|t,a=0|r||o;return o===l.width&&a===l.height||(S(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),f.width=l.width=o,f.height=l.height=a,e.bindRenderbuffer(36161,l.renderbuffer),e.renderbufferStorage(36161,l.format,o,a),S(0===e.getError(),"invalid render buffer format"),i.profile&&(l.stats.size=Ce(l.format,l.width,l.height))),f},f._reglType="renderbuffer",f._renderbuffer=l,i.profile&&(f.stats=l.stats),f.destroy=function(){l.decRef()},f},clear:function(){z(u).forEach(l)},restore:function(){z(u).forEach((function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,t.renderbuffer),e.renderbufferStorage(36161,t.format,t.width,t.height)})),e.bindRenderbuffer(36161,null)}}}(i,h,y,f,r),E=function(e,n,r,i,o,a){var s={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],c=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&c.push("srgba"),n.ext_color_buffer_half_float&&c.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&c.push("rgba32f");var l=["uint8"];function f(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,i=0;t?(r=t.width,i=t.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function h(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function d(e,t,n){if(e)if(e.texture){var r=e.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);S(i===t&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=e.renderbuffer._renderbuffer;S(a.width===t&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function p(t,n){n&&(n.texture?e.framebufferTexture2D(36160,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(36160,t,36161,n.renderbuffer._renderbuffer.renderbuffer))}function v(e){var t=3553,n=null,r=null,i=e;"object"==typeof e&&(i=e.data,"target"in e&&(t=0|e.target)),S.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,S(3553===t)):"textureCube"===o?(n=i,S(t>=34069&&t<34075,"invalid cube map target")):"renderbuffer"===o?(r=i,t=36161):S.raise("invalid regl object for attachment"),new f(t,n,r)}function g(e,t,n,r,a){if(n){var s=i.create2D({width:e,height:t,format:r,type:a});return s._texture.refCount=0,new f(3553,s,null)}var u=o.create({width:e,height:t,format:r});return u._renderbuffer.refCount=0,new f(36161,null,u)}function m(e){return e&&(e.texture||e.renderbuffer)}function y(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}n.oes_texture_half_float&&l.push("half float","float16"),n.oes_texture_float&&l.push("float","float32");var b=0,_={};function x(){this.id=b++,_[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function w(e){e.colorAttachments.forEach(h),h(e.depthAttachment),h(e.stencilAttachment),h(e.depthStencilAttachment)}function A(t){var n=t.framebuffer;S(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,a.framebufferCount--,delete _[t.id]}function T(t){var n;e.bindFramebuffer(36160,t.framebuffer);var i=t.colorAttachments;for(n=0;n<i.length;++n)p(36064+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)e.framebufferTexture2D(36160,36064+n,3553,null,0);e.framebufferTexture2D(36160,33306,3553,null,0),e.framebufferTexture2D(36160,36096,3553,null,0),e.framebufferTexture2D(36160,36128,3553,null,0),p(36096,t.depthAttachment),p(36128,t.stencilAttachment),p(33306,t.depthStencilAttachment);var o=e.checkFramebufferStatus(36160);e.isContextLost()||36053===o||S.raise("framebuffer configuration not supported, status = "+Pe[o]),e.bindFramebuffer(36160,s.next?s.next.framebuffer:null),s.cur=s.next,e.getError()}function E(e,i){var o=new x;function f(e,t){var i;S(s.next!==o,"can not update framebuffer which is currently in use");var a=0,h=0,p=!0,y=!0,b=null,_=!0,x="rgba",A="uint8",E=1,C=null,M=null,k=null,O=!1;if("number"==typeof e)a=0|e,h=0|t||a;else if(e){S.type(e,"object","invalid arguments for framebuffer");var I=e;if("shape"in I){var P=I.shape;S(Array.isArray(P)&&P.length>=2,"invalid shape for framebuffer"),a=P[0],h=P[1]}else"radius"in I&&(a=h=I.radius),"width"in I&&(a=I.width),"height"in I&&(h=I.height);("color"in I||"colors"in I)&&(b=I.color||I.colors,Array.isArray(b)&&S(1===b.length||n.webgl_draw_buffers,"multiple render targets not supported")),b||("colorCount"in I&&(E=0|I.colorCount,S(E>0,"invalid color buffer count")),"colorTexture"in I&&(_=!!I.colorTexture,x="rgba4"),"colorType"in I&&(A=I.colorType,_?(S(n.oes_texture_float||!("float"===A||"float32"===A),"you must enable OES_texture_float in order to use floating point framebuffer objects"),S(n.oes_texture_half_float||!("half float"===A||"float16"===A),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===A||"float16"===A?(S(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),x="rgba16f"):"float"!==A&&"float32"!==A||(S(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),x="rgba32f"),S.oneOf(A,l,"invalid color type")),"colorFormat"in I&&(x=I.colorFormat,u.indexOf(x)>=0?_=!0:c.indexOf(x)>=0?_=!1:_?S.oneOf(I.colorFormat,u,"invalid color format for texture"):S.oneOf(I.colorFormat,c,"invalid color format for renderbuffer"))),("depthTexture"in I||"depthStencilTexture"in I)&&(O=!(!I.depthTexture&&!I.depthStencilTexture),S(!O||n.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in I&&("boolean"==typeof I.depth?p=I.depth:(C=I.depth,y=!1)),"stencil"in I&&("boolean"==typeof I.stencil?y=I.stencil:(M=I.stencil,p=!1)),"depthStencil"in I&&("boolean"==typeof I.depthStencil?p=y=I.depthStencil:(k=I.depthStencil,p=!1,y=!1))}else a=h=1;var L=null,R=null,N=null,D=null;if(Array.isArray(b))L=b.map(v);else if(b)L=[v(b)];else for(L=new Array(E),i=0;i<E;++i)L[i]=g(a,h,_,x,A);S(n.webgl_draw_buffers||L.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),S(L.length<=r.maxColorAttachments,"too many color attachments, not supported"),a=a||L[0].width,h=h||L[0].height,C?R=v(C):p&&!y&&(R=g(a,h,O,"depth","uint32")),M?N=v(M):y&&!p&&(N=g(a,h,!1,"stencil","uint8")),k?D=v(k):!C&&!M&&y&&p&&(D=g(a,h,O,"depth stencil","depth stencil")),S(!!C+!!M+!!k<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var F=null;for(i=0;i<L.length;++i)if(d(L[i],a,h),S(!L[i]||L[i].texture&&Me.indexOf(L[i].texture._texture.format)>=0||L[i].renderbuffer&&Ie.indexOf(L[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),L[i]&&L[i].texture){var z=ke[L[i].texture._texture.format]*Oe[L[i].texture._texture.type];null===F?F=z:S(F===z,"all color attachments much have the same number of bits per pixel.")}return d(R,a,h),S(!R||R.texture&&6402===R.texture._texture.format||R.renderbuffer&&33189===R.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object"),d(N,a,h),S(!N||N.renderbuffer&&36168===N.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object"),d(D,a,h),S(!D||D.texture&&34041===D.texture._texture.format||D.renderbuffer&&34041===D.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object"),w(o),o.width=a,o.height=h,o.colorAttachments=L,o.depthAttachment=R,o.stencilAttachment=N,o.depthStencilAttachment=D,f.color=L.map(m),f.depth=m(R),f.stencil=m(N),f.depthStencil=m(D),f.width=o.width,f.height=o.height,T(o),f}return a.framebufferCount++,f(e,i),t(f,{resize:function(e,t){S(s.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|e,1),r=Math.max(0|t||n,1);if(n===o.width&&r===o.height)return f;for(var i=o.colorAttachments,a=0;a<i.length;++a)y(i[a],n,r);return y(o.depthAttachment,n,r),y(o.stencilAttachment,n,r),y(o.depthStencilAttachment,n,r),o.width=f.width=n,o.height=f.height=r,T(o),f},_reglType:"framebuffer",_framebuffer:o,destroy:function(){A(o),w(o)},use:function(e){s.setFBO({framebuffer:f},e)}})}return t(s,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof x)return t}return null},create:E,createCube:function(e){var o=Array(6);function a(e){var r;S(o.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var c,f={color:null},h=0,d=null,p="rgba",v="uint8",g=1;if("number"==typeof e)h=0|e;else if(e){S.type(e,"object","invalid arguments for framebuffer");var m=e;if("shape"in m){var y=m.shape;S(Array.isArray(y)&&y.length>=2,"invalid shape for framebuffer"),S(y[0]===y[1],"cube framebuffer must be square"),h=y[0]}else"radius"in m&&(h=0|m.radius),"width"in m?(h=0|m.width,"height"in m&&S(m.height===h,"must be square")):"height"in m&&(h=0|m.height);("color"in m||"colors"in m)&&(d=m.color||m.colors,Array.isArray(d)&&S(1===d.length||n.webgl_draw_buffers,"multiple render targets not supported")),d||("colorCount"in m&&(g=0|m.colorCount,S(g>0,"invalid color buffer count")),"colorType"in m&&(S.oneOf(m.colorType,l,"invalid color type"),v=m.colorType),"colorFormat"in m&&(p=m.colorFormat,S.oneOf(m.colorFormat,u,"invalid color format for texture"))),"depth"in m&&(f.depth=m.depth),"stencil"in m&&(f.stencil=m.stencil),"depthStencil"in m&&(f.depthStencil=m.depthStencil)}else h=1;if(d)if(Array.isArray(d))for(c=[],r=0;r<d.length;++r)c[r]=d[r];else c=[d];else{c=Array(g);var b={radius:h,format:p,type:v};for(r=0;r<g;++r)c[r]=i.createCube(b)}for(f.color=Array(c.length),r=0;r<c.length;++r){var _=c[r];S("function"==typeof _&&"textureCube"===_._reglType,"invalid cube map"),h=h||_.width,S(_.width===h&&_.height===h,"invalid cube map shape"),f.color[r]={target:34069,data:c[r]}}for(r=0;r<6;++r){for(var x=0;x<c.length;++x)f.color[x].target=34069+r;r>0&&(f.depth=o[0].depth,f.stencil=o[0].stencil,f.depthStencil=o[0].depthStencil),o[r]?o[r](f):o[r]=E(f)}return t(a,{width:h,height:h,color:c})}return a(e),t(a,{faces:o,resize:function(e){var t,n=0|e;if(S(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var i=a.color;for(t=0;t<i.length;++t)i[t].resize(n);for(t=0;t<6;++t)o[t].resize(n);return a.width=a.height=n,a},_reglType:"framebufferCube",destroy:function(){o.forEach((function(e){e.destroy()}))}})},clear:function(){z(_).forEach(A)},restore:function(){s.cur=null,s.next=null,s.dirty=!0,z(_).forEach((function(t){t.framebuffer=e.createFramebuffer(),T(t)}))}})}(i,h,y,A,T,f),O=lt(i,l,h,y,b,x,0,E,{},_,w,{elements:null,primitive:4,count:-1,offset:0,instances:-1},m,d,r),I=Re(i,E,O.procs.poll,m,o,h,y),L=O.next,R=i.canvas,N=[],j=[],U=[],B=[r.onDestroy],Q=null;function J(){if(0===N.length)return d&&d.update(),void(Q=null);Q=M.next(J),ue();for(var e=N.length-1;e>=0;--e){var t=N[e];t&&t(m,null,0)}i.flush(),d&&d.update()}function $(){!Q&&N.length>0&&(Q=M.next(J))}function ee(){Q&&(M.cancel(J),Q=null)}function te(e){e.preventDefault(),a=!0,ee(),j.forEach((function(e){e()}))}function ne(e){i.getError(),a=!1,s.restore(),w.restore(),b.restore(),A.restore(),T.restore(),E.restore(),_.restore(),d&&d.restore(),O.procs.refresh(),$(),U.forEach((function(e){e()}))}function re(e){function n(e,t){var n={},r={};return Object.keys(e).forEach((function(i){var o=e[i];if(C.isDynamic(o))r[i]=C.unbox(o,i);else{if(t&&Array.isArray(o))for(var a=0;a<o.length;++a)if(C.isDynamic(o[a]))return void(r[i]=C.unbox(o,i));n[i]=o}})),{dynamic:r,static:n}}S(!!e,"invalid args to regl({...})"),S.type(e,"object","invalid args to regl({...})");var r=n(e.context||{},!0),i=n(e.uniforms||{},!0),o=n(e.attributes||{},!1),s=n(function(e){var n=t({},e);function r(e){if(e in n){var t=n[e];delete n[e],Object.keys(t).forEach((function(r){n[e+"."+r]=t[r]}))}}return delete n.uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in e&&(n.vao=e.vao),n}(e),!1),u={gpuTime:0,cpuTime:0,count:0},c=O.compile(s,o,i,r,u),l=c.draw,f=c.batch,h=c.scope,d=[];return t((function(e,t){var n;if(a&&S.raise("context lost"),"function"==typeof e)return h.call(this,null,e,0);if("function"==typeof t)if("number"==typeof e)for(n=0;n<e;++n)h.call(this,null,t,n);else{if(!Array.isArray(e))return h.call(this,e,t,0);for(n=0;n<e.length;++n)h.call(this,e[n],t,n)}else if("number"==typeof e){if(e>0)return f.call(this,function(e){for(;d.length<e;)d.push(null);return d}(0|e),0|e)}else{if(!Array.isArray(e))return l.call(this,e);if(e.length)return f.call(this,e,e.length)}}),{stats:u,destroy:function(){c.destroy()}})}R&&(R.addEventListener("webglcontextlost",te,!1),R.addEventListener("webglcontextrestored",ne,!1));var ie=E.setFBO=re({framebuffer:C.define.call(null,1,"framebuffer")});function oe(e,t){var n=0;O.procs.poll();var r=t.color;r&&(i.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),n|=16384),"depth"in t&&(i.clearDepth(+t.depth),n|=256),"stencil"in t&&(i.clearStencil(0|t.stencil),n|=1024),S(!!n,"called regl.clear with no buffer specified"),i.clear(n)}function ae(e){return S.type(e,"function","regl.frame() callback must be a function"),N.push(e),$(),{cancel:function(){var t=ht(N,e);S(t>=0,"cannot cancel a frame twice"),N[t]=function e(){var t=ht(N,e);N[t]=N[N.length-1],N.length-=1,N.length<=0&&ee()}}}}function se(){var e=L.viewport,t=L.scissor_box;e[0]=e[1]=t[0]=t[1]=0,m.viewportWidth=m.framebufferWidth=m.drawingBufferWidth=e[2]=t[2]=i.drawingBufferWidth,m.viewportHeight=m.framebufferHeight=m.drawingBufferHeight=e[3]=t[3]=i.drawingBufferHeight}function ue(){m.tick+=1,m.time=le(),se(),O.procs.poll()}function ce(){A.refresh(),se(),O.procs.refresh(),d&&d.update()}function le(){return(k()-p)/1e3}ce();var fe=t(re,{clear:function(e){if(S("object"==typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var n=0;n<6;++n)ie(t({framebuffer:e.framebuffer.faces[n]},e),oe);else ie(e,oe);else oe(0,e)},prop:C.define.bind(null,1),context:C.define.bind(null,2),this:C.define.bind(null,3),draw:re({}),buffer:function(e){return b.create(e,34962,!1,!1)},elements:function(e){return x.create(e,!1)},texture:A.create2D,cube:A.createCube,renderbuffer:T.create,framebuffer:E.create,framebufferCube:E.createCube,vao:_.createVAO,attributes:o,frame:ae,on:function(e,t){var n;switch(S.type(t,"function","listener callback must be a function"),e){case"frame":return ae(t);case"lost":n=j;break;case"restore":n=U;break;case"destroy":n=B;break;default:S.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t)return n[e]=n[n.length-1],void n.pop()}}},limits:y,hasExtension:function(e){return y.extensions.indexOf(e.toLowerCase())>=0},read:I,destroy:function(){N.length=0,ee(),R&&(R.removeEventListener("webglcontextlost",te),R.removeEventListener("webglcontextrestored",ne)),w.clear(),E.clear(),T.clear(),A.clear(),x.clear(),b.clear(),_.clear(),d&&d.clear(),B.forEach((function(e){e()}))},_gl:i,_refresh:ce,poll:function(){ue(),d&&d.update()},now:le,stats:f});return r.onDone(null,fe),fe}}()})),uT=function(){function e(t,n){dr(this,e),gr(this,"attribute",void 0),gr(this,"buffer",void 0);var r=n.buffer,i=n.offset,o=n.stride,a=n.normalized,s=n.size,u=n.divisor;this.buffer=r,this.attribute={buffer:r.get(),offset:i||0,stride:o||0,normalized:a||!1,divisor:u||0},s&&(this.attribute.size=s)}return vr(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(e){this.buffer.subData(e)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),cT=(gr(YA={},e.gl.POINTS,"points"),gr(YA,e.gl.LINES,"lines"),gr(YA,e.gl.LINE_LOOP,"line loop"),gr(YA,e.gl.LINE_STRIP,"line strip"),gr(YA,e.gl.TRIANGLES,"triangles"),gr(YA,e.gl.TRIANGLE_FAN,"triangle fan"),gr(YA,e.gl.TRIANGLE_STRIP,"triangle strip"),YA),lT=(gr(qA={},e.gl.STATIC_DRAW,"static"),gr(qA,e.gl.DYNAMIC_DRAW,"dynamic"),gr(qA,e.gl.STREAM_DRAW,"stream"),qA),fT=(gr(XA={},e.gl.BYTE,"int8"),gr(XA,e.gl.UNSIGNED_INT,"int16"),gr(XA,e.gl.INT,"int32"),gr(XA,e.gl.UNSIGNED_BYTE,"uint8"),gr(XA,e.gl.UNSIGNED_SHORT,"uint16"),gr(XA,e.gl.UNSIGNED_INT,"uint32"),gr(XA,e.gl.FLOAT,"float"),XA),hT=(gr(KA={},e.gl.ALPHA,"alpha"),gr(KA,e.gl.LUMINANCE,"luminance"),gr(KA,e.gl.LUMINANCE_ALPHA,"luminance alpha"),gr(KA,e.gl.RGB,"rgb"),gr(KA,e.gl.RGBA,"rgba"),gr(KA,e.gl.RGBA4,"rgba4"),gr(KA,e.gl.RGB5_A1,"rgb5 a1"),gr(KA,e.gl.RGB565,"rgb565"),gr(KA,e.gl.DEPTH_COMPONENT,"depth"),gr(KA,e.gl.DEPTH_STENCIL,"depth stencil"),KA),dT=(gr(QA={},e.gl.DONT_CARE,"dont care"),gr(QA,e.gl.NICEST,"nice"),gr(QA,e.gl.FASTEST,"fast"),QA),pT=(gr(JA={},e.gl.NEAREST,"nearest"),gr(JA,e.gl.LINEAR,"linear"),gr(JA,e.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),gr(JA,e.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),gr(JA,e.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),gr(JA,e.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),JA),vT=(gr($A={},e.gl.REPEAT,"repeat"),gr($A,e.gl.CLAMP_TO_EDGE,"clamp"),gr($A,e.gl.MIRRORED_REPEAT,"mirror"),$A),gT=(gr(eT={},e.gl.NONE,"none"),gr(eT,e.gl.BROWSER_DEFAULT_WEBGL,"browser"),eT),mT=(gr(tT={},e.gl.NEVER,"never"),gr(tT,e.gl.ALWAYS,"always"),gr(tT,e.gl.LESS,"less"),gr(tT,e.gl.LEQUAL,"lequal"),gr(tT,e.gl.GREATER,"greater"),gr(tT,e.gl.GEQUAL,"gequal"),gr(tT,e.gl.EQUAL,"equal"),gr(tT,e.gl.NOTEQUAL,"notequal"),tT),yT=(gr(nT={},e.gl.FUNC_ADD,"add"),gr(nT,e.gl.MIN_EXT,"min"),gr(nT,e.gl.MAX_EXT,"max"),gr(nT,e.gl.FUNC_SUBTRACT,"subtract"),gr(nT,e.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),nT),bT=(gr(rT={},e.gl.ZERO,"zero"),gr(rT,e.gl.ONE,"one"),gr(rT,e.gl.SRC_COLOR,"src color"),gr(rT,e.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),gr(rT,e.gl.SRC_ALPHA,"src alpha"),gr(rT,e.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),gr(rT,e.gl.DST_COLOR,"dst color"),gr(rT,e.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),gr(rT,e.gl.DST_ALPHA,"dst alpha"),gr(rT,e.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),gr(rT,e.gl.CONSTANT_COLOR,"constant color"),gr(rT,e.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),gr(rT,e.gl.CONSTANT_ALPHA,"constant alpha"),gr(rT,e.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),gr(rT,e.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),rT),_T=(gr(iT={},e.gl.NEVER,"never"),gr(iT,e.gl.ALWAYS,"always"),gr(iT,e.gl.LESS,"less"),gr(iT,e.gl.LEQUAL,"lequal"),gr(iT,e.gl.GREATER,"greater"),gr(iT,e.gl.GEQUAL,"gequal"),gr(iT,e.gl.EQUAL,"equal"),gr(iT,e.gl.NOTEQUAL,"notequal"),iT),xT=(gr(oT={},e.gl.ZERO,"zero"),gr(oT,e.gl.KEEP,"keep"),gr(oT,e.gl.REPLACE,"replace"),gr(oT,e.gl.INVERT,"invert"),gr(oT,e.gl.INCR,"increment"),gr(oT,e.gl.DECR,"decrement"),gr(oT,e.gl.INCR_WRAP,"increment wrap"),gr(oT,e.gl.DECR_WRAP,"decrement wrap"),oT),ST=(gr(aT={},e.gl.FRONT,"front"),gr(aT,e.gl.BACK,"back"),aT),wT=function(){function t(n,r){dr(this,t),gr(this,"buffer",void 0);var i=r.data,o=r.usage,a=r.type;this.buffer=n.buffer({data:i,usage:lT[o||e.gl.STATIC_DRAW],type:fT[a||e.gl.UNSIGNED_BYTE]})}return vr(t,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(e){var t=e.data,n=e.offset;this.buffer.subdata(t,n)}}]),t}(),AT=function(){function t(n,r){dr(this,t),gr(this,"elements",void 0);var i=r.data,o=r.usage,a=r.type,s=r.count;this.elements=n.elements({data:i,usage:lT[o||e.gl.STATIC_DRAW],type:fT[a||e.gl.UNSIGNED_BYTE],count:s})}return vr(t,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(e){var t=e.data;this.elements.subdata(t)}},{key:"destroy",value:function(){}}]),t}(),TT=function(){function e(t,n){dr(this,e),gr(this,"framebuffer",void 0);var r=n.width,i=n.height,o=n.color,a=n.colors,s=(n.depth,n.stencil,{width:r,height:i});Array.isArray(a)&&(s.colors=a.map((function(e){return e.get()}))),o&&"boolean"!=typeof o&&(s.color=o.get()),this.framebuffer=t.framebuffer(s)}return vr(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.framebuffer.resize(t,n)}}]),e}(),ET=ce.f,CT=function(e){return function(t){for(var n,r=ge(t),i=Ht(r),o=i.length,a=0,s=[];o>a;)n=i[a++],ae&&!ET.call(r,n)||s.push(e?[n,r[n]]:r[n]);return s}},MT={entries:CT(!0),values:CT(!1)}.values;Lt({target:"Object",stat:!0},{values:function(e){return MT(e)}});var kT,OT,IT,PT,LT,RT=function(){function t(n,r){dr(this,t),gr(this,"reGl",void 0),gr(this,"destroyed",!1),gr(this,"drawCommand",void 0),gr(this,"drawParams",void 0),gr(this,"options",void 0),gr(this,"uniforms",{}),this.reGl=n;var i=r.vs,o=r.fs,a=r.attributes,s=r.uniforms,u=r.primitive,c=r.count,l=r.elements,f=r.depth,h=r.blend,d=r.stencil,p=r.cull,v=r.instances,g={};this.options=r,s&&(this.uniforms=this.extractUniforms(s),Object.keys(s).forEach((function(e){g[e]=n.prop(e)})));var m={};Object.keys(a).forEach((function(e){m[e]=a[e].get()}));var y={attributes:m,frag:o,uniforms:g,vert:i,primitive:cT[void 0===u?e.gl.TRIANGLES:u]};v&&(y.instances=v),c&&(y.count=c),l&&(y.elements=l.get()),this.initDepthDrawParams({depth:f},y),this.initBlendDrawParams({blend:h},y),this.initStencilDrawParams({stencil:d},y),this.initCullDrawParams({cull:p},y),this.drawCommand=n(y),this.drawParams=y}return vr(t,[{key:"addUniforms",value:function(e){this.uniforms=cr(cr({},this.uniforms),this.extractUniforms(e))}},{key:"draw",value:function(e){if(!this.drawParams.attributes||0!==Object.keys(this.drawParams.attributes).length){var t=cr(cr({},this.uniforms),this.extractUniforms(e.uniforms||{})),n={};Object.keys(t).forEach((function(e){var r=lr(t[e]);"boolean"===r||"number"===r||Array.isArray(t[e])||t[e].BYTES_PER_ELEMENT?n[e]=t[e]:n[e]=t[e].get()})),this.drawCommand(n)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach((function(e){e.destroy()})),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,n){var r=t.depth;r&&(n.depth={enable:void 0===r.enable||!!r.enable,mask:void 0===r.mask||!!r.mask,func:mT[r.func||e.gl.LESS],range:r.range||[0,1]})}},{key:"initBlendDrawParams",value:function(t,n){var r=t.blend;if(r){var i=r.enable,o=r.func,a=r.equation,s=r.color,u=void 0===s?[0,0,0,0]:s;n.blend={enable:!!i,func:{srcRGB:bT[o&&o.srcRGB||e.gl.SRC_ALPHA],srcAlpha:bT[o&&o.srcAlpha||e.gl.SRC_ALPHA],dstRGB:bT[o&&o.dstRGB||e.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:bT[o&&o.dstAlpha||e.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:yT[a&&a.rgb||e.gl.FUNC_ADD],alpha:yT[a&&a.alpha||e.gl.FUNC_ADD]},color:u}}}},{key:"initStencilDrawParams",value:function(t,n){var r=t.stencil;if(r){var i=r.enable,o=r.mask,a=void 0===o?-1:o,s=r.func,u=void 0===s?{cmp:e.gl.ALWAYS,ref:0,mask:-1}:s,c=r.opFront,l=void 0===c?{fail:e.gl.KEEP,zfail:e.gl.KEEP,zpass:e.gl.KEEP}:c,f=r.opBack,h=void 0===f?{fail:e.gl.KEEP,zfail:e.gl.KEEP,zpass:e.gl.KEEP}:f;n.stencil={enable:!!i,mask:a,func:cr(cr({},u),{},{cmp:_T[u.cmp]}),opFront:{fail:xT[l.fail],zfail:xT[l.zfail],zpass:xT[l.zpass]},opBack:{fail:xT[h.fail],zfail:xT[h.zfail],zpass:xT[h.zpass]}}}}},{key:"initCullDrawParams",value:function(t,n){var r=t.cull;if(r){var i=r.enable,o=r.face,a=void 0===o?e.gl.BACK:o;n.cull={enable:!!i,face:ST[a]}}}},{key:"extractUniforms",value:function(e){var t=this,n={};return Object.keys(e).forEach((function(r){t.extractUniformsRecursively(r,e[r],n,"")})),n}},{key:"extractUniformsRecursively",value:function(e,t,n,r){var i=this;null===t||"number"==typeof t||"boolean"==typeof t||Array.isArray(t)&&"number"==typeof t[0]||xy(t)||""===t||"resize"in t?n["".concat(r&&r+".").concat(e)]=t:(vy(t)&&Object.keys(t).forEach((function(o){i.extractUniformsRecursively(o,t[o],n,"".concat(r&&r+".").concat(e))})),Array.isArray(t)&&t.forEach((function(t,o){Object.keys(t).forEach((function(a){i.extractUniformsRecursively(a,t[a],n,"".concat(r&&r+".").concat(e,"[").concat(o,"]"))}))})))}}]),t}(),NT=function(){function t(n,r){dr(this,t),gr(this,"texture",void 0),gr(this,"width",void 0),gr(this,"height",void 0);var i=r.data,o=r.type,a=void 0===o?e.gl.UNSIGNED_BYTE:o,s=r.width,u=r.height,c=r.flipY,l=void 0!==c&&c,f=r.format,h=void 0===f?e.gl.RGBA:f,d=r.mipmap,p=void 0!==d&&d,v=r.wrapS,g=void 0===v?e.gl.CLAMP_TO_EDGE:v,m=r.wrapT,y=void 0===m?e.gl.CLAMP_TO_EDGE:m,b=r.aniso,_=void 0===b?0:b,x=r.alignment,S=void 0===x?1:x,w=r.premultiplyAlpha,A=void 0!==w&&w,T=r.mag,E=void 0===T?e.gl.NEAREST:T,C=r.min,M=void 0===C?e.gl.NEAREST:C,k=r.colorSpace,O=void 0===k?e.gl.BROWSER_DEFAULT_WEBGL:k;this.width=s,this.height=u;var I={width:s,height:u,type:fT[a],format:hT[h],wrapS:vT[g],wrapT:vT[y],mag:pT[E],min:pT[M],alignment:S,flipY:l,colorSpace:gT[O],premultiplyAlpha:A,aniso:_};i&&(I.data=i),"number"==typeof p?I.mipmap=dT[p]:"boolean"==typeof p&&(I.mipmap=p),this.texture=n.texture(I)}return vr(t,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.texture(e)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.texture.resize(t,n),this.width=t,this.height=n}},{key:"destroy",value:function(){this.texture.destroy()}}]),t}(),DT=$()(kT=function(){function e(){var t=this;dr(this,e),gr(this,"extensionObject",void 0),gr(this,"gl",void 0),gr(this,"$container",void 0),gr(this,"canvas",void 0),gr(this,"width",void 0),gr(this,"height",void 0),gr(this,"isDirty",void 0),gr(this,"createModel",(function(e){return new RT(t.gl,e)})),gr(this,"createAttribute",(function(e){return new uT(t.gl,e)})),gr(this,"createBuffer",(function(e){return new wT(t.gl,e)})),gr(this,"createElements",(function(e){return new AT(t.gl,e)})),gr(this,"createTexture2D",(function(e){return new NT(t.gl,e)})),gr(this,"createFramebuffer",(function(e){return new TT(t.gl,e)})),gr(this,"useFramebuffer",(function(e,n){t.gl({framebuffer:e?e.get():null})(n)})),gr(this,"clear",(function(e){var n=e.color,r=e.depth,i=e.stencil,o=e.framebuffer,a=void 0===o?null:o,s={color:n,depth:r,stencil:i};s.framebuffer=null===a?a:a.get(),t.gl.clear(s)})),gr(this,"viewport",(function(e){var n=e.x,r=e.y,i=e.width,o=e.height;t.gl._gl.viewport(n,r,i,o),t.width=i,t.height=o,t.gl._refresh()})),gr(this,"readPixels",(function(e){var n=e.framebuffer,r={x:e.x,y:e.y,width:e.width,height:e.height};return n&&(r.framebuffer=n.get()),t.gl.read(r)})),gr(this,"getViewportSize",(function(){return{width:t.gl._gl.drawingBufferWidth,height:t.gl._gl.drawingBufferHeight}})),gr(this,"getContainer",(function(){var e;return null===(e=t.canvas)||void 0===e?void 0:e.parentElement})),gr(this,"getCanvas",(function(){return t.canvas})),gr(this,"getGLContext",(function(){return t.gl._gl})),gr(this,"destroy",(function(){t.gl.destroy()}))}var t;return vr(e,[{key:"init",value:(t=hr(regeneratorRuntime.mark((function e(t,n){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.canvas=t,e.next=3,new Promise((function(e,t){sT({canvas:r.canvas,attributes:{alpha:!0,antialias:n.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:n.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(n,r){!n&&r||t(n),e(r)}})}));case 3:this.gl=e.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"testExtension",value:function(e){return!!this.getGLContext().getExtension(e)}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var e=this.getGLContext();e.disable(e.CULL_FACE)}},{key:"setDirty",value:function(e){this.isDirty=e}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||kT,FT=function(){function e(t){dr(this,e),gr(this,"sceneService",void 0),gr(this,"mapService",void 0),gr(this,"controlService",void 0),gr(this,"layerService",void 0),gr(this,"iconService",void 0),gr(this,"markerService",void 0),gr(this,"popupService",void 0),gr(this,"fontService",void 0),gr(this,"interactionService",void 0),gr(this,"container",void 0);var n=t.id,r=t.map,i=cA();this.container=i,r.setContainer(i,n),i.bind(sr.IRendererService).to(DT).inSingletonScope(),this.sceneService=i.get(sr.ISceneService),this.mapService=i.get(sr.IMapService),this.iconService=i.get(sr.IIconService),this.fontService=i.get(sr.IFontService),this.controlService=i.get(sr.IControlService),this.layerService=i.get(sr.ILayerService),this.markerService=i.get(sr.IMarkerService),this.interactionService=i.get(sr.IInteractionService),this.popupService=i.get(sr.IPopupService),this.initComponent(n),this.sceneService.init(t),this.initControl()}return vr(e,[{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(e){return this.sceneService.exportPng(e)}},{key:"exportMap",value:function(e){return this.sceneService.exportPng(e)}},{key:"registerRenderService",value:function(e){var t=this;this.sceneService.loaded?new e(this).init():this.on("loaded",(function(){new e(t).init()}))}},{key:"map",get:function(){return this.mapService.map}},{key:"addLayer",value:function(e){var t=lA(this.container);e.setContainer(t),this.sceneService.addLayer(e)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(e){return this.layerService.getLayer(e)}},{key:"getLayerByName",value:function(e){return this.layerService.getLayerByName(e)}},{key:"removeLayer",value:function(e){this.layerService.remove(e)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addIconFont",value:function(e,t){this.fontService.addIconFont(e,t)}},{key:"addIconFonts",value:function(e){var t=this;e.forEach((function(e){var n=Mr(e,2),r=n[0],i=n[1];t.fontService.addIconFont(r,i)}))}},{key:"addFontFace",value:function(e,t){this.sceneService.addFontFace(e,t)}},{key:"addImage",value:function(e,t){this.iconService.addImage(e,t)}},{key:"hasImage",value:function(e){return this.iconService.hasImage(e)}},{key:"removeImage",value:function(e){this.iconService.removeImage(e)}},{key:"addIconFontGlyphs",value:function(e,t){this.fontService.addIconGlyphs(t)}},{key:"addControl",value:function(e){this.controlService.addControl(e,this.container)}},{key:"removeControl",value:function(e){this.controlService.removeControl(e)}},{key:"getControlByName",value:function(e){return this.controlService.getControlByName(e)}},{key:"addMarker",value:function(e){this.markerService.addMarker(e)}},{key:"addMarkerLayer",value:function(e){this.markerService.addMarkerLayer(e)}},{key:"removeMarkerLayer",value:function(e){this.markerService.removeMarkerLayer(e)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(e){this.popupService.addPopup(e)}},{key:"on",value:function(e,t){-1===PA.indexOf(e)?this.mapService.on(e,t):this.sceneService.on(e,t)}},{key:"once",value:function(e,t){-1===PA.indexOf(e)?this.mapService.once(e,t):this.sceneService.once(e,t)}},{key:"off",value:function(e,t){-1===PA.indexOf(e)?this.mapService.off(e,t):this.sceneService.off(e,t)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(e){return this.mapService.getCenter(e)}},{key:"setCenter",value:function(e,t){return this.mapService.setCenter(e,t)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(e){return this.mapService.setPitch(e)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(e){this.mapService.setRotation(e)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(e){this.mapService.panTo(e)}},{key:"panBy",value:function(e){this.mapService.panBy(e)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(e){this.mapService.setZoom(e)}},{key:"fitBounds",value:function(e,t){var n=this.sceneService.getSceneConfig(),r=n.fitBoundsOptions,i=n.animate;this.mapService.fitBounds(e,t||cr(cr({},r),{},{animate:i}))}},{key:"setZoomAndCenter",value:function(e,t){this.mapService.setZoomAndCenter(e,t)}},{key:"setMapStyle",value:function(e){this.mapService.setMapStyle(e)}},{key:"setMapStatus",value:function(e){this.mapService.setMapStatus(e)}},{key:"pixelToLngLat",value:function(e){return this.mapService.pixelToLngLat(e)}},{key:"lngLatToPixel",value:function(e){return this.mapService.lngLatToPixel(e)}},{key:"containerToLngLat",value:function(e){return this.mapService.containerToLngLat(e)}},{key:"lngLatToContainer",value:function(e){return this.mapService.lngLatToContainer(e)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(e,t){this.container.bind(sr.IPostProcessingPass).to(e).whenTargetNamed(t)}},{key:"initComponent",value:function(e){this.controlService.init({container:Ea(e)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var e=this.sceneService.getSceneConfig(),t=e.logoVisible,n=e.logoPosition;t&&this.addControl(new DA({position:n}))}}]),e}(),zT=(OT=sA(sr.IGlobalConfigService),PT=Rr((IT=function(){function e(t){dr(this,e),Lr(this,"configService",PT,this),gr(this,"config",void 0),this.config=t}return vr(e,[{key:"setContainer",value:function(e,t){e.bind(sr.MapConfig).toConstantValue(cr(cr({},this.config),{},{id:t})),e.bind(sr.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}()).prototype,"configService",[OT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IT),jT=o((function(e,t){e.exports=function(){function e(e){var r=[];return e.AMapUI&&r.push(t(e.AMapUI)),e.Loca&&r.push(n(e.Loca)),Promise.all(r)}function t(e){return new Promise((function(t,n){var i=[];if(e.plugins)for(var u=0;u<e.plugins.length;u+=1)-1==o.AMapUI.plugins.indexOf(e.plugins[u])&&i.push(e.plugins[u]);if(a.AMapUI===r.failed)n(" AMapUI ");else if(a.AMapUI===r.notload){a.AMapUI=r.loading,o.AMapUI.version=e.version||o.AMapUI.version,u=o.AMapUI.version;var c=document.body||document.head,l=document.createElement("script");l.type="text/javascript",l.src="https://webapi.amap.com/ui/"+u+"/main.js",l.onerror=function(e){a.AMapUI=r.failed,n(" AMapUI ")},l.onload=function(){if(a.AMapUI=r.loaded,i.length)window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}for(t();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()}));else for(t();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()},c.appendChild(l)}else a.AMapUI===r.loaded?e.version&&e.version!==o.AMapUI.version?n(" AMapUI "):i.length?window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}t()})):t():e.version&&e.version!==o.AMapUI.version?n(" AMapUI "):s.AMapUI.push((function(e){e?n(e):i.length?window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}t()})):t()}))}))}function n(e){return new Promise((function(t,n){if(o.AMap.version.startsWith("2.0"))n("Loca  JSAPI 2.0, 1.4.15");else if(a.Loca===r.failed)n(" Loca ");else if(a.Loca===r.notload){a.Loca=r.loading,o.Loca.version=e.version||o.Loca.version;var i=o.Loca.version,u=o.key,c=document.body||document.head,l=document.createElement("script");l.type="text/javascript",l.src="https://webapi.amap.com/loca?v="+i+"&key="+u,l.onerror=function(e){a.Loca=r.failed,n(" AMapUI ")},l.onload=function(){for(a.Loca=r.loaded,t();s.Loca.length;)s.Loca.splice(0,1)[0]()},c.appendChild(l)}else a.Loca===r.loaded?e.version&&e.version!==o.Loca.version?n(" Loca "):t():e.version&&e.version!==o.Loca.version?n(" Loca "):s.Loca.push((function(e){e?n(e):n()}))}))}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var r,i;(i=r||(r={})).notload="notload",i.loading="loading",i.loaded="loaded",i.failed="failed";var o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]},u=[];return{load:function(t){return new Promise((function(n,i){if(a.AMap==r.failed)i("");else if(a.AMap==r.notload){var s=t.key,c=t.version,l=t.plugins;s?(window.AMap&&"lbs.amap.com"!==location.host&&i("API"),o.key=s,o.AMap.version=c||o.AMap.version,o.AMap.plugins=l||o.AMap.plugins,a.AMap=r.loading,c=document.body||document.head,window.___onAPILoaded=function(o){if(delete window.___onAPILoaded,o)a.AMap=r.failed,i(o);else for(a.AMap=r.loaded,e(t).then((function(){n(window.AMap)})).catch(i);u.length;)u.splice(0,1)[0]()},(l=document.createElement("script")).type="text/javascript",l.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+o.AMap.version+"&key="+s+"&plugin="+o.AMap.plugins.join(","),l.onerror=function(e){a.AMap=r.failed,i(e)},c.appendChild(l)):i("key")}else if(a.AMap==r.loaded)if(t.key&&t.key!==o.key)i(" key");else if(t.version&&t.version!==o.AMap.version)i(" JSAPI ");else{if(s=[],t.plugins)for(c=0;c<t.plugins.length;c+=1)-1==o.AMap.plugins.indexOf(t.plugins[c])&&s.push(t.plugins[c]);s.length?window.AMap.plugin(s,(function(){e(t).then((function(){n(window.AMap)})).catch(i)})):e(t).then((function(){n(window.AMap)})).catch(i)}else if(t.key&&t.key!==o.key)i(" key");else if(t.version&&t.version!==o.AMap.version)i(" JSAPI ");else{var f=[];if(t.plugins)for(c=0;c<t.plugins.length;c+=1)-1==o.AMap.plugins.indexOf(t.plugins[c])&&f.push(t.plugins[c]);!function(e){"function"==typeof e&&(a.AMap===r.loaded?e(window.AMap):u.push(e))}((function(){f.length?window.AMap.plugin(f,(function(){e(t).then((function(){n(window.AMap)})).catch(i)})):e(t).then((function(){n(window.AMap)})).catch(i)}))}}))},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]}}}}()}));function UT(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={top:0,right:0,bottom:0,left:0};if("number"==typeof e)return{top:e,right:e,bottom:e,left:e};if(Array.isArray(e)){if(4===e.length)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(2===e.length)return{top:e[0],right:e[1],bottom:e[0],left:e[1]}}return cr(cr({},t),e)}!function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP"}(LT||(LT={}));var BT,VT,HT,GT,WT,ZT,YT,qT,XT,KT,QT,JT={dark:"amap://styles/2a09079c3daac9420ee53b67307a8006?isPublic=true",light:"amap://styles/1fd9f8ef9751298f11f5c56968312c70?isPublic=true",normal:"amap://styles/normal",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true"},$T=Math.PI/180,eE=function(){function e(){dr(this,e),gr(this,"projectionMatrix",pv()),gr(this,"viewMatrix",pv()),gr(this,"viewProjectionMatrix",pv()),gr(this,"ViewProjectionMatrixUncentered",pv()),gr(this,"viewUncenteredMatrix",pv()),gr(this,"zoom",void 0),gr(this,"center",void 0)}return vr(e,[{key:"syncWithMapCamera",value:function(e){var t=e.zoom,n=void 0===t?1:t,r=e.pitch,i=void 0===r?0:r,o=e.bearing,a=void 0===o?0:o,s=e.center,u=void 0===s?[0,0]:s,c=e.offsetOrigin,l=void 0===c?[0,0]:c,f=e.cameraHeight,h=void 0===f?1:f,d=e.aspect,p=void 0===d?1:d,v=e.near,g=void 0===v?.1:v,m=e.far,y=void 0===m?1e3:m,b=e.fov,_=void 0===b?0:b;this.zoom=n,this.center=u;var x=i*$T,S=(360-a)*$T;Mv(this.projectionMatrix,_,p,g,y);var w=Fv(h*Math.sin(x)*Math.sin(S),-h*Math.sin(x)*Math.cos(S),h*Math.cos(x)),A=Fv(-Math.cos(x)*Math.sin(S),Math.cos(x)*Math.cos(S),Math.sin(x));kv(this.viewMatrix,w,Fv(0,0,0),A),this.viewUncenteredMatrix=vv(this.viewMatrix),_v(this.viewMatrix,this.viewMatrix,Fv(-l[0],l[1],0)),bv(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),bv(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var e=Mr(this.center,2);return[e[0],e[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){var n=Math.max(Math.min(85.0511287798,e[1]),-85.0511287798),r=Math.PI/180,i=e[0]*r,o=n*r;o=Math.log(Math.tan(Math.PI/4+o/2));return[i=(256<<20)*(.5/Math.PI*i+.5)-215440491,o=-((256<<20)*(-.5/Math.PI*o+(r=.5))-106744817)]}}]),e}(),tE=["id","style","minZoom","maxZoom","token","mapInstance","plugin"],nE=0;window.forceWebGL=!0;var rE,iE,oE,aE,sE,uE,cE,lE,fE,hE,dE,pE=!1,vE=[],gE=(BT=$(),VT=J(sr.IGlobalConfigService),HT=J(sr.MapConfig),GT=J(sr.ICoordinateSystemService),WT=J(sr.IEventEmitter),BT((qT=Rr((YT=function(){function t(){var n=this;dr(this,t),gr(this,"version",LT["GAODE1.x"]),gr(this,"map",void 0),Lr(this,"configService",qT,this),Lr(this,"config",XT,this),Lr(this,"coordinateSystemService",KT,this),Lr(this,"eventEmitter",QT,this),gr(this,"markerContainer",void 0),gr(this,"$mapContainer",void 0),gr(this,"viewport",void 0),gr(this,"cameraChangedCallback",void 0),gr(this,"handleCameraChanged",(function(t){var r=t.camera,i=r.fov,o=r.near,a=r.far,s=r.height,u=r.pitch,c=r.rotation,l=r.aspect,f=r.position,h=n.getCenter(),d=h.lng,p=h.lat;if(n.cameraChangedCallback){n.viewport.syncWithMapCamera({aspect:l,bearing:360-c,far:a,fov:i,cameraHeight:s,near:o,pitch:u,zoom:n.map.getZoom()-1,center:[d,p],offsetOrigin:[f.x,f.y]});var v=n.config.offsetZoom,g=void 0===v?12:v;n.viewport.getZoom()>g?n.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.P20_OFFSET):n.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.P20),n.cameraChangedCallback(n.viewport)}}))}var n;return vr(t,[{key:"addMarkerContainer",value:function(){var e=this.map.getContainer();if(null!==e){var t=e.getElementsByClassName("amap-maps")[0];this.markerContainer=ka("div","l7-marker-container",t)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(e,t){-1!==OA.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(e,t)}},{key:"off",value:function(e,t){-1!==OA.indexOf(e)?this.eventEmitter.off(e,t):this.map.off(e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var e;return null===(e=this.map.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var e=this.map.getSize();return[e.getWidth(),e.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(e){return this.map.setZoom(e)}},{key:"getCenter",value:function(e){if(null!=e&&e.padding){var t=this.getCenter(),n=Mr(this.getSize(),2),r=(n[0],n[1],UT(e.padding)),i=this.lngLatToPixel([t.lng,t.lat]),o=[(r.right-r.left)/2,(r.bottom-r.top)/2];return this.pixelToLngLat([i.x-o[0],i.y-o[1]])}var a=this.map.getCenter();return{lng:a.getLng(),lat:a.getLat()}}},{key:"setCenter",value:function(e,t){if(null!=t&&t.padding){var n=UT(t.padding),r=this.lngLatToPixel(e),i=[(n.right-n.left)/2,(n.bottom-n.top)/2],o=this.pixelToLngLat([r.x+i[0],r.y+i[1]]);this.map.setCenter([o.lng,o.lat])}else this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var e=this.map.getBounds().toBounds(),t=e.getNorthEast(),n=e.getSouthWest(),r=this.getCenter(),i=r.lng>t.getLng()||r.lng<n.getLng()?180-t.getLng():t.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,t.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.get("zooms")[0]-1}},{key:"getMaxZoom",value:function(){return this.map.get("zooms")[1]-1}},{key:"setRotation",value:function(e){return this.map.setRotation(e)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(e){this.map.panTo(e)}},{key:"fitBounds",value:function(e){this.map.setBounds(new AMap.Bounds([e[0][0],e[0][1],e[1][0],e[1][1]]))}},{key:"setZoomAndCenter",value:function(e,t){this.map.setZoomAndCenter(e,t)}},{key:"setMapStyle",value:function(e){this.map.setMapStyle(this.getMapStyle(e))}},{key:"setMapStatus",value:function(e){this.map.setStatus(e)}},{key:"pixelToLngLat",value:function(e){var t=this.map.pixelToLngLat(new AMap.Pixel(e[0],e[1]));return{lng:t.getLng(),lat:t.getLat()}}},{key:"lngLatToPixel",value:function(e){var t=this.map.lnglatToPixel(new AMap.LngLat(e[0],e[1]));return{x:t.getX(),y:t.getY()}}},{key:"containerToLngLat",value:function(e){var t=new AMap.Pixel(e[0],e[1]),n=this.map.containerToLngLat(t);return{lng:null==n?void 0:n.getLng(),lat:null==n?void 0:n.getLat()}}},{key:"lngLatToContainer",value:function(e){var t=new AMap.LngLat(e[0],e[1]),n=this.map.lngLatToContainer(t);return{x:n.getX(),y:n.getY()}}},{key:"lngLatToMercator",value:function(e,t){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(e),o=pv();return _v(o,o,Fv(i[0],i[1],t)),xv(o,o,Fv(r[0],r[1],r[2])),Sv(o,o,n[0]),wv(o,o,n[1]),Av(o,o,n[2]),o}},{key:"init",value:(n=hr(regeneratorRuntime.mark((function e(){var t,n,r,i,o,a,s,u,c,l,f,h,d,p,v=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config,n=t.id,r=t.style,i=void 0===r?"light":r,o=t.minZoom,a=void 0===o?0:o,s=t.maxZoom,u=void 0===s?18:s,c=t.token,l=void 0===c?"15cd8a57710d40c9b7c0e3cc120f1200":c,f=t.mapInstance,h=t.plugin,d=void 0===h?[]:h,p=wr(t,tE),e.next=3,new Promise((function(e){var t=function(){if(f)v.map=f,v.$mapContainer=v.map.getContainer(),setTimeout((function(){v.map.on("camerachange",v.handleCameraChanged),e()}),30);else{v.$mapContainer=v.creatAmapContainer(n);var t=new AMap.Map(v.$mapContainer,cr({mapStyle:v.getMapStyle(i),zooms:[a,u],viewMode:"3D"},p));t.on("camerachange",v.handleCameraChanged),v.map=t,setTimeout((function(){e()}),10)}};pE||f?pE&&window.AMap||f?t():vE.push(t):("15cd8a57710d40c9b7c0e3cc120f1200"===l&&console.warn(v.configService.getSceneWarninfo("MapToken")),pE=!0,d.push("Map3D"),jT.load({key:l,version:"1.4.15",plugins:d}).then((function(e){t(),vE.length&&(vE.forEach((function(e){return e()})),vE=[])})).catch((function(e){throw new Error(e)})))}));case 3:this.viewport=new eE;case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"exportMap",value:function(e){var t,n=null===(t=this.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-layer")[0];return"jpg"===e?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"destroy",value:function(){this.map.destroy(),delete window.initAMap;var e=document.getElementById("amap-script");e&&document.head.removeChild(e)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"getMapStyle",value:function(e){return JT[e]?JT[e]:e}},{key:"creatAmapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_amap_div"+nE++,t.appendChild(n),n}}]),t}()).prototype,"configService",[VT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XT=Rr(YT.prototype,"config",[HT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KT=Rr(YT.prototype,"coordinateSystemService",[GT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QT=Rr(YT.prototype,"eventEmitter",[WT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZT=YT))||ZT),mE=function(e){mr(n,e);var t=Er(n);function n(){return dr(this,n),t.apply(this,arguments)}return vr(n,[{key:"getServiceConstructor",value:function(){return gE}}]),n}(zT),yE={dark:"amap://styles/dark",light:"amap://styles/light",normal:"amap://styles/normal",blank:"amap://styles/1a91e7ec761981d85b35f3099ff781a3"},bE=function(){function e(){dr(this,e),gr(this,"projectionMatrix",pv()),gr(this,"viewMatrix",pv()),gr(this,"viewProjectionMatrix",pv()),gr(this,"ViewProjectionMatrixUncentered",pv()),gr(this,"viewUncenteredMatrix",pv()),gr(this,"zoom",void 0),gr(this,"center",void 0)}return vr(e,[{key:"syncWithMapCamera",value:function(e){var t=e.zoom,n=void 0===t?1:t,r=e.center,i=void 0===r?[0,0]:r,o=e.offsetOrigin,a=void 0===o?[0,0]:o,s=e.cameraPosition,u=void 0===s?[0,0,0]:s,c=e.up,l=void 0===c?[0,1,0]:c,f=e.lookAt,h=void 0===f?[0,0,0]:f,d=e.aspect,p=void 0===d?1:d,v=e.near,g=void 0===v?.1:v,m=e.far,y=void 0===m?1e3:m,b=e.fov,_=void 0===b?45:b;this.zoom=n,this.center=i,Mv(this.projectionMatrix,_/180*Math.PI,p,g,y);var x=Fv.apply(rg,kr(u)),S=Fv.apply(rg,kr(h)),w=Fv.apply(rg,kr(l));kv(this.viewMatrix,x,S,w),this.viewUncenteredMatrix=vv(this.viewMatrix),_v(this.viewMatrix,this.viewMatrix,Fv(-a[0],a[1],0)),bv(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),bv(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 1048576}},{key:"getCenter",value:function(){var e=Mr(this.center,2);return[e[0],e[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){var n=Math.max(Math.min(85.0511287798,e[1]),-85.0511287798),r=Math.PI/180,i=e[0]*r,o=n*r;o=Math.log(Math.tan(Math.PI/4+o/2));return[i=(256<<20)*(.5/Math.PI*i+.5)-215440491,o=-((256<<20)*(-.5/Math.PI*o+(r=.5))-106744817)]}}]),e}(),_E=["id","style","minZoom","maxZoom","token","mapInstance","plugin","version"],xE=0;window.forceWebGL=!0;var SE=!1,wE=[],AE=(rE=$(),iE=J(sr.IGlobalConfigService),oE=J(sr.MapConfig),aE=J(sr.ICoordinateSystemService),sE=J(sr.IEventEmitter),rE((lE=Rr((cE=function(){function t(){var n=this;dr(this,t),gr(this,"version",LT["GAODE2.x"]),gr(this,"map",void 0),gr(this,"sceneCenter",void 0),gr(this,"sceneCenterMKT",void 0),Lr(this,"configService",lE,this),Lr(this,"config",fE,this),Lr(this,"coordinateSystemService",hE,this),Lr(this,"eventEmitter",dE,this),gr(this,"markerContainer",void 0),gr(this,"$mapContainer",void 0),gr(this,"viewport",void 0),gr(this,"cameraChangedCallback",void 0),gr(this,"handleViewChanged",(function(t){var r=n.map.customCoords.getCameraParams(),i=r.fov,o=r.near,a=r.far,s=r.aspect,u=r.position,c=r.lookAt,l=r.up,f=t.zoom,h=n.map.customCoords.getCenter();n.cameraChangedCallback&&(n.viewport.syncWithMapCamera({aspect:s,far:a,fov:i,cameraPosition:u,lookAt:c,up:l,near:o,zoom:f-1,center:h,offsetOrigin:[u[0],u[1]]}),n.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.P20_2),n.cameraChangedCallback(n.viewport))}))}var n;return vr(t,[{key:"setCustomCoordCenter",value:function(e){var t;this.sceneCenter=e,this.sceneCenterMKT=(t=this.map.getProjection()).project.apply(t,kr(this.sceneCenter))}},{key:"getCustomCoordCenter",value:function(){return this.sceneCenterMKT}},{key:"lngLatToCoord",value:function(e){var t=this.map.getProjection().project;return this.sceneCenter||(this.map.customCoords.setCenter(e),this.setCustomCoordCenter(e)),this._sub(t(e[0],e[1]),this.sceneCenterMKT)}},{key:"lngLatToCoords",value:function(e){var t=this;return e.map((function(e){return"number"==typeof e[0]?t.lngLatToCoord(e):e.map((function(e){return t.lngLatToCoord(e)}))}))}},{key:"addMarkerContainer",value:function(){if(this.map){var e=this.map.getContainer();null!==e&&(this.markerContainer=ka("div","l7-marker-container2",e))}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(e,t){-1!==OA.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(e,t)}},{key:"off",value:function(e,t){-1!==OA.indexOf(e)?this.eventEmitter.off(e,t):this.map.off(e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var e;return null===(e=this.map.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var e=this.map.getSize();return[e.getWidth(),e.getHeight()]}},{key:"getType",value:function(){return"amap2"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(e){return this.map.setZoom(e)}},{key:"getCenter",value:function(e){if(null!=e&&e.padding){var t=this.getCenter(),n=Mr(this.getSize(),2),r=(n[0],n[1],UT(e.padding)),i=this.lngLatToPixel([t.lng,t.lat]),o=[(r.right-r.left)/2,(r.bottom-r.top)/2];return this.pixelToLngLat([i.x-o[0],i.y-o[1]])}var a=this.map.getCenter();return{lng:a.getLng(),lat:a.getLat()}}},{key:"setCenter",value:function(e,t){if(null!=t&&t.padding){var n=UT(t.padding),r=this.lngLatToPixel(e),i=[(n.right-n.left)/2,(n.bottom-n.top)/2],o=this.pixelToLngLat([r.x+i[0],r.y+i[1]]);this.map.setCenter([o.lng,o.lat])}else this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var e=this.map.getBounds(),t=e.getNorthEast(),n=e.getSouthWest(),r=this.getCenter(),i=r.lng>t.getLng()||r.lng<n.getLng()?180-t.getLng():t.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,t.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.getZooms()[0]-1}},{key:"getMaxZoom",value:function(){return this.map.getZooms()[1]-1}},{key:"setRotation",value:function(e){return this.map.setRotation(e)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(e){this.map.panTo(e)}},{key:"fitBounds",value:function(e){this.map.setBounds(new AMap.Bounds([e[0][0],e[0][1],e[1][0],e[1][1]]))}},{key:"setZoomAndCenter",value:function(e,t){this.map.setZoomAndCenter(e,t)}},{key:"setMapStyle",value:function(e){this.map.setMapStyle(this.getMapStyle(e))}},{key:"setMapStatus",value:function(e){this.map.setStatus(e)}},{key:"pixelToLngLat",value:function(e){var t=this.map.pixelToLngLat(new AMap.Pixel(e[0],e[1]));return{lng:t.getLng(),lat:t.getLat()}}},{key:"lngLatToPixel",value:function(e){var t=this.map.lnglatToPixel(new AMap.LngLat(e[0],e[1]));return{x:t.getX(),y:t.getY()}}},{key:"containerToLngLat",value:function(e){var t=new AMap.Pixel(e[0],e[1]),n=this.map.containerToLngLat(t);return{lng:null==n?void 0:n.getLng(),lat:null==n?void 0:n.getLat()}}},{key:"lngLatToContainer",value:function(e){var t=new AMap.LngLat(e[0],e[1]),n=this.map.lngLatToContainer(t);return{x:n.getX(),y:n.getY()}}},{key:"lngLatToMercator",value:function(e,t){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(e),o=pv();return _v(o,o,Fv(i[0],i[1],t)),xv(o,o,Fv(r[0],r[1],r[2])),Sv(o,o,n[0]),wv(o,o,n[1]),Av(o,o,n[2]),o}},{key:"init",value:(n=hr(regeneratorRuntime.mark((function e(){var t,n,r,i,o,a,s,u,c,l,f,h,d,p,v,g,m=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config,n=t.id,r=t.style,i=void 0===r?"light":r,o=t.minZoom,a=void 0===o?0:o,s=t.maxZoom,u=void 0===s?18:s,c=t.token,l=void 0===c?"ff533602d57df6f8ab3b0fea226ae52f":c,f=t.mapInstance,h=t.plugin,d=void 0===h?[]:h,p=t.version,v=void 0===p?"2.0":p,g=wr(t,_E),e.next=3,new Promise((function(e){var t=function(){if(f){var t;m.map=f,m.$mapContainer=m.map.getContainer();var r=m.map.getCenter();null===(t=m.map.customCoords)||void 0===t||t.setCenter([r.lng,r.lat]),m.setCustomCoordCenter([r.lng,r.lat]),setTimeout((function(){m.map.on("viewchange",m.handleViewChanged),e()}),30)}else{m.$mapContainer=m.creatAmapContainer(n);var o=new AMap.Map(m.$mapContainer,cr({mapStyle:m.getMapStyle(i),zooms:[a,u],viewMode:"3D"},g));m.map=o;var s=o.getCenter();o.customCoords.setCenter([s.lng,s.lat]),m.setCustomCoordCenter([s.lng,s.lat]),o.on("viewchange",m.handleViewChanged),setTimeout((function(){e()}),10)}};m.viewport=new bE,SE||f?SE&&window.AMap||f?t():wE.push(t):("ff533602d57df6f8ab3b0fea226ae52f"===l&&console.warn(m.configService.getSceneWarninfo("MapToken")),SE=!0,d.push("Map3D"),jT.load({key:l,version:v,plugins:d}).then((function(e){t(),wE.length&&(wE.forEach((function(e){return e()})),wE=[])})).catch((function(e){throw new Error(e)})))}));case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"exportMap",value:function(e){var t,n=null===(t=this.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-layer")[0];return"jpg"===e?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"destroy",value:function(){this.map.destroy(),delete window.initAMap;var e=document.getElementById("amap-script");e&&document.head.removeChild(e)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"initViewPort",value:function(){var t,n=null===(t=this.map.customCoords)||void 0===t?void 0:t.getCameraParams(),r=n.fov,i=n.near,o=n.far,a=n.aspect,s=n.position,u=n.lookAt,c=n.up,l=this.map.customCoords.getCenter(),f=this.map.getZoom();this.cameraChangedCallback&&(this.viewport.syncWithMapCamera({aspect:a,far:o,fov:r,cameraPosition:s,lookAt:u,near:i,up:c,zoom:f-1,center:l,offsetOrigin:[s[0],s[1]]}),this.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.P20_2),this.cameraChangedCallback(this.viewport))}},{key:"_sub",value:function(e,t){var n=[0,0];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n}},{key:"getMapStyle",value:function(e){return yE[e]?yE[e]:e}},{key:"creatAmapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_amap_div"+xE++,t.appendChild(n),n}}]),t}()).prototype,"configService",[iE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fE=Rr(cE.prototype,"config",[oE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hE=Rr(cE.prototype,"coordinateSystemService",[aE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dE=Rr(cE.prototype,"eventEmitter",[sE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uE=cE))||uE),TE=function(e){mr(n,e);var t=Er(n);function n(){return dr(this,n),t.apply(this,arguments)}return vr(n,[{key:"getServiceConstructor",value:function(){return AE}}]),n}(zT);Lt({target:"String",proto:!0,forced:BA("sub")},{sub:function(){return UA(this,"sub","","")}});var EE,CE=ME;function ME(e,t,n,r){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=n,this.p2y=r}function kE(e,t,n){var r=n-t,i=((e-t)%r+r)%r+t;return i===t?n:i}function OE(e,t,n){return Math.min(n,Math.max(t,e))}function IE(e,t,n){return e*(1-n)+t*n}function PE(e,t,n,r){var i=new CE(e,t,n,r);return function(e){return i.solve(e)}}ME.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},ME.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},ME.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},ME.prototype.solveCurveX=function(e,t){var n,r,i,o,a;for(void 0===t&&(t=1e-6),i=e,a=0;a<8;a++){if(o=this.sampleCurveX(i)-e,Math.abs(o)<t)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=e)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(o=this.sampleCurveX(i),Math.abs(o-e)<t)return i;e>o?n=i:r=i,i=.5*(r-n)+n}return i},ME.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var LE=PE(.25,.1,.25,1);function RE(){return!!window.matchMedia&&(null==EE&&(EE=window.matchMedia("(prefers-reduced-motion: reduce)")),EE.matches)}function NE(e,t){var n,r={},i=Pr(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;o in e&&(r[o]=e[o])}}catch(e){i.e(e)}finally{i.f()}return r}var DE=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now.bind(Date),FE=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,zE=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;function jE(e){var t=FE(e);return{cancel:function(){return zE(t)}}}var UE=function(){function e(t,n){if(dr(this,e),gr(this,"lng",void 0),gr(this,"lat",void 0),isNaN(t)||isNaN(n))throw new Error("Invalid LngLat object: (".concat(t,", ").concat(n,")"));if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return vr(e,[{key:"wrap",value:function(){return new e(kE(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(e){var t=Math.PI/180,n=this.lat*t,r=e.lat*t,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return 6371008.8*Math.acos(Math.min(i,1))}}],[{key:"convert",value:function(t){if(t instanceof e)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new e(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"===lr(t)&&null!==t){var n="lng"in t?t.lng:t.lon;return new e(Number(n),Number(t.lat))}throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}]),e}(),BE=function(){function e(t,n){dr(this,e),gr(this,"ne",void 0),gr(this,"sw",void 0),t&&(n?this.setSouthWest(t).setNorthEast(n):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}return vr(e,[{key:"setNorthEast",value:function(e){return this.ne=e instanceof UE?new UE(e.lng,e.lat):UE.convert(e),this}},{key:"setSouthWest",value:function(e){return this.sw=e instanceof UE?new UE(e.lng,e.lat):UE.convert(e),this}},{key:"extend",value:function(t){var n,r,i=this.sw,o=this.ne;if(t instanceof UE)n=t,r=t;else{if(!(t instanceof e)){if(Array.isArray(t)){if(4===t.length||t.every(Array.isArray)){var a=t;return this.extend(e.convert(a))}var s=t;return this.extend(UE.convert(s))}return this}if(n=t.sw,r=t.ne,!n||!r)return this}return i||o?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),o.lng=Math.max(r.lng,o.lng),o.lat=Math.max(r.lat,o.lat)):(this.sw=new UE(n.lng,n.lat),this.ne=new UE(r.lng,r.lat)),this}},{key:"getCenter",value:function(){return new UE((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)}},{key:"getSouthWest",value:function(){return this.sw}},{key:"getNorthEast",value:function(){return this.ne}},{key:"getNorthWest",value:function(){return new UE(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new UE(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this.sw.lng}},{key:"getSouth",value:function(){return this.sw.lat}},{key:"getEast",value:function(){return this.ne.lng}},{key:"getNorth",value:function(){return this.ne.lat}},{key:"toArray",value:function(){return[this.sw.toArray(),this.ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this.sw.toString(),", ").concat(this.ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this.sw&&this.ne)}},{key:"contains",value:function(e){var t=UE.convert(e),n=t.lng,r=t.lat,i=this.sw.lat<=r&&r<=this.ne.lat,o=this.sw.lng<=n&&n<=this.ne.lng;return this.sw.lng>this.ne.lng&&(o=this.sw.lng>=n&&n>=this.ne.lng),i&&o}}],[{key:"convert",value:function(t){return t instanceof e?t:new e(t)}}]),e}(),VE=function(){function e(t,n){dr(this,e),gr(this,"x",void 0),gr(this,"y",void 0),this.x=t,this.y=n}return vr(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"_add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"add",value:function(e){return this.clone()._add(e)}},{key:"_sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"sub",value:function(e){return this.clone()._sub(e)}},{key:"_multByPoint",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multByPoint",value:function(e){return this.clone()._multByPoint(e)}},{key:"_divByPoint",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divByPoint",value:function(e){return this.clone()._divByPoint(e)}},{key:"_mult",value:function(e){return this.x*=e,this.y*=e,this}},{key:"mult",value:function(e){return this.clone()._mult(e)}},{key:"_div",value:function(e){return this.x/=e,this.y/=e,this}},{key:"div",value:function(e){return this.clone()._div(e)}},{key:"_rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),r=t*this.x-n*this.y,i=n*this.x+t*this.y;return this.x=r,this.y=i,this}},{key:"rotate",value:function(e){return this.clone()._rotate(e)}},{key:"_rotateAround",value:function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.x+n*(this.x-t.x)-r*(this.y-t.y),o=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=i,this.y=o,this}},{key:"roateAround",value:function(e,t){return this.clone()._rotateAround(e,t)}},{key:"_matMult",value:function(e){var t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this}},{key:"matMult",value:function(e){return this.clone()._matMult(e)}},{key:"_unit",value:function(){return this.div(this.mag()),this}},{key:"unit",value:function(){return this.clone()._unit()}},{key:"_perp",value:function(){var e=this.y;return this.y=this.x,this.x=-e,this}},{key:"perp",value:function(){return this.clone()._perp()}},{key:"_round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"round",value:function(){return this.clone()._round()}},{key:"mag",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"dist",value:function(e){return Math.sqrt(this.distSqr(e))}},{key:"distSqr",value:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"angleTo",value:function(e){return Math.atan2(this.y-e.y,this.x-e.x)}},{key:"angleWith",value:function(e){return this.angleWithSep(e.x,e.y)}},{key:"angleWithSep",value:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)}}],[{key:"convert",value:function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t}}]),e}();Lt({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}}),il("Float32",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var HE=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(dr(this,e),gr(this,"top",void 0),gr(this,"bottom",void 0),gr(this,"left",void 0),gr(this,"right",void 0),isNaN(t)||t<0||isNaN(n)||n<0||isNaN(r)||r<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=r,this.right=i}return vr(e,[{key:"interpolate",value:function(e,t,n){return null!=t.top&&null!=e.top&&(this.top=IE(e.top,t.top,n)),null!=t.bottom&&null!=e.bottom&&(this.bottom=IE(e.bottom,t.bottom,n)),null!=t.left&&null!=e.left&&(this.left=IE(e.left,t.left,n)),null!=t.right&&null!=e.right&&(this.right=IE(e.right,t.right,n)),this}},{key:"getCenter",value:function(e,t){var n=OE((this.left+e-this.right)/2,0,e),r=OE((this.top+t-this.bottom)/2,0,t);return new VE(n,r)}},{key:"equals",value:function(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}},{key:"clone",value:function(){return new e(this.top,this.bottom,this.left,this.right)}},{key:"toJSON",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}]),e}(),GE=2*Math.PI*6371008.8;function WE(e){return GE*Math.cos(e*Math.PI/180)}function ZE(e){return(180+e)/360}function YE(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function qE(e,t){return e/WE(t)}function XE(e){var t=180-360*e;return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}var KE=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;dr(this,e),gr(this,"x",void 0),gr(this,"y",void 0),gr(this,"z",void 0),this.x=+t,this.y=+n,this.z=+r}return vr(e,[{key:"toLngLat",value:function(){return new UE(360*this.x-180,XE(this.y))}},{key:"toAltitude",value:function(){return e=this.z,t=this.y,e*WE(XE(t));var e,t}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/GE*(e=XE(this.y),1/Math.cos(e*Math.PI/180));var e}}],[{key:"fromLngLat",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=UE.convert(t);return new e(ZE(r.lng),YE(r.lat),qE(n,r.lat))}}]),e}(),QE=function(){function e(t,n,r,i,o){dr(this,e),gr(this,"tileSize",void 0),gr(this,"tileZoom",void 0),gr(this,"lngRange",void 0),gr(this,"latRange",void 0),gr(this,"maxValidLatitude",void 0),gr(this,"scale",void 0),gr(this,"width",void 0),gr(this,"height",void 0),gr(this,"angle",void 0),gr(this,"rotationMatrix",void 0),gr(this,"pixelsToGLUnits",void 0),gr(this,"cameraToCenterDistance",void 0),gr(this,"mercatorMatrix",void 0),gr(this,"projMatrix",void 0),gr(this,"invProjMatrix",void 0),gr(this,"alignedProjMatrix",void 0),gr(this,"pixelMatrix",void 0),gr(this,"pixelMatrixInverse",void 0),gr(this,"glCoordMatrix",void 0),gr(this,"labelPlaneMatrix",void 0),gr(this,"_fov",void 0),gr(this,"_pitch",void 0),gr(this,"_zoom",void 0),gr(this,"_renderWorldCopies",void 0),gr(this,"_minZoom",void 0),gr(this,"_maxZoom",void 0),gr(this,"_minPitch",void 0),gr(this,"_maxPitch",void 0),gr(this,"_center",void 0),gr(this,"zoomFraction",void 0),gr(this,"unmodified",void 0),gr(this,"edgeInsets",void 0),gr(this,"constraining",void 0),gr(this,"posMatrixCache",void 0),gr(this,"alignedPosMatrixCache",void 0),this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==i?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new UE(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this.unmodified=!0,this.edgeInsets=new HE,this.posMatrixCache={},this.alignedPosMatrixCache={}}return vr(e,[{key:"minZoom",get:function(){return this._minZoom},set:function(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}},{key:"minPitch",get:function(){return this._minPitch},set:function(e){this._minPitch!==e&&(this._minPitch=e,this._pitch=Math.max(this._pitch,e))}},{key:"maxPitch",get:function(){return this._maxPitch},set:function(e){this._maxPitch!==e&&(this._maxPitch=e,this._pitch=Math.min(this._pitch,e))}},{key:"renderWorldCopies",get:function(){return this._renderWorldCopies},set:function(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"centerOffset",get:function(){return this.centerPoint._sub(this.size._div(2))}},{key:"size",get:function(){return new VE(this.width,this.height)}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(e){var t,n=-kE(e,-180,180)*Math.PI/180;this.angle!==n&&(this.unmodified=!1,this.angle=n,this.calcMatrices(),this.rotationMatrix=(t=new hv(4),hv!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t),function(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),u=Math.cos(n);e[0]=r*u+o*s,e[1]=i*u+a*s,e[2]=r*-s+o*u,e[3]=i*-s+a*u}(this.rotationMatrix,this.rotationMatrix,this.angle))}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(e){var t=OE(e,this._minPitch,this._maxPitch)/180*Math.PI;this._pitch!==t&&(this.unmodified=!1,this._pitch=t,this.calcMatrices())}},{key:"fov",get:function(){return this._fov/Math.PI*180},set:function(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this.unmodified=!1,this._fov=e/180*Math.PI,this.calcMatrices())}},{key:"zoom",get:function(){return this._zoom},set:function(e){var t=Math.min(Math.max(e,this._minZoom),this._maxZoom);this._zoom!==t&&(this.unmodified=!1,this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom,this.constrain(),this.calcMatrices())}},{key:"center",get:function(){return this._center},set:function(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this.unmodified=!1,this._center=e,this.constrain(),this.calcMatrices())}},{key:"padding",get:function(){return this.edgeInsets.toJSON()},set:function(e){this.edgeInsets.equals(e)||(this.unmodified=!1,this.edgeInsets.interpolate(this.edgeInsets,e,1),this.calcMatrices())}},{key:"centerPoint",get:function(){return this.edgeInsets.getCenter(this.width,this.height)}},{key:"point",get:function(){return this.project(this.center)}},{key:"clone",value:function(){var t=new e(this._minZoom,this._maxZoom,this._minPitch,this._maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t.center=this._center,t.zoom=this.zoom,t.angle=this.angle,t.fov=this._fov,t.pitch=this._pitch,t.unmodified=this.unmodified,t.edgeInsets=this.edgeInsets.clone(),t.calcMatrices(),t}},{key:"isPaddingEqual",value:function(e){return this.edgeInsets.equals(e)}},{key:"interpolatePadding",value:function(e,t,n){this.unmodified=!1,this.edgeInsets.interpolate(e,t,n),this.constrain(),this.calcMatrices()}},{key:"coveringZoomLevel",value:function(e){var t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}},{key:"resize",value:function(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this.constrain(),this.calcMatrices()}},{key:"zoomScale",value:function(e){return Math.pow(2,e)}},{key:"scaleZoom",value:function(e){return Math.log(e)/Math.LN2}},{key:"project",value:function(e){var t=OE(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new VE(ZE(e.lng)*this.worldSize,YE(t)*this.worldSize)}},{key:"unproject",value:function(e){return new KE(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}},{key:"setLocationAtPoint",value:function(e,t){var n=this.pointCoordinate(t),r=this.pointCoordinate(this.centerPoint),i=this.locationCoordinate(e),o=new KE(i.x-(n.x-r.x),i.y-(n.y-r.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}},{key:"pointCoordinate",value:function(e){var t=new Float32Array([e.x,e.y,0,1]),n=new Float32Array([e.x,e.y,1,1]);ag(t,t,this.pixelMatrixInverse),ag(n,n,this.pixelMatrixInverse);var r=t[3],i=n[3],o=t[0]/r,a=n[0]/i,s=t[1]/r,u=n[1]/i,c=t[2]/r,l=n[2]/i,f=c===l?0:(0-c)/(l-c);return new KE(IE(o,a,f)/this.worldSize,IE(s,u,f)/this.worldSize)}},{key:"getBounds",value:function(){return(new BE).extend(this.pointLocation(new VE(0,0))).extend(this.pointLocation(new VE(this.width,0))).extend(this.pointLocation(new VE(this.width,this.height))).extend(this.pointLocation(new VE(0,this.height)))}},{key:"getMaxBounds",value:function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new BE([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}},{key:"setMaxBounds",value:function(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this.constrain()):(this.lngRange=void 0,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}},{key:"customLayerMatrix",value:function(){return this.mercatorMatrix.slice()}},{key:"maxPitchScaleFactor",value:function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new VE(0,0)),t=new Float32Array([e.x*this.worldSize,e.y*this.worldSize,0,1]);return ag(t,t,this.pixelMatrix)[3]/this.cameraToCenterDistance}},{key:"getCameraPoint",value:function(){var e=this._pitch,t=Math.tan(e)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new VE(0,t))}},{key:"getCameraQueryGeometry",value:function(e){var t=this.getCameraPoint();if(1===e.length)return[e[0],t];var n,r=t.x,i=t.y,o=t.x,a=t.y,s=Pr(e);try{for(s.s();!(n=s.n()).done;){var u=n.value;r=Math.min(r,u.x),i=Math.min(i,u.y),o=Math.max(o,u.x),a=Math.max(a,u.y)}}catch(e){s.e(e)}finally{s.f()}return[new VE(r,i),new VE(o,i),new VE(o,a),new VE(r,a),new VE(r,i)]}},{key:"coordinatePoint",value:function(e){var t=og(e.x*this.worldSize,e.y*this.worldSize,0,1);return ag(t,t,this.pixelMatrix),new VE(t[0]/t[3],t[1]/t[3])}},{key:"locationPoint",value:function(e){return this.coordinatePoint(this.locationCoordinate(e))}},{key:"pointLocation",value:function(e){return this.coordinateLocation(this.pointCoordinate(e))}},{key:"locationCoordinate",value:function(e){return KE.fromLngLat(e)}},{key:"coordinateLocation",value:function(e){return e.toLngLat()}},{key:"getProjectionMatrix",value:function(){return this.projMatrix}},{key:"constrain",value:function(){if(this.center&&this.width&&this.height&&!this.constraining){this.constraining=!0;var e,t,n,r,i=-90,o=90,a=-180,s=180,u=this.size,c=this.unmodified;if(this.latRange){var l=this.latRange;i=YE(l[1])*this.worldSize,e=(o=YE(l[0])*this.worldSize)-i<u.y?u.y/(o-i):0}if(this.lngRange){var f=this.lngRange;a=ZE(f[0])*this.worldSize,t=(s=ZE(f[1])*this.worldSize)-a<u.x?u.x/(s-a):0}var h=this.point,d=Math.max(t||0,e||0);if(d)return this.center=this.unproject(new VE(t?(s+a)/2:h.x,e?(o+i)/2:h.y)),this.zoom+=this.scaleZoom(d),this.unmodified=c,void(this.constraining=!1);if(this.latRange){var p=h.y,v=u.y/2;p-v<i&&(r=i+v),p+v>o&&(r=o-v)}if(this.lngRange){var g=h.x,m=u.x/2;g-m<a&&(n=a+m),g+m>s&&(n=s-m)}void 0===n&&void 0===r||(this.center=this.unproject(new VE(void 0!==n?n:h.x,void 0!==r?r:h.y))),this.unmodified=c,this.constraining=!1}}},{key:"calcMatrices",value:function(){if(this.height){var e=this._fov/2,t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(e)*this.height;var n=Math.PI/2+this._pitch,r=this._fov*(.5+t.y/this.height),i=Math.sin(r)*this.cameraToCenterDistance/Math.sin(OE(Math.PI-n-r,.01,Math.PI-.01)),o=this.point,a=o.x,s=o.y,u=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),c=this.height/50,l=pv();Mv(l,this._fov,this.width/this.height,c,u),l[8]=2*-t.x/this.width,l[9]=2*t.y/this.height,xv(l,l,[1,-1,1]),_v(l,l,[0,0,-this.cameraToCenterDistance]),Sv(l,l,this._pitch),Av(l,l,this.angle),_v(l,l,[-a,-s,0]),this.mercatorMatrix=xv(pv(),l,[this.worldSize,this.worldSize,this.worldSize]),xv(l,l,Fv(1,1,qE(1,this.center.lat)*this.worldSize)),this.projMatrix=l,this.invProjMatrix=yv(pv(),this.projMatrix);var f=this.width%2/2,h=this.height%2/2,d=Math.cos(this.angle),p=Math.sin(this.angle),v=a-Math.round(a)+d*f+p*h,g=s-Math.round(s)+d*h+p*f,m=vv(l);if(_v(m,m,[v>.5?v-1:v,g>.5?g-1:g,0]),this.alignedProjMatrix=m,xv(l=pv(),l,[this.width/2,-this.height/2,1]),_v(l,l,[1,-1,0]),this.labelPlaneMatrix=l,xv(l=pv(),l,[1,-1,1]),_v(l,l,[-1,-1,0]),xv(l,l,[2/this.width,2/this.height,1]),this.glCoordMatrix=l,this.pixelMatrix=bv(pv(),this.labelPlaneMatrix,this.projMatrix),!(l=yv(pv(),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=l,this.posMatrixCache={},this.alignedPosMatrixCache={}}}}]),e}(),JE=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};dr(this,e),gr(this,"type",void 0),Ky(this,n),this.type=t},$E=function(e){mr(n,e);var t=Er(n);function n(e){var r;dr(this,n),gr(Ar(r=t.call(this)),"transform",void 0),gr(Ar(r),"options",void 0),gr(Ar(r),"moving",void 0),gr(Ar(r),"zooming",void 0),gr(Ar(r),"rotating",void 0),gr(Ar(r),"pitching",void 0),gr(Ar(r),"padding",void 0),gr(Ar(r),"bearingSnap",void 0),gr(Ar(r),"easeEndTimeoutID",void 0),gr(Ar(r),"easeStart",void 0),gr(Ar(r),"easeOptions",void 0),gr(Ar(r),"easeId",void 0),gr(Ar(r),"onEaseFrame",void 0),gr(Ar(r),"onEaseEnd",void 0),gr(Ar(r),"easeFrameId",void 0),gr(Ar(r),"renderFrameCallback",(function(){var e=Math.min((DE()-r.easeStart)/r.easeOptions.duration,1);r.onEaseFrame(r.easeOptions.easing(e)),e<1?r.easeFrameId=r.requestRenderFrame(r.renderFrameCallback):r.stop()})),r.options=e;var i=e.minZoom,o=e.maxZoom,a=e.minPitch,s=e.maxPitch,u=e.renderWorldCopies;return r.moving=!1,r.zooming=!1,r.bearingSnap=e.bearingSnap,r.transform=new QE(i,o,a,s,u),r}return vr(n,[{key:"requestRenderFrame",value:function(e){return 0}},{key:"cancelRenderFrame",value:function(e){}},{key:"getCenter",value:function(){var e=this.transform.center,t=e.lng,n=e.lat;return new UE(t,n)}},{key:"getZoom",value:function(){return this.transform.zoom}},{key:"getPitch",value:function(){return this.transform.pitch}},{key:"setCenter",value:function(e,t){return this.jumpTo({center:e},t)}},{key:"setPitch",value:function(e,t){return this.jumpTo({pitch:e},t),this}},{key:"getBearing",value:function(){return this.transform.bearing}},{key:"panTo",value:function(e,t,n){return this.easeTo(Ky({center:e},t),n)}},{key:"zoomOut",value:function(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}},{key:"setBearing",value:function(e,t){return this.jumpTo({bearing:e},t),this}},{key:"setZoom",value:function(e,t){return this.jumpTo({zoom:e},t),this}},{key:"zoomIn",value:function(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}},{key:"zoomTo",value:function(e,t,n){return this.easeTo(Ky({zoom:e},t),n)}},{key:"getPadding",value:function(){return this.transform.padding}},{key:"setPadding",value:function(e,t){return this.jumpTo({padding:e},t),this}},{key:"rotateTo",value:function(e,t,n){return this.easeTo(Ky({bearing:e},t),n)}},{key:"resetNorth",value:function(e,t){return this.rotateTo(0,Ky({duration:1e3},e),t),this}},{key:"resetNorthPitch",value:function(e,t){return this.easeTo(Ky({bearing:0,pitch:0,duration:1e3},e),t),this}},{key:"fitBounds",value:function(e,t,n){return this.fitInternal(this.cameraForBounds(e,t),t,n)}},{key:"cameraForBounds",value:function(e,t){return e=BE.convert(e),this.cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),0,t)}},{key:"snapToNorth",value:function(e,t){return Math.abs(this.getBearing())<this.bearingSnap?this.resetNorth(e,t):this}},{key:"jumpTo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;this.stop();var n=this.transform,r=!1,i=!1,o=!1;return e.zoom&&n.zoom!==+e.zoom&&(r=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=UE.convert(e.center)),e.bearing&&n.bearing!==+e.bearing&&(i=!0,n.bearing=+e.bearing),e.pitch&&n.pitch!==+e.pitch&&(o=!0,n.pitch=+e.pitch),null==e.padding||n.isPaddingEqual(e.padding)||(n.padding=e.padding),this.emit("movestart",new JE("movestart",t)),this.emit("move",new JE("move",t)),r&&(this.emit("zoomstart",new JE("zoomstart",t)),this.emit("zoom",new JE("zoom",t)),this.emit("zoomend",new JE("zoomend",t))),i&&(this.emit("rotatestart",new JE("rotatestart",t)),this.emit("rotate",new JE("rotate",t)),this.emit("rotateend",new JE("rotateend",t))),o&&(this.emit("pitchstart",new JE("pitchstart",t)),this.emit("pitch",new JE("pitch",t)),this.emit("pitchend",new JE("pitchend",t))),this.emit("moveend",new JE("moveend",t))}},{key:"easeTo",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;(!1===(t=Ky({offset:[0,0],duration:500,easing:LE},t)).animate||!t.essential&&RE())&&(t.duration=0);var r=this.transform,i=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),u=t.zoom?+t.zoom:i,c=t.bearing?this.normalizeBearing(t.bearing,o):o,l=t.pitch?+t.pitch:a,f=t.padding?t.padding:r.padding,h=VE.convert(t.offset),d=r.centerPoint.add(h),p=r.pointLocation(d),v=UE.convert(t.center||p);this.normalizeCenter(v);var g,m,y=r.project(p),b=r.project(v).sub(y),_=r.zoomScale(u-i);t.around&&(g=UE.convert(t.around),m=r.locationPoint(g));var x={moving:this.moving,zooming:this.zooming,rotating:this.rotating,pitching:this.pitching};return this.zooming=this.zooming||u!==i,this.rotating=this.rotating||o!==c,this.pitching=this.pitching||l!==a,this.padding=!r.isPaddingEqual(f),this.easeId=t.easeId,this.prepareEase(n,t.noMoveStart,x),clearTimeout(this.easeEndTimeoutID),this.ease((function(t){if(e.zooming&&(r.zoom=IE(i,u,t)),e.rotating&&(r.bearing=IE(o,c,t)),e.pitching&&(r.pitch=IE(a,l,t)),e.padding&&(r.interpolatePadding(s,f,t),d=r.centerPoint.add(h)),g)r.setLocationAtPoint(g,m);else{var p=r.zoomScale(r.zoom-i),v=u>i?Math.min(2,_):Math.max(.5,_),x=Math.pow(v,1-t),S=r.unproject(y.add(b.mult(t*x)).mult(p));r.setLocationAtPoint(r.renderWorldCopies?S.wrap():S,d)}e.fireMoveEvents(n)}),(function(t){e.afterEase(n,t)}),t),this}},{key:"flyTo",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(!t.essential&&RE()){var r=NE(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,n)}this.stop(),t=Ky({offset:[0,0],speed:1.2,curve:1.42,easing:LE},t);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u=this.getPadding(),c=t.zoom?OE(+t.zoom,i.minZoom,i.maxZoom):o,l=t.bearing?this.normalizeBearing(t.bearing,a):a,f=t.pitch?+t.pitch:s,h="padding"in t?t.padding:i.padding,d=i.zoomScale(c-o),p=VE.convert(t.offset),v=i.centerPoint.add(p),g=i.pointLocation(v),m=UE.convert(t.center||g);this.normalizeCenter(m);var y=i.project(g),b=i.project(m).sub(y),_=t.curve,x=Math.max(i.width,i.height),S=x/d,w=b.mag();if("minZoom"in t){var A=OE(Math.min(t.minZoom,o,c),i.minZoom,i.maxZoom),T=x/i.zoomScale(A-o);_=Math.sqrt(T/w*2)}var E=_*_;function C(e){var t=(S*S-x*x+(e?-1:1)*E*E*w*w)/(2*(e?S:x)*E*w);return Math.log(Math.sqrt(t*t+1)-t)}function M(e){return(Math.exp(e)-Math.exp(-e))/2}function k(e){return(Math.exp(e)+Math.exp(-e))/2}function O(e){return M(e)/k(e)}var I=C(0),P=function(e){return k(I)/k(I+_*e)},L=function(e){return x*((k(I)*O(I+_*e)-M(I))/E)/w},R=(C(1)-I)/_;if(Math.abs(w)<1e-6||!isFinite(R)){if(Math.abs(x-S)<1e-6)return this.easeTo(t,n);var N=S<x?-1:1;R=Math.abs(Math.log(S/x))/_,L=function(){return 0},P=function(e){return Math.exp(N*_*e)}}if("duration"in t)t.duration=+t.duration;else{var D="screenSpeed"in t?+t.screenSpeed/_:+t.speed;t.duration=1e3*R/D}return t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this.zooming=!0,this.rotating=a!==l,this.pitching=f!==s,this.padding=!i.isPaddingEqual(h),this.prepareEase(n,!1),this.ease((function(t){var r=t*R,d=1/P(r);i.zoom=1===t?c:o+i.scaleZoom(d),e.rotating&&(i.bearing=IE(a,l,t)),e.pitching&&(i.pitch=IE(s,f,t)),e.padding&&(i.interpolatePadding(u,h,t),v=i.centerPoint.add(p));var g=1===t?m:i.unproject(y.add(b.mult(L(r))).mult(d));i.setLocationAtPoint(i.renderWorldCopies?g.wrap():g,v),e.fireMoveEvents(n)}),(function(){return e.afterEase(n)}),t),this}},{key:"fitScreenCoordinates",value:function(e,t,n,r,i){return this.fitInternal(this.cameraForBoxAndBearing(this.transform.pointLocation(VE.convert(e)),this.transform.pointLocation(VE.convert(t)),n,r),r,i)}},{key:"stop",value:function(e,t){if(this.easeFrameId&&(this.cancelRenderFrame(this.easeFrameId),delete this.easeFrameId,delete this.onEaseFrame),this.onEaseEnd){var n=this.onEaseEnd;delete this.onEaseEnd,n.call(this,t)}return this}},{key:"normalizeBearing",value:function(e,t){e=kE(e,-180,180);var n=Math.abs(e-t);return Math.abs(e-360-t)<n&&(e-=360),Math.abs(e+360-t)<n&&(e+=360),e}},{key:"normalizeCenter",value:function(e){var t=this.transform;if(t.renderWorldCopies&&!t.lngRange){var n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}}},{key:"fireMoveEvents",value:function(e){this.emit("move",new JE("move",e)),this.zooming&&this.emit("zoom",new JE("zoom",e)),this.rotating&&this.emit("rotate",new JE("rotate",e)),this.pitching&&this.emit("rotate",new JE("pitch",e))}},{key:"prepareEase",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.moving=!0,t||n.moving||this.emit("movestart",new JE("movestart",e)),this.zooming&&!n.zooming&&this.emit("zoomstart",new JE("zoomstart",e)),this.rotating&&!n.rotating&&this.emit("rotatestart",new JE("rotatestart",e)),this.pitching&&!n.pitching&&this.emit("pitchstart",new JE("pitchstart",e))}},{key:"afterEase",value:function(e,t){if(!this.easeId||!t||this.easeId!==t){delete this.easeId;var n=this.zooming,r=this.rotating,i=this.pitching;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.padding=!1,n&&this.emit("zoomend",new JE("zoomend",e)),r&&this.emit("rotateend",new JE("rotateend",e)),i&&this.emit("pitchend",new JE("pitchend",e)),this.emit("moveend",new JE("moveend",e))}}},{key:"ease",value:function(e,t,n){!1===n.animate||0===n.duration?(e(1),t()):(this.easeStart=DE(),this.easeOptions=n,this.onEaseFrame=e,this.onEaseEnd=t,this.easeFrameId=this.requestRenderFrame(this.renderFrameCallback))}},{key:"cameraForBoxAndBearing",value:function(e,t,n,r){var i={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=Ky({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){var o=r.padding;r.padding={top:o,bottom:o,right:o,left:o}}r.padding=Ky(i,r.padding);var a=this.transform,s=a.padding,u=a.project(UE.convert(e)),c=a.project(UE.convert(t)),l=u.rotate(-n*Math.PI/180),f=c.rotate(-n*Math.PI/180),h=new VE(Math.max(l.x,f.x),Math.max(l.y,f.y)),d=new VE(Math.min(l.x,f.x),Math.min(l.y,f.y)),p=h.sub(d),v=(a.width-(s.left+s.right+r.padding.left+r.padding.right))/p.x,g=(a.height-(s.top+s.bottom+r.padding.top+r.padding.bottom))/p.y;if(!(g<0||v<0)){var m=Math.min(a.scaleZoom(a.scale*Math.min(v,g)),r.maxZoom),y=VE.convert(r.offset),b=(r.padding.left-r.padding.right)/2,_=(r.padding.top-r.padding.bottom)/2,x=new VE(y.x+b,y.y+_).mult(a.scale/a.zoomScale(m));return{center:a.unproject(u.add(c).div(2).sub(x)),zoom:m,bearing:n}}}},{key:"fitInternal",value:function(e,t,n){return e?(delete(t=Ky(e,t)).padding,t.linear?this.easeTo(t,n):this.flyTo(t,n)):this}}]),n}(s);ZA(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: -webkit-grab;\n  cursor: -moz-grab;\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: -webkit-grabbing;\n  cursor: -moz-grabbing;\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n");var eC={create:function(e,t,n){var r=window.document.createElement(e);return void 0!==t&&(r.className=t),n&&n.appendChild(r),r},createNS:function(e,t){return window.document.createElementNS(e,t)}},tC=window.document&&window.document.documentElement.style;function nC(e){if(!tC)return e[0];var t,n=Pr(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r in tC)return r}}catch(e){n.e(e)}finally{n.f()}return e[0]}var rC,iC=nC(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);eC.disableDrag=function(){tC&&iC&&(rC=tC[iC],tC[iC]="none")},eC.enableDrag=function(){tC&&iC&&(tC[iC]=rC)};var oC=nC(["transform","WebkitTransform"]);eC.setTransform=function(e,t){e.style[oC]=t};var aC=!1;try{var sC=Object.defineProperty({},"passive",{get:function(){aC=!0}});window.addEventListener("test",sC,sC),window.removeEventListener("test",sC,sC)}catch(e){aC=!1}eC.addEventListener=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&aC?e.addEventListener(t,n,r):e.addEventListener(t,n,r.capture)},eC.removeEventListener=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&aC?e.removeEventListener(t,n,r):e.removeEventListener(t,n,r.capture)};var uC=function e(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",e,!0)};eC.suppressClick=function(){window.addEventListener("click",uC,!0),window.setTimeout((function(){window.removeEventListener("click",uC,!0)}),0)},eC.mousePos=function(e,t){var n=e.getBoundingClientRect();return new VE(t.clientX-n.left-e.clientLeft,t.clientY-n.top-e.clientTop)},eC.touchPos=function(e,t){var n,r=e.getBoundingClientRect(),i=[],o=Pr(t);try{for(o.s();!(n=o.n()).done;){var a=n.value;i.push(new VE(a.clientX-r.left-e.clientLeft,a.clientY-r.top-e.clientTop))}}catch(e){o.e(e)}finally{o.f()}return i},eC.mouseButton=function(e){return void 0!==window.InstallTrigger&&2===e.button&&e.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},eC.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)};var cC=function(e){mr(n,e);var t=Er(n);function n(e,r,i){var o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};dr(this,n);var s=eC.mousePos(r.getCanvasContainer(),i),u=r.unproject(s);return gr(Ar(o=t.call(this,e,Ky({point:s,lngLat:u,originalEvent:i},a))),"type",void 0),gr(Ar(o),"target",void 0),gr(Ar(o),"originalEvent",void 0),gr(Ar(o),"point",void 0),gr(Ar(o),"lngLat",void 0),gr(Ar(o),"defaultPrevented",void 0),o.defaultPrevented=!1,o.target=r,o}return vr(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(JE),lC=function(e){mr(n,e);var t=Er(n);function n(e,r,i){var o;dr(this,n);var a="touchend"===e?i.changedTouches:i.touches,s=eC.touchPos(r.getCanvasContainer(),a),u=s.map((function(e){return r.unproject(e)})),c=s.reduce((function(e,t,n,r){return e.add(t.div(r.length))}),new VE(0,0)),l=r.unproject(c);return gr(Ar(o=t.call(this,e,{points:s,point:c,lngLats:u,lngLat:l,originalEvent:i})),"type",void 0),gr(Ar(o),"target",void 0),gr(Ar(o),"originalEvent",void 0),gr(Ar(o),"lngLat",void 0),gr(Ar(o),"point",void 0),gr(Ar(o),"points",void 0),gr(Ar(o),"lngLats",void 0),gr(Ar(o),"defaultPrevented",void 0),o.defaultPrevented=!1,o}return vr(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(JE),fC=function(e){mr(n,e);var t=Er(n);function n(e,r,i){var o;return dr(this,n),gr(Ar(o=t.call(this,e,{originalEvent:i})),"type",void 0),gr(Ar(o),"originalEvent",void 0),gr(Ar(o),"defaultPrevented",void 0),gr(Ar(o),"target",void 0),o.defaultPrevented=!1,o}return vr(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(JE),hC=function(){function e(t){dr(this,e),gr(this,"map",void 0),gr(this,"delayContextMenu",void 0),gr(this,"contextMenuEvent",void 0),this.map=t}return vr(e,[{key:"reset",value:function(){this.delayContextMenu=!1,delete this.contextMenuEvent}},{key:"mousemove",value:function(e){this.map.emit(e.type,new cC(e.type,this.map,e))}},{key:"mousedown",value:function(){this.delayContextMenu=!0}},{key:"mouseup",value:function(){this.delayContextMenu=!1,this.contextMenuEvent&&(this.map.emit("contextmenu",new cC("contextmenu",this.map,this.contextMenuEvent)),delete this.contextMenuEvent)}},{key:"contextmenu",value:function(e){this.delayContextMenu?this.contextMenuEvent=e:this.map.emit(e.type,new cC(e.type,this.map,e)),this.map.listeners("contextmenu")&&e.preventDefault()}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!0}},{key:"disable",value:function(){return!1}}]),e}(),dC=function(){function e(t,n){dr(this,e),gr(this,"map",void 0),gr(this,"el",void 0),gr(this,"container",void 0),gr(this,"enabled",void 0),gr(this,"active",void 0),gr(this,"startPos",void 0),gr(this,"lastPos",void 0),gr(this,"box",void 0),gr(this,"clickTolerance",void 0),this.map=t,this.el=t.getCanvasContainer(),this.container=t.getContainer(),this.clickTolerance=n.clickTolerance||1}return vr(e,[{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active}},{key:"enable",value:function(){this.isEnabled()||(this.enabled=!0)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"mousedown",value:function(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(eC.disableDrag(),this.startPos=this.lastPos=t,this.active=!0)}},{key:"mousemoveWindow",value:function(e,t){if(this.active){var n=t;if(!(this.lastPos.equals(n)||!this.box&&n.dist(this.startPos)<this.clickTolerance)){var r=this.startPos;this.lastPos=n,this.box||(this.box=eC.create("div","l7-boxzoom",this.container),this.container.classList.add("l7-crosshair"),this.fireEvent("boxzoomstart",e));var i=Math.min(r.x,n.x),o=Math.max(r.x,n.x),a=Math.min(r.y,n.y),s=Math.max(r.y,n.y);eC.setTransform(this.box,"translate(".concat(i,"px,").concat(a,"px)")),this.box&&(this.box.style.width="".concat(o-i,"px"),this.box.style.height="".concat(s-a,"px"))}}}},{key:"mouseupWindow",value:function(e,t){var n=this;if(this.active&&0===e.button){var r=this.startPos,i=t;if(this.reset(),eC.suppressClick(),r.x!==i.x||r.y!==i.y)return this.map.emit("boxzoomend",new JE("boxzoomend",{originalEvent:e})),{cameraAnimation:function(e){return e.fitScreenCoordinates(r,i,n.map.getBearing(),{linear:!0})}};this.fireEvent("boxzoomcancel",e)}}},{key:"keydown",value:function(e){this.active&&27===e.keyCode&&(this.reset(),this.fireEvent("boxzoomcancel",e))}},{key:"reset",value:function(){this.active=!1,this.container.classList.remove("l7-crosshair"),this.box&&(eC.remove(this.box),this.box=null),eC.enableDrag(),delete this.startPos,delete this.lastPos}},{key:"fireEvent",value:function(e,t){return this.map.emit(e,new JE(e,{originalEvent:t}))}}]),e}(),pC=function(){function e(){dr(this,e),gr(this,"enabled",void 0),gr(this,"active",void 0),this.reset()}return vr(e,[{key:"reset",value:function(){this.active=!1}},{key:"dblclick",value:function(e,t){return e.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(e.shiftKey?-1:1),around:n.unproject(t)},{originalEvent:e})}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),vC=function(e){mr(n,e);var t=Er(n);function n(){var e;dr(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return gr(Ar(e=t.call.apply(t,[this].concat(i))),"type","renderFrame"),gr(Ar(e),"timeStamp",void 0),e}return n}(JE),gC={linearity:.3,easing:PE(0,0,.3,1)},mC=Ky({deceleration:2500,maxSpeed:1400},gC),yC=Ky({deceleration:20,maxSpeed:1400},gC),bC=Ky({deceleration:1e3,maxSpeed:360},gC),_C=Ky({deceleration:1e3,maxSpeed:90},gC),xC=function(){function e(t){dr(this,e),gr(this,"map",void 0),gr(this,"inertiaBuffer",void 0),this.map=t,this.clear()}return vr(e,[{key:"clear",value:function(){this.inertiaBuffer=[]}},{key:"record",value:function(e){this.drainInertiaBuffer(),this.inertiaBuffer.push({time:DE(),settings:e})}},{key:"drainInertiaBuffer",value:function(){for(var e=this.inertiaBuffer,t=DE();e.length>0&&t-e[0].time>160;)e.shift()}},{key:"onMoveEnd",value:function(e){if(this.drainInertiaBuffer(),!(this.inertiaBuffer.length<2)){var t,n={zoom:0,bearing:0,pitch:0,pan:new VE(0,0),pinchAround:void 0,around:void 0},r=Pr(this.inertiaBuffer);try{for(r.s();!(t=r.n()).done;){var i=t.value.settings;n.zoom+=i.zoomDelta||0,n.bearing+=i.bearingDelta||0,n.pitch+=i.pitchDelta||0,i.panDelta&&n.pan._add(i.panDelta),i.around&&(n.around=i.around),i.pinchAround&&(n.pinchAround=i.pinchAround)}}catch(e){r.e(e)}finally{r.f()}var o=this.inertiaBuffer[this.inertiaBuffer.length-1].time-this.inertiaBuffer[0].time,a={};if(n.pan.mag()){var s=wC(n.pan.mag(),o,Ky({},mC,e||{}));a.offset=n.pan.mult(s.amount/n.pan.mag()),a.center=this.map.transform.center,SC(a,s)}if(n.zoom){var u=wC(n.zoom,o,yC);a.zoom=this.map.transform.zoom+u.amount,SC(a,u)}if(n.bearing){var c=wC(n.bearing,o,bC);a.bearing=this.map.transform.bearing+OE(c.amount,-179,179),SC(a,c)}if(n.pitch){var l=wC(n.pitch,o,_C);a.pitch=this.map.transform.pitch+l.amount,SC(a,l)}if(a.zoom||a.bearing){var f=void 0===n.pinchAround?n.around:n.pinchAround;a.around=f?this.map.unproject(f):this.map.getCenter()}return this.clear(),Ky(a,{noMoveStart:!0})}}}]),e}();function SC(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function wC(e,t,n){var r=n.maxSpeed,i=n.linearity,o=n.deceleration,a=OE(e*i/(t/1e3),-r,r),s=Math.abs(a)/(o*i);return{easing:n.easing,duration:1e3*s,amount:a*(s/2)}}var AC={panStep:100,bearingStep:15,pitchStep:10},TC=function(){function e(){dr(this,e),gr(this,"enabled",void 0),gr(this,"active",void 0),gr(this,"panStep",void 0),gr(this,"bearingStep",void 0),gr(this,"pitchStep",void 0);var t=AC;this.panStep=t.panStep,this.bearingStep=t.bearingStep,this.pitchStep=t.pitchStep}return vr(e,[{key:"reset",value:function(){this.active=!1}},{key:"keydown",value:function(e){var t=this;if(!(e.altKey||e.ctrlKey||e.metaKey)){var n=0,r=0,i=0,o=0,a=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),o=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),o=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),a=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),a=1);break;default:return}return{cameraAnimation:function(s){var u=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:EC,zoom:n?Math.round(u)+n*(e.shiftKey?2:1):u,bearing:s.getBearing()+r*t.bearingStep,pitch:s.getPitch()+i*t.pitchStep,offset:[-o*t.panStep,-a*t.panStep],center:s.getCenter()},{originalEvent:e})}}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function EC(e){return e*(2-e)}var CC,MC=function(){function e(t,n){dr(this,e),gr(this,"mousedownPos",void 0),gr(this,"clickTolerance",void 0),gr(this,"map",void 0),this.map=t,this.clickTolerance=n.clickTolerance}return vr(e,[{key:"reset",value:function(){delete this.mousedownPos}},{key:"wheel",value:function(e){return this.firePreventable(new fC(e.type,this.map,e))}},{key:"mousedown",value:function(e,t){return this.mousedownPos=t,this.firePreventable(new cC(e.type,this.map,e))}},{key:"mouseup",value:function(e){this.map.emit(e.type,new cC(e.type,this.map,e))}},{key:"click",value:function(e,t){this.mousedownPos&&this.mousedownPos.dist(t)>=this.clickTolerance||this.map.emit(e.type,new cC(e.type,this.map,e))}},{key:"dblclick",value:function(e){return this.firePreventable(new cC(e.type,this.map,e))}},{key:"mouseover",value:function(e){this.map.emit(e.type,new cC(e.type,this.map,e))}},{key:"mouseout",value:function(e){this.map.emit(e.type,new cC(e.type,this.map,e))}},{key:"touchstart",value:function(e){return this.firePreventable(new lC(e.type,this.map,e))}},{key:"touchmove",value:function(e){this.map.emit(e.type,new lC(e.type,this.map,e))}},{key:"touchend",value:function(e){this.map.emit(e.type,new lC(e.type,this.map,e))}},{key:"touchcancel",value:function(e){this.map.emit(e.type,new lC(e.type,this.map,e))}},{key:"firePreventable",value:function(e){if(this.map.emit(e.type,e),e.defaultPrevented)return{}}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!1}},{key:"disable",value:function(){return!1}}]),e}(),kC=(gr(CC={},0,1),gr(CC,2,2),CC);var OC=function(){function e(t){dr(this,e),gr(this,"enabled",void 0),gr(this,"active",void 0),gr(this,"lastPoint",void 0),gr(this,"eventButton",void 0),gr(this,"moved",void 0),gr(this,"clickTolerance",void 0),this.reset(),this.clickTolerance=t.clickTolerance||1}return vr(e,[{key:"reset",value:function(){this.active=!1,this.moved=!1,delete this.lastPoint,delete this.eventButton}},{key:"mousedown",value:function(e,t){if(!this.lastPoint){var n=eC.mouseButton(e);this.correctButton(e,n)&&(this.lastPoint=t,this.eventButton=n)}}},{key:"mousemoveWindow",value:function(e,t){var n=this.lastPoint;if(n)if(e.preventDefault(),function(e,t){var n=kC[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this.eventButton))this.reset();else if(this.moved||!(t.dist(n)<this.clickTolerance))return this.moved=!0,this.lastPoint=t,this.move(n,t)}},{key:"mouseupWindow",value:function(e){this.lastPoint&&(eC.mouseButton(e)===this.eventButton&&(this.moved&&eC.suppressClick(),this.reset()))}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"correctButton",value:function(e,t){return!1}},{key:"move",value:function(e,t){}}]),e}(),IC=function(e){mr(n,e);var t=Er(n);function n(){return dr(this,n),t.apply(this,arguments)}return vr(n,[{key:"mousedown",value:function(e,t){Cr(yr(n.prototype),"mousedown",this).call(this,e,t),this.lastPoint&&(this.active=!0)}},{key:"move",value:function(e,t){return{around:t,panDelta:t.sub(e)}}},{key:"correctButton",value:function(e,t){return 0===t&&!e.ctrlKey}}]),n}(OC),PC=function(e){mr(n,e);var t=Er(n);function n(){return dr(this,n),t.apply(this,arguments)}return vr(n,[{key:"correctButton",value:function(e,t){return 0===t&&e.ctrlKey||2===t}},{key:"move",value:function(e,t){var n=-.5*(t.y-e.y);if(n)return this.active=!0,{pitchDelta:n}}},{key:"contextmenu",value:function(e){e.preventDefault()}}]),n}(OC),LC=function(e){mr(n,e);var t=Er(n);function n(){return dr(this,n),t.apply(this,arguments)}return vr(n,[{key:"contextmenu",value:function(e){e.preventDefault()}},{key:"correctButton",value:function(e,t){return 0===t&&e.ctrlKey||2===t}},{key:"move",value:function(e,t){var n=.8*(t.x-e.x);if(n)return this.active=!0,{bearingDelta:n}}}]),n}(OC),RC=function(){function e(t,n){var r=this;dr(this,e),gr(this,"map",void 0),gr(this,"el",void 0),gr(this,"enabled",void 0),gr(this,"active",void 0),gr(this,"zooming",void 0),gr(this,"aroundCenter",void 0),gr(this,"around",void 0),gr(this,"aroundPoint",void 0),gr(this,"type",void 0),gr(this,"lastValue",void 0),gr(this,"timeout",void 0),gr(this,"finishTimeout",void 0),gr(this,"lastWheelEvent",void 0),gr(this,"lastWheelEventTime",void 0),gr(this,"startZoom",void 0),gr(this,"targetZoom",void 0),gr(this,"delta",void 0),gr(this,"easing",void 0),gr(this,"prevEase",void 0),gr(this,"frameId",void 0),gr(this,"handler",void 0),gr(this,"defaultZoomRate",void 0),gr(this,"wheelZoomRate",void 0),gr(this,"onScrollFrame",(function(){if(r.frameId&&(r.frameId=null,r.isActive())){var e=r.map.transform;if(0!==r.delta){var t="wheel"===r.type&&Math.abs(r.delta)>4.000244140625?r.wheelZoomRate:r.defaultZoomRate,n=2/(1+Math.exp(-Math.abs(r.delta*t)));r.delta<0&&0!==n&&(n=1/n);var i="number"==typeof r.targetZoom?e.zoomScale(r.targetZoom):e.scale;r.targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(i*n))),"wheel"===r.type&&(r.startZoom=e.zoom,r.easing=r.smoothOutEasing(200)),r.delta=0}var o,a="number"==typeof r.targetZoom?r.targetZoom:e.zoom,s=r.startZoom,u=r.easing,c=!1;if("wheel"===r.type&&s&&u){var l=Math.min((DE()-r.lastWheelEventTime)/200,1);o=IE(s,a,u(l)),l<1?r.frameId||(r.frameId=!0):c=!0}else o=a,c=!0;return r.active=!0,c&&(r.active=!1,r.finishTimeout=setTimeout((function(){r.zooming=!1,r.handler.triggerRenderFrame(),delete r.targetZoom,delete r.finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!c,zoomDelta:o-e.zoom,around:r.aroundPoint,originalEvent:r.lastWheelEvent}}})),this.map=t,this.el=t.getCanvasContainer(),this.handler=n,this.delta=0,this.defaultZoomRate=.01,this.wheelZoomRate=1/450}return vr(e,[{key:"setZoomRate",value:function(e){this.defaultZoomRate=e}},{key:"setWheelZoomRate",value:function(e){this.wheelZoomRate=e}},{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active||void 0!==this.finishTimeout}},{key:"isZooming",value:function(){return!!this.zooming}},{key:"enable",value:function(e){this.isEnabled()||(this.enabled=!0,this.aroundCenter=e&&"center"===e.around)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"wheel",value:function(e){if(this.isEnabled()){var t=e.deltaMode===window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,n=DE(),r=n-(this.lastWheelEventTime||0);this.lastWheelEventTime=n,0!==t&&t%4.000244140625==0?this.type="wheel":0!==t&&Math.abs(t)<4?this.type="trackpad":r>400?(this.type=null,this.lastValue=t,this.timeout=setTimeout(this.onTimeout,40,e)):this.type||(this.type=Math.abs(r*t)<200?"trackpad":"wheel",this.timeout&&(clearTimeout(this.timeout),this.timeout=null,t+=this.lastValue)),e.shiftKey&&t&&(t/=4),this.type&&(this.lastWheelEvent=e,this.delta-=t,this.active||this.start(e)),e.preventDefault()}}},{key:"renderFrame",value:function(){return this.onScrollFrame()}},{key:"reset",value:function(){this.active=!1}},{key:"onTimeout",value:function(e){this.type="wheel",this.delta-=this.lastValue,this.active||this.start(e)}},{key:"start",value:function(e){if(this.delta){this.frameId&&(this.frameId=null),this.active=!0,this.isZooming()||(this.zooming=!0),this.finishTimeout&&(clearTimeout(this.finishTimeout),delete this.finishTimeout);var t=eC.mousePos(this.el,e);this.around=UE.convert(this.aroundCenter?this.map.getCenter():this.map.unproject(t)),this.aroundPoint=this.map.transform.locationPoint(this.around),this.frameId||(this.frameId=!0,this.handler.triggerRenderFrame())}}},{key:"smoothOutEasing",value:function(e){var t=LE;if(this.prevEase){var n=this.prevEase,r=(DE()-n.start)/n.duration,i=n.easing(r+.01)-n.easing(r),o=.27/Math.sqrt(i*i+1e-4)*.01;t=PE(o,Math.sqrt(.0729-o*o),.25,1)}return this.prevEase={start:DE(),duration:e,easing:t},t}}]),e}(),NC=function(){function e(t,n){dr(this,e),gr(this,"clickZoom",void 0),gr(this,"tapZoom",void 0),this.clickZoom=t,this.tapZoom=n}return vr(e,[{key:"enable",value:function(){this.clickZoom.enable(),this.tapZoom.enable()}},{key:"disable",value:function(){this.clickZoom.disable(),this.tapZoom.disable()}},{key:"isEnabled",value:function(){return this.clickZoom.isEnabled()&&this.tapZoom.isEnabled()}},{key:"isActive",value:function(){return this.clickZoom.isActive()||this.tapZoom.isActive()}}]),e}(),DC=function(){function e(t,n,r){dr(this,e),gr(this,"inertiaOptions",void 0),gr(this,"el",void 0),gr(this,"mousePan",void 0),gr(this,"touchPan",void 0),this.el=t,this.mousePan=n,this.touchPan=r}return vr(e,[{key:"enable",value:function(e){this.inertiaOptions=e||{},this.mousePan.enable(),this.touchPan.enable(),this.el.classList.add("l7-touch-drag-pan")}},{key:"disable",value:function(){this.mousePan.disable(),this.touchPan.disable(),this.el.classList.remove("l7-touch-drag-pan")}},{key:"isEnabled",value:function(){return this.mousePan.isEnabled()&&this.touchPan.isEnabled()}},{key:"isActive",value:function(){return this.mousePan.isActive()||this.touchPan.isActive()}}]),e}(),FC=function(){function e(t,n,r){dr(this,e),gr(this,"mouseRotate",void 0),gr(this,"mousePitch",void 0),gr(this,"pitchWithRotate",void 0),this.pitchWithRotate=t.pitchWithRotate,this.mouseRotate=n,this.mousePitch=r}return vr(e,[{key:"enable",value:function(){this.mouseRotate.enable(),this.pitchWithRotate&&this.mousePitch.enable()}},{key:"disable",value:function(){this.mouseRotate.disable(),this.mousePitch.disable()}},{key:"isEnabled",value:function(){return this.mouseRotate.isEnabled()&&(!this.pitchWithRotate||this.mousePitch.isEnabled())}},{key:"isActive",value:function(){return this.mouseRotate.isActive()||this.mousePitch.isActive()}}]),e}(),zC=function(){function e(t,n,r,i){dr(this,e),gr(this,"el",void 0),gr(this,"touchZoom",void 0),gr(this,"touchRotate",void 0),gr(this,"tapDragZoom",void 0),gr(this,"rotationDisabled",void 0),gr(this,"enabled",void 0),this.el=t,this.touchZoom=n,this.touchRotate=r,this.tapDragZoom=i,this.rotationDisabled=!1,this.enabled=!0}return vr(e,[{key:"enable",value:function(e){this.touchZoom.enable(e),this.rotationDisabled||this.touchRotate.enable(e),this.tapDragZoom.enable(),this.el.classList.add("l7-touch-zoom-rotate")}},{key:"disable",value:function(){this.touchZoom.disable(),this.touchRotate.disable(),this.tapDragZoom.disable(),this.el.classList.remove("l7-touch-zoom-rotate")}},{key:"isEnabled",value:function(){return this.touchZoom.isEnabled()&&(this.rotationDisabled||this.touchRotate.isEnabled())&&this.tapDragZoom.isEnabled()}},{key:"isActive",value:function(){return this.touchZoom.isActive()||this.touchRotate.isActive()||this.tapDragZoom.isActive()}},{key:"disableRotation",value:function(){this.rotationDisabled=!0,this.touchRotate.disable()}},{key:"enableRotation",value:function(){this.rotationDisabled=!1,this.touchZoom.isEnabled()&&this.touchRotate.enable()}}]),e}();function jC(e,t){for(var n={},r=0;r<e.length;r++)n[e[r].identifier]=t[r];return n}var UC=function(){function e(t){dr(this,e),gr(this,"numTouches",void 0),gr(this,"centroid",void 0),gr(this,"startTime",void 0),gr(this,"aborted",void 0),gr(this,"touches",void 0),this.reset(),this.numTouches=t.numTouches}return vr(e,[{key:"reset",value:function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}},{key:"touchstart",value:function(e,t,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=function(e){var t,n=new VE(0,0),r=Pr(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n._add(i)}}catch(e){r.e(e)}finally{r.f()}return n.div(e.length)}(t),this.touches=jC(n,t)))}},{key:"touchmove",value:function(e,t,n){if(!this.aborted&&this.centroid){var r=jC(n,t);for(var i in this.touches)if(this.touches[i]){var o=this.touches[i],a=r[i];(!a||a.dist(o)>30)&&(this.aborted=!0)}}}},{key:"touchend",value:function(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}}}]),e}(),BC=function(){function e(t){dr(this,e),gr(this,"singleTap",void 0),gr(this,"numTaps",void 0),gr(this,"lastTime",void 0),gr(this,"lastTap",void 0),gr(this,"count",void 0),this.singleTap=new UC(t),this.numTaps=t.numTaps,this.reset()}return vr(e,[{key:"reset",value:function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}},{key:"touchstart",value:function(e,t,n){this.singleTap.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){this.singleTap.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){var r=this.singleTap.touchend(e,t,n);if(r){var i=e.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(r)<30;if(i&&o||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}]),e}(),VC=function(){function e(){dr(this,e),gr(this,"enabled",void 0),gr(this,"active",void 0),gr(this,"swipePoint",void 0),gr(this,"swipeTouch",void 0),gr(this,"tapTime",void 0),gr(this,"tap",void 0),this.tap=new BC({numTouches:1,numTaps:1}),this.reset()}return vr(e,[{key:"reset",value:function(){this.active=!1,delete this.swipePoint,delete this.swipeTouch,delete this.tapTime,this.tap.reset()}},{key:"touchstart",value:function(e,t,n){this.swipePoint||(this.tapTime&&e.timeStamp-this.tapTime>500&&this.reset(),this.tapTime?n.length>0&&(this.swipePoint=t[0],this.swipeTouch=n[0].identifier):this.tap.touchstart(e,t,n))}},{key:"touchmove",value:function(e,t,n){if(this.tapTime){if(this.swipePoint){if(n[0].identifier!==this.swipeTouch)return;var r=t[0],i=r.y-this.swipePoint.y;return this.swipePoint=r,e.preventDefault(),this.active=!0,{zoomDelta:i/128}}}else this.tap.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){this.tapTime?this.swipePoint&&0===n.length&&this.reset():this.tap.touchend(e,t,n)&&(this.tapTime=e.timeStamp)}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),HC=function(){function e(){dr(this,e),gr(this,"enabled",void 0),gr(this,"active",void 0),gr(this,"zoomIn",void 0),gr(this,"zoomOut",void 0),this.zoomIn=new BC({numTouches:1,numTaps:2}),this.zoomOut=new BC({numTouches:2,numTaps:1}),this.reset()}return vr(e,[{key:"reset",value:function(){this.active=!1,this.zoomIn.reset(),this.zoomOut.reset()}},{key:"touchstart",value:function(e,t,n){this.zoomIn.touchstart(e,t,n),this.zoomOut.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){this.zoomIn.touchmove(e,t,n),this.zoomOut.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){var r=this,i=this.zoomIn.touchend(e,t,n),o=this.zoomOut.touchend(e,t,n);return i?(this.active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(i)},{originalEvent:e})}}):o?(this.active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(o)},{originalEvent:e})}}):void 0}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),GC=function(){function e(t){dr(this,e),gr(this,"enabled",void 0),gr(this,"active",void 0),gr(this,"touches",void 0),gr(this,"minTouches",void 0),gr(this,"clickTolerance",void 0),gr(this,"sum",void 0),this.minTouches=1,this.clickTolerance=t.clickTolerance||1,this.reset()}return vr(e,[{key:"reset",value:function(){this.active=!1,this.touches={},this.sum=new VE(0,0)}},{key:"touchstart",value:function(e,t,n){return this.calculateTransform(e,t,n)}},{key:"touchmove",value:function(e,t,n){if(this.active)return e.preventDefault(),this.calculateTransform(e,t,n)}},{key:"touchend",value:function(e,t,n){this.calculateTransform(e,t,n),this.active&&n.length<this.minTouches&&this.reset()}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"calculateTransform",value:function(e,t,n){n.length>0&&(this.active=!0);var r=jC(n,t),i=new VE(0,0),o=new VE(0,0),a=0;for(var s in r)if(r[s]){var u=r[s],c=this.touches[s];c&&(i._add(u),o._add(u.sub(c)),a++,r[s]=u)}if(this.touches=r,!(a<this.minTouches)&&o.mag()){var l=o.div(a);if(this.sum._add(l),!(this.sum.mag()<this.clickTolerance))return{around:i.div(a),panDelta:l}}}}]),e}(),WC=function(){function e(){dr(this,e),gr(this,"enabled",void 0),gr(this,"active",void 0),gr(this,"firstTwoTouches",void 0),gr(this,"vector",void 0),gr(this,"startVector",void 0),gr(this,"aroundCenter",void 0),this.reset()}return vr(e,[{key:"reset",value:function(){this.active=!1,delete this.firstTwoTouches}},{key:"start",value:function(e){}},{key:"move",value:function(e,t,n){}},{key:"touchstart",value:function(e,t,n){this.firstTwoTouches||n.length<2||(this.firstTwoTouches=[n[0].identifier,n[1].identifier],this.start([t[0],t[1]]))}},{key:"touchmove",value:function(e,t,n){if(this.firstTwoTouches){e.preventDefault();var r=Mr(this.firstTwoTouches,2),i=r[0],o=r[1],a=ZC(n,t,i),s=ZC(n,t,o);if(a&&s){var u=this.aroundCenter?null:a.add(s).div(2);return this.move([a,s],u,e)}}}},{key:"touchend",value:function(e,t,n){if(this.firstTwoTouches){var r=Mr(this.firstTwoTouches,2),i=r[0],o=r[1],a=ZC(n,t,i),s=ZC(n,t,o);a&&s||(this.active&&eC.suppressClick(),this.reset())}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(e){this.enabled=!0,this.aroundCenter=!!e&&"center"===e.around}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function ZC(e,t,n){for(var r=0;r<e.length;r++)if(e[r].identifier===n)return t[r]}function YC(e){return Math.abs(e.y)>Math.abs(e.x)}var qC=function(e){mr(n,e);var t=Er(n);function n(){var e;dr(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return gr(Ar(e=t.call.apply(t,[this].concat(i))),"valid",void 0),gr(Ar(e),"firstMove",void 0),gr(Ar(e),"lastPoints",void 0),e}return vr(n,[{key:"reset",value:function(){Cr(yr(n.prototype),"reset",this).call(this),this.valid=void 0,delete this.firstMove,delete this.lastPoints}},{key:"start",value:function(e){this.lastPoints=e,YC(e[0].sub(e[1]))&&(this.valid=!1)}},{key:"move",value:function(e,t,n){var r=e[0].sub(this.lastPoints[0]),i=e[1].sub(this.lastPoints[1]);if(this.valid=this.gestureBeginsVertically(r,i,n.timeStamp),this.valid){this.lastPoints=e,this.active=!0;return{pitchDelta:-.5*((r.y+i.y)/2)}}}},{key:"gestureBeginsVertically",value:function(e,t,n){if(void 0!==this.valid)return this.valid;var r=e.mag()>=2,i=t.mag()>=2;if(r||i){if(!r||!i)return void 0===this.firstMove&&(this.firstMove=n),n-this.firstMove<100&&void 0;var o=e.y>0==t.y>0;return YC(e)&&YC(t)&&o}}}]),n}(WC);function XC(e,t){return 180*e.angleWith(t)/Math.PI}var KC=function(e){mr(n,e);var t=Er(n);function n(){var e;dr(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return gr(Ar(e=t.call.apply(t,[this].concat(i))),"minDiameter",void 0),e}return vr(n,[{key:"reset",value:function(){Cr(yr(n.prototype),"reset",this).call(this),delete this.minDiameter,delete this.startVector,delete this.vector}},{key:"start",value:function(e){this.startVector=this.vector=e[0].sub(e[1]),this.minDiameter=e[0].dist(e[1])}},{key:"move",value:function(e,t){var n=this.vector;if(this.vector=e[0].sub(e[1]),this.active||!this.isBelowThreshold(this.vector))return this.active=!0,{bearingDelta:XC(this.vector,n),pinchAround:t}}},{key:"isBelowThreshold",value:function(e){this.minDiameter=Math.min(this.minDiameter,e.mag());var t=25/(Math.PI*this.minDiameter)*360,n=XC(e,this.startVector);return Math.abs(n)<t}}]),n}(WC);function QC(e,t){return Math.log(e/t)/Math.LN2}var JC=function(e){mr(n,e);var t=Er(n);function n(){var e;dr(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return gr(Ar(e=t.call.apply(t,[this].concat(i))),"distance",void 0),gr(Ar(e),"startDistance",void 0),e}return vr(n,[{key:"reset",value:function(){Cr(yr(n.prototype),"reset",this).call(this),delete this.distance,delete this.startDistance}},{key:"start",value:function(e){this.startDistance=this.distance=e[0].dist(e[1])}},{key:"move",value:function(e,t){var n=this.distance;if(this.distance=e[0].dist(e[1]),this.active||!(Math.abs(QC(this.distance,this.startDistance))<.1))return this.active=!0,{zoomDelta:QC(this.distance,n),pinchAround:t}}}]),n}(WC),$C=function(e){return e.zoom||e.drag||e.pitch||e.rotate};function eM(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}var tM=function(){function e(t,n){var r=this;dr(this,e),gr(this,"map",void 0),gr(this,"el",void 0),gr(this,"handlers",void 0),gr(this,"eventsInProgress",void 0),gr(this,"frameId",void 0),gr(this,"inertia",void 0),gr(this,"bearingSnap",void 0),gr(this,"handlersById",void 0),gr(this,"updatingCamera",void 0),gr(this,"changes",void 0),gr(this,"previousActiveHandlers",void 0),gr(this,"bearingChanged",void 0),gr(this,"listeners",void 0),gr(this,"handleWindowEvent",(function(e){r.handleEvent(e,"".concat(e.type,"Window"))})),gr(this,"handleEvent",(function(e,t){if("blur"!==e.type){r.updatingCamera=!0;var n,i="renderFrame"===e.type?void 0:e,o={needsRenderFrame:!1},a={},s={},u=e.touches?r.getMapTouches(e.touches):void 0,c=u?eC.touchPos(r.el,u):eC.mousePos(r.el,e),l=Pr(r.handlers);try{for(l.s();!(n=l.n()).done;){var f=n.value,h=f.handlerName,d=f.handler,p=f.allowed;if(d.isEnabled()){var v=void 0;if(r.blockedByActive(s,p,h))d.reset();else{var g=t||e.type;d&&d[g]&&(v=d[g](e,c,u),r.mergeIHandlerResult(o,a,v,h,i),v&&v.needsRenderFrame&&r.triggerRenderFrame())}(v||d.isActive())&&(s[h]=d)}}}catch(e){l.e(e)}finally{l.f()}var m={};for(var y in r.previousActiveHandlers)s[y]||(m[y]=i);r.previousActiveHandlers=s,(Object.keys(m).length||eM(o))&&(r.changes.push([o,a,m]),r.triggerRenderFrame()),(Object.keys(s).length||eM(o))&&r.map.stop(!0),r.updatingCamera=!1;var b=o.cameraAnimation;b&&(r.inertia.clear(),r.fireEvents({},{}),r.changes=[],b(r.map))}else r.stop()})),this.map=t,this.el=this.map.getCanvasContainer(),this.handlers=[],this.handlersById={},this.changes=[],this.inertia=new xC(t),this.bearingSnap=n.bearingSnap,this.previousActiveHandlers={},this.eventsInProgress={},this.addDefaultHandlers(n);var i=this.el;this.listeners=[[i,"touchstart",{passive:!1}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[window.document,"mousemove",{capture:!0}],[window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];var o,a=Pr(this.listeners);try{for(a.s();!(o=a.n()).done;){var s=Mr(o.value,3),u=s[0],c=s[1],l=s[2];eC.addEventListener(u,c,u===window.document?this.handleWindowEvent:this.handleEvent,l)}}catch(e){a.e(e)}finally{a.f()}}return vr(e,[{key:"destroy",value:function(){var e,t=Pr(this.listeners);try{for(t.s();!(e=t.n()).done;){var n=Mr(e.value,3),r=n[0],i=n[1],o=n[2];eC.removeEventListener(r,i,r===window.document?this.handleWindowEvent:this.handleEvent,o)}}catch(e){t.e(e)}finally{t.f()}}},{key:"stop",value:function(){if(!this.updatingCamera){var e,t=Pr(this.handlers);try{for(t.s();!(e=t.n()).done;){e.value.handler.reset()}}catch(e){t.e(e)}finally{t.f()}this.inertia.clear(),this.fireEvents({},{}),this.changes=[]}}},{key:"isActive",value:function(){var e,t=Pr(this.handlers);try{for(t.s();!(e=t.n()).done;){if(e.value.handler.isActive())return!0}}catch(e){t.e(e)}finally{t.f()}return!1}},{key:"isZooming",value:function(){return!!this.eventsInProgress.zoom||this.map.scrollZoom.isZooming()}},{key:"isRotating",value:function(){return!!this.eventsInProgress.rotate}},{key:"isMoving",value:function(){return Boolean($C(this.eventsInProgress))||this.isZooming()}},{key:"mergeIHandlerResult",value:function(e,t,n,r,i){if(n){Ky(e,n);var o={handlerName:r,originalEvent:n.originalEvent||i};void 0!==n.zoomDelta&&(t.zoom=o),void 0!==n.panDelta&&(t.drag=o),void 0!==n.pitchDelta&&(t.pitch=o),void 0!==n.bearingDelta&&(t.rotate=o)}}},{key:"triggerRenderFrame",value:function(){var e=this;void 0===this.frameId&&(this.frameId=this.map.requestRenderFrame((function(t){delete e.frameId,e.handleEvent(new vC("renderFrame",{timeStamp:t})),e.applyChanges()})))}},{key:"addDefaultHandlers",value:function(e){var t=this.map,n=t.getCanvasContainer();this.add("mapEvent",new MC(t,e));var r=t.boxZoom=new dC(t,e);this.add("boxZoom",r);var i=new HC,o=new pC;t.doubleClickZoom=new NC(o,i),this.add("tapZoom",i),this.add("clickZoom",o);var a=new VC;this.add("tapDragZoom",a);var s=t.touchPitch=new qC;this.add("touchPitch",s);var u=new PC(e),c=new LC(e);t.dragRotate=new FC(e,u,c),this.add("mouseRotate",u,["mousePitch"]),this.add("mousePitch",c,["mouseRotate"]);var l=new IC(e),f=new GC(e);t.dragPan=new DC(n,l,f),this.add("mousePan",l),this.add("touchPan",f,["touchZoom","touchRotate"]);var h=new KC,d=new JC;t.touchZoomRotate=new zC(n,d,h,a),this.add("touchRotate",h,["touchPan","touchZoom"]),this.add("touchZoom",d,["touchPan","touchRotate"]);var p=t.scrollZoom=new RC(t,this);this.add("scrollZoom",p,["mousePan"]);var v=t.keyboard=new TC;this.add("keyboard",v),this.add("blockableMapEvent",new hC(t));for(var g=0,m=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];g<m.length;g++){var y=m[g];e.interactive&&e[y]&&t[y].enable(e[y])}}},{key:"add",value:function(e,t,n){this.handlers.push({handlerName:e,handler:t,allowed:n}),this.handlersById[e]=t}},{key:"blockedByActive",value:function(e,t,n){for(var r in e)if(r!==n&&(!t||t.indexOf(r)<0))return!0;return!1}},{key:"getMapTouches",value:function(e){var t,n=[],r=Pr(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,o=i.target;this.el.contains(o)&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"applyChanges",value:function(){var e,t={},n={},r={},i=Pr(this.changes);try{for(i.s();!(e=i.n()).done;){var o=Mr(e.value,3),a=o[0],s=o[1],u=o[2];a.panDelta&&(t.panDelta=(t.panDelta||new VE(0,0))._add(a.panDelta)),a.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+a.zoomDelta),a.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+a.bearingDelta),a.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+a.pitchDelta),void 0!==a.around&&(t.around=a.around),void 0!==a.pinchAround&&(t.pinchAround=a.pinchAround),a.noInertia&&(t.noInertia=a.noInertia),Ky(n,s),Ky(r,u)}}catch(e){i.e(e)}finally{i.f()}this.updateMapTransform(t,n,r),this.changes=[]}},{key:"updateMapTransform",value:function(e,t,n){var r=this.map,i=r.transform;if(!eM(e))return this.fireEvents(t,n);var o=e.panDelta,a=e.zoomDelta,s=e.bearingDelta,u=e.pitchDelta,c=e.pinchAround,l=e.around;void 0!==c&&(l=c),r.stop(!0),l=l||r.transform.centerPoint;var f=i.pointLocation(o?l.sub(o):l);s&&(i.bearing+=s),u&&(i.pitch+=u),a&&(i.zoom+=a),i.setLocationAtPoint(f,l),this.map.update(),e.noInertia||this.inertia.record(e),this.fireEvents(t,n)}},{key:"fireEvents",value:function(e,t){var n=this,r=$C(this.eventsInProgress),i=$C(e),o={};for(var a in e)if(e[a]){var s=e[a].originalEvent;this.eventsInProgress[a]||(o["".concat(a,"start")]=s),this.eventsInProgress[a]=e[a]}for(var u in!r&&i&&this.fireEvent("movestart",i.originalEvent),o)o[u]&&this.fireEvent(u,o[u]);for(var c in e.rotate&&(this.bearingChanged=!0),i&&this.fireEvent("move",i.originalEvent),e)if(e[c]){var l=e[c].originalEvent;this.fireEvent(c,l)}var f,h={};for(var d in this.eventsInProgress)if(this.eventsInProgress[d]){var p=this.eventsInProgress[d],v=p.handlerName,g=p.originalEvent;this.handlersById[v].isActive()||(delete this.eventsInProgress[d],f=t[v]||g,h["".concat(d,"end")]=f)}for(var m in h)h[m]&&this.fireEvent(m,h[m]);var y=$C(this.eventsInProgress);if((r||i)&&!y){this.updatingCamera=!0;var b=this.inertia.onMoveEnd(this.map.dragPan.inertiaOptions),_=function(e){return 0!==e&&-n.bearingSnap<e&&e<n.bearingSnap};b?(_(b.bearing||this.map.getBearing())&&(b.bearing=0),this.map.easeTo(b,{originalEvent:f})):(this.map.emit("moveend",new JE("moveend",{originalEvent:f})),_(this.map.getBearing())&&this.map.resetNorth()),this.bearingChanged=!1,this.updatingCamera=!1}}},{key:"fireEvent",value:function(e,t){this.map.emit(e,new JE(e,t?{originalEvent:t}:{}))}}]),e}(),nM=function(){return Ug.Date.now()},rM=Math.max,iM=Math.min;var oM=function(e,t,n){var r,i,o,a,s,u,c=0,l=!1,f=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function d(t){var n=r,o=i;return r=i=void 0,c=t,a=e.apply(o,n)}function p(e){return c=e,s=setTimeout(g,t),l?d(e):a}function v(e){var n=e-u;return void 0===u||n>=t||n<0||f&&e-c>=o}function g(){var e=nM();if(v(e))return m(e);s=setTimeout(g,function(e){var n=t-(e-u);return f?iM(n,o-(e-c)):n}(e))}function m(e){return s=void 0,h&&r?d(e):(r=i=void 0,a)}function y(){var e=nM(),n=v(e);if(r=arguments,i=this,u=e,n){if(void 0===s)return p(u);if(f)return clearTimeout(s),s=setTimeout(g,t),d(u)}return void 0===s&&(s=setTimeout(g,t)),a}return t=_A(t)||0,Qg(n)&&(l=!!n.leading,o=(f="maxWait"in n)?rM(_A(n.maxWait)||0,t):o,h="trailing"in n?!!n.trailing:h),y.cancel=function(){void 0!==s&&clearTimeout(s),c=0,r=u=i=s=void 0},y.flush=function(){return void 0===s?a:m(nM())},y};var aM=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return Qg(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),oM(e,t,{leading:r,maxWait:t,trailing:i})},sM=function(){function e(t){var n=this;dr(this,e),gr(this,"map",void 0),gr(this,"updateHash",void 0),gr(this,"hashName",void 0),gr(this,"onHashChange",(function(){var e=n.getCurrentHash();if(e.length>=3&&!e.some((function(e){return isNaN(+e)}))){var t=n.map.dragRotate.isEnabled()&&n.map.touchZoomRotate.isEnabled()?+(e[3]||0):n.map.getBearing();return n.map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0}return!1})),gr(this,"getCurrentHash",(function(){var e,t=window.location.hash.replace("#","");return n.hashName?(t.split("&").map((function(e){return e.split("=")})).forEach((function(t){t[0]===n.hashName&&(e=t)})),(e&&e[1]||"").split("/")):t.split("/")})),gr(this,"updateHashUnthrottled",(function(){var e=n.getHashString();try{window.history.replaceState(window.history.state,"",e)}catch(e){}})),this.hashName=t&&encodeURIComponent(t),this.updateHash=aM(this.updateHashUnthrottled,300)}return vr(e,[{key:"addTo",value:function(e){return this.map=e,window.addEventListener("hashchange",this.onHashChange,!1),this.map.on("moveend",this.updateHash),this}},{key:"remove",value:function(){return window.removeEventListener("hashchange",this.onHashChange,!1),this.map.off("moveend",this.updateHash),delete this.map,this}},{key:"getHashString",value:function(e){var t=this.map.getCenter(),n=Math.round(100*this.map.getZoom())/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,r),o=Math.round(t.lng*i)/i,a=Math.round(t.lat*i)/i,s=this.map.getBearing(),u=this.map.getPitch(),c="";if(c+=e?"/".concat(o,"/").concat(a,"/").concat(n):"".concat(n,"/").concat(a,"/").concat(o),(s||u)&&(c+="/".concat(Math.round(10*s)/10)),u&&(c+="/".concat(Math.round(u))),this.hashName){var l=this.hashName,f=!1,h=window.location.hash.slice(1).split("&").map((function(e){var t=e.split("=")[0];return t===l?(f=!0,"".concat(t,"=").concat(c)):e})).filter((function(e){return e}));return f||h.push("".concat(l,"=").concat(c)),"#".concat(h.join("&"))}return"#".concat(c)}}]),e}(),uM=null,cM=[],lM=(window.performance,function(e){var t=e;if(null!=uM){var n=t-uM;cM.push(n)}uM=t}),fM=function(){function e(){dr(this,e),gr(this,"queue",void 0),gr(this,"id",void 0),gr(this,"cleared",void 0),gr(this,"currentlyRunning",void 0),this.queue=[],this.id=0,this.cleared=!1,this.currentlyRunning=!1}return vr(e,[{key:"add",value:function(e){var t=++this.id;return this.queue.push({callback:e,id:t,cancelled:!1}),t}},{key:"remove",value:function(e){var t,n=this.currentlyRunning,r=Pr(n?this.queue.concat(n):this.queue);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.id===e)return void(i.cancelled=!0)}}catch(e){r.e(e)}finally{r.f()}}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.currentlyRunning=this.queue;this.queue=[];var n,r=Pr(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.cancelled&&(i.callback(e),this.cleared))break}}catch(e){r.e(e)}finally{r.f()}this.cleared=!1,this.currentlyRunning=!1}},{key:"clear",value:function(){this.currentlyRunning&&(this.cleared=!0),this.queue=[]}}]),e}(),hM={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0},dM=function(e){mr(n,e);var t=Er(n);function n(e){var r;dr(this,n),gr(Ar(r=t.call(this,Ky({},hM,e))),"doubleClickZoom",void 0),gr(Ar(r),"dragRotate",void 0),gr(Ar(r),"dragPan",void 0),gr(Ar(r),"touchZoomRotate",void 0),gr(Ar(r),"scrollZoom",void 0),gr(Ar(r),"keyboard",void 0),gr(Ar(r),"touchPitch",void 0),gr(Ar(r),"boxZoom",void 0),gr(Ar(r),"handlers",void 0),gr(Ar(r),"container",void 0),gr(Ar(r),"canvas",void 0),gr(Ar(r),"canvasContainer",void 0),gr(Ar(r),"renderTaskQueue",new fM),gr(Ar(r),"frame",void 0),gr(Ar(r),"trackResize",!0),gr(Ar(r),"hash",void 0),gr(Ar(r),"onWindowOnline",(function(){r.update()})),gr(Ar(r),"onWindowResize",(function(e){r.trackResize&&r.resize({originalEvent:e}).update()})),r.initContainer(),r.resize(),r.handlers=new tM(Ar(r),r.options),"undefined"!=typeof window&&(window.addEventListener("online",r.onWindowOnline,!1),window.addEventListener("resize",r.onWindowResize,!1),window.addEventListener("orientationchange",r.onWindowResize,!1));var i="string"==typeof e.hash&&e.hash||void 0;return e.hash&&(r.hash=new sM(i).addTo(Ar(r))),r.hash&&r.hash.onHashChange()||(r.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(r.resize(),r.fitBounds(e.bounds,Ky({},e.fitBoundsOptions,{duration:0})))),r}return vr(n,[{key:"resize",value:function(e){var t=this.containerDimensions(),n=t[0],r=t[1];this.transform.resize(n,r);var i=!this.moving;return i&&(this.stop(),this.emit("movestart",new Event("movestart",e)),this.emit("move",new Event("move",e))),this.emit("resize",new Event("resize",e)),i&&this.emit("moveend",new Event("moveend",e)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(e){return this.transform.locationPoint(UE.convert(e))}},{key:"unproject",value:function(e){return this.transform.pointLocation(VE.convert(e))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(e){this.transform.setMaxBounds(BE.convert(e))}},{key:"setStyle",value:function(e){}},{key:"setMinZoom",value:function(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(e){if((e=null==e?60:e)>60)throw new Error("maxPitch must be less than or equal to ".concat(60));if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(e){this.transform.renderWorldCopies=!!e}},{key:"remove",value:function(){this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(e){return this.update(),this.renderTaskQueue.add(e)}},{key:"cancelRenderFrame",value:function(e){return this.renderTaskQueue.remove(e)}},{key:"triggerRepaint",value:function(){var e=this;this.frame||(this.frame=jE((function(t){lM(t),e.frame=null,e.update(t)})))}},{key:"update",value:function(e){var t=this;this.frame||(this.frame=jE((function(n){lM(n),t.frame=null,t.renderTaskQueue.run(e)})))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var e=this.container;e.classList.add("l7-map");var t=this.canvasContainer=ka("div","l7-canvas-container",e);this.options.interactive&&t.classList.add("l7-interactive")}},{key:"containerDimensions",value:function(){var e=0,t=0;return this.container&&(e=this.container.clientWidth||400,t=this.container.clientHeight||300),[e,t]}},{key:"resizeCanvas",value:function(e,t){var n=Ba||1;this.canvas.width=n*e,this.canvas.height=n*t,this.canvas.style.width="".concat(e,"px"),this.canvas.style.height="".concat(t,"px")}}]),n}($E);function pM(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vM(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function gM(e,t,n){return t&&vM(e.prototype,t),n&&vM(e,n),e}var mM=i(o((function(e){function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=t=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),t(n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0})));function yM(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bM(e,t){return!t||"object"!==mM(t)&&"function"!=typeof t?yM(e):t}function _M(e){return(_M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xM(e,t){return(xM=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function SM(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function wM(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return SM(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?SM(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function AM(e,t){var n,r,i,o=ag([],t,e);return n=o,r=o,i=1/o[3],n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=r[3]*i,o}function TM(e,t){if(!e)throw new Error(t||"viewport-mercator-project: assertion failed.")}var EM=Math.PI,CM=EM/4,MM=EM/180,kM=180/EM;function OM(e){return Math.pow(2,e)}function IM(e,t){var n=wM(e,2),r=n[0],i=n[1];TM(Number.isFinite(r)&&Number.isFinite(t)),TM(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");var o=i*MM;return[(t*=512)*(r*MM+EM)/(2*EM),t*(EM-Math.log(Math.tan(CM+.5*o)))/(2*EM)]}function PM(e,t){var n=wM(e,2),r=n[0],i=n[1],o=r/(t*=512)*(2*EM)-EM,a=2*(Math.atan(Math.exp(EM-i/t*(2*EM)))-CM);return[o*kM,a*kM]}function LM(e){var t=e.latitude,n=e.longitude,r=e.zoom,i=e.scale,o=e.highPrecision,a=void 0!==o&&o;i=void 0!==i?i:OM(r),TM(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(i));var s={},u=512*i,c=Math.cos(t*MM),l=u/360,f=l/c,h=u/4003e4/c;if(s.pixelsPerMeter=[h,-h,h],s.metersPerPixel=[1/h,-1/h,1/h],s.pixelsPerDegree=[l,-f,h],s.degreesPerPixel=[1/l,-1/f,1/h],a){var d=MM*Math.tan(t*MM)/c,p=l*d/2,v=u/4003e4*d,g=v/f*h;s.pixelsPerDegree2=[0,-p,v],s.pixelsPerMeter2=[g,0,g]}return s}function RM(e){var t=e.height,n=e.pitch,r=e.bearing,i=e.altitude,o=e.center,a=void 0===o?null:o,s=e.flipY,u=void 0!==s&&s,c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return _v(c,c,[0,0,-i]),xv(c,c,[1,1,1/t]),Sv(c,c,-n*MM),Av(c,c,r*MM),u&&xv(c,c,[1,-1,1]),a&&_v(c,c,Gv([],a)),c}function NM(e){var t=e.width,n=e.height,r=e.pitch,i=function(e){var t=e.width,n=e.height,r=e.altitude,i=void 0===r?1.5:r,o=e.pitch,a=void 0===o?0:o,s=e.nearZMultiplier,u=void 0===s?1:s,c=e.farZMultiplier,l=void 0===c?1:c,f=a*MM,h=Math.atan(.5/i),d=Math.sin(h)*i/Math.sin(Math.PI/2-f-h),p=Math.cos(Math.PI/2-f)*d+i;return{fov:2*Math.atan(n/2/i),aspect:t/n,focalDistance:i,near:u,far:p*l}}({width:t,height:n,altitude:e.altitude,pitch:r,nearZMultiplier:e.nearZMultiplier,farZMultiplier:e.farZMultiplier});return Mv([],i.fov,i.aspect,i.near,i.far)}function DM(e,t){var n=wM(e,3),r=n[0],i=n[1],o=n[2],a=void 0===o?0:o;return TM(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(a)),AM(t,[r,i,a,1])}function FM(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=wM(e,3),i=r[0],o=r[1],a=r[2];if(TM(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(a)){var s=AM(t,[i,o,a,1]);return s}var u=AM(t,[i,o,0,1]),c=AM(t,[i,o,1,1]),l=u[2],f=c[2],h=l===f?0:((n||0)-l)/(f-l);return pg([],u,c,h)}var zM=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function jM(e){var t=e.width,n=e.height,r=e.bounds,i=e.minExtent,o=void 0===i?0:i,a=e.maxZoom,s=void 0===a?24:a,u=e.padding,c=void 0===u?0:u,l=e.offset,f=void 0===l?[0,0]:l,h=wM(r,2),d=wM(h[0],2),p=d[0],v=d[1],g=wM(h[1],2),m=g[0],y=g[1];if(Number.isFinite(c)){c={top:c,bottom:c,left:c,right:c}}else TM(Number.isFinite(c.top)&&Number.isFinite(c.bottom)&&Number.isFinite(c.left)&&Number.isFinite(c.right));var b=new QM({width:t,height:n,longitude:0,latitude:0,zoom:0}),_=b.project([p,y]),x=b.project([m,v]),S=[Math.max(Math.abs(x[0]-_[0]),o),Math.max(Math.abs(x[1]-_[1]),o)],w=[t-c.left-c.right-2*Math.abs(f[0]),n-c.top-c.bottom-2*Math.abs(f[1])];TM(w[0]>0&&w[1]>0);var A=w[0]/S[0],T=w[1]/S[1],E=(c.right-c.left)/2/A,C=(c.bottom-c.top)/2/T,M=[(x[0]+_[0])/2+E,(x[1]+_[1])/2+C],k=b.unproject(M),O=b.zoom+Math.log2(Math.abs(Math.min(A,T)));return{longitude:k[0],latitude:k[1],zoom:Math.min(O,s)}}var UM,BM,VM,HM,GM,WM,ZM,YM,qM,XM,KM,QM=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.width,i=n.height,o=n.latitude,a=void 0===o?0:o,s=n.longitude,u=void 0===s?0:s,c=n.zoom,l=void 0===c?0:c,f=n.pitch,h=void 0===f?0:f,d=n.bearing,p=void 0===d?0:d,v=n.altitude,g=void 0===v?1.5:v,m=n.nearZMultiplier,y=n.farZMultiplier;pM(this,t),r=r||1,i=i||1;var b=OM(l);g=Math.max(.75,g);var _=IM([u,a],b);_[2]=0;var x=NM({width:r,height:i,pitch:h,bearing:p,altitude:g,nearZMultiplier:m||1/i,farZMultiplier:y||1.01}),S=RM({height:i,center:_,pitch:h,bearing:p,altitude:g,flipY:!0});return(e=bM(this,_M(t).call(this,{width:r,height:i,viewMatrix:S,projectionMatrix:x}))).latitude=a,e.longitude=u,e.zoom=l,e.pitch=h,e.bearing=p,e.altitude=g,e.scale=b,e.center=_,e.pixelsPerMeter=LM(yM(yM(e))).pixelsPerMeter[2],Object.freeze(yM(yM(e))),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xM(e,t)}(t,e),gM(t,[{key:"projectFlat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return IM(e,t)}},{key:"unprojectFlat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return PM(e,t)}},{key:"getMapCenterByLngLatPosition",value:function(e){var t,n,r=e.lngLat,i=FM(e.pos,this.pixelUnprojectionMatrix),o=lg([],IM(r,this.scale),((t=[])[0]=-(n=i)[0],t[1]=-n[1],t));return PM(lg([],this.center,o),this.scale)}},{key:"getLocationAtPoint",value:function(e){var t=e.lngLat,n=e.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:n})}},{key:"fitBounds",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.width,i=this.height,o=jM(Object.assign({width:r,height:i,bounds:e},n)),a=o.longitude,s=o.latitude,u=o.zoom;return new t({width:r,height:i,longitude:a,latitude:s,zoom:u})}}]),t}(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.width,r=t.height,i=t.viewMatrix,o=void 0===i?zM:i,a=t.projectionMatrix,s=void 0===a?zM:a;pM(this,e),this.width=n||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=s;var u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];bv(u,u,this.projectionMatrix),bv(u,u,this.viewMatrix),this.viewProjectionMatrix=u;var c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];xv(c,c,[this.width/2,-this.height/2,1]),_v(c,c,[1,-1,0]),bv(c,c,this.viewProjectionMatrix);var l=yv([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],c);if(!l)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=c,this.pixelUnprojectionMatrix=l,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return gM(e,[{key:"equals",value:function(t){return t instanceof e&&(t.width===this.width&&t.height===this.height&&Iv(t.projectionMatrix,this.projectionMatrix)&&Iv(t.viewMatrix,this.viewMatrix))}},{key:"project",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,r=void 0===n||n,i=this.projectPosition(e),o=DM(i,this.pixelProjectionMatrix),a=wM(o,2),s=a[0],u=a[1],c=r?u:this.height-u;return 2===e.length?[s,c]:[s,c,o[2]]}},{key:"unproject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,r=void 0===n||n,i=t.targetZ,o=wM(e,3),a=o[0],s=o[1],u=o[2],c=r?s:this.height-s,l=i&&i*this.pixelsPerMeter,f=FM([a,c,u],this.pixelUnprojectionMatrix,l),h=this.unprojectPosition(f),d=wM(h,3),p=d[0],v=d[1],g=d[2];return Number.isFinite(u)?[p,v,g]:Number.isFinite(i)?[p,v,i]:[p,v]}},{key:"projectPosition",value:function(e){var t=wM(this.projectFlat(e),2);return[t[0],t[1],(e[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(e){var t=wM(this.unprojectFlat(e),2);return[t[0],t[1],(e[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(e){arguments.length>1&&void 0!==arguments[1]||this.scale;return e}},{key:"unprojectFlat",value:function(e){arguments.length>1&&void 0!==arguments[1]||this.scale;return e}}]),e}()),JM=function(){function e(){dr(this,e),gr(this,"viewport",void 0)}return vr(e,[{key:"syncWithMapCamera",value:function(e){var t=e.center,n=e.zoom,r=e.pitch,i=e.bearing,o=e.viewportHeight,a=e.viewportWidth;this.viewport=new QM({width:a,height:o,longitude:t&&t[0],latitude:t&&t[1],zoom:n,pitch:r,bearing:i})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}]),e}(),$M={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},ek=["id","attributionControl","style","rotation","mapInstance"],tk={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},nk=(UM=$(),BM=J(sr.MapConfig),VM=J(sr.IGlobalConfigService),HM=J(sr.ICoordinateSystemService),GM=J(sr.IEventEmitter),UM((YM=Rr((ZM=function(){function t(){var n=this;dr(this,t),gr(this,"version",LT.L7MAP),gr(this,"map",void 0),Lr(this,"config",YM,this),Lr(this,"configService",qM,this),Lr(this,"coordinateSystemService",XM,this),Lr(this,"eventEmitter",KM,this),gr(this,"viewport",void 0),gr(this,"markerContainer",void 0),gr(this,"cameraChangedCallback",void 0),gr(this,"$mapContainer",void 0),gr(this,"handleCameraChanged",(function(){var t=n.map.getCenter(),r=t.lat,i=t.lng,o=n.config.offsetCoordinate,a=void 0===o||o;n.viewport.syncWithMapCamera({bearing:n.map.getBearing(),center:[i,r],viewportHeight:n.map.transform.height,pitch:n.map.getPitch(),viewportWidth:n.map.transform.width,zoom:n.map.getZoom(),cameraHeight:0}),n.viewport.getZoom()>12&&a?n.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.LNGLAT_OFFSET):n.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.LNGLAT),n.cameraChangedCallback(n.viewport)}))}var n;return vr(t,[{key:"addMarkerContainer",value:function(){var e=this.map.getCanvasContainer();this.markerContainer=ka("div","l7-marker-container",e),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(e,t){-1!==OA.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(tk[e]||e,t)}},{key:"off",value:function(e,t){this.map.off(tk[e]||e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var e=this.map.transform;return[e.width,e.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(e){return this.map.setZoom(e)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(e){this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(e){this.map.setBearing(e)}},{key:"zoomIn",value:function(e,t){this.map.zoomIn(e,t)}},{key:"zoomOut",value:function(e,t){this.map.zoomOut(e,t)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(e){this.panTo(e)}},{key:"fitBounds",value:function(e,t){this.map.fitBounds(e,t)}},{key:"setMaxZoom",value:function(e){this.map.setMaxZoom(e)}},{key:"setMinZoom",value:function(e){this.map.setMinZoom(e)}},{key:"setMapStatus",value:function(e){!0===e.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===e.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===e.dragEnable&&this.map.dragPan.disable(),!0===e.dragEnable&&this.map.dragPan.enable(),!1===e.rotateEnable&&this.map.dragRotate.disable(),!0===e.dragEnable&&this.map.dragRotate.enable(),!1===e.keyboardEnable&&this.map.keyboard.disable(),!0===e.keyboardEnable&&this.map.keyboard.enable(),!1===e.zoomEnable&&this.map.scrollZoom.disable(),!0===e.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(e,t){this.map.flyTo({zoom:e,center:t})}},{key:"setMapStyle",value:function(e){this.map.setStyle(this.getMapStyle(e))}},{key:"pixelToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToPixel",value:function(e){return this.map.project(e)}},{key:"containerToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToContainer",value:function(e){return this.map.project(e)}},{key:"lngLatToMercator",value:function(e,t){throw new Error("not implement")}},{key:"getModelMatrix",value:function(e,t,n){throw new Error("not implement")}},{key:"init",value:(n=hr(regeneratorRuntime.mark((function e(){var t,n,r,i,o,a,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,t.attributionControl,i=t.style,o=void 0===i?"light":i,a=t.rotation,s=void 0===a?0:a,u=t.mapInstance,c=wr(t,ek),this.viewport=new JM,u?(this.map=u,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(r),this.map=new dM(cr({container:this.$mapContainer,style:this.getMapStyle(o),bearing:s},c))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"creatAmapContainer",value:function(e){var t=e;return"string"==typeof e&&(t=document.getElementById(e)),t}},{key:"getMapStyle",value:function(e){return"string"!=typeof e?e:$M[e]?$M[e]:e}}]),t}()).prototype,"config",[BM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qM=Rr(ZM.prototype,"configService",[VM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XM=Rr(ZM.prototype,"coordinateSystemService",[HM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KM=Rr(ZM.prototype,"eventEmitter",[GM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WM=ZM))||WM),rk=function(e){mr(n,e);var t=Er(n);function n(){return dr(this,n),t.apply(this,arguments)}return vr(n,[{key:"getServiceConstructor",value:function(){return nk}}]),n}(zT);ZA(".mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:-moz-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-moz-box-shadow:0 0 2px rgba(0,0,0,.1);-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;-moz-animation:mapboxgl-spin 2s infinite linear;-o-animation:mapboxgl-spin 2s infinite linear;-ms-animation:mapboxgl-spin 2s infinite linear;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@-moz-keyframes mapboxgl-spin{0%{-moz-transform:rotate(0deg)}to{-moz-transform:rotate(1turn)}}@-o-keyframes mapboxgl-spin{0%{-o-transform:rotate(0deg)}to{-o-transform:rotate(1turn)}}@-ms-keyframes mapboxgl-spin{0%{-ms-transform:rotate(0deg)}to{-ms-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-flex;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:\"\";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;-moz-animation:mapboxgl-user-location-dot-pulse 2s infinite;-ms-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px;box-sizing:border-box;box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@-ms-keyframes mapboxgl-user-location-dot-pulse{0%{-ms-transform:scale(1);opacity:1}70%{-ms-transform:scale(3);opacity:0}to{-ms-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{transform:scale(1);opacity:1}70%{transform:scale(3);opacity:0}to{transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}");var ik,ok,ak,sk,uk,ck,lk,fk,hk,dk,pk,vk=function(){function e(){dr(this,e),gr(this,"viewport",void 0)}return vr(e,[{key:"syncWithMapCamera",value:function(e){var t=e.center,n=e.zoom,r=e.pitch,i=e.bearing,o=e.viewportHeight,a=e.viewportWidth;this.viewport=new QM({width:a,height:o,longitude:t&&t[0],latitude:t&&t[1],zoom:n,pitch:r,bearing:i})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}]),e}(),gk={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},mk=["id","attributionControl","style","token","rotation","mapInstance"];window.mapboxgl=t;var yk,bk,_k,xk,Sk,wk={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},Ak=0,Tk="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",Ek=(ik=$(),ok=J(sr.MapConfig),ak=J(sr.IGlobalConfigService),sk=J(sr.ICoordinateSystemService),uk=J(sr.IEventEmitter),ik((fk=Rr((lk=function(){function t(){var n=this;dr(this,t),gr(this,"version",LT.MAPBOX),gr(this,"map",void 0),Lr(this,"config",fk,this),Lr(this,"configService",hk,this),Lr(this,"coordinateSystemService",dk,this),Lr(this,"eventEmitter",pk,this),gr(this,"viewport",void 0),gr(this,"markerContainer",void 0),gr(this,"cameraChangedCallback",void 0),gr(this,"$mapContainer",void 0),gr(this,"handleCameraChanged",(function(){var t=n.map.getCenter().wrap(),r=t.lat,i=t.lng;n.viewport.syncWithMapCamera({bearing:n.map.getBearing(),center:[i,r],viewportHeight:n.map.transform.height,pitch:n.map.getPitch(),viewportWidth:n.map.transform.width,zoom:n.map.getZoom(),cameraHeight:0});var o=n.config.offsetZoom,a=void 0===o?12:o;n.viewport.getZoom()>a?n.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.LNGLAT_OFFSET):n.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.LNGLAT),n.cameraChangedCallback(n.viewport)}))}var n;return vr(t,[{key:"addMarkerContainer",value:function(){var e=this.map.getCanvasContainer();this.markerContainer=ka("div","l7-marker-container",e),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(e,t){-1!==OA.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(wk[e]||e,t)}},{key:"off",value:function(e,t){this.map.off(wk[e]||e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var e=this.map.transform;return[e.width,e.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(e){return this.map.setZoom(e)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(e){this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(e){this.map.setBearing(e)}},{key:"zoomIn",value:function(e,t){this.map.zoomIn(e,t)}},{key:"zoomOut",value:function(e,t){this.map.zoomOut(e,t)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(e){this.panTo(e)}},{key:"fitBounds",value:function(e,t){this.map.fitBounds(e,t)}},{key:"setMaxZoom",value:function(e){this.map.setMaxZoom(e)}},{key:"setMinZoom",value:function(e){this.map.setMinZoom(e)}},{key:"setMapStatus",value:function(e){!0===e.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===e.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===e.dragEnable&&this.map.dragPan.disable(),!0===e.dragEnable&&this.map.dragPan.enable(),!1===e.rotateEnable&&this.map.dragRotate.disable(),!0===e.rotateEnable&&this.map.dragRotate.enable(),!1===e.keyboardEnable&&this.map.keyboard.disable(),!0===e.keyboardEnable&&this.map.keyboard.enable(),!1===e.zoomEnable&&this.map.scrollZoom.disable(),!0===e.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(e,t){this.map.flyTo({zoom:e,center:t})}},{key:"setMapStyle",value:function(e){this.map.setStyle(this.getMapStyle(e))}},{key:"pixelToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToPixel",value:function(e){return this.map.project(e)}},{key:"containerToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToContainer",value:function(e){return this.map.project(e)}},{key:"lngLatToMercator",value:function(e,t){var n=window.mapboxgl.MercatorCoordinate.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=window.mapboxgl.MercatorCoordinate.fromLngLat(e,t),a=o.meterInMercatorCoordinateUnits(),s=pv();return _v(s,s,Fv(o.x-i.x,o.y-i.y,o.z||0-i.z)),xv(s,s,Fv(a*r[0],-a*r[1],a*r[2])),Sv(s,s,n[0]),wv(s,s,n[1]),Av(s,s,n[2]),s}},{key:"init",value:(n=hr(regeneratorRuntime.mark((function e(){var t,n,r,i,o,a,s,u,c,l,f,h,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,i=t.attributionControl,o=void 0!==i&&i,a=t.style,s=void 0===a?"light":a,u=t.token,c=void 0===u?Tk:u,l=t.rotation,f=void 0===l?0:l,h=t.mapInstance,d=wr(t,mk),this.viewport=new vk,h||window.mapboxgl||console.error(this.configService.getSceneWarninfo("SDK")),c!==Tk||"blank"===s||window.mapboxgl.accessToken||h||console.warn(this.configService.getSceneWarninfo("MapToken")),h||window.mapboxgl.accessToken||(window.mapboxgl.accessToken=c),h?(this.map=h,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(r),this.map=new window.mapboxgl.Map(cr({container:this.$mapContainer,style:this.getMapStyle(s),attributionControl:o,bearing:f},d))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"creatAmapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_mapbox_div"+Ak++,t.appendChild(n),n}},{key:"getMapStyle",value:function(e){return"string"!=typeof e?e:gk[e]?gk[e]:e}}]),t}()).prototype,"config",[ok],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hk=Rr(lk.prototype,"configService",[ak],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dk=Rr(lk.prototype,"coordinateSystemService",[sk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pk=Rr(lk.prototype,"eventEmitter",[uk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ck=lk))||ck),Ck=function(e){mr(n,e);var t=Er(n);function n(){return dr(this,n),t.apply(this,arguments)}return vr(n,[{key:"getServiceConstructor",value:function(){return Ek}}]),n}(zT);var Mk,kk=(yk=$(),bk=J(sr.IGlobalConfigService),yk((Sk=Rr((xk=function(){function e(){dr(this,e),Lr(this,"configService",Sk,this),gr(this,"enabled",void 0)}return vr(e,[{key:"apply",value:function(e,t){var n=this,r=(t.rendererService,t.postProcessingPassFactory),i=t.normalPassFactory;e.hooks.init.tap("MultiPassRendererPlugin",(function(){var t=e.getLayerConfig(),o=t.enableMultiPassRenderer,a=t.passes,s=void 0===a?[]:a;n.enabled=!!o&&!1!==e.getLayerConfig().enableMultiPassRenderer,n.enabled&&(e.multiPassRenderer=n.createMultiPassRenderer(e,s,r,i),e.multiPassRenderer.setRenderFlag(!0))})),e.hooks.beforeRender.tap("MultiPassRendererPlugin",(function(){}))}},{key:"createMultiPassRenderer",value:function(e,t,n,r){var i=e.multiPassRenderer,o=e.getLayerConfig(),a=o.enablePicking;o.enableTAA;return a&&i.add(r("pixelPicking")),i}}]),e}()).prototype,"configService",[bk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_k=xk))||_k),Ok=(gr(Mk={},e.BlendType.additive,{enable:!0,func:{srcRGB:e.gl.ONE,dstRGB:e.gl.ONE,srcAlpha:1,dstAlpha:1}}),gr(Mk,e.BlendType.none,{enable:!1}),gr(Mk,e.BlendType.normal,{enable:!0,func:{srcRGB:e.gl.SRC_ALPHA,dstRGB:e.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),gr(Mk,e.BlendType.subtractive,{enable:!0,func:{srcRGB:e.gl.ONE,dstRGB:e.gl.ONE,srcAlpha:e.gl.ZERO,dstAlpha:e.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:e.gl.FUNC_SUBTRACT,alpha:e.gl.FUNC_SUBTRACT}}),gr(Mk,e.BlendType.max,{enable:!0,func:{srcRGB:e.gl.ONE,dstRGB:e.gl.ONE},equation:{rgb:e.gl.MAX_EXT}}),gr(Mk,e.BlendType.min,{enable:!0,func:{srcRGB:e.gl.ONE,dstRGB:e.gl.ONE},equation:{rgb:e.gl.MIN_EXT}}),Mk);var Ik=function(e){return"string"==typeof e||!iy(e)&&Jm(e)&&"[object String]"==Kg(e)};var Pk=function(e){return"number"==typeof e||Jm(e)&&"[object Number]"==Kg(e)};function Lk(e,t,n,r,i){t.updateStyleAttribute(e,n,r,i)}function Rk(e,t){e.opacity&&Nk("opacity",t,e.opacity),e.strokeWidth&&Nk("strokeWidth",t,e.strokeWidth),e.strokeOpacity&&Nk("strokeOpacity",t,e.strokeOpacity),e.stroke&&function(e,t,n){Ik(n)?Lk(e,t,n,void 0):iy(n)&&2===n.length&&(Ik(n[0])&&Jg(n[1])||Ik(n[0])&&iy(n[1])&&n[1].length>0)?Lk(e,t,n[0],n[1]):Lk(e,t,"#fff",void 0)}("stroke",t,e.stroke),e.offsets&&Dk("offsets",t,e.offsets),e.textOffset&&Dk("textOffset",t,e.textOffset)}function Nk(e,t,n){Ik(n)?Lk(e,t,n,(function(e){return e})):Pk(n)?Lk(e,t,[n],void 0):iy(n)&&2===n.length&&(Ik(n[0])&&Jg(n[1])||Ik(n[0])&&iy(n[1])&&Pk(n[1][0])&&Pk(n[1][1]))?Lk(e,t,n[0],n[1]):Lk(e,t,[1],void 0)}function Dk(e,t,n){Ik(n)?Lk(e,t,n,(function(e){return e})):iy(n)&&2===n.length&&Ik(n[0])&&Jg(n[1])?Lk(e,t,n[0],n[1]):iy(n)&&2===n.length&&Pk(n[0])&&Pk(n[1])?Lk(e,t,n,void 0):Lk(e,t,[0,0],void 0)}var Fk,zk,jk,Uk,Bk,Vk=["passes"],Hk=["moduleName","vertexShader","fragmentShader","triangulation"],Gk=0,Wk=(Fk=sA(sr.IGlobalConfigService),zk=sA(sr.IShaderModuleService),Uk=Rr((jk=function(t){mr(r,t);var n=Er(r);function r(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return dr(this,r),gr(Ar(e=n.call(this)),"id","".concat(Gk++)),gr(Ar(e),"name","".concat(Gk)),gr(Ar(e),"type",void 0),gr(Ar(e),"visible",!0),gr(Ar(e),"zIndex",0),gr(Ar(e),"minZoom",void 0),gr(Ar(e),"maxZoom",void 0),gr(Ar(e),"inited",!1),gr(Ar(e),"layerModelNeedUpdate",!1),gr(Ar(e),"pickedFeatureID",null),gr(Ar(e),"selectedFeatureID",null),gr(Ar(e),"styleNeedUpdate",!1),gr(Ar(e),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),gr(Ar(e),"hooks",{init:new V_,afterInit:new V_,beforeRender:new V_,beforeRenderData:new B_,afterRender:new D_,beforePickingEncode:new D_,afterPickingEncode:new D_,beforeHighlight:new D_(["pickedColor"]),afterHighlight:new D_,beforeSelect:new D_(["pickedColor"]),afterSelect:new D_,beforeDestroy:new D_,afterDestroy:new D_}),gr(Ar(e),"models",[]),gr(Ar(e),"multiPassRenderer",void 0),gr(Ar(e),"plugins",void 0),gr(Ar(e),"sourceOption",void 0),gr(Ar(e),"layerModel",void 0),Lr(Ar(e),"configService",Uk,Ar(e)),Lr(Ar(e),"shaderModuleService",Bk,Ar(e)),gr(Ar(e),"cameraService",void 0),gr(Ar(e),"coordinateService",void 0),gr(Ar(e),"iconService",void 0),gr(Ar(e),"fontService",void 0),gr(Ar(e),"pickingService",void 0),gr(Ar(e),"rendererService",void 0),gr(Ar(e),"layerService",void 0),gr(Ar(e),"interactionService",void 0),gr(Ar(e),"mapService",void 0),gr(Ar(e),"styleAttributeService",void 0),gr(Ar(e),"layerSource",void 0),gr(Ar(e),"postProcessingPassFactory",void 0),gr(Ar(e),"normalPassFactory",void 0),gr(Ar(e),"animateOptions",{enable:!1}),gr(Ar(e),"container",void 0),gr(Ar(e),"encodedData",void 0),gr(Ar(e),"configSchema",void 0),gr(Ar(e),"currentPickId",null),gr(Ar(e),"rawConfig",void 0),gr(Ar(e),"needUpdateConfig",void 0),gr(Ar(e),"pendingStyleAttributes",[]),gr(Ar(e),"scaleOptions",{}),gr(Ar(e),"animateStartTime",void 0),gr(Ar(e),"aniamateStatus",!1),gr(Ar(e),"sourceEvent",(function(){e.dataState.dataSourceNeedUpdate=!0;var t=e.getLayerConfig(),n=t.autoFit,r=t.fitBoundsOptions;n&&e.fitBounds(r),e.emit("dataUpdate"),e.reRender()})),e.name=t.name||e.id,e.zIndex=t.zIndex||0,e.rawConfig=t,e}return vr(r,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(e){if(this.inited){var t=this.container.get(sr.SceneID);Rk(e,this),this.configService.setLayerConfig(t,this.id,cr(cr(cr({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),e)),this.needUpdateConfig={}}else this.needUpdateConfig=cr(cr({},this.needUpdateConfig),e)}},{key:"setContainer",value:function(e){this.container=e}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(e){return this.plugins.push(e),this}},{key:"init",value:function(){var e=this,t=this.container.get(sr.SceneID),n=this.rawConfig.enableMultiPassRenderer,r=void 0!==n&&n;this.configService.setLayerConfig(t,this.id,{enableMultiPassRenderer:r}),this.iconService=this.container.get(sr.IIconService),this.fontService=this.container.get(sr.IFontService),this.rendererService=this.container.get(sr.IRendererService),this.layerService=this.container.get(sr.ILayerService),this.interactionService=this.container.get(sr.IInteractionService),this.pickingService=this.container.get(sr.IPickingService),this.mapService=this.container.get(sr.IMapService),this.cameraService=this.container.get(sr.ICameraService),this.coordinateService=this.container.get(sr.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(sr.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(sr.IFactoryNormalPass),this.styleAttributeService=this.container.get(sr.IStyleAttributeService),this.multiPassRenderer=this.container.get(sr.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach((function(t){var n=t.attributeName,r=t.attributeField,i=t.attributeValues,o=t.updateOptions;e.styleAttributeService.updateStyleAttribute(n,{scale:cr({field:r},e.splitValuesAndCallbackInAttribute(i,e.getLayerConfig()[n]))},o)})),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(sr.ILayerPlugin);var i,o=Pr(this.plugins);try{for(o.s();!(i=o.n()).done;){i.value.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(e){o.e(e)}finally{o.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(cr(cr({},this.getDefaultConfig()),this.rawConfig));var e=this.getLayerConfig().animateOption;null!=e&&e.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(e,t,n){return this.updateStyleAttribute("color",e,t,n),this}},{key:"texture",value:function(e,t,n){return this.updateStyleAttribute("texture",e,t,n),this}},{key:"rotate",value:function(e,t,n){return this.updateStyleAttribute("rotate",e,t,n),this}},{key:"size",value:function(e,t,n){return this.updateStyleAttribute("size",e,t,n),this}},{key:"filter",value:function(e,t,n){return this.updateStyleAttribute("filter",e,t,n),this}},{key:"shape",value:function(e,t,n){return this.updateStyleAttribute("shape",e,t,n),this}},{key:"label",value:function(e,t,n){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:e,attributeValues:t,updateOptions:n}),this}},{key:"animate",value:function(e){var t={};return Qg(e)?(t.enable=!0,t=cr(cr({},t),e)):t.enable=e,this.updateLayerConfig({animateOption:t}),this}},{key:"source",value:function(e,t){return this.sourceOption={data:e,options:t},this}},{key:"setData",value:function(e,t){var n=this;return this.inited?this.layerSource.setData(e,t):this.on("inited",(function(){n.layerSource.setData(e,t)})),this}},{key:"style",value:function(e){var t=this,n=e.passes,r=wr(e,Vk);return n&&function(e){return e.map((function(e){return"string"==typeof e&&(e=[e,{}]),e}))}(n).forEach((function(e){var n=t.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(e[0]);n&&n.updateOptions(e[1])})),this.rawConfig=cr(cr({},this.rawConfig),r),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(e,t){return Qg(e)?this.scaleOptions=cr(cr({},this.scaleOptions),e):this.scaleOptions[e]=t,this}},{key:"render",value:function(){return 0!==this.getEncodedData().length&&this.renderModels(),this}},{key:"active",value:function(e){var t={};return t.enableHighlight=!!Qg(e)||e,Qg(e)?(t.enableHighlight=!0,e.color&&(t.highlightColor=e.color)):t.enableHighlight=!!e,this.updateLayerConfig(t),this}},{key:"setActive",value:function(e,t){var n=this;if(Qg(e)){var r=e.x,i=void 0===r?0:r,o=e.y,a=void 0===o?0:o;this.updateLayerConfig({highlightColor:Qg(t)?t.color:this.getLayerConfig().highlightColor}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:e,highlightColor:Qg(t)?t.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call(sd(e)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"select",value:function(e){var t={};return t.enableSelect=!!Qg(e)||e,Qg(e)?(t.enableSelect=!0,e.color&&(t.selectColor=e.color)):t.enableSelect=!!e,this.updateLayerConfig(t),this}},{key:"setSelect",value:function(e,t){var n=this;if(Qg(e)){var r=e.x,i=void 0===r?0:r,o=e.y,a=void 0===o?0:o;this.updateLayerConfig({selectColor:Qg(t)?t.color:this.getLayerConfig().selectColor}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:e,selectColor:Qg(t)?t.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call(sd(e)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"setBlend",value:function(e){this.updateLayerConfig({blend:e}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(e){return this.zIndex=e,this.layerService.updateRenderOrder(),this}},{key:"setCurrentPickId",value:function(e){this.currentPickId=e}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(e){this.selectedFeatureID=e}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var e=this.mapService.getZoom(),t=this.getLayerConfig(),n=t.visible,r=t.minZoom,i=void 0===r?-1/0:r,o=t.maxZoom;return!!n&&e>=i&&e<=(void 0===o?1/0:o)}},{key:"setMinZoom",value:function(e){return this.updateLayerConfig({minZoom:e}),this}},{key:"getMinZoom",value:function(){return this.getLayerConfig().minZoom}},{key:"getMaxZoom",value:function(){return this.getLayerConfig().maxZoom}},{key:"get",value:function(e){return this.getLayerConfig()[e]}},{key:"setMaxZoom",value:function(e){return this.updateLayerConfig({maxZoom:e}),this}},{key:"fitBounds",value:function(e){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var t=this.getSource().extent;return t.some((function(e){return Math.abs(e)===1/0}))||this.mapService.fitBounds([[t[0],t[1]],[t[2],t[3]]],e),this}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach((function(e){return e.destroy()})),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter((function(e){return e.needRescale||e.needRemapping||e.needRegenerateVertices})).length}},{key:"setSource",value:function(e){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=e,this.inited&&this.layerSource.cluster){var t=this.mapService.getZoom();this.layerSource.updateClusterData(t)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(e){this.encodedData=e}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(e){var t=this.styleAttributeService.getLayerAttributeScale(e);return t?t.ticks?t.ticks().map((function(n){return gr({value:n},e,t(n))})):t.invertExtent?t.range().map((function(n){return gr({value:t.invertExtent(n)},e,n)})):void 0:[]}},{key:"pick",value:function(e){var t=e.x,n=e.y;this.interactionService.triggerHover({x:t,y:n})}},{key:"boxSelect",value:function(e,t){this.pickingService.boxPickLayer(this,e,t)}},{key:"buildLayerModel",value:function(t){var n=t.moduleName,r=t.vertexShader,i=t.fragmentShader,o=t.triangulation,a=wr(t,Hk);this.shaderModuleService.registerModule(n,{vs:r,fs:i});var s=this.shaderModuleService.getModule(n),u=s.vs,c=s.fs,l=s.uniforms,f=this.rendererService.createModel,h=this.styleAttributeService.createAttributesAndIndices(this.encodedData,o);return f(cr({attributes:h.attributes,uniforms:l,fs:c,vs:u,elements:h.elements,blend:Ok[e.BlendType.normal]},a))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(e){var t=this.getLayerConfig(),n=t.enableHighlight,r=void 0===n||n,i=t.enableSelect,o=void 0===i||i,a=-1!==this.eventNames().indexOf(e)||-1!==this.eventNames().indexOf("un"+e);return"click"!==e&&"dblclick"!==e||!o||(a=!0),"mousemove"!==e||!r&&-1===this.eventNames().indexOf("mouseenter")&&-1===this.eventNames().indexOf("unmousemove")&&-1===this.eventNames().indexOf("mouseout")||(a=!0),this.isVisible()&&a}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var e=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach((function(t){t.draw({uniforms:e.layerModel.getUninforms()})}))),this}},{key:"updateStyleAttribute",value:function(e,t,n,r){this.inited?this.styleAttributeService.updateStyleAttribute(e,{scale:cr({field:t},this.splitValuesAndCallbackInAttribute(n,this.getLayerConfig()[t]))},r):this.pendingStyleAttributes.push({attributeName:e,attributeField:t,attributeValues:n,updateOptions:r})}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&this.layerService.renderLayers()}},{key:"splitValuesAndCallbackInAttribute",value:function(e,t){return{values:Jg(e)?void 0:e||t,callback:Jg(e)?e:void 0}}}]),r}(s)).prototype,"configService",[Fk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bk=Rr(jk.prototype,"shaderModuleService",[zk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jk);var Zk=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1};var Yk=function(e,t,n,r,i,o){var a=1&n,s=e.length,u=t.length;if(s!=u&&!(a&&u>s))return!1;var c=o.get(e),l=o.get(t);if(c&&l)return c==t&&l==e;var f=-1,h=!0,d=2&n?new Px:void 0;for(o.set(e,t),o.set(t,e);++f<s;){var p=e[f],v=t[f];if(r)var g=a?r(v,p,f,t,e,o):r(p,v,f,e,t,o);if(void 0!==g){if(g)continue;h=!1;break}if(d){if(!Zk(t,(function(e,t){if(!jx(d,t)&&(p===e||i(p,e,n,r,o)))return d.push(t)}))){h=!1;break}}else if(p!==v&&!i(p,v,n,r,o)){h=!1;break}}return o.delete(e),o.delete(t),h};var qk=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n},Xk=Bg?Bg.prototype:void 0,Kk=Xk?Xk.valueOf:void 0;var Qk=function(e,t,n,r,i,o,a){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!o(new Bm(e),new Bm(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Tg(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=qk;case"[object Set]":var u=1&r;if(s||(s=Vx),e.size!=t.size&&!u)return!1;var c=a.get(e);if(c)return c==t;r|=2,a.set(e,t);var l=Yk(s(e),s(t),r,i,o,a);return a.delete(e),l;case"[object Symbol]":if(Kk)return Kk.call(e)==Kk.call(t)}return!1};var Jk=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e};var $k=function(e,t,n){var r=t(e);return iy(e)?r:Jk(r,n(e))};var eO=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o};var tO=function(){return[]},nO=Object.prototype.propertyIsEnumerable,rO=Object.getOwnPropertySymbols,iO=rO?function(e){return null==e?[]:(e=Object(e),eO(rO(e),(function(t){return nO.call(e,t)})))}:tO,oO=Ym(Object.keys,Object),aO=Object.prototype.hasOwnProperty;var sO=function(e){if(!Km(e))return oO(e);var t=[];for(var n in Object(e))aO.call(e,n)&&"constructor"!=n&&t.push(n);return t};var uO=function(e){return ay(e)?Oy(e):sO(e)};var cO=function(e){return $k(e,uO,iO)},lO=Object.prototype.hasOwnProperty;var fO=function(e,t,n,r,i,o){var a=1&n,s=cO(e),u=s.length;if(u!=cO(t).length&&!a)return!1;for(var c=u;c--;){var l=s[c];if(!(a?l in t:lO.call(t,l)))return!1}var f=o.get(e),h=o.get(t);if(f&&h)return f==t&&h==e;var d=!0;o.set(e,t),o.set(t,e);for(var p=a;++c<u;){var v=e[l=s[c]],g=t[l];if(r)var m=a?r(g,v,l,t,e,o):r(v,g,l,e,t,o);if(!(void 0===m?v===g||i(v,g,n,r,o):m)){d=!1;break}p||(p="constructor"==l)}if(d&&!p){var y=e.constructor,b=t.constructor;y==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b||(d=!1)}return o.delete(e),o.delete(t),d},hO=hm(Ug,"DataView"),dO=hm(Ug,"Promise"),pO=hm(Ug,"WeakMap"),vO=rm(hO),gO=rm(dm),mO=rm(dO),yO=rm(Ux),bO=rm(pO),_O=Kg;(hO&&"[object DataView]"!=_O(new hO(new ArrayBuffer(1)))||dm&&"[object Map]"!=_O(new dm)||dO&&"[object Promise]"!=_O(dO.resolve())||Ux&&"[object Set]"!=_O(new Ux)||pO&&"[object WeakMap]"!=_O(new pO))&&(_O=function(e){var t=Kg(e),n="[object Object]"==t?e.constructor:void 0,r=n?rm(n):"";if(r)switch(r){case vO:return"[object DataView]";case gO:return"[object Map]";case mO:return"[object Promise]";case yO:return"[object Set]";case bO:return"[object WeakMap]"}return t});var xO=_O,SO=Object.prototype.hasOwnProperty;var wO=function(e,t,n,r,i,o){var a=iy(e),s=iy(t),u=a?"[object Array]":xO(e),c=s?"[object Array]":xO(t),l="[object Object]"==(u="[object Arguments]"==u?"[object Object]":u),f="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),h=u==c;if(h&&cy(e)){if(!cy(t))return!1;a=!0,l=!1}if(h&&!l)return o||(o=new Nm),a||xy(e)?Yk(e,t,n,r,i,o):Qk(e,t,u,n,r,i,o);if(!(1&n)){var d=l&&SO.call(e,"__wrapped__"),p=f&&SO.call(t,"__wrapped__");if(d||p){var v=d?e.value():e,g=p?t.value():t;return o||(o=new Nm),i(v,g,n,r,o)}}return!!h&&(o||(o=new Nm),fO(e,t,n,r,i,o))};var AO=function e(t,n,r,i,o){return t===n||(null==t||null==n||!Jm(t)&&!Jm(n)?t!=t&&n!=n:wO(t,n,r,i,e,o))};var TO,EO,CO,MO,kO,OO=function(e,t){return AO(e,t)},IO=(TO=sA(sr.IGlobalConfigService),EO=sA(sr.IShaderModuleService),MO=Rr((CO=function(){function t(n){dr(this,t),gr(this,"triangulation",void 0),gr(this,"createTexture2D",void 0),gr(this,"layer",void 0),gr(this,"dataTexture",void 0),gr(this,"DATA_TEXTURE_WIDTH",void 0),gr(this,"rowCount",void 0),gr(this,"cacheStyleProperties",void 0),gr(this,"cellLength",void 0),gr(this,"cellProperties",void 0),gr(this,"cellTypeLayout",void 0),gr(this,"stylePropertyesExist",void 0),gr(this,"dataTextureTest",void 0),Lr(this,"configService",MO,this),Lr(this,"shaderModuleService",kO,this),gr(this,"rendererService",void 0),gr(this,"iconService",void 0),gr(this,"fontService",void 0),gr(this,"styleAttributeService",void 0),gr(this,"mapService",void 0),gr(this,"cameraService",void 0),gr(this,"layerService",void 0),this.layer=n,this.rendererService=n.getContainer().get(sr.IRendererService),this.styleAttributeService=n.getContainer().get(sr.IStyleAttributeService),this.mapService=n.getContainer().get(sr.IMapService),this.iconService=n.getContainer().get(sr.IIconService),this.fontService=n.getContainer().get(sr.IFontService),this.cameraService=n.getContainer().get(sr.ICameraService),this.layerService=n.getContainer().get(sr.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new ImageData(1,1).data,mag:e.gl.NEAREST,min:e.gl.NEAREST,width:1,height:1}))}return vr(t,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,0,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(e){var t=!1;return OO(e.opacity,this.cacheStyleProperties.opacity)||(t=!0,this.cacheStyleProperties.opacity=e.opacity),OO(e.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(t=!0,this.cacheStyleProperties.strokeOpacity=e.strokeOpacity),OO(e.strokeWidth,this.cacheStyleProperties.strokeWidth)||(t=!0,this.cacheStyleProperties.strokeWidth=e.strokeWidth),OO(e.stroke,this.cacheStyleProperties.stroke)||(t=!0,this.cacheStyleProperties.stroke=e.stroke),OO(e.offsets,this.cacheStyleProperties.offsets)||(t=!0,this.cacheStyleProperties.offsets=e.offsets),void 0===this.dataTexture&&(t=!0),t}},{key:"judgeStyleAttributes",value:function(e){this.clearLastCalRes(),void 0===e.opacity||Pk(e.opacity)||(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),void 0===e.strokeOpacity||Pk(e.strokeOpacity)||(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),void 0===e.strokeWidth||Pk(e.strokeWidth)||(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),void 0===e.stroke||this.isStaticColor(e.stroke)||(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),void 0===e.offsets||this.isOffsetStatic(e.offsets)||(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2)}},{key:"isStaticColor",value:function(e){return!!Ik(e)&&!!Zh(e)}},{key:"getStrokeColor",value:function(e){if(this.isStaticColor(e)){var t=od(e);return t[0]=t[0]?t[0]:0,t[1]=t[1]?t[1]:0,t[2]=t[2]?t[2]:0,t[3]=t[3]?t[3]:0,t}return[0,0,0,0]}},{key:"isOffsetStatic",value:function(e){return!!(iy(e)&&2===e.length&&Pk(e[0])&&Pk(e[1]))}},{key:"patchMod",value:function(e,t){for(var n=0;n<t;n++)e.push(-1)}},{key:"patchData",value:function(e,t,n){var r,i=Pr(n);try{for(i.s();!(r=i.n()).done;){var o=r.value,a=o.attr,s=o.count,u=t[a];u?"stroke"===a?e.push.apply(e,kr(od(u))):"offsets"===a?this.isOffsetStatic(u)?e.push(-u[0],u[1]):e.push(0,0):e.push(Pk(u)?u:1):this.patchMod(e,s)}}catch(e){i.e(e)}finally{i.f()}}},{key:"calDataFrame",value:function(e,t,n){for(var r=t.length,i=Math.ceil(r*e/this.DATA_TEXTURE_WIDTH),o=i*this.DATA_TEXTURE_WIDTH,a=[],s=0;s<r;s++){var u=t[s];this.patchData(a,u,n)}for(var c=a.length;c<o;c++)a.push(-1);return{data:a,width:this.DATA_TEXTURE_WIDTH,height:i}}},{key:"getBlend",value:function(){var t=this.layer.getLayerConfig().blend,n=void 0===t?"normal":t;return Ok[e.BlendType[n]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.duration||4,e.interval||.2,e.trailLength||.1]}},{key:"startModelAnimate",value:function(){this.layer.getLayerConfig().animateOption.enable&&this.layer.setAnimateStartTime()}}]),t}()).prototype,"configService",[TO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kO=Rr(CO.prototype,"shaderModuleService",[EO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CO),PO=RO,LO=RO;function RO(e,t,n){n=n||2;var r,i,o,a,s,u,c,l=t&&t.length,f=l?t[0]*n:e.length,h=NO(e,0,f,n,!0),d=[];if(!h||h.next===h.prev)return d;if(l&&(h=function(e,t,n,r){var i,o,a,s,u,c=[];for(i=0,o=t.length;i<o;i++)a=t[i]*r,s=i<o-1?t[i+1]*r:e.length,(u=NO(e,a,s,r,!1))===u.next&&(u.steiner=!0),c.push(ZO(u));for(c.sort(VO),i=0;i<c.length;i++)n=DO(n=HO(c[i],n),n.next);return n}(e,t,h,n)),e.length>80*n){r=o=e[0],i=a=e[1];for(var p=n;p<f;p+=n)(s=e[p])<r&&(r=s),(u=e[p+1])<i&&(i=u),s>o&&(o=s),u>a&&(a=u);c=0!==(c=Math.max(o-r,a-i))?1/c:0}return FO(h,d,n,r,i,c),d}function NO(e,t,n,r,i){var o,a;if(i===oI(e,t,n,r)>0)for(o=t;o<n;o+=r)a=nI(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=nI(o,e[o],e[o+1],a);return a&&KO(a,a.next)&&(rI(a),a=a.next),a}function DO(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!KO(r,r.next)&&0!==XO(r.prev,r,r.next))r=r.next;else{if(rI(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function FO(e,t,n,r,i,o,a){if(e){!a&&o&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=WO(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,s,u,c=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,s=0,t=0;t<c&&(s++,r=r.nextZ);t++);for(u=c;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(e,r,i,o);for(var s,u,c=e;e.prev!==e.next;)if(s=e.prev,u=e.next,o?jO(e,r,i,o):zO(e))t.push(s.i/n),t.push(e.i/n),t.push(u.i/n),rI(e),e=u.next,c=u.next;else if((e=u)===c){a?1===a?FO(e=UO(DO(e),t,n),t,n,r,i,o,2):2===a&&BO(e,t,n,r,i,o):FO(DO(e),t,n,r,i,o,1);break}}}function zO(e){var t=e.prev,n=e,r=e.next;if(XO(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(YO(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&XO(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function jO(e,t,n,r){var i=e.prev,o=e,a=e.next;if(XO(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,f=WO(s,u,t,n,r),h=WO(c,l,t,n,r),d=e.prevZ,p=e.nextZ;d&&d.z>=f&&p&&p.z<=h;){if(d!==e.prev&&d!==e.next&&YO(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&XO(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,p!==e.prev&&p!==e.next&&YO(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&XO(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;d&&d.z>=f;){if(d!==e.prev&&d!==e.next&&YO(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&XO(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;p&&p.z<=h;){if(p!==e.prev&&p!==e.next&&YO(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&XO(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function UO(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!KO(i,o)&&QO(i,r,r.next,o)&&eI(i,o)&&eI(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),rI(r),rI(r.next),r=e=o),r=r.next}while(r!==e);return DO(r)}function BO(e,t,n,r,i,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&qO(a,s)){var u=tI(a,s);return a=DO(a,a.next),u=DO(u,u.next),FO(a,t,n,r,i,o),void FO(u,t,n,r,i,o)}s=s.next}a=a.next}while(a!==e)}function VO(e,t){return e.x-t.x}function HO(e,t){var n=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===a)return n;var u,c=n,l=n.x,f=n.y,h=1/0;r=n;do{i>=r.x&&r.x>=l&&i!==r.x&&YO(o<f?i:a,o,l,f,o<f?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),eI(r,e)&&(u<h||u===h&&(r.x>n.x||r.x===n.x&&GO(n,r)))&&(n=r,h=u)),r=r.next}while(r!==c);return n}(e,t);if(!n)return t;var r=tI(n,e),i=DO(n,n.next);return DO(r,r.next),t===n?i:t}function GO(e,t){return XO(e.prev,e,t.prev)<0&&XO(t.next,e,e.next)<0}function WO(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ZO(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function YO(e,t,n,r,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function qO(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&QO(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(eI(e,t)&&eI(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(XO(e.prev,e,t.prev)||XO(e,t.prev,t))||KO(e,t)&&XO(e.prev,e,e.next)>0&&XO(t.prev,t,t.next)>0)}function XO(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function KO(e,t){return e.x===t.x&&e.y===t.y}function QO(e,t,n,r){var i=$O(XO(e,t,n)),o=$O(XO(e,t,r)),a=$O(XO(n,r,e)),s=$O(XO(n,r,t));return i!==o&&a!==s||(!(0!==i||!JO(e,n,t))||(!(0!==o||!JO(e,r,t))||(!(0!==a||!JO(n,e,r))||!(0!==s||!JO(n,t,r)))))}function JO(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function $O(e){return e>0?1:e<0?-1:0}function eI(e,t){return XO(e.prev,e,e.next)<0?XO(e,t,e.next)>=0&&XO(e,e.prev,t)>=0:XO(e,t,e.prev)<0||XO(e,e.next,t)<0}function tI(e,t){var n=new iI(e.i,e.x,e.y),r=new iI(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function nI(e,t,n,r){var i=new iI(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function rI(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function iI(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function oI(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}RO.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,a=Math.abs(oI(e,0,o,n));if(i)for(var s=0,u=t.length;s<u;s++){var c=t[s]*n,l=s<u-1?t[s+1]*n:e.length;a-=Math.abs(oI(e,c,l,n))}var f=0;for(s=0;s<r.length;s+=3){var h=r[s]*n,d=r[s+1]*n,p=r[s+2]*n;f+=Math.abs((e[h]-e[p])*(e[d+1]-e[h+1])-(e[h]-e[d])*(e[p+1]-e[h+1]))}return 0===a&&0===f?0:Math.abs((f-a)/a)},RO.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[i][o][a]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n},PO.default=LO;var aI=sg(),sI=(sg(),sg()),uI=sg(),cI=sg();function lI(e,t,n,r,i){return lg(e,n,r),hg(e,e),[i/dg(t=ug(-e[1],e[0]),ug(-n[1],n[0])),t]}function fI(e,t){return function(e,t,n){return e[0]=t,e[1]=n,e}(e,-t[1],t[0])}function hI(e,t,n){return bg(e,t,n),hg(e,e),e}function dI(e,t){return e[0]===t[0]&&e[1]===t[1]}var pI,vI,gI,mI=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};dr(this,e),gr(this,"complex",void 0),gr(this,"join",void 0),gr(this,"cap",void 0),gr(this,"miterLimit",void 0),gr(this,"thickness",void 0),gr(this,"normal",void 0),gr(this,"lastFlip",-1),gr(this,"miter",ug(0,0)),gr(this,"started",!1),gr(this,"dash",!1),gr(this,"totalDistance",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return vr(e,[{key:"extrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var a=e[o-1],s=t[o-1],u=e[o],c=t[o],l=o<e.length-1?e[o+1]:null,f=o<t.length-1?t[o+1]:null;i+=this.segment_gaode2(n,i,a,u,l,s,c,f)}if(this.dash)for(var h=0;h<n.positions.length/6;h++)n.positions[6*h+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.segment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"segment_gaode2",value:function(e,t,n,r,i,o,a,s){var u=0,c=e.indices,l=e.positions,f=e.normals,h="square"===this.cap,d="bevel"===this.join,p=mh([a[0],a[1]]),v=mh([o[0],o[1]]);hI(sI,r,n);var g=0;if(this.dash&&(g=this.lineSegmentDistance(p,v),this.totalDistance+=g),this.normal||(this.normal=sg(),fI(this.normal,sI)),!this.started)if(this.started=!0,h){var m=sg(),y=sg();lg(m,this.normal,sI),lg(y,this.normal,sI),f.push(y[0],y[1],0),f.push(m[0],m[1],0),l.push(n[0],n[1],0,this.totalDistance-g,-this.thickness,0),l.push(n[0],n[1],0,this.totalDistance-g,this.thickness,0)}else this.extrusions(l,f,n,this.normal,this.thickness,this.totalDistance-g);if(c.push(t+0,t+1,t+2),i){dI(r,i)&&lg(i,r,hg(i,fg(i,r,n))),hI(uI,i,r);var b=Mr(lI(cI,sg(),sI,uI,this.thickness),2),_=b[0],x=b[1],S=dg(cI,this.normal)<0?-1:1,w=d;if(!w&&"miter"===this.join)_>this.miterLimit&&(w=!0);w?(f.push(this.normal[0],this.normal[1],0),f.push(x[0],x[1],0),l.push(r[0],r[1],0,this.totalDistance,-this.thickness*S,0),l.push(r[0],r[1],0,this.totalDistance,this.thickness*S,0),c.push.apply(c,kr(this.lastFlip!==-S?[t,t+2,t+3]:[t+2,t+1,t+3])),c.push(t+2,t+3,t+4),fI(aI,uI),cg(this.normal,aI),f.push(this.normal[0],this.normal[1],0),l.push(r[0],r[1],0,this.totalDistance,-this.thickness*S,0),u+=3):(this.extrusions(l,f,r,x,_,this.totalDistance),c.push.apply(c,kr(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),S=-1,cg(this.normal,x),u+=2),this.lastFlip=S}else{if(fI(this.normal,sI),h){var A=sg(),T=sg();bg(T,sI,this.normal),lg(A,sI,this.normal),f.push(T[0],T[1],0),f.push(A[0],A[1],0),l.push(r[0],r[1],0,this.totalDistance,this.thickness,0),l.push(r[0],r[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(l,f,r,this.normal,this.thickness,this.totalDistance);c.push.apply(c,kr(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),u+=2}return u}},{key:"segment",value:function(e,t,n,r,i){var o=0,a=e.indices,s=e.positions,u=e.normals,c="square"===this.cap,l="bevel"===this.join,f=mh([r[0],r[1]]),h=mh([n[0],n[1]]);hI(sI,f,h);var d=0;if(this.dash&&(d=this.lineSegmentDistance(f,h),this.totalDistance+=d),this.normal||(this.normal=sg(),fI(this.normal,sI)),!this.started)if(this.started=!0,c){var p=sg(),v=sg();lg(p,this.normal,sI),lg(v,this.normal,sI),u.push(v[0],v[1],0),u.push(p[0],p[1],0),s.push(n[0],n[1],0,this.totalDistance-d,-this.thickness,0),s.push(n[0],n[1],0,this.totalDistance-d,this.thickness,0)}else this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-d);if(a.push(t+0,t+1,t+2),i){var g=mh([i[0],i[1]]);dI(f,g)&&lg(g,f,hg(g,fg(g,f,h))),hI(uI,g,f);var m=Mr(lI(cI,sg(),sI,uI,this.thickness),2),y=m[0],b=m[1],_=dg(cI,this.normal)<0?-1:1,x=l;if(!x&&"miter"===this.join)y>this.miterLimit&&(x=!0);x?(u.push(this.normal[0],this.normal[1],0),u.push(b[0],b[1],0),s.push(r[0],r[1],0,this.totalDistance,-this.thickness*_,0),s.push(r[0],r[1],0,this.totalDistance,this.thickness*_,0),a.push.apply(a,kr(this.lastFlip!==-_?[t,t+2,t+3]:[t+2,t+1,t+3])),a.push(t+2,t+3,t+4),fI(aI,uI),cg(this.normal,aI),u.push(this.normal[0],this.normal[1],0),s.push(r[0],r[1],0,this.totalDistance,-this.thickness*_,0),o+=3):(this.extrusions(s,u,r,b,y,this.totalDistance),a.push.apply(a,kr(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),_=-1,cg(this.normal,b),o+=2),this.lastFlip=_}else{if(fI(this.normal,sI),c){var S=sg(),w=sg();bg(w,sI,this.normal),lg(S,sI,this.normal),u.push(w[0],w[1],0),u.push(S[0],S[1],0),s.push(r[0],r[1],0,this.totalDistance,this.thickness,0),s.push(r[0],r[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance);a.push.apply(a,kr(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),o+=2}return o}},{key:"extrusions",value:function(e,t,n,r,i,o){t.push(r[0],r[1],0),t.push(r[0],r[1],0),e.push(n[0],n[1],0,o,-i,0),e.push(n[0],n[1],0,o,i,0)}},{key:"lineSegmentDistance",value:function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}}]),e}();function yI(e){if(Pk(e[0]))return e;if(Pk(e[0][0]))throw new Error("");if(Pk(e[0][0][0])){var t=0,n=0,r=0;return e.forEach((function(e){e.forEach((function(e){t+=e[0],n+=e[1],r++}))})),[t/r,n/r,0]}throw new Error("")}function bI(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e[0][0],r=e[0][e[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,o=PO.flatten(e),a=o.vertices,s=o.dimensions,u=[],c=[],l=[],f=0;f<a.length/s;f++)2===s?u.push(a[2*f],a[2*f+1],1,-1,-1):u.push(a[3*f],a[3*f+1],1,-1,-1),l.push(0,0,1);var h=PO(o.vertices,o.holes,o.dimensions);c.push.apply(c,kr(h));for(var d=function(e){var n=o.vertices.slice(e*s,(e+1)*s),r=o.vertices.slice((e+1)*s,(e+2)*s);0===r.length&&(r=o.vertices.slice(0,s));var i=u.length/5;u.push(n[0],n[1],1,0,0,r[0],r[1],1,.1,0,n[0],n[1],0,0,.8,r[0],r[1],0,.1,.8);var a=_I([r[0],r[1],1],[n[0],n[1],0],[n[0],n[1],1],t);l.push.apply(l,kr(a).concat(kr(a),kr(a),kr(a))),c.push.apply(c,kr([1,2,0,3,2,1].map((function(e){return e+i}))))},p=0;p<i;p++)d(p);return{positions:u,index:c,normals:l}}function _I(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=Nv(),o=Nv(),a=Nv();r&&(e=dh(e),t=dh(t),n=dh(n));var s=Fv.apply(rg,kr(e)),u=Fv.apply(rg,kr(t)),c=Fv.apply(rg,kr(n));Xv(i,c,u),Xv(o,s,u),Yv(a,i,o);var l=Nv();return Wv(l,a),l}function xI(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=2*Math.PI/e,r=[],i=0;i<e;i++)r.push(n*i+t*Math.PI/12);var o=r.map((function(e){return[Math.sin(e+Math.PI/4),Math.cos(e+Math.PI/4),0]}));return o}function SI(){return xI(30)}function wI(){return xI(4)}function AI(){return xI(3)}function TI(){return xI(6,1)}function EI(){return xI(5)}!function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"}(vI||(vI={})),function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"}(gI||(gI={}));var CI=(gr(pI={},gI.CIRCLE,SI),gr(pI,gI.HEXAGON,TI),gr(pI,gI.TRIANGLE,AI),gr(pI,gI.SQUARE,wI),gr(pI,gI.PENTAGON,EI),gr(pI,vI.CYLINDER,SI),gr(pI,vI.HEXAGONCOLUMN,TI),gr(pI,vI.TRIANGLECOLUMN,AI),gr(pI,vI.SQUARECOLUMN,wI),gr(pI,vI.PENTAGONCOLUMN,EI),pI),MI={};function kI(e){var t=yI(e.coordinates);return{vertices:[].concat(kr(t),kr(t),kr(t),kr(t)),indices:[0,1,2,2,3,0],size:t.length}}function OI(e){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(MI&&MI[e])return MI[e];var n=CI[e]?CI[e]():CI.cylinder(),r=bI([n],t);return MI[e]=r,r}(e.shape,!1);return{vertices:t.positions,indices:t.index,normals:t.normals,size:5}}function II(e){var t=yI(e.coordinates);return{vertices:kr(t),indices:[0],size:t.length}}function PI(e){var t=e.coordinates,n=e.originCoordinates,r=e.version,i=new mI({dash:!0,join:"bevel"});if("GAODE2.x"===r){var o=t;Array.isArray(o[0][0])||(o=[t]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],c=a[s];i.extrude_gaode2(u,c)}}else{var l=t;Array.isArray(l[0][0])||(l=[t]),l.forEach((function(e){i.extrude(e)}))}var f=i.complex;return{vertices:f.positions,indices:f.indices,normals:f.normals,size:6}}function LI(e){var t=e.coordinates,n=PO.flatten(t),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:PO(r,o,i),vertices:r,size:i}}function RI(e){var t=bI(e.coordinates,!0);return{vertices:t.positions,indices:t.index,normals:t.normals,size:5}}function NI(e){var t=function(e){var t=CI[e]?CI[e]():CI.circle();return-1===["cylinder","triangleColumn","hexagonColumn","squareColumn"].indexOf(e)?(n=[t],r=PO.flatten(n),i=PO(r.vertices,r.holes,r.dimensions),{positions:r.vertices,index:i}):function(e){var t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var r=e[0].length,i=PO.flatten(e),o=i.vertices,a=i.dimensions,s=[],u=[],c=0;c<o.length/a;c++)2===a?s.push(o[2*c],o[2*c+1],1):s.push(o[3*c],o[3*c+1],1);var l=PO(i.vertices,i.holes,i.dimensions);u.push.apply(u,kr(l));for(var f=function(e){var t=i.vertices.slice(e*a,(e+1)*a),n=i.vertices.slice((e+1)*a,(e+2)*a);0===n.length&&(n=i.vertices.slice(0,a));var r=s.length/3;s.push(t[0],t[1],1,n[0],n[1],1,t[0],t[1],0,n[0],n[1],0),u.push.apply(u,kr([0,2,1,2,3,1].map((function(e){return e+r}))))},h=0;h<r;h++)f(h);return{positions:s,index:u}}([t]);var n,r,i}(e.shape);return{vertices:t.positions,indices:t.index,size:3}}function DI(e){var t=e.coordinates;return{vertices:[].concat(kr(t[0]),[0,0,1,t[1][0],t[0][1],0,1,1],kr(t[1]),[0,1,0],kr(t[0]),[0,0,1],kr(t[1]),[0,1,0,t[0][0],t[1][1],0,0,0]),indices:[0,1,2,3,4,5],size:5}}function FI(e){for(var t=e.coordinates,n=[],r=[],i=function(e){n.push(e,1,e,t[0][0],t[0][1],t[1][0],t[1][1],e,-1,e,t[0][0],t[0][1],t[1][0],t[1][1]),29!==e&&r.push.apply(r,kr([0,1,2,1,3,2].map((function(t){return 2*e+t}))))},o=0;o<30;o++)i(o);return{vertices:n,indices:r,size:7}}function zI(e){var t=e.coordinates;2===t.length&&t.push(0);e.size;var n=jI(-1,1),r=jI(1,1),i=jI(-1,-1),o=jI(1,-1);return{vertices:[].concat(kr(t),kr(n),kr(t),kr(i),kr(t),kr(o),kr(t),kr(r)),indices:[0,1,2,3,0,2],size:5}}function jI(e,t){return[(e+1)/2,(t+1)/2]}var UI,BI=function(t){mr(r,t);var n=Er(r);function r(){return dr(this,r),n.apply(this,arguments)}return vr(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.baseColor,i=void 0===r?"rgb(16,16,16)":r,o=e.brightColor,a=void 0===o?"rgb(255,176,38)":o,s=e.windowColor,u=void 0===s?"rgb(30,60,89)":s,c=e.time,l=void 0===c?0:c;return{u_opacity:n,u_baseColor:od(i),u_brightColor:od(a),u_windowColor:od(u),u_time:this.layer.getLayerAnimateTime()||l}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:'precision highp float;\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\nvarying vec4 v_Color;\nuniform mat4 u_Mvp;\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nvoid main() {\nvec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\nvec4 project_pos = project_position(pos);\nv_texCoord = a_Uv;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nfloat lightWeight = calc_lighting(pos);\nv_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform float u_opacity: 1.0;\nuniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];\nuniform float u_near : 0;\nuniform float u_far : 1;\nvarying vec4 v_Color;\nvarying vec2 v_texCoord;\nuniform float u_Zoom : 1;\nuniform float u_time;\n#pragma include "picking"\nvec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {\nfloat s = step(hot, n);\nvec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);\nreturn mix(darkColor, color, s);\n}\nfloat random (vec2 st) {\nreturn fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);\n}\nfloat LinearizeDepth()\n{\nfloat z = gl_FragCoord.z * 2.0 - 1.0;\nreturn (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));\n}\nvec3 fog(vec3 color, vec3 fogColor, float depth){\nfloat fogFactor=clamp(depth,0.0,1.0);\nvec3 output_color=mix(fogColor,color,fogFactor);\nreturn output_color;\n}\nfloat sdRect(vec2 p, vec2 sz) {\nvec2 d = abs(p) - sz;\nfloat outside = length(max(d, 0.));\nfloat inside = min(max(d.x, d.y), 0.);\nreturn outside + inside;\n}\nvoid main() {\ngl_FragColor = v_Color;\nvec3 baseColor = u_baseColor.xyz;\nvec3 brightColor = u_brightColor.xyz;\nvec3 windowColor = u_windowColor.xyz;\nfloat targetColId = 5.;\nfloat depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;\nvec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);\nif(v_texCoord.x < 0.) {\nvec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);\ngl_FragColor = vec4( foggedColor, v_Color.w);\n}else {\nvec2 st = v_texCoord;\nvec2  UvScale = v_texCoord;\nfloat tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));\nfloat tStart = 0.25 * tStep;\nfloat tEnd = 0.75 * tStep;\nfloat u = mod(UvScale.x, tStep);\nfloat v = mod(UvScale.y, tStep);\nfloat ux = floor(UvScale.x/tStep);\nfloat uy = floor(UvScale.y/tStep);\nfloat n = random(vec2(ux,uy));\nfloat lightP = u_time;\nfloat head = 1.0- step(0.005,st.y);\nfloat sU = step(tStart, u) - step(tEnd, u);\nfloat sV = step(tStart, v) - step(tEnd, v);\nvec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));\nfloat dist = sdRect(vec2(u,v), windowSize);\nfloat s = sU * sV;\nfloat curColId = floor(UvScale.x / tStep);\nfloat sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);\nfloat mLightP = mod(lightP, 2.);\nfloat sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);\nif(ux == targetColId){\nn =0.;\n}\nfloat timeP = min(0.75, abs ( sin(u_time/3.0) ) );\nfloat hot = smoothstep(1.0,0.0,timeP);\nvec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);\nfloat sFinal = s * sCol * sRow;\ncolor += mix(baseColor, brightColor, sFinal*n);\nif (st.y<0.01){\ncolor = baseColor;\n}\nif(head ==1.0) {\ncolor = brightColor;\n}\ncolor = color * v_Color.rgb;\nvec3 foggedColor = fog(color,fogColor,depth);\ngl_FragColor = vec4(foggedColor,1.0);\n}\ngl_FragColor.a *= u_opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:RI})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,o=void 0===i?10:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){e.size;return[n[3],n[4]]}}})}}]),r}(IO),VI=function(e){mr(n,e);var t=Er(n);function n(){var e;dr(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return gr(Ar(e=t.call.apply(t,[this].concat(i))),"type","PolygonLayer"),e}return vr(n,[{key:"buildModels",value:function(){this.layerModel=new BI(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(e){this.updateLayerConfig({time:e})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),n}(Wk),HI='precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n#pragma include "picking"\nvoid main() {\ngl_FragColor = v_color;\ngl_FragColor.a *= u_opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',GI=function(t){mr(r,t);var n=Er(r);function r(){return dr(this,r),n.apply(this,arguments)}return vr(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||.9,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\r\nattribute float a_Size;\r\nattribute vec4 a_Color;\r\nuniform vec2 u_radius;\r\nuniform float u_coverage: 0.9;\r\nuniform float u_angle: 0;\r\nuniform mat4 u_ModelMatrix;\r\nuniform mat4 u_Mvp;\r\nvarying vec4 v_color;\r\nuniform vec2 u_SceneCenterMKT;\r\n#pragma include "projection"\r\n#pragma include "project"\r\n#pragma include "picking"\r\nvoid main() {\r\nv_color = a_Color;\r\nmat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r\nvec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nvec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\nvec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;\nvec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r\ngl_Position = u_Mvp * (project_pos);\r\n} else {\r\nvec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\nvec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\ngl_Position = project_common_position_to_clipspace(project_pos);\r\n}\r\nsetPickingColor(a_PickingColor);\r\n}',fragmentShader:HI,triangulation:NI,depth:{enable:!1},primitive:e.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:e.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t){var n="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[n[0],n[1],0]}}})}}]),r}(IO),WI=function(t){mr(r,t);var n=Er(r);function r(){return dr(this,r),n.apply(this,arguments)}return vr(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||1,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\nuniform vec2 u_SceneCenterMKT;\n#pragma include "projection"\n#pragma include "project"\n#pragma include "light"\n#pragma include "picking"\nvoid main() {\nmat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\nvec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nvec2 lnglat = unProjectFlat(a_Pos.xy + offset);\nvec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;\nvec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));\nfloat lightWeight = calc_lighting(project_pos);\nv_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\ngl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);\n} else {\nvec2 lnglat = unProjectFlat(a_Pos.xy + offset);\nvec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\nfloat lightWeight = calc_lighting(project_pos);\nv_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\ngl_Position = project_common_position_to_clipspace(project_pos);\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:HI,triangulation:OI,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size;return Array.isArray(i)?[i[0]]:[i]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:e.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t){var n="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[n[0],n[1],0]}}})}}]),r}(IO);var ZI=$()(UI=function(t){mr(r,t);var n=Er(r);function r(){var e;dr(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return gr(Ar(e=n.call.apply(n,[this].concat(i))),"texture",void 0),gr(Ar(e),"colorTexture",void 0),gr(Ar(e),"heatmapFramerBuffer",void 0),gr(Ar(e),"intensityModel",void 0),gr(Ar(e),"colorModel",void 0),gr(Ar(e),"shapeType",void 0),e}return vr(r,[{key:"render",value:function(){var e=this,t=this.rendererService,n=t.clear;(0,t.useFramebuffer)(this.heatmapFramerBuffer,(function(){n({color:[0,0,0,0],depth:1,stencil:0,framebuffer:e.heatmapFramerBuffer}),e.drawIntensityMode()})),this.layer.styleNeedUpdate&&this.updateColorTexture(),"heatmap"===this.shapeType?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var t,n=this.rendererService,r=n.createFramebuffer,i=(n.clear,n.getViewportSize),o=n.createTexture2D,a=(n.useFramebuffer,this.styleAttributeService.getLayerStyleAttribute("shape")),s=(null==a||null===(t=a.scale)||void 0===t?void 0:t.field)||"heatmap";this.shapeType=s,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel="heatmap"===s?this.buildHeatmapColor():this.build3dHeatMap();ud(this.layer.getLayerConfig().rampColors);var u=i(),c=u.width,l=u.height;return this.heatmapFramerBuffer=r({color:o({width:Math.floor(c/4),height:Math.floor(l/4),wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE,min:e.gl.LINEAR,mag:e.gl.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:e.AttributeType.Attribute,descriptor:{name:"a_Dir",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){return[n[3],n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size;return[void 0===i?1:i]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute float a_Size;\nattribute vec2 a_Dir;\nuniform float u_intensity;\nuniform float u_radius;\nvarying vec2 v_extrude;\nvarying float v_weight;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n#define GAUSS_COEF  0.3989422804014327\n#pragma include "projection"\nvoid main(){\nv_weight = a_Size;\nfloat ZERO = 1.0 / 255.0 / 16.0;\nfloat extrude_x = a_Dir.x * 2.0 -1.0;\nfloat extrude_y = a_Dir.y * 2.0 -1.0;\nvec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));\nfloat S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;\nv_extrude = extrude_dir * S;\nvec2 offset = project_pixel(v_extrude * u_radius);\nvec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n}\n}',fragmentShader:"precision highp float;\nuniform float u_intensity;\nvarying float v_weight;\nvarying vec2 v_extrude;\n#define GAUSS_COEF  0.3989422804014327\nvoid main(){\nfloat d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\nfloat val = v_weight * u_intensity * GAUSS_COEF * exp(d);\ngl_FragColor = vec4(val, 1., 1., 1.);\n}",triangulation:zI,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:e.gl.ONE,srcAlpha:1,dstRGB:e.gl.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:"precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvarying float v_intensity;\nvoid main() {\nv_texCoord = a_Uv;\nv_intensity = texture2D(u_texture, v_texCoord).r;\ngl_Position = vec4(a_Position.xy, 0, 1.);\n}",fs:"uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_opacity;\nvarying vec2 v_texCoord;\nvarying float v_intensity;\nvoid main(){\nfloat intensity = texture2D(u_texture, v_texCoord).r;\nvec4 color = texture2D(u_colorTexture,vec2(intensity, 0));\ngl_FragColor =color;\ngl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}"});var t=this.shaderModuleService.getModule("heatmapColor"),n=t.vs,r=t.fs,i=t.uniforms,o=this.rendererService,a=o.createAttribute,s=o.createElements,u=o.createBuffer;return(0,o.createModel)({vs:n,fs:r,attributes:{a_Position:a({buffer:u({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:e.gl.FLOAT}),size:3}),a_Uv:a({buffer:u({data:[0,1,1,1,0,0,1,0],type:e.gl.FLOAT}),size:2})},uniforms:cr({},i),depth:{enable:!1},blend:this.getBlend(),count:6,elements:s({data:[0,2,1,2,3,1],type:e.gl.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.intensity,r=void 0===n?10:n,i=e.radius,o=void 0===i?5:i;this.intensityModel.draw({uniforms:{u_opacity:t||1,u_radius:o,u_intensity:r}})}},{key:"drawColorMode",value:function(){var e=this.layer.getLayerConfig().opacity;this.colorModel.draw({uniforms:{u_opacity:e||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var e=this.layer.getLayerConfig().opacity,t=pv();yv(t,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:e||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:kr(t)}})}},{key:"build3dHeatMap",value:function(){var t=(0,this.rendererService.getViewportSize)(),n=function(e,t){for(var n=[],r=[],i=[],o=e+1,a=t+1,s=e/2,u=t/2,c=0;c<a;c++)for(var l=c-u,f=0;f<o;f++){var h=f-s;r.push(h/s,-l/u,0),i.push(f/e),i.push(1-c/t)}for(var d=0;d<t;d++)for(var p=0;p<e;p++){var v=p+o*d,g=p+o*(d+1),m=p+1+o*(d+1),y=p+1+o*d;n.push(v,g,y),n.push(g,m,y)}return{vertices:r,indices:n,uvs:i}}(t.width/4,t.height/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:'precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_InverseViewProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrixUncentered;\nvarying float v_intensity;\nvec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {\nfloat t2 = t * t;\nfloat one_minus_t = 1.0 - t;\nfloat one_minus_t2 = one_minus_t * one_minus_t;\nreturn (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);\n}\nvec2 toBezier(float t, vec4 p){\nreturn toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));\n}\n#pragma include "projection"\nvoid main() {\nv_texCoord = a_Uv;\nvec2 pos = a_Uv * vec2(2.0) - vec2(1.0);\nvec4 p1 = vec4(pos, 0.0, 1.0);\nvec4 p2 = vec4(pos, 1.0, 1.0);\nvec4 inverseP1 = u_InverseViewProjectionMatrix * p1;\nvec4 inverseP2 = u_InverseViewProjectionMatrix * p2;\ninverseP1 = inverseP1 / inverseP1.w;\ninverseP2 = inverseP2 / inverseP2.w;\nfloat zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z);\nvec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);\nvec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);\nfloat fh;\nv_intensity = texture2D(u_texture, v_texCoord).r;\nfh = toBezier(v_intensity, b).y;\ngl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);\n}',fs:"uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_opacity;\nvarying vec2 v_texCoord;\nvarying float v_intensity;\nvoid main(){\nfloat intensity = texture2D(u_texture, v_texCoord).r;\nvec4 color = texture2D(u_colorTexture,vec2(intensity, 0));\ngl_FragColor = color;\ngl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}"});var r=this.shaderModuleService.getModule("heatmap3dColor"),i=r.vs,o=r.fs,a=r.uniforms,s=this.rendererService,u=s.createAttribute,c=s.createElements,l=s.createBuffer;return(0,s.createModel)({vs:i,fs:o,attributes:{a_Position:u({buffer:l({data:n.vertices,type:e.gl.FLOAT}),size:3}),a_Uv:u({buffer:l({data:n.uvs,type:e.gl.FLOAT}),size:2})},primitive:e.gl.TRIANGLES,uniforms:cr({},a),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:e.gl.SRC_ALPHA,srcAlpha:1,dstRGB:e.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:c({data:n.indices,type:e.gl.UNSIGNED_INT,count:n.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var n=ud(this.layer.getLayerConfig().rampColors);this.colorTexture=t({data:new Uint8Array(n.data),width:n.width,height:n.height,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE,min:e.gl.NEAREST,mag:e.gl.NEAREST,flipY:!1})}}]),r}(IO))||UI,YI={heatmap:ZI,heatmap3d:ZI,grid:GI,grid3d:WI,hexagon:function(t){mr(r,t);var n=Er(r);function r(){return dr(this,r),n.apply(this,arguments)}return vr(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||.9,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\nuniform vec2 u_SceneCenterMKT;\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nvoid main() {\nv_color = a_Color;\nmat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\nvec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\nvec2 lnglat = unProjectFlat(a_Pos.xy + offset);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nvec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;\nvec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\ngl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);\n} else {\nvec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:HI,triangulation:NI,depth:{enable:!1},primitive:e.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:e.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t){var n="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[n[0],n[1],0]}}})}}]),r}(IO)},qI=function(e){mr(n,e);var t=Er(n);function n(){var e;dr(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return gr(Ar(e=t.call.apply(t,[this].concat(i))),"type","HeatMapLayer"),e}return vr(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new YI[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var e=this;return"heatmap"===this.getModelType()?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach((function(t){return t.draw({uniforms:e.layerModel.getUninforms()})})),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=this.getLayerConfig().shape3d,r=this.getSource().data.type,i=(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"heatmap";return"heatmap"===i||"heatmap3d"===i?"heatmap":"hexagon"===r?-1===(null==n?void 0:n.indexOf(i))?"hexagon":"grid3d":"grid"===r?-1===(null==n?void 0:n.indexOf(i))?"grid":"grid3d":"heatmap"}}]),n}(Wk),XI={image:function(t){mr(r,t);var n=Er(r);function r(){var e;dr(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return gr(Ar(e=n.call.apply(n,[this].concat(i))),"texture",void 0),e}return vr(r,[{key:"getUninforms",value:function(){return{u_opacity:this.layer.getLayerConfig().opacity||1,u_texture:this.texture}}},{key:"initModels",value:function(){var t=this,n=this.layer.getSource(),r=this.rendererService.createTexture2D;return this.texture=r({height:0,width:0}),n.data.images.then((function(e){t.texture=r({data:e[0],width:e[0].width,height:e[0].height}),t.layerService.renderLayers()})),[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\nv_texCoord = a_Uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n}\n}',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\nvec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\ngl_FragColor = color;\ngl_FragColor.a *= u_opacity;\n}",triangulation:DI,primitive:e.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){return[n[3],n[4]]}}})}}]),r}(IO)},KI=function(e){mr(n,e);var t=Er(n);function n(){var e;dr(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return gr(Ar(e=t.call.apply(t,[this].concat(i))),"type","ImageLayer"),e}return vr(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new XI[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{image:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"image"}}]),n}(Wk),QI={solid:0,dash:1},JI=function(t){mr(r,t);var n=Er(r);function r(){var t;dr(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return gr(Ar(t=n.call.apply(n,[this].concat(o))),"texture",void 0),gr(Ar(t),"updateTexture",(function(){var n=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=n({data:t.iconService.getCanvas(),mag:e.gl.NEAREST,min:e.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return vr(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=t.sourceColor,i=t.targetColor,o=t.textureBlend,a=void 0===o?"normal":o,s=t.lineType,u=void 0===s?"solid":s,c=t.dashArray,l=void 0===c?[10,5]:c,f=t.forward,h=void 0===f||f,d=t.lineTexture,p=void 0!==d&&d,v=t.iconStep,g=void 0===v?100:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var m=this.layer.getEncodedData(),y=this.calDataFrame(this.cellLength,m,this.cellProperties),b=y.data,_=y.width,x=y.height;this.rowCount=x,this.dataTexture=this.cellLength>0&&b.length>0?this.createTexture2D({flipY:!0,data:b,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:_,height:x}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}2===l.length&&l.push(0,0);var S=0,w=[0,0,0,0],A=[0,0,0,0];return r&&i&&(w=od(r),A=od(i),S=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pk(n)?n:1,u_textureBlend:"normal"===a?0:1,segmentNumber:30,u_line_type:QI[u||"solid"],u_dash_array:l,u_blur:.9,u_lineDir:h?1:-1,u_texture:this.texture,u_line_texture:p?1:0,u_icon_step:g,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:S,u_sourceColor:w,u_targetColor:A}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.dataTexture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying vec4 v_color;\nvarying vec2 v_normal;\nvarying float v_distance_ratio;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_lineDir: 1.0;\nvarying vec4 v_dash_array;\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\nvarying float v_arcDistrance;\nvarying float v_pixelLen;\nvarying float v_a;\nvarying vec2 v_offset;\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat bezier3(vec3 arr, float t) {\nfloat ut = 1. - t;\nreturn (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target) {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec2 center = target - source;\nfloat r = length(center);\nfloat theta = atan(center.y, center.x);\nfloat thetaOffset = 0.314;\nfloat r2 = r / 2.0 / cos(thetaOffset);\nfloat theta2 = theta + thetaOffset;\nvec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\nif(u_lineDir == 1.0) {\nreturn mid;\n} else {\nvec2 vmid = source + target - mid;\nreturn vmid;\n}\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t) {\nvec2 mid = midPoint(source, target);\nvec3 x = vec3(source.x, mid.x, target.x);\nvec3 y = vec3(source.y, mid.y, target.y);\nreturn vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nvoid main() {\nv_color = a_Color;\nvec2 source = a_Instance.rg;\nvec2 target =  a_Instance.ba;\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nif(u_line_type == LineTypeDash) {\nv_distance_ratio = segmentIndex / segmentNumber;\nvec2 s = source;\nvec2 t = target;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ns = unProjCustomCoord(source);\nt = unProjCustomCoord(target);\n}\nfloat total_Distance = pixelDistance(s, t) / 2.0 * PI;\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n}\nif(u_aimate.x == Animate) {\nv_distance_ratio = segmentIndex / segmentNumber;\nif(u_lineDir != 1.0) {\nv_distance_ratio = 1.0 - v_distance_ratio;\n}\n}\nvec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));\nvec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));\nv_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\nvec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\nv_segmentIndex = a_Position.x + 1.0;\nif(LineTexture == u_line_texture) {\nv_arcDistrance = length(source - target);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\nv_arcDistrance *= 1000000.0;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nv_arcDistrance = project_pixel_allmap(v_arcDistrance);\n}\nv_iconMapUV = a_iconMapUV;\nv_pixelLen = project_pixel(u_icon_step);\nv_a = project_pixel(a_Size);\nv_offset = offset + offset * sign(a_Position.y);\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\nvarying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\nvarying vec4 v_color;\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float segmentNumber;\nvarying float v_segmentIndex;\nvarying float v_arcDistrance;\nvarying float v_pixelLen;\nvarying float v_a;\nvarying vec2 v_offset;\nvarying vec2 v_iconMapUV;\nvarying mat4 styleMappingMat;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat animateSpeed = 0.0;\nif(u_linearColor == 1.0) {\ngl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);\n} else {\ngl_FragColor = v_color;\n}\ngl_FragColor.a *= opacity;\nif(u_line_type == LineTypeDash) {\nfloat flag = 0.;\nfloat dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\nif(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\nflag = 1.;\n}\ngl_FragColor.a *=flag;\n}\nif(u_aimate.x == Animate) {\nanimateSpeed = u_time / u_aimate.y;\nfloat alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);\nalpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\nalpha = clamp(alpha, 0.0, 1.0);\ngl_FragColor.a *= alpha;\n}\nif(u_line_texture == LineTexture && u_line_type != LineTypeDash) {\nfloat arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));\nfloat count = floor(v_arcDistrance/v_pixelLen);\nfloat u = 1.0 - fract(arcRadio * count + animateSpeed);\nif(u_aimate.x == Animate) {\nu = gl_FragColor.a/opacity;\n}\nfloat v = length(v_offset)/(v_a);\nvec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\nvec4 pattern = texture2D(u_texture, uv);\nif(u_textureBlend == 0.0) {\npattern.a = 0.0;\ngl_FragColor = filterColor(gl_FragColor + pattern);\n} else {\npattern.a *= opacity;\nif(gl_FragColor.a <= 0.0) {\npattern.a = 0.0;\n}\ngl_FragColor = filterColor(pattern);\n}\n} else {\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',triangulation:FI,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:e.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:4,update:function(e,t,n,r){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,n,r,i){var o=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[o.x,o.y]}}})}}]),r}(IO),$I={solid:0,dash:1},eP=function(t){mr(r,t);var n=Er(r);function r(){var t;dr(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return gr(Ar(t=n.call.apply(n,[this].concat(o))),"texture",void 0),gr(Ar(t),"updateTexture",(function(){var n=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=n({data:t.iconService.getCanvas(),mag:e.gl.NEAREST,min:e.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return vr(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=t.sourceColor,i=t.targetColor,o=t.textureBlend,a=void 0===o?"normal":o,s=t.lineType,u=void 0===s?"solid":s,c=t.dashArray,l=void 0===c?[10,5]:c,f=t.lineTexture,h=void 0!==f&&f,d=t.iconStep,p=void 0===d?100:d;2===l.length&&l.push(0,0);var v=0,g=[0,0,0,0],m=[0,0,0,0];if(r&&i&&(g=od(r),m=od(i),v=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var y=this.layer.getEncodedData(),b=this.calDataFrame(this.cellLength,y,this.cellProperties),_=b.data,x=b.width,S=b.height;this.rowCount=S,this.dataTexture=this.cellLength>0&&_.length>0?this.createTexture2D({flipY:!0,data:_,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:x,height:S}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pk(n)?n:1,u_textureBlend:"normal"===a?0:1,segmentNumber:30,u_line_type:$I[u]||0,u_dash_array:l,u_texture:this.texture,u_line_texture:h?1:0,u_icon_step:p,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:v,u_sourceColor:g,u_targetColor:m}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.dataTexture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying vec4 v_color;\nvarying vec2 v_normal;\nvarying float v_distance_ratio;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\nvarying float v_arcDistrance;\nvarying float v_pixelLen;\nvarying float v_a;\nvarying vec2 v_offset;\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\nreturn start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\nvec2 x = mix(source, target, ratio);\nvec2 center = mix(source, target, 0.5);\nfloat dSourceCenter = distance(source, center);\nfloat dXCenter = distance(x, center);\nreturn (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\nfloat vertex_height = paraboloid(source, target, segmentRatio);\nreturn vec3(\nmix(source, target, segmentRatio),\nsqrt(max(0.0, vertex_height))\n);\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nv_color = a_Color;\nvec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\nvec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nif(u_line_type == LineTypeDash) {\nv_distance_ratio = segmentIndex / segmentNumber;\nvec2 s = source;\nvec2 t = target;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ns = unProjCustomCoord(source);\nt = unProjCustomCoord(target);\n}\nfloat total_Distance = pixelDistance(s, t) / 2.0 * PI;\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n}\nif(u_aimate.x == Animate) {\nv_distance_ratio = segmentIndex / segmentNumber;\n}\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nvec3 curr = getPos(source, target, segmentRatio);\nvec3 next = getPos(source, target, nextSegmentRatio);\nvec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\nv_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\nv_segmentIndex = a_Position.x;\nif(LineTexture == u_line_texture && u_line_type != LineTypeDash) {\nv_arcDistrance = length(source - target);\nv_pixelLen = project_pixel(u_icon_step);\nvec2 projectOffset = project_pixel(offset);\nv_offset = projectOffset + projectOffset * sign(a_Position.y);\nv_a = project_pixel(a_Size);\nv_iconMapUV = a_iconMapUV;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\nvarying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\nvarying vec4 v_color;\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\nvarying float v_arcDistrance;\nvarying float v_pixelLen;\nvarying float v_a;\nvarying vec2 v_offset;\nvarying vec2 v_iconMapUV;\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat animateSpeed = 0.0;\nif(u_linearColor == 1.0) {\ngl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);\n} else {\ngl_FragColor = v_color;\n}\ngl_FragColor.a *= opacity;\nif(u_line_type == LineTypeDash) {\nfloat flag = 0.;\nfloat dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\nif(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\nflag = 1.;\n}\ngl_FragColor.a *=flag;\n}\nif(u_aimate.x == Animate) {\nanimateSpeed = u_time / u_aimate.y;\nfloat alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);\nalpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\nalpha = clamp(alpha, 0.0, 1.0);\ngl_FragColor.a *= alpha;\n}\nif(u_line_texture == LineTexture && u_line_type != LineTypeDash) {\nfloat arcRadio = v_segmentIndex / (segmentNumber - 1.0);\nfloat count = floor(v_arcDistrance/v_pixelLen);\nfloat u = fract(arcRadio * count - animateSpeed * count);\nif(u_aimate.x == Animate) {\nu = gl_FragColor.a/opacity;\n}\nfloat v = length(v_offset)/(v_a);\nvec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\nvec4 pattern = texture2D(u_texture, uv);\nif(u_textureBlend == 0.0) {\npattern.a = 0.0;\ngl_FragColor = filterColor(gl_FragColor + pattern);\n} else {\npattern.a *= opacity;\nif(gl_FragColor.a <= 0.0) {\npattern.a = 0.0;\ndiscard;\n} else {\ngl_FragColor = filterColor(pattern);\n}\n}\n} else {\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',triangulation:FI,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:e.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:4,update:function(e,t,n,r){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,n,r,i){var o=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[o.x,o.y]}}})}}]),r}(IO),tP={solid:0,dash:1},nP=function(t){mr(r,t);var n=Er(r);function r(){var t;dr(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return gr(Ar(t=n.call.apply(n,[this].concat(o))),"texture",void 0),gr(Ar(t),"updateTexture",(function(){var n=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=n({data:t.iconService.getCanvas(),mag:e.gl.NEAREST,min:e.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return vr(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=t.sourceColor,i=t.targetColor,o=t.textureBlend,a=void 0===o?"normal":o,s=t.lineType,u=void 0===s?"solid":s,c=t.dashArray,l=void 0===c?[10,5]:c,f=t.lineTexture,h=void 0!==f&&f,d=t.iconStep,p=void 0===d?100:d;2===l.length&&l.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var v=0,g=[0,0,0,0],m=[0,0,0,0];if(r&&i&&(g=od(r),m=od(i),v=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var y=this.layer.getEncodedData(),b=this.calDataFrame(this.cellLength,y,this.cellProperties),_=b.data,x=b.width,S=b.height;this.rowCount=S,this.dataTexture=this.cellLength>0&&_.length>0?this.createTexture2D({flipY:!0,data:_,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:x,height:S}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pk(n)?n:1,u_textureBlend:"normal"===a?0:1,segmentNumber:30,u_line_type:tP[u]||0,u_dash_array:l,u_texture:this.texture,u_line_texture:h?1:0,u_icon_step:p,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:v,u_sourceColor:g,u_targetColor:m}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.dataTexture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying vec4 v_color;\nvarying vec2 v_normal;\nvarying float v_distance_ratio;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\nvarying float v_arcDistrance;\nvarying float v_pixelLen;\nvarying vec2 v_offset;\nvarying float v_a;\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\nreturn start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\nvec2 x = mix(source, target, ratio);\nvec2 center = mix(source, target, 0.5);\nfloat dSourceCenter = distance(source, center);\nfloat dXCenter = distance(x, center);\nreturn (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\nfloat vertex_height = paraboloid(source, target, segmentRatio);\nreturn vec3(\nmix(source, target, segmentRatio),\nsqrt(max(0.0, vertex_height))\n);\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nfloat getAngularDist (vec2 source, vec2 target) {\nvec2 delta = source - target;\nvec2 sin_half_delta = sin(delta / 2.0);\nfloat a =\nsin_half_delta.y * sin_half_delta.y +\ncos(source.y) * cos(target.y) *\nsin_half_delta.x * sin_half_delta.x;\nreturn 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\nvec2 midPoint(vec2 source, vec2 target) {\nvec2 center = target - source;\nfloat r = length(center);\nfloat theta = atan(center.y, center.x);\nfloat thetaOffset = 0.314;\nfloat r2 = r / 2.0 / cos(thetaOffset);\nfloat theta2 = theta + thetaOffset;\nvec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\nreturn mid;\n}\nfloat bezier3(vec3 arr, float t) {\nfloat ut = 1. - t;\nreturn (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nvec2 mid = midPoint(source, target);\nvec3 x = vec3(source.x, mid.x, target.x);\nvec3 y = vec3(source.y, mid.y, target.y);\nreturn vec2(bezier3(x ,t), bezier3(y,t));\n}else {\nif(abs(angularDist - PI) < 0.001) {\nreturn (1.0 - t) * source + t * target;\n}\nfloat a = sin((1.0 - t) * angularDist) / sin(angularDist);\nfloat b = sin(t * angularDist) / sin(angularDist);\nvec2 sin_source = sin(source);\nvec2 cos_source = cos(source);\nvec2 sin_target = sin(target);\nvec2 cos_target = cos(target);\nfloat x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\nfloat y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\nfloat z = a * sin_source.y + b * sin_target.y;\nreturn vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n}\n}\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nv_color = a_Color;\nvec2 source = radians(a_Instance.rg);\nvec2 target = radians(a_Instance.ba);\nfloat angularDist = getAngularDist(source, target);\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nif(u_line_type == LineTypeDash) {\nv_distance_ratio = segmentIndex / segmentNumber;\nvec2 s = source;\nvec2 t = target;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ns = unProjCustomCoord(source);\nt = unProjCustomCoord(target);\n}\nfloat total_Distance = pixelDistance(s, t) / 2.0 * PI;\ntotal_Distance = total_Distance*8.0;\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n}\nif(u_aimate.x == Animate) {\nv_distance_ratio = segmentIndex / segmentNumber;\n}\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nv_distance_ratio = segmentIndex / segmentNumber;\nvec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));\nvec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));\nv_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\nvec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\nv_segmentIndex = a_Position.x;\nif(LineTexture == u_line_texture) {\nv_arcDistrance = length(source - target);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\nv_arcDistrance = v_arcDistrance * 1000000.0;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nv_arcDistrance = project_pixel_allmap(v_arcDistrance);\n}\nv_pixelLen = project_pixel(u_icon_step)/8.0;\nv_a = project_pixel(a_Size);\nv_offset = offset + offset * sign(a_Position.y);\nv_iconMapUV = a_iconMapUV;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\nvarying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\nvarying vec4 v_color;\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float segmentNumber;\nvarying float v_segmentIndex;\nvarying float v_arcDistrance;\nvarying float v_pixelLen;\nvarying vec2 v_offset;\nvarying float v_a;\nvarying vec2 v_iconMapUV;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\n#pragma include "project"\n#pragma include "projection"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat animateSpeed = 0.0;\nif(u_linearColor == 1.0) {\ngl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);\n} else {\ngl_FragColor = v_color;\n}\ngl_FragColor.a *= opacity;\nif(u_line_type == LineTypeDash) {\nfloat flag = 0.;\nfloat dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\nif(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\nflag = 1.;\n}\ngl_FragColor.a *=flag;\n}\nif(u_aimate.x == Animate) {\nanimateSpeed = u_time / u_aimate.y;\nfloat alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);\nalpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\nalpha = smoothstep(0., 1., alpha);\ngl_FragColor.a *= alpha;\n}\nif(LineTexture == u_line_texture && u_line_type != LineTypeDash) {\nfloat arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / (segmentNumber - 1.0)));\nfloat count = floor(v_arcDistrance/v_pixelLen);\nfloat u = fract(arcRadio * count - animateSpeed * count);\nif(u_aimate.x == Animate) {\nu = gl_FragColor.a/opacity;\n}\nfloat v = length(v_offset)/(v_a);\nvec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\nvec4 pattern = texture2D(u_texture, uv);\nif(u_textureBlend == 0.0) {\npattern.a = 0.0;\ngl_FragColor = filterColor(gl_FragColor + pattern);\n} else {\npattern.a *= opacity;\nif(gl_FragColor.a <= 0.0) {\npattern.a = 0.0;\n}\ngl_FragColor = filterColor(pattern);\n}\n} else {\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',triangulation:FI,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:e.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:4,update:function(e,t,n,r){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,n,r,i){var o=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[o.x,o.y]}}})}}]),r}(IO),rP={solid:0,dash:1},iP=function(t){mr(r,t);var n=Er(r);function r(){var t;dr(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return gr(Ar(t=n.call.apply(n,[this].concat(o))),"texture",void 0),gr(Ar(t),"updateTexture",(function(){var n=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=n({data:t.iconService.getCanvas(),mag:e.gl.NEAREST,min:e.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return vr(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=t.sourceColor,i=t.targetColor,o=t.textureBlend,a=void 0===o?"normal":o,s=t.lineType,u=void 0===s?"solid":s,c=t.dashArray,l=void 0===c?[10,5,0,0]:c,f=t.lineTexture,h=void 0!==f&&f,d=t.iconStep,p=void 0===d?100:d;2===l.length&&l.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var v=0,g=[0,0,0,0],m=[0,0,0,0];if(r&&i&&(g=od(r),m=od(i),v=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var y=this.layer.getEncodedData(),b=this.calDataFrame(this.cellLength,y,this.cellProperties),_=b.data,x=b.width,S=b.height;this.rowCount=S,this.dataTexture=this.cellLength>0&&_.length>0?this.createTexture2D({flipY:!0,data:_,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:x,height:S}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pk(n)?n:1,u_textureBlend:"normal"===a?0:1,u_line_type:rP[u],u_dash_array:l,u_texture:this.texture,u_line_texture:h?1:0,u_icon_step:p,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:v,u_sourceColor:g,u_targetColor:m}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.dataTexture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute vec2 a_iconMapUV;\nattribute float a_Total_Distance;\nattribute float a_Distance;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\n#pragma include "projection"\n#pragma include "picking"\nvarying vec4 v_color;\nvarying vec4 v_dash_array;\nvarying vec2 v_normal;\nvarying float v_distance_ratio;\nvarying float v_side;\nvarying float v_distance;\nvarying vec2 v_offset;\nvarying float v_size;\nvarying float v_a;\nvarying float v_pixelLen;\nvarying vec2 v_iconMapUV;\nuniform float u_linearColor: 0;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nv_iconMapUV = a_iconMapUV;\nv_distance = a_Distance;\nv_pixelLen = project_pixel(u_icon_step);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nv_pixelLen *= 10.0;\n}\nif(u_line_type == LineTypeDash) {\nv_distance_ratio = a_Distance / a_Total_Distance;\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;\n}\nif(u_aimate.x == Animate || u_linearColor == 1.0) {\nv_distance_ratio = a_Distance / a_Total_Distance;\n}\nv_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));\nv_color = a_Color;\nv_a = project_pixel(a_Size.x);\nvec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\nvec2 offset = project_pixel(size.xy);\nv_offset = offset + offset * sign(a_Miter);\nv_side = a_Miter * a_Size.x;\nvec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0, 1.0));\n} else {\nfloat lineHeight = a_Size.y;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nlineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);\n}\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_blur : 0.99;\nuniform float u_line_type: 0.0;\nuniform float u_opacity : 1.0;\nuniform float u_textureBlend;\nvarying vec4 v_color;\nvarying vec2 v_normal;\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float u_dash_offset : 0.0;\nuniform float u_dash_ratio : 0.1;\nvarying float v_distance_ratio;\nvarying vec4 v_dash_array;\nvarying float v_side;\nvarying float v_distance;\nvarying vec2 v_offset;\nvarying float v_a;\nvarying float v_pixelLen;\nvarying vec2 v_iconMapUV;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n#pragma include "picking"\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying mat4 styleMappingMat;\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat animateSpeed = 0.0;\nif(u_linearColor == 1.0) {\ngl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);\n} else {\ngl_FragColor = v_color;\n}\ngl_FragColor.a *= opacity;\nif(u_aimate.x == Animate) {\nanimateSpeed = u_time / u_aimate.y;\nfloat alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);\nalpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\nalpha = smoothstep(0., 1., alpha);\ngl_FragColor.a *= alpha;\n}\nif(u_line_type == LineTypeDash) {\nfloat flag = 0.;\nfloat dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\nif(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\nflag = 1.;\n}\ngl_FragColor.a *=flag;\n}\nif(u_line_texture == LineTexture && u_line_type != LineTypeDash) {\nfloat u = fract(mod(v_distance, v_pixelLen)/v_pixelLen - animateSpeed);\nfloat v = length(v_offset)/(v_a*2.0);\nv = max(smoothstep(0.95, 1.0, v), v);\nvec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\nvec4 pattern = texture2D(u_texture, uv);\nif(u_textureBlend == 0.0) {\npattern.a = 0.0;\ngl_FragColor = filterColor(gl_FragColor + pattern);\n} else {\npattern.a *= opacity;\nif(gl_FragColor.a <= 0.0) {\npattern.a = 0.0;\n}\ngl_FragColor = filterColor(pattern);\n}\n} else {\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',triangulation:PI,primitive:e.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.layer.getLayerConfig().lineType;this.styleAttributeService.registerStyleAttribute({name:"distance",type:e.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:e.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){var i=e.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0],o[1]]:[o,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:e.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,n,r,i){var o=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[o.x,o.y]}}})}},{key:"loadImage",value:function(e){return new Promise((function(t,n){if(e instanceof HTMLImageElement)t(e);else{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t(r)},r.onerror=function(){n(new Error("Could not load image at "+e))},r.src=e instanceof File?URL.createObjectURL(e):e}}))}}]),r}(IO),oP={arc:JI,arc3d:eP,greatcircle:nP,line:iP},aP=function(e){mr(n,e);var t=Er(n);function n(){var e;dr(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return gr(Ar(e=t.call.apply(t,[this].concat(i))),"type","LineLayer"),e}return vr(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new oP[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"}}[this.getModelType()]}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape");return(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"line"}}]),n}(Wk),sP=function(t){mr(r,t);var n=Er(r);function r(){return dr(this,r),n.apply(this,arguments)}return vr(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig().opacity,n=void 0===t?1:t;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var r=this.layer.getEncodedData(),i=this.calDataFrame(this.cellLength,r,this.cellProperties),o=i.data,a=i.width,s=i.height;this.rowCount=s,this.dataTexture=this.cellLength>0&&o.length>0?this.createTexture2D({flipY:!0,data:o,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:a,height:s}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pk(n)?n:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:'precision highp float;\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\nuniform float u_opacity : 1;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec3 size = a_Size * a_Position;\nvec2 offset = project_pixel(size.xy);\nvec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\nvec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);\nfloat lightWeight = calc_lighting(pos);\nv_color =vec4(a_Color.rgb * lightWeight, a_Color.w);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * pos;\n} else {\ngl_Position = project_common_position_to_clipspace(pos);\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'varying vec4 v_color;\nuniform float u_opacity: 1.0;\n#pragma include "picking"\nvarying mat4 styleMappingMat;\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\ngl_FragColor = v_color;\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:OI,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r){var i=e.size;if(i){var o=[];return Array.isArray(i)&&(o=2===i.length?[i[0],i[0],i[1]]:i),Array.isArray(i)||(o=[i]),o}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:e.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t){var n=yI(e.coordinates);return[n[0],n[1],0]}}})}}]),r}(IO),uP=function(t){mr(r,t);var n=Er(r);function r(){return dr(this,r),n.apply(this,arguments)}return vr(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.strokeOpacity,o=void 0===i?1:i,a=t.strokeWidth,s=void 0===a?0:a,u=t.stroke,c=void 0===u?"rgba(0,0,0,0)":u,l=t.offsets,f=void 0===l?[0,0]:l;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r,strokeOpacity:o,strokeWidth:s,stroke:c,offsets:f})){this.judgeStyleAttributes({opacity:r,strokeOpacity:o,strokeWidth:s,stroke:c,offsets:f});var h=this.layer.getEncodedData(),d=this.calDataFrame(this.cellLength,h,this.cellProperties),p=d.data,v=d.width,g=d.height;this.rowCount=g,this.dataTexture=this.cellLength>0&&p.length>0?this.createTexture2D({flipY:!0,data:p,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:v,height:g}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pk(r)?r:1,u_stroke_opacity:Pk(o)?o:1,u_stroke_width:Pk(s)?s:0,u_stroke_color:this.getStrokeColor(c),u_offsets:this.isOffsetStatic(f)?f:[0,0]}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),kI)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec2 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\nvarying mat4 styleMappingMat;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\nuniform vec2 u_offsets;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalStrokeOpacity"\n#pragma include "styleMappingCalStrokeWidth"\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nvec2 extrude = a_Extrude;\nfloat shape_type = a_Shape;\nfloat newSize = setPickingSize(a_Size);\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][1] = strokeOpacityAndOffset.r;\ntextureOffset = strokeOpacityAndOffset.g;\nvec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][2] = strokeWidthAndOffset.r;\ntextureOffset = strokeWidthAndOffset.g;\nvec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);\nif(hasStroke()) {\nvec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\n} else {\nif(u_stroke_color == vec4(0.0)) {\nstyleMappingMat[1][0] = v_color.r;\nstyleMappingMat[1][1] = v_color.g;\nstyleMappingMat[1][2] = v_color.b;\nstyleMappingMat[1][3] = v_color.a;\n} else {\nstyleMappingMat[1][0] = u_stroke_color.r;\nstyleMappingMat[1][1] = u_stroke_color.g;\nstyleMappingMat[1][2] = u_stroke_color.b;\nstyleMappingMat[1][3] = u_stroke_color.a;\n}\n}\nvec2 textrueOffsets = vec2(0.0, 0.0);\nif(hasOffsets()) {\nvec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\n} else {\ntextrueOffsets = u_offsets;\n}\nv_color = a_Color;\nv_radius = newSize;\nfloat antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);\nv_data = vec4(extrude, antialiasblur,shape_type);\nvec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + textrueOffsets);\nvec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'#define Animate 0.0\nuniform float u_blur : 0;\nvarying mat4 styleMappingMat;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\n#pragma include "sdf_2d"\n#pragma include "picking"\nvoid main() {\nint shape = int(floor(v_data.w + 0.5));\nvec4 textrueStroke = vec4(\nstyleMappingMat[1][0],\nstyleMappingMat[1][1],\nstyleMappingMat[1][2],\nstyleMappingMat[1][3]\n);\nfloat opacity = styleMappingMat[0][0];\nfloat stroke_opacity = styleMappingMat[0][1];\nfloat strokeWidth = styleMappingMat[0][2];\nvec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;\nlowp float antialiasblur = v_data.z;\nfloat antialiased_blur = -max(u_blur, antialiasblur);\nfloat r = v_radius / (v_radius + strokeWidth);\nfloat outer_df;\nfloat inner_df;\nif (shape == 0) {\nouter_df = sdCircle(v_data.xy, 1.0);\ninner_df = sdCircle(v_data.xy, r);\n} else if (shape == 1) {\nouter_df = sdEquilateralTriangle(1.1 * v_data.xy);\ninner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n} else if (shape == 2) {\nouter_df = sdBox(v_data.xy, vec2(1.));\ninner_df = sdBox(v_data.xy, vec2(r));\n} else if (shape == 3) {\nouter_df = sdPentagon(v_data.xy, 0.8);\ninner_df = sdPentagon(v_data.xy, r * 0.8);\n} else if (shape == 4) {\nouter_df = sdHexagon(v_data.xy, 0.8);\ninner_df = sdHexagon(v_data.xy, r * 0.8);\n} else if (shape == 5) {\nouter_df = sdOctogon(v_data.xy, 1.0);\ninner_df = sdOctogon(v_data.xy, r);\n} else if (shape == 6) {\nouter_df = sdHexagram(v_data.xy, 0.52);\ninner_df = sdHexagram(v_data.xy, r * 0.52);\n} else if (shape == 7) {\nouter_df = sdRhombus(v_data.xy, vec2(1.0));\ninner_df = sdRhombus(v_data.xy, vec2(r));\n} else if (shape == 8) {\nouter_df = sdVesica(v_data.xy, 1.1, 0.8);\ninner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n}\nfloat opacity_t = smoothstep(0.0, antialiased_blur, outer_df);\nfloat color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,\n0.0,\ninner_df\n);\nfloat PI = 3.14159;\nfloat N_RINGS = 3.0;\nfloat FREQ = 1.0;\ngl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);\ngl_FragColor.a = gl_FragColor.a * opacity_t;\nif(u_aimate.x == Animate) {\nfloat d = length(v_data.xy);\nfloat intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);\ngl_FragColor = vec4(gl_FragColor.xyz, intensity);\n}\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:kI,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:e.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){var i=[1,1,-1,1,-1,-1,1,-1],o=r%4*2;return[i[o],i[o+1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,o=void 0===i?5:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:e.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,n,r,i){var o=e.shape,a=void 0===o?2:o;return[t.layer.getLayerConfig().shape2d.indexOf(a)]}}})}}]),r}(IO),cP='uniform sampler2D u_texture;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform vec2 u_textSize;\nuniform float u_opacity : 1;\nvarying mat4 styleMappingMat;\nvarying float v_size;\n#pragma include "picking"\nvoid main(){\nfloat opacity = styleMappingMat[0][0];\nvec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;\nvec4 textureColor=texture2D(u_texture,pos);\nif(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){\ngl_FragColor= textureColor;\n}else {\ngl_FragColor= step(0.01, textureColor.z) * v_color;\n}\ngl_FragColor.a =gl_FragColor.a * opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',lP='precision highp float;\nattribute vec3 a_Position;\nattribute vec4 a_Color;\nattribute vec2 a_Uv;\nattribute float a_Size;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_stroke_width : 1;\nuniform vec2 u_offsets;\nvarying float v_size;\nuniform float u_opacity : 1;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec2 textrueOffsets = vec2(0.0, 0.0);\nif(hasOffsets()) {\nvec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\n} else {\ntextrueOffsets = u_offsets;\n}\nv_color = a_Color;\nv_uv = a_Uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nv_size = a_Size;\nvec2 offset = project_pixel(textrueOffsets);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));\n}\ngl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\nsetPickingColor(a_PickingColor);\n}',fP=function(t){mr(r,t);var n=Er(r);function r(){var e;dr(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return gr(Ar(e=n.call.apply(n,[this].concat(i))),"texture",void 0),e}return vr(r,[{key:"getUninforms",value:function(){return{u_opacity:this.layer.getLayerConfig().opacity||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var t=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",(function(){t.updateTexture(),t.layer.render()})),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:lP,fragmentShader:cP,triangulation:II,primitive:e.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size;return Array.isArray(i)?[i[0]]:[i]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,n,r,i){var o=t.fontService.mapping,a=e.shape,s=o[t.fontService.getGlyph(a)];return[s.x,s.y]}}})}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,n=this.fontService.canvas;this.texture=t({data:n,mag:e.gl.LINEAR,min:e.gl.LINEAR,width:n.width,height:n.height})}},{key:"initIconFontGlyphs",value:function(){var e=this,t=this.layer.getLayerConfig(),n=t.fontWeight,r=void 0===n?"normal":n,i=t.fontFamily,o=void 0===i?"sans-serif":i,a=this.layer.getEncodedData(),s=[];a.forEach((function(t){var n=t.shape,r=void 0===n?"":n;r=r.toString();var i=e.fontService.getGlyph(r);-1===s.indexOf(i)&&s.push(i)})),this.fontService.setFontOptions({characterSet:s,fontWeight:r,fontFamily:o,fontSize:48})}}]),r}(IO),hP=function(t){mr(r,t);var n=Er(r);function r(){var t;dr(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return gr(Ar(t=n.call.apply(n,[this].concat(o))),"texture",void 0),gr(Ar(t),"updateTexture",(function(){var n=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=n({data:t.iconService.getCanvas(),mag:e.gl.NEAREST,min:e.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return vr(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=t.offsets,i=void 0===r?[0,0]:r;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n,offsets:i})){this.judgeStyleAttributes({opacity:n,offsets:i});var o=this.layer.getEncodedData(),a=this.calDataFrame(this.cellLength,o,this.cellProperties),s=a.data,u=a.width,c=a.height;this.rowCount=c,this.dataTexture=this.cellLength>0&&s.length>0?this.createTexture2D({flipY:!0,data:s,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:u,height:c}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Pk(n)?n:1,u_offsets:this.isOffsetStatic(i)?i:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.dataTexture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:lP,fragmentShader:cP,triangulation:II,primitive:e.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,o=void 0===i?5:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,n,r,i){var o=t.iconService.getIconMap()[e.shape]||{x:0,y:0};return[o.x,o.y]}}})}}]),r}(IO);function dP(e){var t=e.coordinates;return{vertices:kr(t),indices:[0],size:t.length}}var pP=function(t){mr(r,t);var n=Er(r);function r(){return dr(this,r),n.apply(this,arguments)}return vr(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.offsets,o=void 0===i?[0,0]:i;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r,offsets:o})){this.judgeStyleAttributes({opacity:r,offsets:o});var a=this.layer.getEncodedData(),s=this.calDataFrame(this.cellLength,a,this.cellProperties),u=s.data,c=s.width,l=s.height;this.rowCount=l,this.dataTexture=this.cellLength>0&&u.length>0?this.createTexture2D({flipY:!0,data:u,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:c,height:l}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pk(r)?r:1,u_offsets:this.isOffsetStatic(o)?o:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:'attribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\nvarying vec4 v_color;\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "project"\nvoid main() {\nv_color = a_Color;\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec2 textrueOffsets = vec2(0.0, 0.0);\nif(hasOffsets()) {\nvec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\n} else {\ntextrueOffsets = u_offsets;\n}\nvec2 offset = project_pixel(textrueOffsets);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);\n} else {\nvec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\ngl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\n}\ngl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform float u_opacity : 1;\nuniform vec2 u_offsets;\nvarying vec4 v_color;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\ngl_FragColor = v_color;\ngl_FragColor.a =gl_FragColor.a * opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:dP,depth:{enable:!1},primitive:e.gl.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:e.BlendType.additive}}}]),r}(IO),vP=function(){function e(t,n,r){dr(this,e),gr(this,"boxCells",[]),gr(this,"xCellCount",void 0),gr(this,"yCellCount",void 0),gr(this,"boxKeys",void 0),gr(this,"bboxes",void 0),gr(this,"width",void 0),gr(this,"height",void 0),gr(this,"xScale",void 0),gr(this,"yScale",void 0),gr(this,"boxUid",void 0);var i=this.boxCells;this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(n/r);for(var o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0}return vr(e,[{key:"insert",value:function(e,t,n,r,i){this.forEachCell(t,n,r,i,this.insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}},{key:"query",value:function(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!1,i)}},{key:"hitTest",value:function(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!0,i)}},{key:"insertBoxCell",value:function(e,t,n,r,i,o){this.boxCells[i].push(o)}},{key:"queryHitTest",value:function(e,t,n,r,i,o){if(n<0||e>this.width||r<0||t>this.height)return!i&&[];var a=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});return o?a.filter(o):a}var u={hitTest:i,seenUids:{box:{},circle:{}}};return this.forEachCell(e,t,n,r,this.queryCell,a,u,o),i?a.length>0:a}},{key:"queryCell",value:function(e,t,n,r,i,o,a,s){var u=a.seenUids,c=this.boxCells[i];if(null!==c){var l,f=this.bboxes,h=Pr(c);try{for(h.s();!(l=h.n()).done;){var d=l.value;if(!u.box[d]){u.box[d]=!0;var p=4*d;if(e<=f[p+2]&&t<=f[p+3]&&n>=f[p+0]&&r>=f[p+1]&&(!s||s(this.boxKeys[d]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[d],x1:f[p],y1:f[p+1],x2:f[p+2],y2:f[p+3]})}}}}catch(e){h.e(e)}finally{h.f()}}return!1}},{key:"forEachCell",value:function(e,t,n,r,i,o,a,s){for(var u=this.convertToXCellCoord(e),c=this.convertToYCellCoord(t),l=this.convertToXCellCoord(n),f=this.convertToYCellCoord(r),h=u;h<=l;h++)for(var d=c;d<=f;d++){var p=this.xCellCount*d+h;if(i.call(this,e,t,n,r,p,o,a,s))return}}},{key:"convertToXCellCoord",value:function(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}},{key:"convertToYCellCoord",value:function(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}}]),e}(),gP=function(){function e(t,n){dr(this,e),gr(this,"width",void 0),gr(this,"height",void 0),gr(this,"grid",void 0),gr(this,"viewportPadding",100),gr(this,"screenRightBoundary",void 0),gr(this,"screenBottomBoundary",void 0),gr(this,"gridRightBoundary",void 0),gr(this,"gridBottomBoundary",void 0),this.width=t,this.height=n,this.viewportPadding=Math.max(t,n),this.grid=new vP(t+this.viewportPadding,n+this.viewportPadding,25),this.screenRightBoundary=t+this.viewportPadding,this.screenBottomBoundary=n+this.viewportPadding,this.gridRightBoundary=t+2*this.viewportPadding,this.gridBottomBoundary=n+2*this.viewportPadding}return vr(e,[{key:"placeCollisionBox",value:function(e){var t=e.x1+e.anchorPointX+this.viewportPadding,n=e.y1+e.anchorPointY+this.viewportPadding,r=e.x2+e.anchorPointX+this.viewportPadding,i=e.y2+e.anchorPointY+this.viewportPadding;return!this.isInsideGrid(t,n,r,i)||this.grid.hitTest(t,n,r,i)?{box:[]}:{box:[t,n,r,i]}}},{key:"insertCollisionBox",value:function(e,t){var n={featureIndex:t};this.grid.insert(n,e[0],e[1],e[2],e[3])}},{key:"project",value:function(e,t,n){var r=og(t,n,0,1),i=ig();return ag(i,r,gv.apply(Rv,kr(e))),{x:(i[0]/i[3]+1)/2*this.width+this.viewportPadding,y:(-i[1]/i[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(e,t,n,r){return n>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}}]),e}();function mP(e){var t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0;break;default:t=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0;break;default:n=.5}return{horizontalAlign:t,verticalAlign:n}}function yP(e,t,n,r,i){if(i){var o=e[r],a=o.glyph;if(a)for(var s=t[a].advance*o.scale,u=(e[r].x+s)*i,c=n;c<=r;c++)e[c].x-=u}}function bP(e,t,n,r,i,o,a){var s,u=(t-n)*i,c=(-r*a+.5)*o,l=Pr(e);try{for(l.s();!(s=l.n()).done;){var f=s.value;f.x+=u,f.y+=c}}catch(e){l.e(e)}finally{l.f()}}function _P(e,t,n,r,i,o,a){var s=0,u=-8,c=0,l=e.positionedGlyphs,f="right"===o?1:"left"===o?0:.5,h=l.length;n.forEach((function(e){if(e.split("").forEach((function(e){var n=t[e];n&&(l.push({glyph:e,x:s,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a)})),l.length!==h){var n=s-a;c=Math.max(n,c),yP(l,t,h,l.length-1,f)}s=0,u+=r}));var d=mP(i),p=d.horizontalAlign,v=d.verticalAlign;bP(l,f,p,v,c,r,n.length);var g=u- -8;e.top+=-v*g,e.bottom=e.top+g,e.left+=-p*c,e.right=e.left+c}function xP(e,t,n,r,i,o,a){var s=0,u=-8,c=0,l=e.positionedGlyphs,f="right"===o?1:"left"===o?0:.5,h=l.length;n.forEach((function(e){var n=t[e];if(n&&(l.push({glyph:e,x:s,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a),l.length!==h){var i=s-a;c=Math.max(i,c),yP(l,t,h,l.length-1,f)}s=0,u+=r}));var d=mP(i),p=d.horizontalAlign,v=d.verticalAlign;bP(l,f,p,v,c,r,n.length);var g=u- -8;e.top+=-v*g,e.bottom=e.top+g,e.left+=-p*c,e.right=e.left+c}var SP='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 48.0\nuniform sampler2D u_sdf_map;\nuniform float u_gamma_scale : 0.5;\nuniform float u_opacity : 1.0;\nuniform vec4 u_stroke_color : [0, 0, 0, 1];\nuniform float u_stroke_width : 2.0;\nuniform float u_halo_blur : 0.5;\nuniform float u_DevicePixelRatio;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying float v_fontScale;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat strokeWidth = styleMappingMat[0][2];\nvec4 textrueStroke = vec4(\nstyleMappingMat[1][0],\nstyleMappingMat[1][1],\nstyleMappingMat[1][2],\nstyleMappingMat[1][3]\n);\nfloat dist = texture2D(u_sdf_map, v_uv).a;\nlowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;\nhighp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\nhighp float gamma_scaled = gamma * v_gamma_scale;\nhighp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\ngl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));\ngl_FragColor.a= gl_FragColor.a * alpha;\ngl_FragColor = filterColor(gl_FragColor);\n}',wP='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 24.0\nattribute vec3 a_Position;\nattribute vec2 a_tex;\nattribute vec2 a_textOffsets;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute float a_Rotate;\nuniform vec2 u_sdf_map_size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying vec4 v_color;\nvarying float v_fontScale;\nvarying mat4 styleMappingMat;\nuniform float u_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalStrokeWidth"\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][2] = strokeWidthAndOffset.r;\ntextureOffset = strokeWidthAndOffset.g;\nvec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);\nif(hasStroke()) {\nvec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\n} else {\nif(u_stroke_color == vec4(0.0)) {\nstyleMappingMat[1][0] = v_color.r;\nstyleMappingMat[1][1] = v_color.g;\nstyleMappingMat[1][2] = v_color.b;\nstyleMappingMat[1][3] = v_color.a;\n} else {\nstyleMappingMat[1][0] = u_stroke_color.r;\nstyleMappingMat[1][1] = u_stroke_color.g;\nstyleMappingMat[1][2] = u_stroke_color.b;\nstyleMappingMat[1][3] = u_stroke_color.a;\n}\n}\nv_color = a_Color;\nv_uv = a_tex / u_sdf_map_size;\nfloat fontScale = a_Size / FONT_SIZE;\nv_fontScale = fontScale;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nhighp float angle_sin = sin(a_Rotate);\nhighp float angle_cos = cos(a_Rotate);\nmat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\nvec4 projected_position;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nprojected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));\n} else {\nprojected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\ngl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\nv_gamma_scale = gl_Position.w;\nsetPickingColor(a_PickingColor);\n}';function AP(e){var t=e.id,n=[],r=[];if(!this.glyphInfoMap||!this.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var i=this.glyphInfoMap[t].centroid,o=2===i.length?[i[0],i[1],0]:i;return this.glyphInfoMap[t].glyphQuads.forEach((function(e,t){n.push.apply(n,kr(o).concat([e.tex.x,e.tex.y+e.tex.height,e.tl.x,e.tl.y],kr(o),[e.tex.x+e.tex.width,e.tex.y+e.tex.height,e.tr.x,e.tr.y],kr(o),[e.tex.x+e.tex.width,e.tex.y,e.br.x,e.br.y],kr(o),[e.tex.x,e.tex.y,e.bl.x,e.bl.y])),r.push(0+4*t,1+4*t,2+4*t,2+4*t,3+4*t,0+4*t)})),{vertices:n,indices:r,size:7}}var TP=function(t){mr(r,t);var n=Er(r);function r(){var e;dr(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return gr(Ar(e=n.call.apply(n,[this].concat(i))),"glyphInfo",void 0),gr(Ar(e),"glyphInfoMap",{}),gr(Ar(e),"texture",void 0),gr(Ar(e),"currentZoom",-1),gr(Ar(e),"extent",void 0),gr(Ar(e),"textureHeight",0),gr(Ar(e),"textCount",0),gr(Ar(e),"preTextStyle",{}),gr(Ar(e),"buildModels",(function(){return e.initGlyph(),e.updateTexture(),e.filterGlyphs(),e.reBuildModel(),[e.layer.buildLayerModel({moduleName:"pointText",vertexShader:wP,fragmentShader:SP,triangulation:AP.bind(Ar(e)),depth:{enable:!1},blend:e.getBlend()})]})),e}return vr(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.stroke,o=void 0===i?"#fff":i,a=t.strokeWidth,s=void 0===a?0:a,u=t.textAnchor,c=void 0===u?"center":u,l=t.textAllowOverlap,f=void 0!==l&&l,h=t.halo,d=void 0===h?.5:h,p=t.gamma,v=void 0===p?2:p,g=this.fontService,m=g.canvas,y=g.mapping;if(Object.keys(y).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(y).length),this.preTextStyle={textAnchor:c,textAllowOverlap:f},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r,strokeWidth:s,stroke:o})){this.judgeStyleAttributes({opacity:r,strokeWidth:s,stroke:o});var b=this.layer.getEncodedData(),_=this.calDataFrame(this.cellLength,b,this.cellProperties),x=_.data,S=_.width,w=_.height;this.rowCount=w,this.dataTexture=this.cellLength>0&&x.length>0?this.createTexture2D({flipY:!0,data:x,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:S,height:w}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pk(r)?r:1,u_stroke_width:Pk(s)?s:0,u_stroke_color:this.getStrokeColor(o),u_sdf_map:this.texture,u_halo_blur:d,u_gamma_scale:v,u_sdf_map_size:[m.width,m.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var e=this.layer.getLayerConfig(),t=e.textAnchor,n=void 0===t?"center":t,r=e.textAllowOverlap,i=void 0===r||r;return this.preTextStyle={textAnchor:n,textAllowOverlap:i},this.buildModels()}},{key:"needUpdate",value:function(){var e=this.layer.getLayerConfig().textAllowOverlap,t=void 0!==e&&e,n=this.mapService.getZoom(),r=this.mapService.getBounds(),i=_h(this.extent,r);return(!t&&(Math.abs(this.currentZoom-n)>1||!i)||t!==this.preTextStyle.textAllowOverlap)&&(this.reBuildModel(),!0)}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:e.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.rotate,o=void 0===i?0:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:e.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){return[n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,o=void 0===i?12:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:e.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){return[n[3],n[4]]}}})}},{key:"textExtent",value:function(){return bh(this.mapService.getBounds(),.5)}},{key:"initTextFont",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r,o=this.layer.getEncodedData(),a=[];o.forEach((function(e){var t,n=e.shape,r=void 0===n?"":n,i=Pr(r=r.toString());try{for(i.s();!(t=i.n()).done;){var o=t.value;-1===a.indexOf(o)&&a.push(o)}}catch(e){i.e(e)}finally{i.f()}})),this.fontService.setFontOptions({characterSet:a,fontWeight:n,fontFamily:i,iconfont:!1})}},{key:"initIconFontTex",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r,o=this.layer.getEncodedData(),a=[];o.forEach((function(e){var t=e.shape,n=void 0===t?"":t;n=n.toString(),-1===a.indexOf(n)&&a.push(n)})),this.fontService.setFontOptions({characterSet:a,fontWeight:n,fontFamily:i,iconfont:!0})}},{key:"generateGlyphLayout",value:function(e){var t=this,n=this.fontService.mapping,r=this.layer.getLayerConfig(),i=r.spacing,o=void 0===i?2:i,a=r.textAnchor,s=void 0===a?"center":a,u=this.layer.getEncodedData();this.glyphInfo=u.map((function(r){var i=r.shape,a=void 0===i?"":i,u=r.id,c=r.size,l=void 0===c?1:c,f=r.textOffset,h=void 0===f?[0,0]:f,d=function(e,t,n,r,i,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0],s=arguments.length>7?arguments[7]:void 0,u=e.split("\n"),c=[],l={positionedGlyphs:c,top:a[1],bottom:a[1],left:a[0],right:a[0],lineCount:u.length,text:e};return s?xP(l,t,u,n,r,i,o):_P(l,t,u,n,r,i,o),!!c.length&&l}(a.toString(),n,l,s,"center",o,h,e),p=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,i=e.positionedGlyphs,o=void 0===i?[]:i,a=[],s=Pr(o);try{for(s.s();!(t=s.n()).done;){var u=t.value,c=u.metrics,l=4,f=c.advance*u.scale/2,h=r?[u.x+f,u.y]:[0,0],d=r?[0,0]:[u.x+f+n[0],u.y+n[1]],p=(0-l)*u.scale-f+d[0],v=(0-l)*u.scale+d[1],g=p+c.width*u.scale,m=v+c.height*u.scale,y={x:p,y:v},b={x:g,y:v},_={x:p,y:m},x={x:g,y:m};a.push({tl:y,tr:b,bl:_,br:x,tex:c,glyphOffset:h})}}catch(e){s.e(e)}finally{s.f()}return a}(d,h,!1);return r.shaping=d,r.glyphQuads=p,r.centroid=yI(r.coordinates),r.originCentroid="GAODE2.x"===r.version?yI(r.originCoordinates):r.originCentroid=r.centroid,t.glyphInfoMap[u]={shaping:d,glyphQuads:p,centroid:yI(r.coordinates)},r}))}},{key:"filterGlyphs",value:function(){var e=this,t=this.layer.getLayerConfig(),n=t.padding,r=void 0===n?[4,4]:n,i=t.textAllowOverlap;if(!(void 0!==i&&i)){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var o=this.rendererService.getViewportSize(),a=o.width,s=o.height,u=new gP(a,s);this.glyphInfo.filter((function(t){var n=t.shaping,i=t.id,o=void 0===i?0:i,a="GAODE2.x"===t.version?t.originCentroid:t.centroid,s=t.size/24,c=e.mapService.lngLatToContainer(a),l=u.placeCollisionBox({x1:n.left*s-r[0],x2:n.right*s+r[0],y1:n.top*s-r[1],y2:n.bottom*s+r[1],anchorPointX:c.x,anchorPointY:c.y}).box;return!(!l||!l.length)&&(u.insertCollisionBox(l,o),!0)})).forEach((function(t){e.glyphInfoMap[t.id]=t}))}}},{key:"initGlyph",value:function(){var e=this.layer.getLayerConfig().iconfont,t=void 0!==e&&e;t?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(t)}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,n=this.fontService.canvas;this.textureHeight=n.height,this.texture&&this.texture.destroy(),this.texture=t({data:n,mag:e.gl.LINEAR,min:e.gl.LINEAR,width:n.width,height:n.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:wP,fragmentShader:SP,triangulation:AP.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),r}(IO),EP={fill:uP,image:hP,normal:pP,extrude:sP,text:TP,icon:fP},CP=function(e){mr(n,e);var t=Er(n);function n(){var e;dr(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return gr(Ar(e=t.call.apply(t,[this].concat(i))),"type","PointLayer"),e}return vr(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new EP[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}}[this.getModelType()]}},{key:"getModelType",value:function(){var e=this.getEncodedData(),t=this.getLayerConfig(),n=t.shape2d,r=t.shape3d,i=this.iconService.getIconMap(),o=e.find((function(e){return e.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"normal":-1!==(null==n?void 0:n.indexOf(a))?"fill":-1!==(null==r?void 0:r.indexOf(a))?"extrude":i.hasOwnProperty(a)?"image":""!==this.fontService.getGlyph(a)?"icon":"text"}return"normal"}}]),n}(Wk),MP=function(t){mr(r,t);var n=Er(r);function r(){return dr(this,r),n.apply(this,arguments)}return vr(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig().opacity,n=void 0===t?1:t;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var r=this.layer.getEncodedData(),i=this.calDataFrame(this.cellLength,r,this.cellProperties),o=i.data,a=i.width,s=i.height;this.rowCount=s,this.dataTexture=this.cellLength>0&&o.length>0?this.createTexture2D({flipY:!0,data:o,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:a,height:s}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pk(n)?n:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:'precision highp float;\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_Color;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\nvec4 project_pos = project_position(pos);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nfloat lightWeight = calc_lighting(pos);\nv_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform float u_opacity: 1.0;\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\ngl_FragColor = v_Color;\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:RI})]}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,o=void 0===i?10:i;return Array.isArray(o)?[o[0]]:[o]}}})}}]),r}(IO),kP={fill:function(t){mr(r,t);var n=Er(r);function r(){return dr(this,r),n.apply(this,arguments)}return vr(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig().opacity,n=void 0===t?1:t;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var r=this.layer.getEncodedData(),i=this.calDataFrame(this.cellLength,r,this.cellProperties),o=i.data,a=i.width,s=i.height;this.rowCount=s,this.dataTexture=this.cellLength>0&&o.length>0?this.createTexture2D({flipY:!0,data:o,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:a,height:s}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pk(n)?n:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_Color;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nv_Color = a_Color;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform float u_opacity: 1.0;\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\ngl_FragColor = v_Color;\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:LI,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),r}(IO),line:iP,extrude:MP,text:TP,point_fill:uP,point_image:hP,point_normal:pP,point_extrude:sP},OP=function(e){mr(n,e);var t=Er(n);function n(){var e;dr(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return gr(Ar(e=t.call.apply(t,[this].concat(i))),"type","PolygonLayer"),e}return vr(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new kP[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==t||null===(e=t.scale)||void 0===e?void 0:e.field;return"fill"===n?"fill":"extrude"===n?"extrude":"line"===n?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var e=this.getEncodedData(),t=this.getLayerConfig(),n=t.shape2d,r=t.shape3d,i=this.iconService.getIconMap(),o=e.find((function(e){return e.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"point_normal":-1!==(null==n?void 0:n.indexOf(a))?"point_fill":-1!==(null==r?void 0:r.indexOf(a))?"point_extrude":i.hasOwnProperty(a)?"point_image":"text"}return"fill"}}]),n}(Wk),IP=function(t){mr(r,t);var n=Er(r);function r(){var e;dr(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return gr(Ar(e=n.call.apply(n,[this].concat(i))),"texture",void 0),gr(Ar(e),"colorTexture",void 0),e}return vr(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.clampLow,i=void 0===r||r,o=e.clampHigh,a=void 0===o||o,s=e.noDataValue,u=void 0===s?-9999999:s,c=e.domain,l=void 0===c?[0,1]:c;return this.updateColorTexure(),{u_opacity:n||1,u_texture:this.texture,u_domain:l,u_clampLow:i,u_clampHigh:void 0!==a?a:i,u_noDataValue:u,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var t=this.layer.getSource(),n=this.rendererService.createTexture2D,r=t.data.dataArray[0];this.texture=n({data:r.data,width:r.width,height:r.height,format:e.gl.LUMINANCE,type:e.gl.FLOAT});var i=ud(this.layer.getLayerConfig().rampColors);return this.colorTexture=n({data:i.data,width:i.width,height:i.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\nv_texCoord = a_Uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n}\n}',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_min;\nuniform float u_max;\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nvarying vec2 v_texCoord;\nvoid main() {\nfloat value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;\nif (value == u_noDataValue)\ngl_FragColor = vec4(0.0, 0, 0, 0.0);\nelse if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))\ngl_FragColor = vec4(0, 0, 0, 0);\nelse {\nfloat normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);\nvec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));\ngl_FragColor = color;\ngl_FragColor.a =  gl_FragColor.a * u_opacity ;\n}\n}",triangulation:DI,primitive:e.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){return[n[3],n[4]]}}})}},{key:"updateColorTexure",value:function(){var e=this.rendererService.createTexture2D,t=ud(this.layer.getLayerConfig().rampColors);this.colorTexture=e({data:t.data,width:t.width,height:t.height,flipY:!1})}}]),r}(IO),PP={raster:IP,raster3d:IP},LP=function(e){mr(n,e);var t=Er(n);function n(){var e;dr(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return gr(Ar(e=t.call.apply(t,[this].concat(i))),"type","RasterLayer"),e}return vr(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new PP[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{raster:{},raster3d:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"raster"}}]),n}(Wk);var RP=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e};var NP=function(e,t){return e&&Ty(t,uO(t),e)};var DP=function(e,t){return e&&Ty(t,Ry(t),e)};var FP=function(e,t){return Ty(e,iO(e),t)},zP=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Jk(t,iO(e)),e=qm(e);return t}:tO;var jP=function(e,t){return Ty(e,zP(e),t)};var UP=function(e){return $k(e,Ry,zP)},BP=Object.prototype.hasOwnProperty;var VP=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&BP.call(e,"index")&&(n.index=e.index,n.input=e.input),n};var HP=function(e,t){var n=t?Vm(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)},GP=/\w*$/;var WP=function(e){var t=new e.constructor(e.source,GP.exec(e));return t.lastIndex=e.lastIndex,t},ZP=Bg?Bg.prototype:void 0,YP=ZP?ZP.valueOf:void 0;var qP=function(e){return YP?Object(YP.call(e)):{}};var XP=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return Vm(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return HP(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Hm(e,n);case"[object Map]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return WP(e);case"[object Set]":return new r;case"[object Symbol]":return qP(e)}};var KP=function(e){return Jm(e)&&"[object Map]"==xO(e)},QP=by&&by.isMap,JP=QP?yy(QP):KP;var $P=function(e){return Jm(e)&&"[object Set]"==xO(e)},eL=by&&by.isSet,tL=eL?yy(eL):$P,nL={};nL["[object Arguments]"]=nL["[object Array]"]=nL["[object ArrayBuffer]"]=nL["[object DataView]"]=nL["[object Boolean]"]=nL["[object Date]"]=nL["[object Float32Array]"]=nL["[object Float64Array]"]=nL["[object Int8Array]"]=nL["[object Int16Array]"]=nL["[object Int32Array]"]=nL["[object Map]"]=nL["[object Number]"]=nL["[object Object]"]=nL["[object RegExp]"]=nL["[object Set]"]=nL["[object String]"]=nL["[object Symbol]"]=nL["[object Uint8Array]"]=nL["[object Uint8ClampedArray]"]=nL["[object Uint16Array]"]=nL["[object Uint32Array]"]=!0,nL["[object Error]"]=nL["[object Function]"]=nL["[object WeakMap]"]=!1;var rL=function e(t,n,r,i,o,a){var s,u=1&n,c=2&n,l=4&n;if(r&&(s=o?r(t,i,o,a):r(t)),void 0!==s)return s;if(!Qg(t))return t;var f=iy(t);if(f){if(s=VP(t),!u)return Gm(t,s)}else{var h=xO(t),d="[object Function]"==h||"[object GeneratorFunction]"==h;if(cy(t))return Um(t,u);if("[object Object]"==h||"[object Arguments]"==h||d&&!o){if(s=c||d?{}:Qm(t),!u)return c?jP(t,DP(s,t)):FP(t,NP(s,t))}else{if(!nL[h])return o?t:{};s=XP(t,h,u)}}a||(a=new Nm);var p=a.get(t);if(p)return p;a.set(t,s),tL(t)?t.forEach((function(i){s.add(e(i,n,r,i,t,a))})):JP(t)&&t.forEach((function(i,o){s.set(o,e(i,n,r,o,t,a))}));var v=f?void 0:(l?c?UP:cO:c?Ry:uO)(t);return RP(v||t,(function(i,o){v&&(i=t[o=i]),Ay(s,o,e(i,n,r,o,t,a))})),s};var iL,oL,aL,sL,uL,cL,lL,fL,hL,dL=function(e){return rL(e,5)},pL=(iL=$(),oL=J(sr.IGlobalConfigService),aL=J(sr.IMapService),sL=J(sr.IFontService),iL((lL=Rr((cL=function(){function e(){dr(this,e),Lr(this,"configService",lL,this),Lr(this,"mapService",fL,this),Lr(this,"fontService",hL,this)}return vr(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tap("DataMappingPlugin",(function(){n.generateMaping(e,{styleAttributeService:r})})),e.hooks.beforeRenderData.tap("DataMappingPlugin",(function(){return e.dataState.dataMappingNeedUpdate=!1,n.generateMaping(e,{styleAttributeService:r}),!0})),e.hooks.beforeRender.tap("DataMappingPlugin",(function(){if(!e.layerModelNeedUpdate){var t=r.getLayerStyleAttributes()||[],i=r.getLayerStyleAttribute("filter"),o=e.getSource().data.dataArray,a=t.filter((function(e){return e.needRemapping})),s=o;null!=i&&i.needRemapping&&null!=i&&i.scale&&(s=o.filter((function(e){return n.applyAttributeMapping(i,e)[0]}))),a.length&&(null!=i&&i.needRemapping?(e.setEncodedData(n.mapping(t,s)),i.needRemapping=!1):e.setEncodedData(n.mapping(a,s,e.getEncodedData())),e.emit("remapping",null))}}))}},{key:"generateMaping",value:function(e,t){var n=this,r=t.styleAttributeService,i=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),a=e.getSource().data.dataArray,s=a;null!=o&&o.scale&&(s=a.filter((function(e){return n.applyAttributeMapping(o,e)[0]}))),e.setEncodedData(this.mapping(i,s))}},{key:"mapping",value:function(e,t,n){var r=this,i=t.map((function(t,i){var o=n?n[i]:{},a=cr({id:t._id,coordinates:t.coordinates},o);return e.filter((function(e){return void 0!==e.scale})).forEach((function(e){var n=r.applyAttributeMapping(e,t);e.needRemapping=!1,"color"===e.name&&(n=n.map((function(e){return od(e)}))),a[e.name]=Array.isArray(n)&&1===n.length?n[0]:n,"shape"===e.name&&(a.shape=r.fontService.getIconFontKey(a[e.name]))})),a}));return i.length>0&&"GAODE2.x"===this.mapService.version&&("number"==typeof i[0].coordinates[0]?i.map((function(e){e.version="GAODE2.x",e.originCoordinates=dL(e.coordinates),e.coordinates=r.mapService.lngLatToCoord(e.coordinates)})):i.map((function(e){e.version="GAODE2.x",e.originCoordinates=dL(e.coordinates),e.coordinates=r.mapService.lngLatToCoords(e.coordinates)}))),i}},{key:"applyAttributeMapping",value:function(e,t){var n;if(!e.scale)return[];var r=(null==e||null===(n=e.scale)||void 0===n?void 0:n.scalers)||[],i=[];return r.forEach((function(n){var r,o=n.field;(t.hasOwnProperty(o)||"variable"===(null===(r=e.scale)||void 0===r?void 0:r.type))&&i.push(t[o])})),e.mapping?e.mapping(i):[]}}]),e}()).prototype,"configService",[oL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fL=Rr(cL.prototype,"mapService",[aL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hL=Rr(cL.prototype,"fontService",[sL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uL=cL))||uL),vL={},gL={},mL=function(e){return gL[e]},yL=function(e,t){gL[e]=t},bL=function(e,t){vL[e]=t},_L={},xL={};function SL(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function wL(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function AL(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function TL(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":function(e){return e<0?"-"+AL(-e,6):e>9999?"+"+AL(e,6):AL(e,4)}(e.getUTCFullYear())+"-"+AL(e.getUTCMonth()+1,2)+"-"+AL(e.getUTCDate(),2)+(i?"T"+AL(t,2)+":"+AL(n,2)+":"+AL(r,2)+"."+AL(i,3)+"Z":r?"T"+AL(t,2)+":"+AL(n,2)+":"+AL(r,2)+"Z":n||t?"T"+AL(t,2)+":"+AL(n,2)+"Z":"")}var EL=function(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,i=[],o=e.length,a=0,s=0,u=o<=0,c=!1;function l(){if(u)return xL;if(c)return c=!1,_L;var t,r,i=a;if(34===e.charCodeAt(i)){for(;a++<o&&34!==e.charCodeAt(a)||34===e.charCodeAt(++a););return(t=a)>=o?u=!0:10===(r=e.charCodeAt(a++))?c=!0:13===r&&(c=!0,10===e.charCodeAt(a)&&++a),e.slice(i+1,t-1).replace(/""/g,'"')}for(;a<o;){if(10===(r=e.charCodeAt(t=a++)))c=!0;else if(13===r)c=!0,10===e.charCodeAt(a)&&++a;else if(r!==n)continue;return e.slice(i,t)}return u=!0,e.slice(i,o)}for(10===e.charCodeAt(o-1)&&--o,13===e.charCodeAt(o-1)&&--o;(r=l())!==xL;){for(var f=[];r!==_L&&r!==xL;)f.push(r),r=l();t&&null==(f=t(f,s++))||i.push(f)}return i}function i(t,n){return t.map((function(t){return n.map((function(e){return a(t[e])})).join(e)}))}function o(t){return t.map(a).join(e)}function a(e){return null==e?"":e instanceof Date?TL(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,i,o=r(e,(function(e,r){if(n)return n(e,r-1);i=e,n=t?function(e,t){var n=SL(e);return function(r,i){return t(n(r),i,e)}}(e,t):SL(e)}));return o.columns=i||[],o},parseRows:r,format:function(t,n){return null==n&&(n=wL(t)),[n.map(a).join(e)].concat(i(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=wL(e)),i(e,t).join("\n")},formatRows:function(e){return e.map(o).join("\n")},formatRow:o,formatValue:a}}(",").parse,CL=6378137;function ML(e){var t=0;if(e&&e.length>0){t+=Math.abs(kL(e[0]));for(var n=1;n<e.length;n++)t-=Math.abs(kL(e[n]))}return t}function kL(e){var t,n,r,i,o,a,s=0,u=e.length;if(u>2){for(a=0;a<u;a++)a===u-2?(r=u-2,i=u-1,o=0):a===u-1?(r=u-1,i=0,o=1):(r=a,i=a+1,o=a+2),t=e[r],n=e[i],s+=(OL(e[o][0])-OL(t[0]))*Math.sin(OL(n[1]));s=s*CL*CL/2}return s}function OL(e){return e*Math.PI/180}var IL={geometry:function e(t){var n,r=0;switch(t.type){case"Polygon":return ML(t.coordinates);case"MultiPolygon":for(n=0;n<t.coordinates.length;n++)r+=ML(t.coordinates[n]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<t.geometries.length;n++)r+=e(t.geometries[n]);return r}},ring:kL},PL=function e(t,n){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.map(LL(e,n)),t;case"GeometryCollection":return t.geometries=t.geometries.map(LL(e,n)),t;case"Feature":return t.geometry=e(t.geometry,n),t;case"Polygon":case"MultiPolygon":return function(e,t){"Polygon"===e.type?e.coordinates=RL(e.coordinates,t):"MultiPolygon"===e.type&&(e.coordinates=e.coordinates.map(LL(RL,t)));return e}(t,n);default:return t}};function LL(e,t){return function(n){return e(n,t)}}function RL(e,t){t=!!t,e[0]=NL(e[0],t);for(var n=1;n<e.length;n++)e[n]=NL(e[n],!t);return e}function NL(e,t){return function(e){return IL.ring(e)>=0}(e)===t?e:e.reverse()}function DL(e,t){var n=t.x,r=t.y,i=t.x1,o=t.y1,a=t.coordinates,s=[];return e.forEach((function(e,t){var u=[];(n&&r&&(u=[parseFloat(e[n]),parseFloat(e[r])]),n&&r&&i&&o)&&(u=[[parseFloat(e[n]),parseFloat(e[r])],[parseFloat(e[i]),parseFloat(e[o])]]);if(a){var c="Polygon";Array.isArray(a[0])||(c="Point"),Array.isArray(a[0])&&!Array.isArray(a[0][0])&&(c="LineString");var l={type:c,coordinates:kr(e[a])};PL(l,!0),u=l.coordinates}var f=cr(cr({},e),{},{_id:t,coordinates:u});s.push(f)})),{dataArray:s}}function FL(e,t,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function zL(e,t){!function(e,t){var n,r,i,o,a,s,u,c,l,f,h=0,d="FeatureCollection"===e.type,p="Feature"===e.type,v=d?e.features.length:1;for(n=0;n<v;n++){for(s=d?e.features[n].geometry:p?e.geometry:e,c=d?e.features[n].properties:p?e.properties:{},l=d?e.features[n].bbox:p?e.bbox:void 0,f=d?e.features[n].id:p?e.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<a;i++)if(null!==(o=u?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,h,c,l,f))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===t(o.geometries[r],h,c,l,f))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,h,c,l,f))return!1;h++}}(e,(function(e,n,r,i,o){var a,s=null===e?null:e.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return!1!==t(FL(e,r,{bbox:i,id:o}),n,0)&&void 0}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var u=0;u<e.coordinates.length;u++){var c=e.coordinates[u];if(!1===t(FL({type:a,coordinates:c},r),n,u))return!1}}))}function jL(e,t){var n=t.extent;return{images:new Promise((function(t){!function(e,t){var n=e,r=[];if("string"==typeof n)Uf({url:n},(function(e,n){r.push(n),t(r)}));else{var i=n.length,o=0;n.forEach((function(e){Uf({url:e},(function(e,n){o++,r.push(n),o===i&&t(r)}))}))}}(e,(function(e){t(e)}))})),_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]}}var UL=Xy((function(e,t,n,r){Fy(e,t,n,r)}));function BL(e,t){var n=t.radius,r=void 0===n?40:n,i=t.maxZoom,o=void 0===i?18:i,a=t.minZoom,s=void 0===a?0:a,u=t.zoom,c=void 0===u?2:u;if(e.pointIndex){var l=e.pointIndex.getClusters(e.extent,Math.floor(c));return e.dataArray=l.map((function(e,t){return cr({coordinates:e.geometry.coordinates,_id:t+1},e.properties)})),e}var f=new HA({radius:r,minZoom:s,maxZoom:o}),h={type:"FeatureCollection",features:[]};return h.features=e.dataArray.map((function(e){return{type:"Feature",geometry:{type:"Point",coordinates:e.coordinates},properties:cr({},e)}})),f.load(h.features),f}function VL(e){if(0===e.length)return 0;for(var t,n=e[0],r=0,i=1;i<e.length;i++)t=n+1*e[i],Math.abs(n)>=Math.abs(e[i])?r+=n-t+e[i]:r+=e[i]-t+n,n=t;return n+1*r}var HL={min:function(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return t},max:function(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return t},mean:function(e){if(0===e.length)throw new Error("mean requires at least one data point");return VL(e)/e.length},sum:VL};function GL(e,t){if(Array.isArray(t))return t}var WL=function(e){mr(n,e);var t=Er(n);function n(e,r){var i;return dr(this,n),gr(Ar(i=t.call(this)),"data",void 0),gr(Ar(i),"extent",void 0),gr(Ar(i),"hooks",{init:new D_}),gr(Ar(i),"parser",{type:"geojson"}),gr(Ar(i),"transforms",[]),gr(Ar(i),"cluster",!1),gr(Ar(i),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),gr(Ar(i),"mapService",void 0),gr(Ar(i),"invalidExtent",!1),gr(Ar(i),"originData",void 0),gr(Ar(i),"rawData",void 0),gr(Ar(i),"cfg",{}),gr(Ar(i),"clusterIndex",void 0),i.originData=e,i.initCfg(r),i.hooks.init.tap("parser",(function(){i.excuteParser()})),i.hooks.init.tap("cluster",(function(){i.initCluster()})),i.hooks.init.tap("transform",(function(){i.executeTrans()})),i.init(),i}return vr(n,[{key:"setData",value:function(e,t){this.rawData=e,this.originData=e,this.initCfg(t),this.init(),this.emit("update")}},{key:"getClusters",value:function(e){return this.clusterIndex.getClusters(this.caculClusterExtent(2),e)}},{key:"getClustersLeaves",value:function(e){return this.clusterIndex.getLeaves(e,1/0)}},{key:"updateClusterData",value:function(e){var t=this,n=this.clusterOptions,r=n.method,i=void 0===r?"sum":r,o=n.field,a=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(e));this.clusterOptions.zoom=e,a.forEach((function(e){e.id||(e.properties.point_count=1)})),(o||Jg(i))&&(a=a.map((function(e){var n=e.id;if(n){var r,a=t.clusterIndex.getLeaves(n,1/0).map((function(e){return e.properties}));if(Ik(i)&&o){var s=function(e,t){return e.map((function(e){return 1*e[t]}))}(a,o);r=HL[i](s)}Jg(i)&&(r=i(a)),e.properties.stat=r}else e.properties.point_count=1;return e}))),this.data=mL("geojson")({type:"FeatureCollection",features:a}),this.executeTrans()}},{key:"getFeatureById",value:function(e){var t=this.parser.type;if("geojson"!==(void 0===t?"geojson":t)||this.cluster)return e<this.data.dataArray.length?this.data.dataArray[e]:"null";var n=e<this.originData.features.length?this.originData.features[e]:"null",r=dL(n);if(0!==this.transforms.length){var i=this.data.dataArray.find((function(t){return t._id===e}));r.properties=i}return r}},{key:"getFeatureId",value:function(e,t){var n=this.data.dataArray.find((function(t){return t[e]===name}));return null==n?void 0:n._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(e){var t=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(t=bh(xh(this.extent),e)),t[0].concat(t[1])}},{key:"initCfg",value:function(e){this.cfg=UL(this.cfg,e,GL);var t=this.cfg;t&&(t.parser&&(this.parser=t.parser),t.transforms&&(this.transforms=t.transforms),this.cluster=t.cluster||!1,t.clusterOptions&&(this.cluster=!0,this.clusterOptions=cr(cr({},this.clusterOptions),t.clusterOptions)))}},{key:"excuteParser",value:function(){var e=this.parser,t=e.type||"geojson",n=mL(t);this.data=n(this.originData,e),this.extent=hh(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var e=this;this.transforms.forEach((function(t){var n=function(e){return vL[e]}(t.type)(e.data,t);Object.assign(e.data,n)}))}},{key:"initCluster",value:function(){if(this.cluster){var e=this.clusterOptions||{};this.clusterIndex=BL(this.data,e)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),n}(s);var ZL=ie.isFinite,YL=Number.isFinite||function(e){return"number"==typeof e&&ZL(e)};Lt({target:"Number",stat:!0},{isFinite:YL});var qL=Math.PI/3,XL=[0,qL,2*qL,3*qL,4*qL,5*qL];function KL(e){return e[0]}function QL(e){return e[1]}var JL;yL("geojson",(function(e,t){var n=[],r={};return e.features=e.features.filter((function(e){var t=e.geometry;return null!=e&&t&&t.type&&t.coordinates&&t.coordinates.length>0})),PL(e,!0),0===e.features.length?{dataArray:[],featureKeys:r}:(zL(e,(function(e,t){var r=function(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}(e),i=t,o=cr(cr({},e.properties),{},{coordinates:r,_id:i});n.push(o)})),{dataArray:n,featureKeys:r})})),yL("image",jL),yL("csv",(function(e,t){return DL(EL(e),t)})),yL("json",DL),yL("raster",(function(e,t){var n=t.extent,r=t.width,i=t.height,o=t.min,a=t.max;return{_id:1,dataArray:[{_id:1,data:Array.from(e),width:r,height:i,min:o,max:a,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]}})),bL("cluster",BL),bL("filter",(function(e,t){var n=t.callback;return n&&(e.dataArray=e.dataArray.filter(n)),e})),bL("join",(function(e,t){var n=t.sourceField,r=t.targetField,i=t.data,o={};return i.forEach((function(e){o[e[n]]=e})),e.dataArray=e.dataArray.map((function(e){var t=e[r];return cr(cr({},e),o[t])})),e})),bL("map",(function(e,t){var n=t.callback;return n&&(e.dataArray=e.dataArray.map(n)),e})),bL("grid",(function(e,t){var n=e.dataArray,r=t.size,i=void 0===r?10:r,o=i/(2*Math.PI*6378e3)*(256<<20)/2,a=function(e,t){var n,r,i=1/0,o=-1/0,a=Pr(e);try{for(a.s();!(r=a.n()).done;){var s=r.value;n=s.coordinates[1],Number.isFinite(n)&&(i=n<i?n:i,o=n>o?n:o)}}catch(e){a.e(e)}finally{a.f()}var u=function(e,t){var n=(i=e,i/6378e3*(180/Math.PI)),r=function(e,t){return t/6378e3*(180/Math.PI)/Math.cos(e*Math.PI/180)}(t,e);var i;return{yOffset:n,xOffset:r}}(t,(i+o)/2);if(u.xOffset<=0||u.yOffset<=0)return{gridHash:{},gridOffset:u};var c,l={},f=Pr(e);try{for(f.s();!(c=f.n()).done;){var h=c.value,d=h.coordinates[1],p=h.coordinates[0];if(Number.isFinite(d)&&Number.isFinite(p)){var v=Math.floor((d+90)/u.yOffset),g=Math.floor((p+180)/u.xOffset),m="".concat(v,"-").concat(g);l[m]=l[m]||{count:0,points:[]},l[m].count+=1,l[m].points.push(h)}}}catch(e){f.e(e)}finally{f.f()}return{gridHash:l,gridOffset:u}}(n,i);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:function(e,t,n){return Object.keys(e).reduce((function(r,i,o){var a=i.split("-"),s=parseInt(a[0],10),u=parseInt(a[1],10),c={};if(n.field&&n.method){var l=wd(e[i].points,n.field);c[n.method]=Sd[n.method](l)}return Object.assign(c,{_id:o,coordinates:mh([t.xOffset*(u+.5)-180,t.yOffset*(s+.5)-90]),rawData:e[i].points,count:e[i].count}),r.push(c),r}),[])}(a.gridHash,a.gridOffset,t)}})),bL("hexagon",(function(e,t){var n=e.dataArray,r=t.size,i=void 0===r?10:r,o=t.method,a=void 0===o?"sum":o,s=i/(2*Math.PI*6378e3)*(256<<20)/2,u=n.map((function(e){var t=Mr(mh(e.coordinates),2),n=t[0],r=t[1];return cr(cr({},e),{},{coordinates:[n,r]})}));return{dataArray:function(){var e,t,n,r=0,i=0,o=1,a=1,s=KL,u=QL;function c(e){var r,i={},o=[],a=e.length;for(r=0;r<a;++r)if(!isNaN(l=+s.call(null,c=e[r],r,e))&&!isNaN(f=+u.call(null,c,r,e))){var c,l,f,h=Math.round(f/=n),d=Math.round(l=l/t-(1&h)/2),p=f-h;if(3*Math.abs(p)>1){var v=l-d,g=d+(l<d?-1:1)/2,m=h+(f<h?-1:1),y=l-g,b=f-m;v*v+p*p>y*y+b*b&&(d=g+(1&h?1:-1)/2,h=m)}var _=d+"-"+h,x=i[_];x?x.push(c):(o.push(x=i[_]=[c]),x.x=(d+(1&h)/2)*t,x.y=h*n)}return o}function l(e){var t=0,n=0;return XL.map((function(r){var i=Math.sin(r)*e,o=-Math.cos(r)*e,a=i-t,s=o-n;return t=i,n=o,[a,s]}))}return c.hexagon=function(t){return"m"+l(null==t?e:+t).join("l")+"z"},c.centers=function(){for(var s=[],u=Math.round(i/n),c=Math.round(r/t),l=u*n;l<a+e;l+=n,++u)for(var f=c*t+(1&u)*t/2;f<o+t/2;f+=t)s.push([f,l]);return s},c.mesh=function(){var t=l(e).slice(0,4).join("l");return c.centers().map((function(e){return"M"+e+"m"+t})).join("")},c.x=function(e){return arguments.length?(s=e,c):s},c.y=function(e){return arguments.length?(u=e,c):u},c.radius=function(r){return arguments.length?(t=2*(e=+r)*Math.sin(qL),n=1.5*e,c):e},c.size=function(e){return arguments.length?(r=i=0,o=+e[0],a=+e[1],c):[o-r,a-i]},c.extent=function(e){return arguments.length?(r=+e[0][0],i=+e[0][1],o=+e[1][0],a=+e[1][1],c):[[r,i],[o,a]]},c.radius(1)}().radius(s).x((function(e){return e.coordinates[0]})).y((function(e){return e.coordinates[1]}))(u).map((function(e,n){var r;if(t.field&&a){var i=wd(e,t.field);e[a]=Sd[a](i)}return gr(r={},t.method,e[a]),gr(r,"count",e.length),gr(r,"rawData",e),gr(r,"coordinates",[e.x,e.y]),gr(r,"_id",n),r})),radius:s,xOffset:s,yOffset:s,type:"hexagon"}}));var $L=$()(JL=function(){function e(){dr(this,e),gr(this,"mapService",void 0)}return vr(e,[{key:"apply",value:function(e){var t=this;this.mapService=e.getContainer().get(sr.IMapService),e.hooks.init.tap("DataSourcePlugin",(function(){if(!e.getSource()){var n=e.sourceOption,r=n.data,i=n.options;e.setSource(new WL(r,i))}t.updateClusterData(e)})),e.hooks.beforeRenderData.tap("DataSourcePlugin",(function(){var n=t.updateClusterData(e),r=e.dataState.dataSourceNeedUpdate;return e.dataState.dataSourceNeedUpdate=!1,n||r}))}},{key:"updateClusterData",value:function(e){var t=e.getSource(),n=t.cluster,r=t.clusterOptions,i=r.zoom,o=void 0===i?0:i,a=r.maxZoom,s=void 0===a?16:a,u=this.mapService.getZoom()-1,c=e.dataState.dataSourceNeedUpdate;return!!(n&&(c||Math.abs(o-u)>1)&&s>o)&&(t.updateClusterData(Math.floor(u)),!0)}}]),e}())||JL;function eR(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function tR(e){return 1===e.length&&(e=function(e){return function(t,n){return eR(e(t),n)}}(e)),{left:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var o=r+i>>>1;e(t[o],n)<0?r=o+1:i=o}return r},right:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var o=r+i>>>1;e(t[o],n)>0?i=o:r=o+1}return r}}}var nR=tR(eR).right;function rR(e){return null===e?NaN:+e}var iR=Math.sqrt(50),oR=Math.sqrt(10),aR=Math.sqrt(2);function sR(e,t,n){var r,i,o,a,s=-1;if(n=+n,(e=+e)===(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(a=uR(e,t,n))||!isFinite(a))return[];if(a>0)for(e=Math.ceil(e/a),t=Math.floor(t/a),o=new Array(i=Math.ceil(t-e+1));++s<i;)o[s]=(e+s)*a;else for(e=Math.floor(e*a),t=Math.ceil(t*a),o=new Array(i=Math.ceil(e-t+1));++s<i;)o[s]=(e-s)/a;return r&&o.reverse(),o}function uR(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=iR?10:o>=oR?5:o>=aR?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=iR?10:o>=oR?5:o>=aR?2:1)}function cR(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=iR?i*=10:o>=oR?i*=5:o>=aR&&(i*=2),t<e?-i:i}function lR(e,t,n){if(null==n&&(n=rR),r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,o=Math.floor(i),a=+n(e[o],o,e);return a+(+n(e[o+1],o+1,e)-a)*(i-o)}}function fR(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function hR(){}function dR(e,t){var n=new hR;if(e instanceof hR)e.each((function(e,t){n.set(t,e)}));else if(Array.isArray(e)){var r,i=-1,o=e.length;if(null==t)for(;++i<o;)n.set(i,e[i]);else for(;++i<o;)n.set(t(r=e[i],i,e),r)}else if(e)for(var a in e)n.set(a,e[a]);return n}function pR(){}hR.prototype=dR.prototype={constructor:hR,has:function(e){return"$"+e in this},get:function(e){return this["$"+e]},set:function(e,t){return this["$"+e]=t,this},remove:function(e){var t="$"+e;return t in this&&delete this[t]},clear:function(){for(var e in this)"$"===e[0]&&delete this[e]},keys:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)"$"===t[0]&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)"$"===t[0]&&++e;return e},empty:function(){for(var e in this)if("$"===e[0])return!1;return!0},each:function(e){for(var t in this)"$"===t[0]&&e(this[t],t.slice(1),this)}};var vR=dR.prototype;pR.prototype=function(e,t){var n=new pR;if(e instanceof pR)e.each((function(e){n.add(e)}));else if(e){var r=-1,i=e.length;if(null==t)for(;++r<i;)n.add(e[r]);else for(;++r<i;)n.add(t(e[r],r,e))}return n}.prototype={constructor:pR,has:vR.has,add:function(e){return this["$"+(e+="")]=e,this},remove:vR.remove,clear:vR.clear,values:vR.keys,size:vR.size,empty:vR.empty,each:vR.each};var gR=Array.prototype,mR=gR.map,yR=gR.slice,bR={name:"implicit"};function _R(){var e=dR(),t=[],n=[],r=bR;function i(i){var o=i+"",a=e.get(o);if(!a){if(r!==bR)return r;e.set(o,a=t.push(i))}return n[(a-1)%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=dR();for(var r,o,a=-1,s=n.length;++a<s;)e.has(o=(r=n[a])+"")||e.set(o,t.push(r));return i},i.range=function(e){return arguments.length?(n=yR.call(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return _R(t,n).unknown(r)},fR.apply(i,arguments),i}function xR(e){return function(){return e}}function SR(e){return 1==(e=+e)?wR:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):xR(isNaN(t)?n:t)}}function wR(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):xR(isNaN(e)?t:e)}var AR=function e(t){var n=SR(t);function r(e,t){var r=n((e=Kh(e)).r,(t=Kh(t)).r),i=n(e.g,t.g),o=n(e.b,t.b),a=wR(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=o(t),e.opacity=a(t),e+""}}return r.gamma=e,r}(1);function TR(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(o){for(n=0;n<r;++n)i[n]=e[n]*(1-o)+t[n]*o;return i}}function ER(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,o=new Array(i),a=new Array(r);for(n=0;n<i;++n)o[n]=LR(e[n],t[n]);for(;n<r;++n)a[n]=t[n];return function(e){for(n=0;n<i;++n)a[n]=o[n](e);return a}}function CR(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function MR(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function kR(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=LR(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var OR=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,IR=new RegExp(OR.source,"g");function PR(e,t){var n,r,i,o=OR.lastIndex=IR.lastIndex=0,a=-1,s=[],u=[];for(e+="",t+="";(n=OR.exec(e))&&(r=IR.exec(t));)(i=r.index)>o&&(i=t.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:MR(n,r)})),o=IR.lastIndex;return o<t.length&&(i=t.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?u[0]?function(e){return function(t){return e(t)+""}}(u[0].x):function(e){return function(){return e}}(t):(t=u.length,function(e){for(var n,r=0;r<t;++r)s[(n=u[r]).i]=n.x(e);return s.join("")})}function LR(e,t){var n,r,i=typeof t;return null==t||"boolean"===i?xR(t):("number"===i?MR:"string"===i?(n=Zh(t))?(t=n,AR):PR:t instanceof Zh?AR:t instanceof Date?CR:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?ER:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?kR:MR:TR))(e,t)}function RR(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function NR(e){return+e}var DR=[0,1];function FR(e){return e}function zR(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function jR(e){var t,n=e[0],r=e[e.length-1];return n>r&&(t=n,n=r,r=t),function(e){return Math.max(n,Math.min(r,e))}}function UR(e,t,n){var r=e[0],i=e[1],o=t[0],a=t[1];return i<r?(r=zR(i,r),o=n(a,o)):(r=zR(r,i),o=n(o,a)),function(e){return o(r(e))}}function BR(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),o=new Array(r),a=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<r;)i[a]=zR(e[a],e[a+1]),o[a]=n(t[a],t[a+1]);return function(t){var n=nR(e,t,1,r)-1;return o[n](i[n](t))}}function VR(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function HR(){var e,t,n,r,i,o,a=DR,s=DR,u=LR,c=FR;function l(){return r=Math.min(a.length,s.length)>2?BR:UR,i=o=null,f}function f(t){return isNaN(t=+t)?n:(i||(i=r(a.map(e),s,u)))(e(c(t)))}return f.invert=function(n){return c(t((o||(o=r(s,a.map(e),MR)))(n)))},f.domain=function(e){return arguments.length?(a=mR.call(e,NR),c===FR||(c=jR(a)),l()):a.slice()},f.range=function(e){return arguments.length?(s=yR.call(e),l()):s.slice()},f.rangeRound=function(e){return s=yR.call(e),u=RR,l()},f.clamp=function(e){return arguments.length?(c=e?jR(a):FR,f):c!==FR},f.interpolate=function(e){return arguments.length?(u=e,l()):u},f.unknown=function(e){return arguments.length?(n=e,f):n},function(n,r){return e=n,t=r,l()}}function GR(e,t){return HR()(e,t)}function WR(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function ZR(e){return(e=WR(Math.abs(e)))?e[1]:NaN}var YR,qR=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function XR(e){if(!(t=qR.exec(e)))throw new Error("invalid format: "+e);var t;return new KR({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function KR(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function QR(e,t){var n=WR(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}XR.prototype=KR.prototype,KR.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var JR={"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return QR(100*e,t)},r:QR,s:function(e,t){var n=WR(e,t);if(!n)return e+"";var r=n[0],i=n[1],o=i-(YR=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+WR(e,Math.max(0,t+o-1))[0]},X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function $R(e){return e}var eN,tN,nN,rN=Array.prototype.map,iN=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function oN(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?$R:(t=rN.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,o=[],a=0,s=t[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(e.substring(i-=s,i+s)),!((u+=s+1)>r));)s=t[a=(a+1)%t.length];return o.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",o=void 0===e.currency?"":e.currency[1]+"",a=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?$R:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(rN.call(e.numerals,String)),u=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"-":e.minus+"",l=void 0===e.nan?"NaN":e.nan+"";function f(e){var t=(e=XR(e)).fill,n=e.align,f=e.sign,h=e.symbol,d=e.zero,p=e.width,v=e.comma,g=e.precision,m=e.trim,y=e.type;"n"===y?(v=!0,y="g"):JR[y]||(void 0===g&&(g=12),m=!0,y="g"),(d||"0"===t&&"="===n)&&(d=!0,t="0",n="=");var b="$"===h?i:"#"===h&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",_="$"===h?o:/[%p]/.test(y)?u:"",x=JR[y],S=/[defgprs%]/.test(y);function w(e){var i,o,u,h=b,w=_;if("c"===y)w=x(e)+w,e="";else{var A=(e=+e)<0||1/e<0;if(e=isNaN(e)?l:x(Math.abs(e),g),m&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),A&&0==+e&&"+"!==f&&(A=!1),h=(A?"("===f?f:c:"-"===f||"("===f?"":f)+h,w=("s"===y?iN[8+YR/3]:"")+w+(A&&"("===f?")":""),S)for(i=-1,o=e.length;++i<o;)if(48>(u=e.charCodeAt(i))||u>57){w=(46===u?a+e.slice(i+1):e.slice(i))+w,e=e.slice(0,i);break}}v&&!d&&(e=r(e,1/0));var T=h.length+e.length+w.length,E=T<p?new Array(p-T+1).join(t):"";switch(v&&d&&(e=r(E+e,E.length?p-w.length:1/0),E=""),n){case"<":e=h+e+w+E;break;case"=":e=h+E+e+w;break;case"^":e=E.slice(0,T=E.length>>1)+h+e+w+E.slice(T);break;default:e=E+h+e+w}return s(e)}return g=void 0===g?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),w.toString=function(){return e+""},w}return{format:f,formatPrefix:function(e,t){var n=f(((e=XR(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(ZR(t)/3))),i=Math.pow(10,-r),o=iN[8+r/3];return function(e){return n(i*e)+o}}}}function aN(e,t,n,r){var i,o=cR(e,t,n);switch((r=XR(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(ZR(t)/3)))-ZR(Math.abs(e)))}(o,a))||(r.precision=i),nN(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,ZR(t)-ZR(e))+1}(o,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(e){return Math.max(0,-ZR(Math.abs(e)))}(o))||(r.precision=i-2*("%"===r.type))}return tN(r)}function sN(e){var t=e.domain;return e.ticks=function(e){var n=t();return sR(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return aN(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i=t(),o=0,a=i.length-1,s=i[o],u=i[a];return u<s&&(r=s,s=u,u=r,r=o,o=a,a=r),(r=uR(s,u,n))>0?r=uR(s=Math.floor(s/r)*r,u=Math.ceil(u/r)*r,n):r<0&&(r=uR(s=Math.ceil(s*r)/r,u=Math.floor(u*r)/r,n)),r>0?(i[o]=Math.floor(s/r)*r,i[a]=Math.ceil(u/r)*r,t(i)):r<0&&(i[o]=Math.ceil(s*r)/r,i[a]=Math.floor(u*r)/r,t(i)),e},e}function uN(e,t){var n,r=0,i=(e=e.slice()).length-1,o=e[r],a=e[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),e[r]=t.floor(o),e[i]=t.ceil(a),e}function cN(e){return Math.log(e)}function lN(e){return Math.exp(e)}function fN(e){return-Math.log(-e)}function hN(e){return-Math.exp(-e)}function dN(e){return isFinite(e)?+("1e"+e):e<0?0:e}function pN(e){return function(t){return-e(-t)}}function vN(e){var t,n,r=e(cN,lN),i=r.domain,o=10;function a(){return t=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(o),n=function(e){return 10===e?dN:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(o),i()[0]<0?(t=pN(t),n=pN(n),e(fN,hN)):e(cN,lN),r}return r.base=function(e){return arguments.length?(o=+e,a()):o},r.domain=function(e){return arguments.length?(i(e),a()):i()},r.ticks=function(e){var r,a=i(),s=a[0],u=a[a.length-1];(r=u<s)&&(h=s,s=u,u=h);var c,l,f,h=t(s),d=t(u),p=null==e?10:+e,v=[];if(!(o%1)&&d-h<p){if(h=Math.round(h)-1,d=Math.round(d)+1,s>0){for(;h<d;++h)for(l=1,c=n(h);l<o;++l)if(!((f=c*l)<s)){if(f>u)break;v.push(f)}}else for(;h<d;++h)for(l=o-1,c=n(h);l>=1;--l)if(!((f=c*l)<s)){if(f>u)break;v.push(f)}}else v=sR(h,d,Math.min(d-h,p)).map(n);return r?v.reverse():v},r.tickFormat=function(e,i){if(null==i&&(i=10===o?".0e":","),"function"!=typeof i&&(i=tN(i)),e===1/0)return i;null==e&&(e=10);var a=Math.max(1,o*e/r.ticks().length);return function(e){var r=e/n(Math.round(t(e)));return r*o<o-.5&&(r*=o),r<=a?i(e):""}},r.nice=function(){return i(uN(i(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},r}function gN(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function mN(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function yN(e){return e<0?-e*e:e*e}function bN(e){var t=e(FR,FR),n=1;function r(){return 1===n?e(FR,FR):.5===n?e(mN,yN):e(gN(n),gN(1/n))}return t.exponent=function(e){return arguments.length?(n=+e,r()):n},sN(t)}eN=oN({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),tN=eN.format,nN=eN.formatPrefix;var _N=new Date,xN=new Date;function SN(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,o){var a,s=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return s;do{s.push(a=new Date(+n)),t(n,o),e(n)}while(a<n&&n<r);return s},i.filter=function(n){return SN((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return _N.setTime(+t),xN.setTime(+r),e(_N),e(xN),Math.floor(n(_N,xN))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e==0}:function(t){return i.count(0,t)%e==0}):i:null}),i}var wN=SN((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));wN.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?SN((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):wN:null};var AN=SN((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+1e3*t)}),(function(e,t){return(t-e)/1e3}),(function(e){return e.getUTCSeconds()})),TN=SN((function(e){e.setTime(e-e.getMilliseconds()-1e3*e.getSeconds())}),(function(e,t){e.setTime(+e+6e4*t)}),(function(e,t){return(t-e)/6e4}),(function(e){return e.getMinutes()})),EN=SN((function(e){e.setTime(e-e.getMilliseconds()-1e3*e.getSeconds()-6e4*e.getMinutes())}),(function(e,t){e.setTime(+e+36e5*t)}),(function(e,t){return(t-e)/36e5}),(function(e){return e.getHours()})),CN=SN((function(e){e.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+t)}),(function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5}),(function(e){return e.getDate()-1}));function MN(e){return SN((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/6048e5}))}var kN=MN(0),ON=MN(1),IN=(MN(2),MN(3),MN(4)),PN=(MN(5),MN(6),SN((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}))),LN=SN((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));LN.every=function(e){return isFinite(e=Math.floor(e))&&e>0?SN((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};var RN=SN((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/864e5}),(function(e){return e.getUTCDate()-1}));function NN(e){return SN((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/6048e5}))}var DN=NN(0),FN=NN(1),zN=(NN(2),NN(3),NN(4)),jN=(NN(5),NN(6),SN((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()})));function UN(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function BN(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function VN(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}jN.every=function(e){return isFinite(e=Math.floor(e))&&e>0?SN((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};var HN,GN,WN={"-":"",_:" ",0:"0"},ZN=/^\s*\d+/,YN=/^%/,qN=/[\\^$*+?|[\]().{}]/g;function XN(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(t)+i:i)}function KN(e){return e.replace(qN,"\\$&")}function QN(e){return new RegExp("^(?:"+e.map(KN).join("|")+")","i")}function JN(e){for(var t={},n=-1,r=e.length;++n<r;)t[e[n].toLowerCase()]=n;return t}function $N(e,t,n){var r=ZN.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function eD(e,t,n){var r=ZN.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function tD(e,t,n){var r=ZN.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function nD(e,t,n){var r=ZN.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function rD(e,t,n){var r=ZN.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function iD(e,t,n){var r=ZN.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function oD(e,t,n){var r=ZN.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function aD(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function sD(e,t,n){var r=ZN.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function uD(e,t,n){var r=ZN.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function cD(e,t,n){var r=ZN.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function lD(e,t,n){var r=ZN.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function fD(e,t,n){var r=ZN.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function hD(e,t,n){var r=ZN.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function dD(e,t,n){var r=ZN.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function pD(e,t,n){var r=ZN.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function vD(e,t,n){var r=ZN.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function gD(e,t,n){var r=YN.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function mD(e,t,n){var r=ZN.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function yD(e,t,n){var r=ZN.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function bD(e,t){return XN(e.getDate(),t,2)}function _D(e,t){return XN(e.getHours(),t,2)}function xD(e,t){return XN(e.getHours()%12||12,t,2)}function SD(e,t){return XN(1+CN.count(LN(e),e),t,3)}function wD(e,t){return XN(e.getMilliseconds(),t,3)}function AD(e,t){return wD(e,t)+"000"}function TD(e,t){return XN(e.getMonth()+1,t,2)}function ED(e,t){return XN(e.getMinutes(),t,2)}function CD(e,t){return XN(e.getSeconds(),t,2)}function MD(e){var t=e.getDay();return 0===t?7:t}function kD(e,t){return XN(kN.count(LN(e)-1,e),t,2)}function OD(e){var t=e.getDay();return t>=4||0===t?IN(e):IN.ceil(e)}function ID(e,t){return e=OD(e),XN(IN.count(LN(e),e)+(4===LN(e).getDay()),t,2)}function PD(e){return e.getDay()}function LD(e,t){return XN(ON.count(LN(e)-1,e),t,2)}function RD(e,t){return XN(e.getFullYear()%100,t,2)}function ND(e,t){return XN((e=OD(e)).getFullYear()%100,t,2)}function DD(e,t){return XN(e.getFullYear()%1e4,t,4)}function FD(e,t){var n=e.getDay();return XN((e=n>=4||0===n?IN(e):IN.ceil(e)).getFullYear()%1e4,t,4)}function zD(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+XN(t/60|0,"0",2)+XN(t%60,"0",2)}function jD(e,t){return XN(e.getUTCDate(),t,2)}function UD(e,t){return XN(e.getUTCHours(),t,2)}function BD(e,t){return XN(e.getUTCHours()%12||12,t,2)}function VD(e,t){return XN(1+RN.count(jN(e),e),t,3)}function HD(e,t){return XN(e.getUTCMilliseconds(),t,3)}function GD(e,t){return HD(e,t)+"000"}function WD(e,t){return XN(e.getUTCMonth()+1,t,2)}function ZD(e,t){return XN(e.getUTCMinutes(),t,2)}function YD(e,t){return XN(e.getUTCSeconds(),t,2)}function qD(e){var t=e.getUTCDay();return 0===t?7:t}function XD(e,t){return XN(DN.count(jN(e)-1,e),t,2)}function KD(e){var t=e.getUTCDay();return t>=4||0===t?zN(e):zN.ceil(e)}function QD(e,t){return e=KD(e),XN(zN.count(jN(e),e)+(4===jN(e).getUTCDay()),t,2)}function JD(e){return e.getUTCDay()}function $D(e,t){return XN(FN.count(jN(e)-1,e),t,2)}function eF(e,t){return XN(e.getUTCFullYear()%100,t,2)}function tF(e,t){return XN((e=KD(e)).getUTCFullYear()%100,t,2)}function nF(e,t){return XN(e.getUTCFullYear()%1e4,t,4)}function rF(e,t){var n=e.getUTCDay();return XN((e=n>=4||0===n?zN(e):zN.ceil(e)).getUTCFullYear()%1e4,t,4)}function iF(){return"+0000"}function oF(){return"%"}function aF(e){return+e}function sF(e){return Math.floor(+e/1e3)}!function(e){HN=function(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,o=e.days,a=e.shortDays,s=e.months,u=e.shortMonths,c=QN(i),l=JN(i),f=QN(o),h=JN(o),d=QN(a),p=JN(a),v=QN(s),g=JN(s),m=QN(u),y=JN(u),b={a:function(e){return a[e.getDay()]},A:function(e){return o[e.getDay()]},b:function(e){return u[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:bD,e:bD,f:AD,g:ND,G:FD,H:_D,I:xD,j:SD,L:wD,m:TD,M:ED,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:aF,s:sF,S:CD,u:MD,U:kD,V:ID,w:PD,W:LD,x:null,X:null,y:RD,Y:DD,Z:zD,"%":oF},_={a:function(e){return a[e.getUTCDay()]},A:function(e){return o[e.getUTCDay()]},b:function(e){return u[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:jD,e:jD,f:GD,g:tF,G:rF,H:UD,I:BD,j:VD,L:HD,m:WD,M:ZD,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:aF,s:sF,S:YD,u:qD,U:XD,V:QD,w:JD,W:$D,x:null,X:null,y:eF,Y:nF,Z:iF,"%":oF},x={a:function(e,t,n){var r=d.exec(t.slice(n));return r?(e.w=p[r[0].toLowerCase()],n+r[0].length):-1},A:function(e,t,n){var r=f.exec(t.slice(n));return r?(e.w=h[r[0].toLowerCase()],n+r[0].length):-1},b:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=y[r[0].toLowerCase()],n+r[0].length):-1},B:function(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=g[r[0].toLowerCase()],n+r[0].length):-1},c:function(e,n,r){return A(e,t,n,r)},d:cD,e:cD,f:vD,g:oD,G:iD,H:fD,I:fD,j:lD,L:pD,m:uD,M:hD,p:function(e,t,n){var r=c.exec(t.slice(n));return r?(e.p=l[r[0].toLowerCase()],n+r[0].length):-1},q:sD,Q:mD,s:yD,S:dD,u:eD,U:tD,V:nD,w:$N,W:rD,x:function(e,t,r){return A(e,n,t,r)},X:function(e,t,n){return A(e,r,t,n)},y:oD,Y:iD,Z:aD,"%":gD};function S(e,t){return function(n){var r,i,o,a=[],s=-1,u=0,c=e.length;for(n instanceof Date||(n=new Date(+n));++s<c;)37===e.charCodeAt(s)&&(a.push(e.slice(u,s)),null!=(i=WN[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(o=t[r])&&(r=o(n,i)),a.push(r),u=s+1);return a.push(e.slice(u,s)),a.join("")}}function w(e,t){return function(n){var r,i,o=VN(1900,void 0,1);if(A(o,e,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(t&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(r=BN(VN(o.y,0,1))).getUTCDay(),r=i>4||0===i?FN.ceil(r):FN(r),r=RN.offset(r,7*(o.V-1)),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(i=(r=UN(VN(o.y,0,1))).getDay(),r=i>4||0===i?ON.ceil(r):ON(r),r=CN.offset(r,7*(o.V-1)),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?BN(VN(o.y,0,1)).getUTCDay():UN(VN(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,BN(o)):UN(o)}}function A(e,t,n,r){for(var i,o,a=0,s=t.length,u=n.length;a<s;){if(r>=u)return-1;if(37===(i=t.charCodeAt(a++))){if(i=t.charAt(a++),!(o=x[i in WN?t.charAt(a++):i])||(r=o(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return b.x=S(n,b),b.X=S(r,b),b.c=S(t,b),_.x=S(n,_),_.X=S(r,_),_.c=S(t,_),{format:function(e){var t=S(e+="",b);return t.toString=function(){return e},t},parse:function(e){var t=w(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=S(e+="",_);return t.toString=function(){return e},t},utcParse:function(e){var t=w(e+="",!0);return t.toString=function(){return e},t}}}(e),GN=HN.format,HN.parse,HN.utcFormat,HN.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var uF,cF,lF,fF,hF,dF;function pF(e){return new Date(e)}function vF(e){return e instanceof Date?+e:+new Date(+e)}function gF(e,t,n,r,i,o,a,s,u){var c=GR(FR,FR),l=c.invert,f=c.domain,h=u(".%L"),d=u(":%S"),p=u("%I:%M"),v=u("%I %p"),g=u("%a %d"),m=u("%b %d"),y=u("%B"),b=u("%Y"),_=[[a,1,1e3],[a,5,5e3],[a,15,15e3],[a,30,3e4],[o,1,6e4],[o,5,3e5],[o,15,9e5],[o,30,18e5],[i,1,36e5],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,864e5],[r,2,1728e5],[n,1,6048e5],[t,1,2592e6],[t,3,7776e6],[e,1,31536e6]];function x(s){return(a(s)<s?h:o(s)<s?d:i(s)<s?p:r(s)<s?v:t(s)<s?n(s)<s?g:m:e(s)<s?y:b)(s)}function S(t,n,r,i){if(null==t&&(t=10),"number"==typeof t){var o=Math.abs(r-n)/t,a=tR((function(e){return e[2]})).right(_,o);a===_.length?(i=cR(n/31536e6,r/31536e6,t),t=e):a?(i=(a=_[o/_[a-1][2]<_[a][2]/o?a-1:a])[1],t=a[0]):(i=Math.max(cR(n,r,t),1),t=s)}return null==i?t:t.every(i)}return c.invert=function(e){return new Date(l(e))},c.domain=function(e){return arguments.length?f(mR.call(e,vF)):f().map(pF)},c.ticks=function(e,t){var n,r=f(),i=r[0],o=r[r.length-1],a=o<i;return a&&(n=i,i=o,o=n),n=(n=S(e,i,o,t))?n.range(i,o+1):[],a?n.reverse():n},c.tickFormat=function(e,t){return null==t?x:u(t)},c.nice=function(e,t){var n=f();return(e=S(e,n[0],n[n.length-1],t))?f(uN(n,e)):c},c.copy=function(){return VR(c,gF(e,t,n,r,i,o,a,s,u))},c}var mF,yF,bF,_F,xF,SF,wF,AF,TF,EF,CF=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,MF=(gr(uF={},e.ScaleTypes.LINEAR,(function e(){var t=GR(FR,FR);return t.copy=function(){return VR(t,e())},fR.apply(t,arguments),sN(t)})),gr(uF,e.ScaleTypes.POWER,(function e(){var t=bN(HR());return t.copy=function(){return VR(t,e()).exponent(t.exponent())},fR.apply(t,arguments),t})),gr(uF,e.ScaleTypes.LOG,(function e(){var t=vN(HR()).domain([1,10]);return t.copy=function(){return VR(t,e()).base(t.base())},fR.apply(t,arguments),t})),gr(uF,e.ScaleTypes.IDENTITY,(function e(t){var n;function r(e){return isNaN(e=+e)?n:e}return r.invert=r,r.domain=r.range=function(e){return arguments.length?(t=mR.call(e,NR),r):t.slice()},r.unknown=function(e){return arguments.length?(n=e,r):n},r.copy=function(){return e(t).unknown(n)},t=arguments.length?mR.call(t,NR):[0,1],sN(r)})),gr(uF,e.ScaleTypes.TIME,(function(){return fR.apply(gF(LN,PN,kN,CN,EN,TN,AN,wN,GN).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)})),gr(uF,e.ScaleTypes.QUANTILE,(function e(){var t,n=[],r=[],i=[];function o(){var e=0,t=Math.max(1,r.length);for(i=new Array(t-1);++e<t;)i[e-1]=lR(n,e/t);return a}function a(e){return isNaN(e=+e)?t:r[nR(i,e)]}return a.invertExtent=function(e){var t=r.indexOf(e);return t<0?[NaN,NaN]:[t>0?i[t-1]:n[0],t<i.length?i[t]:n[n.length-1]]},a.domain=function(e){if(!arguments.length)return n.slice();n=[];for(var t,r=0,i=e.length;r<i;++r)null==(t=e[r])||isNaN(t=+t)||n.push(t);return n.sort(eR),o()},a.range=function(e){return arguments.length?(r=yR.call(e),o()):r.slice()},a.unknown=function(e){return arguments.length?(t=e,a):t},a.quantiles=function(){return i.slice()},a.copy=function(){return e().domain(n).range(r).unknown(t)},fR.apply(a,arguments)})),gr(uF,e.ScaleTypes.QUANTIZE,(function e(){var t,n=0,r=1,i=1,o=[.5],a=[0,1];function s(e){return e<=e?a[nR(o,e,0,i)]:t}function u(){var e=-1;for(o=new Array(i);++e<i;)o[e]=((e+1)*r-(e-i)*n)/(i+1);return s}return s.domain=function(e){return arguments.length?(n=+e[0],r=+e[1],u()):[n,r]},s.range=function(e){return arguments.length?(i=(a=yR.call(e)).length-1,u()):a.slice()},s.invertExtent=function(e){var t=a.indexOf(e);return t<0?[NaN,NaN]:t<1?[n,o[0]]:t>=i?[o[i-1],r]:[o[t-1],o[t]]},s.unknown=function(e){return arguments.length?(t=e,s):s},s.thresholds=function(){return o.slice()},s.copy=function(){return e().domain([n,r]).range(a).unknown(t)},fR.apply(sN(s),arguments)})),gr(uF,e.ScaleTypes.THRESHOLD,(function e(){var t,n=[.5],r=[0,1],i=1;function o(e){return e<=e?r[nR(n,e,0,i)]:t}return o.domain=function(e){return arguments.length?(n=yR.call(e),i=Math.min(n.length,r.length-1),o):n.slice()},o.range=function(e){return arguments.length?(r=yR.call(e),i=Math.min(n.length,r.length-1),o):r.slice()},o.invertExtent=function(e){var t=r.indexOf(e);return[n[t-1],n[t]]},o.unknown=function(e){return arguments.length?(t=e,o):t},o.copy=function(){return e().domain(n).range(r).unknown(t)},fR.apply(o,arguments)})),gr(uF,e.ScaleTypes.CAT,_R),uF),kF=(cF=$(),lF=J(sr.IGlobalConfigService),cF((dF=Rr((hF=function(){function t(){dr(this,t),Lr(this,"configService",dF,this),gr(this,"scaleCache",{}),gr(this,"scaleOptions",{})}return vr(t,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tap("FeatureScalePlugin",(function(){n.scaleOptions=e.getScaleOptions();var t=r.getLayerStyleAttributes(),i=e.getSource().data.dataArray;0!==i.length&&n.caculateScalesForAttributes(t||[],i)})),e.hooks.beforeRenderData.tap("FeatureScalePlugin",(function(){n.scaleOptions=e.getScaleOptions();var t=r.getLayerStyleAttributes(),i=e.getSource().data.dataArray;return n.caculateScalesForAttributes(t||[],i),e.layerModelNeedUpdate=!0,!0})),e.hooks.beforeRender.tap("FeatureScalePlugin",(function(){if(!e.layerModelNeedUpdate){n.scaleOptions=e.getScaleOptions();var t=r.getLayerStyleAttributes();if(t){var i=e.getSource().data.dataArray;if(0===i.length)return;var o=t.filter((function(e){return e.needRescale}));o.length&&n.caculateScalesForAttributes(o,i)}}}))}},{key:"isNumber",value:function(e){return!isNaN(parseFloat(e))&&isFinite(e)}},{key:"caculateScalesForAttributes",value:function(t,n){var r=this;this.scaleCache={},t.forEach((function(t){if(t.scale){var i=t.scale,o=t.name;i.names=r.parseFields(t.scale.field||[]);var a=[];i.names.forEach((function(e){a.push(r.getOrCreateScale(e,t,n))})),a.some((function(t){return t.type===e.StyleScaleType.VARIABLE}))?(i.type=e.StyleScaleType.VARIABLE,a.forEach((function(e){var t;if(!i.callback)if(i.values&&"text"!==i.values){var n;if("linear"===(null===(n=e.option)||void 0===n?void 0:n.type)&&i.values.length>2){var r=e.scale.ticks(i.values.length);"color"===o&&e.scale.domain(r)}e.scale.range(i.values)}else"cat"===(null===(t=e.option)||void 0===t?void 0:t.type)&&e.scale.range(e.option.domain)}))):(i.type=e.StyleScaleType.CONSTANT,i.defaultValues=a.map((function(e,t){return e.scale(i.names[t])}))),i.scalers=a.map((function(e){return{field:e.field,func:e.scale,option:e.option}})),t.needRescale=!1}}))}},{key:"getOrCreateScale",value:function(e,t,n){[e,t.name].join("_");var r,i=null===(r=t.scale)||void 0===r?void 0:r.values;return this.createScale(e,t.name,i,n)}},{key:"parseFields",value:function(e){return Array.isArray(e)?e:Ik(e)?e.split("*"):[e]}},{key:"createScale",value:function(t,n,r,i){var o,a,s=this.scaleOptions[n]&&(null===(o=this.scaleOptions[n])||void 0===o?void 0:o.field)===t?this.scaleOptions[n]:this.scaleOptions[t],u={field:t,scale:void 0,type:e.StyleScaleType.VARIABLE,option:s};if(!i||!i.length)return s&&s.type?u.scale=this.createDefaultScale(s):(u.scale=_R([t]),u.type=e.StyleScaleType.CONSTANT),u;var c=null===(a=i.find((function(e){return!r_(e[t])})))||void 0===a?void 0:a[t];if(this.isNumber(t)||r_(c)&&!s)u.scale=_R([t]),u.type=e.StyleScaleType.CONSTANT;else{var l=s&&s.type||this.getDefaultType(c);"text"===r&&(l=e.ScaleTypes.CAT);var f=this.createDefaultScaleConfig(l,t,i);Object.assign(f,s),u.scale=this.createDefaultScale(f),u.option=f}return u}},{key:"getDefaultType",value:function(t){var n=e.ScaleTypes.LINEAR;return"string"==typeof t&&(n=CF.test(t)?e.ScaleTypes.TIME:e.ScaleTypes.CAT),n}},{key:"createDefaultScaleConfig",value:function(t,n,r){var i={type:t},o=(null==r?void 0:r.map((function(e){return e[n]})))||[];return t!==e.ScaleTypes.CAT&&t!==e.ScaleTypes.QUANTILE?i.domain=function(e,t){var n,r,i,o=e.length,a=-1;if(null==t){for(;++a<o;)if(null!=(n=e[a])&&n>=n)for(r=i=n;++a<o;)null!=(n=e[a])&&(r>n&&(r=n),i<n&&(i=n))}else for(;++a<o;)if(null!=(n=t(e[a],a,e))&&n>=n)for(r=i=n;++a<o;)null!=(n=t(e[a],a,e))&&(r>n&&(r=n),i<n&&(i=n));return[r,i]}(o):t===e.ScaleTypes.CAT?i.domain=Wx(o):t===e.ScaleTypes.QUANTILE&&(i.domain=o),i}},{key:"createDefaultScale",value:function(e){var t=e.type,n=e.domain,r=MF[t]();return n&&r.domain(n),r}}]),t}()).prototype,"configService",[lF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fF=hF))||fF),OF=(mF=$(),yF=J(sr.ICameraService),bF=J(sr.IRendererService),mF((SF=Rr((xF=function(){function e(){dr(this,e),Lr(this,"cameraService",SF,this),Lr(this,"rendererService",wF,this)}return vr(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("LayerAnimateStylePlugin",(function(){e.models.forEach((function(t){t.addUniforms(cr({},e.layerModel.getAnimateUniforms()))}))}))}}]),e}()).prototype,"cameraService",[yF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wF=Rr(xF.prototype,"rendererService",[bF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_F=xF))||_F),IF=$()(AF=function(){function e(){dr(this,e)}return vr(e,[{key:"apply",value:function(e){e.hooks.init.tap("LayerModelPlugin",(function(){e.prepareBuildModel(),e.buildModels(),e.styleNeedUpdate=!1})),e.hooks.beforeRenderData.tap("DataSourcePlugin",(function(){return e.prepareBuildModel(),e.clearModels(),e.buildModels(),e.layerModelNeedUpdate=!1,!1}))}}]),e}())||AF,PF=$()(TF=function(){function e(){dr(this,e)}return vr(e,[{key:"apply",value:function(e){e.hooks.afterInit.tap("LayerStylePlugin",(function(){e.updateLayerConfig({});var t=e.getLayerConfig(),n=t.autoFit,r=t.fitBoundsOptions;n&&setTimeout((function(){e.fitBounds(r)}),100)}))}}]),e}())||TF,LF=["type"],RF={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},NF={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},DF={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},FF={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};var zF,jF,UF,BF,VF,HF,GF,WF,ZF,YF,qF,XF,KF,QF,JF,$F=$()(EF=function(){function e(){dr(this,e)}return vr(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("LightingPlugin",(function(){e.getLayerConfig().enableLighting&&e.models.forEach((function(e){return e.addUniforms(cr({},(n={u_DirectionalLights:new Array(3).fill(cr({},DF)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(cr({},FF)),u_NumOfSpotLights:0},t&&t.length||(t=[NF]),t.forEach((function(e,t){var r=e.type,i=void 0===r?"directional":r,o=wr(e,LF),a=RF[i].lights,s=RF[i].num,u=n[s];n[a][u]=cr(cr({},n[a][u]),o),n[s]++})),n)));var t,n}))}))}}]),e}())||EF,ez=1,tz=2,nz=$()(zF=function(){function t(){dr(this,t)}return vr(t,[{key:"apply",value:function(t,n){n.rendererService;var r=n.styleAttributeService;t.hooks.init.tap("PixelPickingPlugin",(function(){var n=t.getLayerConfig().enablePicking;r.registerStyleAttribute({name:"pickingColor",type:e.AttributeType.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:e.gl.FLOAT},size:3,update:function(e,t){var r=e.id;return n?sd(r):[0,0,0]}}})})),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",(function(){t.getLayerConfig().enablePicking&&t.isVisible()&&t.models.forEach((function(e){return e.addUniforms({u_PickingStage:ez})}))})),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",(function(){t.getLayerConfig().enablePicking&&t.isVisible()&&t.models.forEach((function(e){return e.addUniforms({u_PickingStage:tz})}))})),t.hooks.beforeHighlight.tap("PixelPickingPlugin",(function(e){var n=t.getLayerConfig().highlightColor,r="string"==typeof n?od(n):n||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:ad(new Uint8Array(e))}),t.models.forEach((function(t){return t.addUniforms({u_PickingStage:tz,u_PickingColor:e,u_HighlightColor:r.map((function(e){return 255*e}))})}))})),t.hooks.beforeSelect.tap("PixelPickingPlugin",(function(e){var n=t.getLayerConfig().selectColor,r="string"==typeof n?od(n):n||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:ad(new Uint8Array(e))}),t.models.forEach((function(t){return t.addUniforms({u_PickingStage:tz,u_PickingColor:e,u_HighlightColor:r.map((function(e){return 255*e}))})}))}))}}]),t}())||zF,rz=$()(jF=function(){function t(){dr(this,t)}return vr(t,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tap("RegisterStyleAttributePlugin",(function(){n.registerBuiltinAttributes(r)}))}},{key:"registerBuiltinAttributes",value:function(t){t.registerStyleAttribute({name:"position",type:e.AttributeType.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}}}),t.registerStyleAttribute({name:"filter",type:e.AttributeType.Attribute,descriptor:{name:"filter",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t){return e.filter?[1]:[0]}}}),t.registerStyleAttribute({name:"color",type:e.AttributeType.Attribute,descriptor:{name:"a_Color",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:4,update:function(e,t){var n=e.color;return n&&n.length?n:[1,1,1,1]}}}),t.registerStyleAttribute({name:"vertexId",type:e.AttributeType.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){return[t]}}})}}]),t}())||jF,iz=(UF=$(),BF=J(sr.ICameraService),VF=J(sr.ICoordinateSystemService),HF=J(sr.IRendererService),GF=J(sr.IMapService),UF((YF=Rr((ZF=function(){function e(){dr(this,e),Lr(this,"cameraService",YF,this),Lr(this,"coordinateSystemService",qF,this),Lr(this,"rendererService",XF,this),Lr(this,"mapService",KF,this)}return vr(e,[{key:"apply",value:function(e){var t=this,n=this.mapService.version,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],i=[0,0];e.hooks.beforeRender.tap("ShaderUniformPlugin",(function(){t.coordinateSystemService.refresh(),"GAODE2.x"===n&&(r=t.mapService.map.customCoords.getMVPMatrix(),i=t.mapService.getCustomCoordCenter());var o=t.rendererService.getViewportSize(),a=o.width,s=o.height;e.models.forEach((function(n){var o;n.addUniforms((gr(o={},IA.ProjectionMatrix,t.cameraService.getProjectionMatrix()),gr(o,IA.ViewMatrix,t.cameraService.getViewMatrix()),gr(o,IA.ViewProjectionMatrix,t.cameraService.getViewProjectionMatrix()),gr(o,IA.Zoom,t.cameraService.getZoom()),gr(o,IA.ZoomScale,t.cameraService.getZoomScale()),gr(o,IA.FocalDistance,t.cameraService.getFocalDistance()),gr(o,IA.CameraPosition,t.cameraService.getCameraPosition()),gr(o,wb.CoordinateSystem,t.coordinateSystemService.getCoordinateSystem()),gr(o,wb.ViewportCenter,t.coordinateSystemService.getViewportCenter()),gr(o,wb.ViewportCenterProjection,t.coordinateSystemService.getViewportCenterProjection()),gr(o,wb.PixelsPerDegree,t.coordinateSystemService.getPixelsPerDegree()),gr(o,wb.PixelsPerDegree2,t.coordinateSystemService.getPixelsPerDegree2()),gr(o,wb.PixelsPerMeter,t.coordinateSystemService.getPixelsPerMeter()),gr(o,wb.Mvp,r),gr(o,"u_SceneCenterMKT",i),gr(o,"u_ViewportSize",[a,s]),gr(o,"u_DevicePixelRatio",window.devicePixelRatio),gr(o,"u_ModelMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),gr(o,"u_PickingBuffer",e.getLayerConfig().pickingBuffer||0),o))}))}))}}]),e}()).prototype,"cameraService",[BF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qF=Rr(ZF.prototype,"coordinateSystemService",[VF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XF=Rr(ZF.prototype,"rendererService",[HF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KF=Rr(ZF.prototype,"mapService",[GF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WF=ZF))||WF),oz=$()(QF=function(){function e(){dr(this,e)}return vr(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("UpdateModelPlugin",(function(){e.layerModel&&e.layerModel.needUpdate()}))}}]),e}())||QF,az=$()(JF=function(){function e(){dr(this,e)}return vr(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tap("UpdateStyleAttributePlugin",(function(){n.initStyleAttribute(e,{styleAttributeService:r})})),e.hooks.beforeRender.tap("UpdateStyleAttributePlugin",(function(){e.layerModelNeedUpdate||n.updateStyleAtrribute(e,{styleAttributeService:r})}))}},{key:"updateStyleAtrribute",value:function(e,t){var n=t.styleAttributeService,r=n.getLayerStyleAttributes()||[],i=n.getLayerStyleAttribute("filter"),o=n.getLayerStyleAttribute("shape");if(i&&i.needRegenerateVertices||o&&o.needRegenerateVertices)return e.layerModelNeedUpdate=!0,void r.forEach((function(e){return e.needRegenerateVertices=!1}));r.filter((function(e){return e.needRegenerateVertices})).forEach((function(t){n.updateAttributeByFeatureRange(t.name,e.getEncodedData(),t.featureRange.startIndex,t.featureRange.endIndex),t.needRegenerateVertices=!1}))}},{key:"initStyleAttribute",value:function(e,t){var n=t.styleAttributeService;(n.getLayerStyleAttributes()||[]).filter((function(e){return e.needRegenerateVertices})).forEach((function(t){n.updateAttributeByFeatureRange(t.name,e.getEncodedData(),t.featureRange.startIndex,t.featureRange.endIndex),t.needRegenerateVertices=!1}))}}]),e}())||JF;oA.bind(sr.ILayerPlugin).to($L).inRequestScope(),oA.bind(sr.ILayerPlugin).to(rz).inRequestScope(),oA.bind(sr.ILayerPlugin).to(kF).inRequestScope(),oA.bind(sr.ILayerPlugin).to(pL).inRequestScope(),oA.bind(sr.ILayerPlugin).to(PF).inRequestScope(),oA.bind(sr.ILayerPlugin).to(az).inRequestScope(),oA.bind(sr.ILayerPlugin).to(oz).inRequestScope(),oA.bind(sr.ILayerPlugin).to(kk).inRequestScope(),oA.bind(sr.ILayerPlugin).to(iz).inRequestScope(),oA.bind(sr.ILayerPlugin).to(OF).inRequestScope(),oA.bind(sr.ILayerPlugin).to($F).inRequestScope(),oA.bind(sr.ILayerPlugin).to(nz).inRequestScope(),oA.bind(sr.ILayerPlugin).to(IF).inRequestScope();e.BKDRHash=function(e){var t=0;e+="x";for(var n=Math.floor(65745979961613.07),r=0;r<e.length;r++)t>n&&(t=Math.floor(t/137)),t=131*t+e.charCodeAt(r);return t},e.BaseLayer=Wk,e.BasePostProcessingPass=Dw,e.CameraUniform=IA,e.CityBuildingLayer=VI,e.Control=RA,e.CoordinateUniform=wb,e.DOM=Va,e.GaodeMap=mE,e.GaodeMapV2=TE,e.HeatmapLayer=qI,e.ImageLayer=KI,e.LRUCache=Ch,e.Layers=NA,e.LineLayer=aP,e.Logo=DA,e.Map=rk,e.MapServiceEvent=OA,e.Mapbox=Ck,e.Marker=VA,e.MarkerLayer=GA,e.PointLayer=CP,e.PolygonLayer=OP,e.Popup=WA,e.RasterLayer=LP,e.Satistics=Td,e.Scale=FA,e.Scene=FT,e.SceneEventList=PA,e.TYPES=sr,e.Zoom=zA,e.aProjectFlat=mh,e.anchorTranslate=cd,e.applyAnchorClass=ld,e.bBoxToBounds=xh,e.bindAll=Mh,e.boundsContains=_h,e.container=oA,e.createLayerContainer=lA,e.createSceneContainer=cA,e.decodePickingColor=ad,e.djb2hash=function(e){for(var t=5381,n=(e=e.toString()).length;n;)t=33*t^e.charCodeAt(--n);return t>>>0},e.encodePickingColor=sd,e.extent=hh,e.generateColorRamp=ud,e.getArrayBuffer=jf,e.getImage=Uf,e.getJSON=function(e,t){var n=zf(e);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){t(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var r;try{r=JSON.parse(n.response)}catch(e){return t(e)}t(null,r)}else 401===n.status?t(new Ff("".concat(n.statusText),n.status,e.url)):t(new Ff(n.statusText,n.status,e.url))},n.send(),n},e.latitude=vh,e.lazyInject=sA,e.lazyMultiInject=function(e){var t=aA.lazyMultiInject(e);return function(e,n,r){t.call(this,e,n),r&&(r.initializer=function(){return e[n]})}},e.lngLatToMeters=dh,e.lnglatDistance=yh,e.longitude=ph,e.metersToLngLat=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=e[0],r=e[1],i=n/fh*180,o=r/fh*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),null!=t&&(i=Number(i.toFixed(t)),o=Number(o.toFixed(t))),3===e.length?[i,o,e[2]]:[i,o]},e.packCircleVertex=function(e){var t=e.color,n=e.radius,r=e.tileX,i=e.tileY,o=e.shape,a=e.opacity,s=e.stroke,u=e.strokeWidth,c=e.strokeOpacity,l=[],f=[],h=[],d=[MA(t[0],t[1]),MA(t[2],t[3])],p=[MA(s[0],s[1]),MA(s[2],s[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach((function(e){var t=Mr(e,2),s=t[0],v=t[1];l.push([].concat(d,[8388608*(s+1)+2097152*(v+1)+131072*wA(o)+n,524288*(r+512)+64*(i+512)])),f.push([].concat(p,[u,c])),h.push([a,0,0,0])})),{packedBuffer:l,packedBuffer2:f,packedBuffer3:h}},e.padBounds=bh,e.project=function(e){var t=Math.PI/180,n=85.0511287798,r=Math.max(Math.min(n,e[1]),-n),i=Math.sin(r*t);return[6378137*e[0]*t,6378137*Math.log((1+i)/(1-i))/2]},e.rgb2arr=od,e.tranfrormCoord=function(e,t){return function e(t,n){if(Array.isArray(t[0]))return t.map((function(t){return e(t,n)}));return n(t)}(e,t)},e.unProjectFlat=function(e){var t=.5/Math.PI,n=-.5/Math.PI,r=.5,i=Mr(e,2),o=i[0],a=i[1];return o=(o/(256<<20)-.5)/t,a=(a/(256<<20)-r)/n,a=2*(Math.atan(Math.pow(Math.E,a))-Math.PI/4),[o/(r=Math.PI/180),a/r]},e.validateLngLat=gh,e.version="2.5.7",Object.defineProperty(e,"__esModule",{value:!0})}));
